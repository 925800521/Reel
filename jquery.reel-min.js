/*
 Copyright (c) 2009-2011 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 jQuery Reel
 http://jquery.vostrel.cz/reel
 Version: 1.1.3-devel
 Updated: 2011-11-08

 Requires jQuery 1.4.2 or higher
*/
jQuery.reel||function(h,mb,qa,u){function F(i){return h.reel.instances.length?h.reel.instances.first().data(i):null}function nb(i){return h.reel.instances.push(i[0])&&i}function ob(i){return(h.reel.instances=h.reel.instances.not("#"+i.attr(U)))&&i}function ra(i){return pb&&"data:image/gif;base64,R0lGODlh"+i}function qb(i){return"<"+i+"/>"}function sa(i){return"."+i}function ta(i){return"http://code.vostrel.cz/"+i}function ua(i){return"url("+i+")"}function V(i,a,y){return W(i,Pa(a,y))}function rb(i){function a(){h.fn[this]||
(h.fn[this]=function(){return this})}h.each(i,a)}function va(i,a){return z(i)*(a?-1:1)}function ba(i){return i.originalEvent.touches[0]}h.reel={version:"1.1.3-devel",def:{footage:6,frame:1,frames:36,hint:"",horizontal:true,hotspot:u,indicator:0,klass:"",loops:true,reversed:u,spacing:0,stitched:0,suffix:"-reel",tooltip:"",area:u,brake:0.5,clickfree:false,cw:false,delay:-1,directional:false,draggable:true,entry:u,graph:u,image:u,images:[],inversed:false,laziness:6,monitor:u,opening:0,orbital:0,path:"",
preloader:4,rebound:0.5,revolution:u,row:1,rows:0,speed:0,step:u,steps:u,tempo:36,timeout:2,throwable:true,vertical:false,wheelable:true,attr:{},preload:"fidelity",scrollable:true,velocity:0}};h.fn.reel=function(i){var a=h.extend({},h.reel.def,i);i=function(f){var r=[];f.filter(sb).each(function(){var c=h(this),d=a.images.length&&a.images||a.image||a.attr.src||c.attr(Qa),v=ca(a.attr.width||c.css(Ra)),m=ca(a.attr.height||c.css(Sa));!d||d==Ta||!v||!m||r.push(c)});f.filter(sa(A)).each(function(){r.push(h(this).trigger("teardown"))});
return h(r)}(this);var y=[];a.reversed&&(a.cw=true);a.tooltip&&(a.hint=a.tooltip);a.hotspot&&(a.area=a.hotspot);i.each(function(){var f=h(this),r=f.data(),c=function(g,b){r[g]=b;f.trigger("store",[g,b]);return b},d=function(g){var b=r[g];f.trigger("recall",[g,b]);return b},v={setup:function(g){if(f.hasClass(A))return m.call(g);var b=f.attr(a.attr).attr(Qa),e=c(U,f.attr(U)||f.attr(U,A+"-"+ +new Date).attr(U)),k=f.attr("style"),j=h.extend({},f.data()),l=a.images,n=a.stitched,o=a.loops,q={x:ca(f.css(Ra)||
a.attr.width),y:ca(f.css(Sa)||a.attr.height)},B=c(Ua,a.orbital&&a.footage||a.rows<=1&&l.length||a.frames),D=n?1:Va(B/a.footage),X={display:"block",width:q.x,height:q.y};e="#"+e+a.suffix;var Wa=f.attr("class")||"",wa={position:"relative",width:q.x,height:q.y};wa=h(Y,{id:e.substr(1),"class":Wa+xa+tb,css:wa}).bind("openingDone",da);X=f.wrap(wa).attr({"class":A}).css(X).bind(v);y.push(nb(X)[0]);c(Xa,l.length&&l.length||a.image||b.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2"));c(Ya,[]);c(G,
a.frame);c(Za,a.spacing);c(P,q);c(p,0);c(ya,a.steps||a.frames);c(ea,a.revolution||n/2||q.x*2);c(za,D);c(fa,1/(B-(o&&!n?0:1)));c(ub,1/W(B,d(ya)));c(Aa,n);c($a,n-(o?0:q.x));c(ga,e);c(L,c(Ba,a.speed)<0);c(Q,a.velocity||0);c(R,a.vertical);c(E,(a.row-1)/(a.rows-1));c(ha,va(1,!a.cw&&!n));c(Z,false);c(ab,a.brake);c(Ca,!!a.orbital);c(H,a.tempo/(h.reel.lazy?a.laziness:1));c(ia,0);c(bb,{src:b,classes:Wa,style:k||Ta,data:j});I.bind(M,v.tick);m.call(g);f.trigger("start")},teardown:function(g){var b=f.data(bb);
f.parent().unbind("openingDone",da).children("img").unbind(s);f.unbind(s).unbind(v).attr({"class":b.classes,src:b.src,style:b.style}).removeClass(A);f.data(b.data).siblings().remove();f.unwrap();ob(f);ja();I.unbind(M,v.tick).unbind(M,v.opening_tick);ka.unbind(Da).unbind(Ea);m.call(g)},start:function(){var g=d(P),b=d(Ua),e=W(b,d(ya));e=c(p,1/e*((a.step||a.frame)-1));c(G,N(e*b)+1);f.attr("id");b=f.parent();e=h(Y,{"class":vb,css:{position:la,left:0,top:0,width:g.x,height:g.y,background:Fa,opacity:0}}).appendTo(b);
var k=!d(Z)||a.rows<=1||!a.orbital||a.scrollable;e=c(cb,h(a.area||e));if(h.reel.touchy){f.css({WebkitUserSelect:"none",WebkitBackgroundSize:a.images.length?"auto":d(Aa)&&d(Aa)+"px "+g.y+"px"||g.x*a.footage+"px "+g.y*d(za)*(a.rows||1)*(a.directional?2:1)+"px"});e.bind(wb,function(j){f.trigger("down",[ba(j).clientX,ba(j).clientY,true])}).bind(xb,function(j){f.trigger("pan",[ba(j).clientX,ba(j).clientY,true]);return!k}).bind(yb,function(){f.trigger("up",[true]);return false}).bind(zb,function(){f.trigger("up",
[true]);return false})}else e.css({cursor:"url("+db+"), "+Ga}).bind(a.wheelable?Ab:"",function(j,l){f.trigger("wheel",[l]);return false}).bind(Bb,function(){f.trigger("play")}).bind(a.clickfree?Cb:Db,function(j){if(j.which==1){f.trigger("down",[j.clientX,j.clientY]);return false}}).bind(a.clickfree?Eb:"",function(){f.trigger("up");return false}).disableTextSelect();a.hint&&e.attr(Fb,a.hint);a.monitor&&b.append(J=h(Y,{"class":Gb,css:{position:la,left:0,top:0}}))||(J=h());a.indicator&&b.append(C("x"));
a.rows>1&&a.indicator&&b.append(C("y"));f.trigger("preload")},preload:function(g){var b=d(P),e=f.parent(),k=d(Xa),j=a.images,l=h.reel.preload[a.preload]||h.reel.preload[h.reel.def.preload];l=!j.length?[k]:l(j,a,d);var n=[],o=f[0];o.frames=l.length;o.preloaded=0;f.trigger("stop");for(e.append(t=h(Y,{"class":Hb,css:{position:la,left:0,top:b.y-a.preloader,height:a.preloader,overflow:eb,backgroundColor:Fa}}));l.length;){var q=a.path+l.shift(),B=h(new Image).hide().attr({width:b.x,height:b.y}).bind("load"+
s,function(){o.preloaded++;h(this).unbind(s);t.css({width:1/o.frames*o.preloaded*b.x});if(o.frames==o.preloaded){t.remove();j.length||f.attr({src:Ib}).css({backgroundImage:ua(a.path+k)});f.trigger(a.rows>1&&!a.stitched?"rowChange":"frameChange").trigger("loaded").trigger("opening");m.call(g)}});e.append(B);n.push(q);setTimeout(function(D,X){return function(){D.attr({src:X})}}(B,q),0)}c(Ya,n)},tick:function(g){var b=d(Q);if(K){var e=b-d(ab)/F(H)*K;b=!(b*e<=0||b<z(e))&&c(Q,b>z(d(Ba))?e:(K=w=0))}J.text(d(a.monitor));
b&&K++;w&&w++;fb(0);Ha=true;if(w&&!b)return m.call(g);if(d(ma))return m.call(g,x());e=d(ha)*va(1,d(L));var k=(d(Ia)?b:z(d(Ba))+b)/F(H);b=d(p);e=c(p,b-k*e);m.call(g);e!=b&&f.trigger("fractionChange")},opening:function(){var g=a.entry||a.speed,b=d(p),e=a.opening;c(p,b-g*a.opening);c(ia,e*F(H));I.bind(M,v.opening_tick)},opening_tick:function(g){var b=(a.entry||a.speed)/F(H)*(a.cw?-1:1),e=d(p);c(p,e+b);b=c(ia,d(ia)-1);f.trigger("fractionChange");m.call(g);if(!(b>1)){I.unbind(M,v.opening_tick);f.trigger("openingDone")}},
play:function(g){var b=c(Ja,true);c(Ia,!b);$();m.call(g)},pause:function(g){c(Ja,false);x();m.call(g)},stop:function(g){var b=c(Ia,true);c(Ja,!b);m.call(g)},down:function(g,b,e,k){if(a.draggable){c(ma,d(G));c(Q,0);na=oa(b,e,d(p),d(ea),d(E));x();ja();if(!k){ka.css({cursor:ua(Jb)+", "+Ga}).bind(Ea,function(j){f.trigger("pan",[j.clientX,j.clientY]);m.call(j);return false});a.clickfree||ka.bind(Da,function(j){f.trigger("up");m.call(j)})}}m.call(g)},up:function(g,b){if(!a.draggable)return m.call(g);c(ma,
false);c(Z,false);var e=c(Q,!a.throwable?0:z(aa[0]+aa[1])/60);K=e?1:0;e?$():x();ja();!b&&ka.unbind(Da).unbind(Ea)&&d(cb).css({cursor:ua(db)+", "+Ga});m.call(g)},pan:function(g,b,e){if(a.draggable&&Ha){Ha=false;x();var k={x:b-na.x,y:e-na.y};if(z(k.x)>0||z(k.y)>0){na={x:b,y:e};var j=d(ea),l=d(gb),n=d(R),o=c(p,hb(n?e-l.y:b-l.x,d(Ka),j,d(La),d(Ma),d(ha)));c(Z,d(Z)||d(G)!=d(ma));(k=fb(n?k.y:k.x||0))&&c(L,k<0);if(a.orbital&&d(Ca)){c(R,z(e-l.y)>z(b-l.x));l=oa(b,e,o,j,d(E))}if(a.rows>1){k=d(P).y;n=d(ib);
var q=-n*k;c(E,h.reel.math.envelope(e-l.y,n,k,q,q+k,-1))}!(o%1)&&!a.loops&&oa(b,e,o,j,d(E));f.trigger("fractionChange")}}m.call(g)},wheel:function(g,b){var e=Va(Kb(z(b))/2);e=va(e,b>0);b=0.2*d(ea);oa(u,u,d(p),b,d(E));c(p,hb(e,d(Ka),b,d(La),d(Ma),d(ha)));e&&c(L,e<0);c(Q,0);x();m.call(g);f.trigger("fractionChange");return false},fractionChange:function(g,b){b=!b?d(p):c(p,b);b=c(p,a.loops?b-S(b):V(0,1,b));var e=c(G,1+S(b/d(fa))),k=a.rows>1,j=a.orbital;c(Ca,!!j&&(e<=j||e>=a.footage-j+2));if(!a.loops&&
a.rebound){!w&&!(b%1)?Na++:(Na=0);Na>=a.rebound*1E3/F(H)&&c(L,!d(L))}f.trigger(k?"rowChange":"frameChange");m.call(g)},rowChange:function(g,b){var e=d(p)/d(fa)+1;b=c(E,V(0,1,b!=u?(b-1)/(a.rows-1):d(E)));b=V(0,a.rows-1,S(b*a.rows));c(G,S(e+b*a.frames));m.call(g);f.trigger("frameChange")},frameChange:function(g,b){var e=!b?d(p):c(p,d(fa)*(b-1)),k=d(jb);b=c(jb,c(G,N(b?b:d(G))));var j=a.images,l=a.footage,n=d(P),o=a.rows>1,q=a.horizontal;if(d(R)){b=a.inversed?l+1-b:b;b+=l}var B=(d(R)?n.y:n.x)-a.indicator,
D=V(0,B,N(h.reel.math.interpolate(d(p),-1,B+2)));D=!a.cw||a.stitched?D:B-D;h(sa(Oa+".x"),d(ga)).css(d(R)?{left:0,top:D}:{left:D,top:n.y-a.indicator});if(o){o=n.y-a.indicator;o=V(0,o,N(h.reel.math.interpolate(d(E),-1,o+2)));h(sa(Oa+".y"),d(ga)).css({top:o})}if(b!=k){h(d(ga)).removeClass(kb+k).addClass(kb+b);if(j.length)f.attr({src:a.path+j[b-1]});else{if(a.stitched)j=[-N(e*d($a))+T,0+T];else{e=b%l-1;e=e<0?l-1:e;l=S((b-0.1)/l);l+=a.rows>1?0:d(L)?0:d(za);b=d(Za);l=l*((q?n.y:n.x)+b);n=e*((q?n.x:n.y)+
b);j=j.length?[0,0]:q?[-n+T,-l+T]:[-l+T,-n+T]}f.css({backgroundPosition:j.join(xa)})}}m.call(g)}},m=function(g){lb||delete this;return g},w,K=0,$=function(){return w=0},x=function(){clearTimeout(O);I.unbind(M,v.opening_tick);f.trigger("play");return w=-a.timeout*F(H)},O,da=function(){O=setTimeout(function(){f.trigger("play")},a.delay*1E3||0)},J,t,C=function(g){return h(Y,{"class":[Oa,g].join(xa),css:{width:a.indicator,height:a.indicator,overflow:eb,top:d(P).y-a.indicator,left:0,position:la,backgroundColor:Fa}})},
Na=0,na={x:0,y:0},fb=function(g){return aa.push(g)&&aa.shift()&&g},ja=function(){return aa=[0,0]},aa=ja(),hb=a.graph||h.reel.math[a.loops?"hatch":"envelope"],oa=function(g,b,e,k,j){c(Ka,e);c(ib,j);c(La,a.loops?0:-e*k);c(Ma,a.loops?k:k-e*k);return g&&c(gb,{x:g,y:b})||u},Ha=true,ka=h.browser.opera?I:h.unique(I.add(mb.top.document));v.setup()});pa=pa||function f(){var r=+new Date,c=F(H);if(c){I.trigger(M);h.reel.cost=(+new Date+h.reel.cost-r)/2;return pa=setTimeout(f,W(4,1E3/c-h.reel.cost))}else return pa=
u}();return h(y)};h.reel.math={envelope:function(i,a,y,f,r,c){return a+W(f,Pa(r,-i*c))/y},hatch:function(i,a,y,f,r,c){i=(i<f?r:0)+i%r;i=a+-i*c/y;return i-S(i)},interpolate:function(i,a,y){return a+i*(y-a)}};h.reel.preload={linear:function(i){return i},fidelity:function(i,a){function y(m,w,K){function $(C){for(;!(C>=1&&C<=J);)C+=C<1?+J:-J;return v[K+C]||(v[K+C]=!!x.push(C))}if(!m.length)return[];var x=[],O=4*w,da=a.frame,J=m.length;w=J/O;for(var t=0;t<O;t++)$(da+N(t*w));for(;w>1;){t=0;O=x.length;for(w/=
2;t<O;t++)$(N(x[t]+w))}for(t=0;t<x.length;t++)x[t]=m[x[t]-1];return x}var f=a.orbital?2:a.rows||1,r=a.orbital?a.footage:a.frames,c=(a.row-1)*r,d=[].concat(i),v=new Array(i.length);i=f<2?[]:d.slice(c,c+r);return y(i,1,c).concat(y(d,f,0))}};h.reel.touchy=/iphone|ipod|ipad|android/i.test(navigator.userAgent);h.reel.lazy=/iphone|ipod|android/i.test(navigator.userAgent);h.reel.instances=h();h.reel.cost=0;h.reel.leader=F;rb("mousewheel disableTextSelect enableTextSelect".split(/ /));var I=h(qa);qa=+h.browser.version.split(".").slice(0,
2).join(".");var lb=h.browser.msie,pb=!(lb&&qa<8),Ga="ew-resize",pa,A="jquery-reel",tb=A+"-overlay",Oa=A+"-indicator",Hb=A+"-preloader",Gb=A+"-monitor",vb=A+"-interface",kb="frame-",Ib=ra("CAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7")||ta("blank.gif"),db=ra("EAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAI3lC8AeBDvgosQxQtne7yvLWGStVBelXBKqDJpNzLKq3xWBlU2nUs4C/O8cCvU0EfZGUwt19FYAAA7")||ta("jquery.reel.cursor-drag.gif"),Jb=ra("EAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAIslI95EB3MHECxNjBVdE/5b2zcRV1QBabqhwltq41St4hj5konmVioZ6OtEgUAOw==")||
ta("jquery.reel.cursor-drag-down.gif"),N=Math.round,S=Math.floor,Va=Math.ceil,Pa=Math.min,W=Math.max,z=Math.abs,Kb=Math.sqrt,ca=parseInt,cb="area",bb="backup",L="backwards",fa="bit",ab="brake",Ca="center",ma="clicked",gb="clicked_location",Ka="clicked_on",ib="clicked_row",ha="cwish",P="dimensions",p="fraction",G="frame",jb="_frame",Ua="frames",Ma="hi",eb="hidden",Xa="image",Ya="images",ia="opening_ticks",La="lo",Ja="playing",Z="reeling",ea="revolution",E="row",za="rows",Za="spacing",Ba="speed",ga=
"stage",ya="steps",Aa="stitched",$a="stitched_travel",Ia="stopped",H="tempo",Q="velocity",R="vertical",ub="wheel_step",s=".reel",Bb="dblclick"+s,Db="mousedown"+s,Cb="mouseenter"+s,Eb="mouseleave"+s,Ea="mousemove"+s,Da="mouseup"+s,Ab="mousewheel"+s,M="tick"+s,zb="touchcancel"+s,yb="touchend"+s,wb="touchstart"+s,xb="touchmove"+s,Ta="",xa=" ",la="absolute",Y=qb("div"),Sa="height",Fa="#000",U="id",sb="img",T="px",Qa="src",Fb="title",Ra="width"}(jQuery,window,document);
