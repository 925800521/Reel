/*
 Copyright (c) 2009-2011 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 jQuery Reel
 http://jquery.vostrel.cz/reel
 Version: 1.1.3-devel
 Updated: 2011-11-27

 Requires jQuery 1.4.3 or higher
*/
jQuery.reel||function(f,zb,xa,q){function K(e){return f.reel.instances.length?f.reel.instances.first().data(e):null}function Ab(e){return f.reel.instances.push(e[0])&&e}function Bb(e){return(f.reel.instances=f.reel.instances.not(ba(e.attr(ca))))&&e}function ya(e){return Cb&&"data:image/gif;base64,R0lGODlh"+e}function za(e){return"<"+e+"/>"}function z(e){return"."+e}function Aa(e){return"http://code.vostrel.cz/"+e}function Wa(e){return"url("+e+")"}function U(e,a,n){return da(e,Xa(a,n))}function Db(e){function a(){f.fn[this]||
(f.fn[this]=function(){return this})}f.each(e,a)}function Ba(e,a){return E(e)*(a?-1:1)}function la(e){return e.originalEvent.touches[0]}function ea(e){return e===q||typeof e=="string"?e:e+"px"}function ba(e){return"#"+e}function Eb(e){var a=[];f.each(e,function(n,h){a.push(n.replace(/([A-Z])/g,"-$1").toLowerCase()+":"+ea(h))});return"{"+a.join(";")+";}"}function Fb(){var e=f().jquery.split(".");(e=+e[0]<=1&&(+e[1]<4||+e[1]==4&&+e[2]<3))&&console.error("FATAL: jQuery Reel plug-in requires at least jQuery 1.4.3");
return e}if(!Fb()){f.reel={version:"1.1.3-devel",def:{area:q,brake:0.5,clickfree:false,cw:false,delay:-1,directional:false,draggable:true,footage:6,entry:q,frame:1,frames:36,graph:q,hint:"",horizontal:true,image:q,images:[],indicator:0,inversed:false,klass:"",laziness:6,loops:true,monitor:q,opening:0,orbital:0,path:"",preloader:4,rebound:0.5,revolution:q,row:1,rows:0,spacing:0,speed:0,step:q,steps:q,stitched:0,suffix:"-reel",tempo:36,timeout:2,throwable:true,vertical:false,wheelable:true,annotations:q,
attr:{},crop:true,preload:"fidelity",scrollable:true,steppable:true,velocity:0}};f.fn.reel=function(e){var a=f.extend({},f.reel.def,e);e=function(h){var t=[];h.filter(Ca).each(function(){var d=f(this),c=a.images.length&&a.images||a.image||a.attr.src||d.attr(Ya),A=ma(a.attr.width||d.css(Za)),o=ma(a.attr.height||d.css($a));!c||c==ab||!A||!o||t.push(d)});h.filter(z(w)).each(function(){t.push(f(this).unreel())});return f(t)}(this);var n=[];a.tooltip&&(a.hint=a.tooltip);a.hotspot&&(a.area=a.hotspot);e.each(function(){var h=
f(this),t=h.data(),d=function(g,b){t[g]=b;h.trigger("store",[g,b]);return b},c=function(g){var b=t[g];h.trigger("recall",[g,b]);return b},A={setup:function(g){if(h.hasClass(w))return o.call(g);var b=h.attr(a.attr).attr(Ya),i=d(ca,h.attr(ca)||h.attr(ca,w+"-"+ +new Date).attr(ca)),k=h.attr("style"),j=f.extend({},h.data()),l=a.images,m=a.stitched,p=a.loops,x={x:ma(h.css(Za)||a.attr.width),y:ma(h.css($a)||a.attr.height)},F=d(Da,a.orbital&&a.footage||a.rows<=1&&l.length||a.frames),P=m?1:bb(F/a.footage);
i=ba(i+a.suffix);var G=h.attr("class")||"",Q=f(V,{id:i.substr(1),"class":G+B+Gb});Q=h.wrap(Q.addClass(a.klass)).attr({"class":w});n.push(Ab(Q)[0]);Q=Q.parent().bind(A.instance);d(cb,l.length&&l.length||a.image||b.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2"));d(db,[]);d(H,a.frame);d(eb,a.spacing);d(R,x);d(r,0);d(Ea,a.steps||a.frames);d(na,a.revolution||m/2||x.x*2);d(Fa,P);d(W,1/(F-(p&&!m?0:1)));d(Hb,1/da(F,c(Ea)));d(Ga,m);d(fb,m-(p?0:x.x));d(Ha,i);d(I,d(Ia,a.speed)<0);d(X,a.velocity||
0);d(Y,a.vertical);d(J,(a.row-1)/(a.rows-1));d(Z,Ba(1,!a.cw&&!m));d(fa,false);d(gb,a.brake);d(Ja,!!a.orbital);d(L,a.tempo/(f.reel.lazy?a.laziness:1));d(ga,q);d(hb,{src:b,classes:G,style:k||ab,data:j});a.steppable||Q.unbind("click.steppable");a.annotations||Q.unbind(".annotations");C(true,"",{width:x.x,height:x.y});C(true,","+B+z(w),{display:"block",position:"relative"});S.bind(A.pool);o.call(g);h.trigger("setup")},instance:{teardown:function(g){var b=h.data(hb);h.parent().unbind(A.instance).children(Ca).unbind(v);
c(ib).remove();h.unbind(v).attr({"class":b.classes,src:b.src,style:b.style}).removeClass(w);h.data(b.data).siblings().remove();h.unwrap();Bb(h);oa();S.unbind(A.pool);pa.unbind(Ka).unbind(La);o.call(g)},start:function(){var g=c(R),b=c(Da),i=da(b,c(Ea));i=d(r,1/i*((a.step||a.frame)-1));d(H,T(i*b)+1);h.attr("id");b=h.parent();var k=!c(fa)||a.rows<=1||!a.orbital||a.scrollable;i=d(Ma,f(a.area||b));if(f.reel.touchy){C(true,B+z(w),{WebkitUserSelect:"none",WebkitBackgroundSize:a.images.length?"auto":c(Ga)&&
c(Ga)+"px "+g.y+"px"||g.x*a.footage+"px "+g.y*c(Fa)*(a.rows||1)*(a.directional?2:1)+"px"});i.bind(Ib,function(j){h.trigger("down",[la(j).clientX,la(j).clientY,true])}).bind(Jb,function(j){h.trigger("pan",[la(j).clientX,la(j).clientY,true]);return!k}).bind(Kb,function(){h.trigger("up",[true]);return false}).bind(Lb,function(){h.trigger("up",[true]);return false})}else{C(true,"",{cursor:"url("+Mb+"), "+jb});i.bind(a.wheelable?Nb:"",function(j,l){h.trigger("wheel",[l]);return false}).bind(a.clickfree?
Ob:Pb,function(j){if(!j.button){h.trigger("down",[j.clientX,j.clientY]);return false}}).bind(a.clickfree?Qb:"",function(){h.trigger("up");return false}).disableTextSelect()}a.hint&&i.attr(Rb,a.hint);a.monitor&&b.append(M=f(V,{"class":kb}))||(M=f());C(true,B+z(kb),{position:ha,left:0,top:0});C(true,B+z(lb),{display:"none"});C(true,B+z(mb),{position:ha,left:0,top:g.y-a.preloader,height:a.preloader,overflow:nb,backgroundColor:ob});C(true,z(Na),{cursor:Wa(Sb)+", "+jb});a.indicator&&b.append(pb("x"));
a.rows>1&&a.indicator&&b.append(pb("y"))},preload:function(g){var b=c(R),i=h.parent(),k=c(cb),j=a.images,l=f.reel.preload[a.preload]||f.reel.preload[f.reel.def.preload];l=!j.length?[k]:l(j,a,c);var m=[],p=h[0];p.frames=l.length;p.preloaded=0;h.trigger("stop");for(i.append(D=f(V,{"class":mb}));l.length;){var x=a.path+l.shift(),F=f(new Image).addClass(lb).attr({width:b.x,height:b.y}).bind("load"+v,function(){p.preloaded++;f(this).unbind(v);D.css({width:1/p.frames*p.preloaded*b.x});if(p.frames==p.preloaded){D.remove();
j.length||h.attr({src:Tb}).css({backgroundImage:Wa(a.path+k)});h.trigger("loaded");o.call(g)}});i.append(F);m.push(x);setTimeout(function(P,G){return function(){P.attr({src:G})}}(F,x),0)}d(db,m);d(ib,f('<style type="text/css">'+qb.join("\n")+"</style>").insertBefore(f("head link, head style").first()))},opening:function(){var g=a.entry||a.speed,b=c(r),i=a.opening;d(r,b-g*a.opening);d(ga,i*K(L))},openingDone:function(){qa=setTimeout(function(){h.trigger("play")},a.delay*1E3||0)},play:function(g){var b=
d(Oa,true);d(Pa,!b);ia();o.call(g)},pause:function(g){d(Oa,false);u();o.call(g)},stop:function(g){var b=d(Pa,true);d(Oa,!b);o.call(g)},down:function(g,b,i,k){if(a.draggable){d(ra,c(H));d(X,0);sa=ta(b,i,c(r),c(na),c(J));u();oa();N=false;c(Ma).addClass(Na);if(!k){pa.bind(La,function(j){h.trigger("pan",[j.clientX,j.clientY]);o.call(j);return false});a.clickfree||pa.bind(Ka,function(j){h.trigger("up");o.call(j)})}}o.call(g)},up:function(g,b){if(!a.draggable)return o.call(g);d(ra,false);d(fa,false);var i=
d(X,!a.throwable?0:E(ja[0]+ja[1])/60);O=i?1:0;i?ia():u();oa();c(Ma).removeClass(Na);!b&&pa.unbind(Ka).unbind(La);o.call(g)},pan:function(g,b,i){if(a.draggable&&Qa){Qa=false;u();var k={x:b-sa.x,y:i-sa.y};if(E(k.x)>0||E(k.y)>0){N=true;sa={x:b,y:i};var j=c(na),l=c(rb),m=c(Y),p=d(r,sb(m?i-l.y:b-l.x,c(Ra),j,c(Sa),c(Ta),c(Z)));d(fa,c(fa)||c(H)!=c(ra));(k=tb(m?k.y:k.x||0))&&d(I,k<0);if(a.orbital&&c(Ja)){d(Y,E(i-l.y)>E(b-l.x));l=ta(b,i,p,j,c(J))}if(a.rows>1){k=c(R).y;m=c(ub);var x=-m*k;d(J,f.reel.math.envelope(i-
l.y,m,k,x,x+k,-1))}!(p%1)&&!a.loops&&ta(b,i,p,j,c(J));h.trigger("fractionChange")}}o.call(g)},wheel:function(g,b){var i=bb(Ub(E(b))/2);i=Ba(i,b>0);b=0.2*c(na);ta(q,q,c(r),b,c(J));d(r,sb(i,c(Ra),b,c(Sa),c(Ta),c(Z)));i&&d(I,i<0);d(X,0);u();o.call(g);h.trigger("fractionChange");return false},fractionChange:function(g,b){b=d(r,ua.fraction(b,a,c));var i=d(H,1+$(b/c(W))),k=a.rows>1,j=a.orbital;d(Ja,!!j&&(i<=j||i>=a.footage-j+2));if(!a.loops&&a.rebound){!y&&!(b%1)?Ua++:(Ua=0);Ua>=a.rebound*1E3/K(L)&&d(I,
!c(I))}h.trigger(k?"rowChange":"frameChange");o.call(g)},rowChange:function(g,b){var i=c(r)/c(W)+1;b=d(J,ua.row(b,a,c));b=U(0,a.rows-1,$(b*a.rows));d(H,$(i+b*a.frames));o.call(g);h.trigger("frameChange")},frameChange:function(g,b){var i=d(r,ua.fraction(!b?q:c(W)*(b-1),a,c)),k=c(vb);b=ua.frame(b,a,c);var j=a.images,l=a.footage,m=c(R),p=a.rows>1,x=c(Ha),F=a.horizontal;if(c(Y)){b=a.inversed?l+1-b:b;b+=l}b=d(vb,d(H,b));var P=(c(Y)?m.y:m.x)-a.indicator,G=U(0,P,T(f.reel.math.interpolate(c(r),-1,P+2)));
G=!a.cw||a.stitched?G:P-G;f(z(va+".x"),x).css(c(Y)?{left:0,top:G}:{left:G,top:m.y-a.indicator});if(p){p=m.y-a.indicator;p=U(0,p,T(f.reel.math.interpolate(c(J),-1,p+2)));f(z(va+".y"),x).css({top:p})}if(b==k)g.stopPropagation();else if(j.length)h.attr({src:a.path+j[b-1]});else{if(a.stitched)j=[-T(i*c(fb))+aa,0+aa];else{i=b%l-1;i=i<0?l-1:i;l=$((b-0.1)/l);l+=a.rows>1?0:c(I)?0:c(Fa);b=c(eb);l=l*((F?m.y:m.x)+b);m=i*((F?m.x:m.y)+b);j=j.length?[0,0]:F?[-m+aa,-l+aa]:[-l+aa,-m+aa]}h.css({backgroundPosition:j.join(B)})}o.call(g)},
stepLeft:function(){u();d(I,false);h.trigger("fractionChange",c(r)-c(W)*c(Z))},stepRight:function(){u();d(I,true);h.trigger("fractionChange",c(r)+c(W)*c(Z))},"click.steppable":function(g){if(N)return g.stopPropagation();h.trigger(g.clientX-h.offset().left>0.5*c(R).x?"stepRight":"stepLeft")},"setup.annotations":function(){var g=c(R),b=h.parent(),i={position:ha,width:g.x,height:g.y,left:0,top:0};C(true,B+z(Va),i);a.crop&&C(true,B+z(Va),{clip:"rect(0 "+ea(g.x)+" "+ea(g.y)+" 0)"});b.append(s=f(V,{"class":Va+
B+wb+a.frame}))||(s=f());f.each(a.annotations,function(k,j){var l=f(V,j.node).attr({id:k}),m=j.image?f(za(Ca),j.image):f(),p=j.link?f(za(Vb),j.link):f();C(false,ba(k),{display:"none",position:ha});j.image||j.link&&l.append(p);j.link||j.image&&l.append(m);j.link&&j.image&&l.append(p.append(m));l.appendTo(s)})},"frameChange.annotations":function(g,b){b=b||c(H);s[0].className=s[0].className.replace(/frame-\d+/g,wb+b);f.each(a.annotations,function(i,k){i=f(ba(i),s);var j=k.start,l=k.end,m=b-(j||0),p=
typeof k.x!=xb?k.x:k.x[m-1];k=typeof k.y!=xb?k.y:k.y[m-1];k={display:p!==q&&k!==q&&m>=0&&(!l||m<=l-j)?"block":"none",left:ea(p)||0,top:ea(k)||0};i.css(k)})},"setup.fu":function(){h.trigger("start")},"start.fu":function(){h.trigger("preload")},"loaded.fu":function(){h.trigger(a.rows>1&&!a.stitched?"rowChange":"frameChange").trigger("opening")}},pool:{"tick.reel":function(g){var b=c(X);if(O){var i=b-c(gb)/K(L)*O;b=!(b*i<=0||b<E(i))&&d(X,b>E(c(Ia))?i:(O=y=0))}M.text(c(a.monitor));b&&O++;y&&y++;tb(0);
Qa=true;if(y&&!b)return o.call(g);if(c(ra))return o.call(g,u());i=c(Z)*Ba(1,c(I));b=(c(Pa)?b:E(c(Ia))+b)/K(L);var k=c(r);d(r,k-b*i);o.call(g)},"tick.reel.fu":function(g){h.trigger("fractionChange");c(ga)===q&&g.stopImmediatePropagation()},"tick.reel.opening":function(g){var b=(a.entry||a.speed)/K(L)*(a.cw?-1:1),i=c(r);d(r,i+b);b=d(ga,c(ga)-1);o.call(g);if(!(b>1)){S.unbind(ka+".opening",A.pool[ka+".opening"]);h.trigger("openingDone")}}}},o=function(g){yb||delete this;return g},y,O=0,ia=function(){return y=
0},u=function(){clearTimeout(qa);S.unbind(ka+".opening",A.pool[ka+".opening"]);h.trigger("play");return y=-a.timeout*K(L)},N=false,qa,M,s,D,pb=function(g){C(true,B+z(va)+z(g),{position:ha,width:a.indicator,height:a.indicator,overflow:nb,backgroundColor:ob});return f(V,{"class":[va,g].join(B)})},qb=[],C=function(g,b,i){var k=c(Ha);b=b.split(",");g&&f.each(b,function(j,l){b[j]=k+l});qb.push(b.join(",")+Eb(i));return i},Ua=0,sa={x:0,y:0},tb=function(g){return ja.push(g)&&ja.shift()&&g},oa=function(){return ja=
[0,0]},ja=oa(),sb=a.graph||f.reel.math[a.loops?"hatch":"envelope"],ua=f.reel.normal,ta=function(g,b,i,k,j){d(Ra,i);d(ub,j);d(Sa,a.loops?0:-i*k);d(Ta,a.loops?k:k-i*k);return g&&d(rb,{x:g,y:b})||q},Qa=true,pa=f.browser.opera?S:f.unique(S.add(zb.top.document));A.setup()});wa=wa||function h(){var t=+new Date,d=K(L);if(d){S.trigger(ka);f.reel.cost=(+new Date+f.reel.cost-t)/2;return wa=setTimeout(h,da(4,1E3/d-f.reel.cost))}else return wa=q}();return f(n)};f.fn.unreel=function(){return this.trigger("teardown")};
f.reel.math={envelope:function(e,a,n,h,t,d){return a+da(h,Xa(t,-e*d))/n},hatch:function(e,a,n,h,t,d){e=(e<h?t:0)+e%t;e=a+-e*d/n;return e-$(e)},interpolate:function(e,a,n){return a+e*(n-a)}};f.reel.preload={linear:function(e){return e},fidelity:function(e,a){function n(o,y,O){function ia(D){for(;!(D>=1&&D<=M);)D+=D<1?+M:-M;return A[O+D]||(A[O+D]=!!u.push(D))}if(!o.length)return[];var u=[],N=4*y,qa=a.frame,M=o.length;y=M/N;for(var s=0;s<N;s++)ia(qa+T(s*y));for(;y>1;){s=0;N=u.length;for(y/=2;s<N;s++)ia(T(u[s]+
y))}for(s=0;s<u.length;s++)u[s]=o[u[s]-1];return u}var h=a.orbital?2:a.rows||1,t=a.orbital?a.footage:a.frames,d=(a.row-1)*t,c=[].concat(e),A=new Array(e.length);e=h<2?[]:c.slice(d,d+t);return n(e,1,d).concat(n(c,h,0))}};f.reel.normal={fraction:function(e,a,n){e=e!=q?e:n(r);return a.loops?e-$(e):U(0,1,e)},row:function(e,a,n){return U(0,1,e!=q?(e-1)/(a.rows-1):n(J))},frame:function(e,a,n){e=e!=q?T(e):n(H);var h=a.orbital?2:a.rows||1;n=n(Da)*h;e=a.loops?e%n||n:U(1,n,e);return e<0?e+n:e}};f.reel.touchy=
/iphone|ipod|ipad|android/i.test(navigator.userAgent);f.reel.lazy=/iphone|ipod|android/i.test(navigator.userAgent);f.reel.instances=f();f.reel.cost=0;f.reel.leader=K;Db("mousewheel disableTextSelect enableTextSelect".split(/ /));var S=f(xa);xa=+f.browser.version.split(".").slice(0,2).join(".");var yb=f.browser.msie,Cb=!(yb&&xa<8),jb="ew-resize",wa,w="reel",Gb=w+"-overlay",va=w+"-indicator",mb=w+"-preloader",lb=w+"-cached",kb=w+"-monitor",Va=w+"-annotations",Na=w+"-panning",wb="frame-",Tb=ya("CAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7")||
Aa("blank.gif"),Mb=ya("EAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAI3lC8AeBDvgosQxQtne7yvLWGStVBelXBKqDJpNzLKq3xWBlU2nUs4C/O8cCvU0EfZGUwt19FYAAA7")||Aa("jquery.reel.cursor-drag.gif"),Sb=ya("EAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAIslI95EB3MHECxNjBVdE/5b2zcRV1QBabqhwltq41St4hj5konmVioZ6OtEgUAOw==")||Aa("jquery.reel.cursor-drag-down.gif"),T=Math.round,$=Math.floor,bb=Math.ceil,Xa=Math.min,da=Math.max,E=Math.abs,Ub=Math.sqrt,ma=parseInt,Ma="area",hb="backup",I="backwards",W="bit",gb=
"brake",Ja="center",ra="clicked",rb="clicked_location",Ra="clicked_on",ub="clicked_row",Z="cwish",R="dimensions",r="fraction",H="frame",vb="_frame",Da="frames",Ta="hi",nb="hidden",cb="image",db="images",ga="opening_ticks",Sa="lo",Oa="playing",fa="reeling",na="revolution",J="row",Fa="rows",eb="spacing",Ia="speed",Ha="stage",Ea="steps",Ga="stitched",fb="stitched_travel",Pa="stopped",ib="style",L="tempo",X="velocity",Y="vertical",Hb="wheel_step",v=".reel",Pb="mousedown"+v,Ob="mouseenter"+v,Qb="mouseleave"+
v,La="mousemove"+v,Ka="mouseup"+v,Nb="mousewheel"+v,ka="tick"+v,Lb="touchcancel"+v,Kb="touchend"+v,Ib="touchstart"+v,Jb="touchmove"+v,ab="",B=" ",ha="absolute",Vb="a",V=za("div"),$a="height",ob=ba("000"),ca="id",Ca="img",xb="object",aa="px",Ya="src",Rb="title",Za="width"}}(jQuery,window,document);
