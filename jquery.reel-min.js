/*
 Copyright (c) 2009-2011 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 jQuery Reel
 http://jquery.vostrel.cz/reel
 Version: 1.1.3-devel
 Updated: 2011-11-09

 Requires jQuery 1.4.2 or higher
*/
jQuery.reel||function(h,nb,ra,q){function F(e){return h.reel.instances.length?h.reel.instances.first().data(e):null}function ob(e){return h.reel.instances.push(e[0])&&e}function pb(e){return(h.reel.instances=h.reel.instances.not("#"+e.attr(V)))&&e}function sa(e){return qb&&"data:image/gif;base64,R0lGODlh"+e}function rb(e){return"<"+e+"/>"}function ta(e){return"."+e}function ua(e){return"http://code.vostrel.cz/"+e}function va(e){return"url("+e+")"}function P(e,a,o){return W(e,Ra(a,o))}function sb(e){function a(){h.fn[this]||
(h.fn[this]=function(){return this})}h.each(e,a)}function wa(e,a){return z(e)*(a?-1:1)}function ba(e){return e.originalEvent.touches[0]}h.reel={version:"1.1.3-devel",def:{footage:6,frame:1,frames:36,hint:"",horizontal:true,hotspot:q,indicator:0,klass:"",loops:true,reversed:q,spacing:0,stitched:0,suffix:"-reel",tooltip:"",area:q,brake:0.5,clickfree:false,cw:false,delay:-1,directional:false,draggable:true,entry:q,graph:q,image:q,images:[],inversed:false,laziness:6,monitor:q,opening:0,orbital:0,path:"",
preloader:4,rebound:0.5,revolution:q,row:1,rows:0,speed:0,step:q,steps:q,tempo:36,timeout:2,throwable:true,vertical:false,wheelable:true,attr:{},preload:"fidelity",scrollable:true,velocity:0}};h.fn.reel=function(e){var a=h.extend({},h.reel.def,e);e=function(g){var t=[];g.filter(tb).each(function(){var c=h(this),d=a.images.length&&a.images||a.image||a.attr.src||c.attr(Sa),w=ca(a.attr.width||c.css(Ta)),m=ca(a.attr.height||c.css(Ua));!d||d==Va||!w||!m||t.push(c)});g.filter(ta(A)).each(function(){t.push(h(this).trigger("teardown"))});
return h(t)}(this);var o=[];a.reversed&&(a.cw=true);a.tooltip&&(a.hint=a.tooltip);a.hotspot&&(a.area=a.hotspot);e.each(function(){var g=h(this),t=g.data(),c=function(i,b){t[i]=b;g.trigger("store",[i,b]);return b},d=function(i){var b=t[i];g.trigger("recall",[i,b]);return b},w={setup:function(i){if(g.hasClass(A))return m.call(i);var b=g.attr(a.attr).attr(Sa),f=c(V,g.attr(V)||g.attr(V,A+"-"+ +new Date).attr(V)),k=g.attr("style"),j=h.extend({},g.data()),l=a.images,n=a.stitched,p=a.loops,r={x:ca(g.css(Ta)||
a.attr.width),y:ca(g.css(Ua)||a.attr.height)},B=c(xa,a.orbital&&a.footage||a.rows<=1&&l.length||a.frames),D=n?1:Wa(B/a.footage),X={display:"block",width:r.x,height:r.y};f="#"+f+a.suffix;var Xa=g.attr("class")||"",ya={position:"relative",width:r.x,height:r.y};ya=h(Y,{id:f.substr(1),"class":Xa+za+ub,css:ya}).bind("openingDone",da);X=g.wrap(ya).attr({"class":A}).css(X).bind(w);o.push(ob(X)[0]);c(Ya,l.length&&l.length||a.image||b.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2"));c(Za,[]);c(G,
a.frame);c($a,a.spacing);c(Q,r);c(s,0);c(Aa,a.steps||a.frames);c(ea,a.revolution||n/2||r.x*2);c(Ba,D);c(fa,1/(B-(p&&!n?0:1)));c(vb,1/W(B,d(Aa)));c(Ca,n);c(ab,n-(p?0:r.x));c(ga,f);c(L,c(Da,a.speed)<0);c(R,a.velocity||0);c(S,a.vertical);c(E,(a.row-1)/(a.rows-1));c(ha,wa(1,!a.cw&&!n));c(Z,false);c(bb,a.brake);c(Ea,!!a.orbital);c(H,a.tempo/(h.reel.lazy?a.laziness:1));c(ia,0);c(cb,{src:b,classes:Xa,style:k||Va,data:j});I.bind(M,w.tick);m.call(i);g.trigger("start")},teardown:function(i){var b=g.data(cb);
g.parent().unbind("openingDone",da).children("img").unbind(u);g.unbind(u).unbind(w).attr({"class":b.classes,src:b.src,style:b.style}).removeClass(A);g.data(b.data).siblings().remove();g.unwrap();pb(g);ja();I.unbind(M,w.tick).unbind(M,w.opening_tick);ka.unbind(Fa).unbind(Ga);m.call(i)},start:function(){var i=d(Q),b=d(xa),f=W(b,d(Aa));f=c(s,1/f*((a.step||a.frame)-1));c(G,N(f*b)+1);g.attr("id");b=g.parent();f=h(Y,{"class":wb,css:{position:la,left:0,top:0,width:i.x,height:i.y,background:Ha,opacity:0}}).appendTo(b);
var k=!d(Z)||a.rows<=1||!a.orbital||a.scrollable;f=c(db,h(a.area||f));if(h.reel.touchy){g.css({WebkitUserSelect:"none",WebkitBackgroundSize:a.images.length?"auto":d(Ca)&&d(Ca)+"px "+i.y+"px"||i.x*a.footage+"px "+i.y*d(Ba)*(a.rows||1)*(a.directional?2:1)+"px"});f.bind(xb,function(j){g.trigger("down",[ba(j).clientX,ba(j).clientY,true])}).bind(yb,function(j){g.trigger("pan",[ba(j).clientX,ba(j).clientY,true]);return!k}).bind(zb,function(){g.trigger("up",[true]);return false}).bind(Ab,function(){g.trigger("up",
[true]);return false})}else f.css({cursor:"url("+eb+"), "+Ia}).bind(a.wheelable?Bb:"",function(j,l){g.trigger("wheel",[l]);return false}).bind(Cb,function(){g.trigger("play")}).bind(a.clickfree?Db:Eb,function(j){if(j.which==1){g.trigger("down",[j.clientX,j.clientY]);return false}}).bind(a.clickfree?Fb:"",function(){g.trigger("up");return false}).disableTextSelect();a.hint&&f.attr(Gb,a.hint);a.monitor&&b.append(J=h(Y,{"class":Hb,css:{position:la,left:0,top:0}}))||(J=h());a.indicator&&b.append(C("x"));
a.rows>1&&a.indicator&&b.append(C("y"));g.trigger("preload")},preload:function(i){var b=d(Q),f=g.parent(),k=d(Ya),j=a.images,l=h.reel.preload[a.preload]||h.reel.preload[h.reel.def.preload];l=!j.length?[k]:l(j,a,d);var n=[],p=g[0];p.frames=l.length;p.preloaded=0;g.trigger("stop");for(f.append(v=h(Y,{"class":Ib,css:{position:la,left:0,top:b.y-a.preloader,height:a.preloader,overflow:fb,backgroundColor:Ha}}));l.length;){var r=a.path+l.shift(),B=h(new Image).hide().attr({width:b.x,height:b.y}).bind("load"+
u,function(){p.preloaded++;h(this).unbind(u);v.css({width:1/p.frames*p.preloaded*b.x});if(p.frames==p.preloaded){v.remove();j.length||g.attr({src:Jb}).css({backgroundImage:va(a.path+k)});g.trigger(a.rows>1&&!a.stitched?"rowChange":"frameChange").trigger("loaded").trigger("opening");m.call(i)}});f.append(B);n.push(r);setTimeout(function(D,X){return function(){D.attr({src:X})}}(B,r),0)}c(Za,n)},tick:function(i){var b=d(R);if(K){var f=b-d(bb)/F(H)*K;b=!(b*f<=0||b<z(f))&&c(R,b>z(d(Da))?f:(K=x=0))}J.text(d(a.monitor));
b&&K++;x&&x++;gb(0);Ja=true;if(x&&!b)return m.call(i);if(d(ma))return m.call(i,y());f=d(ha)*wa(1,d(L));var k=(d(Ka)?b:z(d(Da))+b)/F(H);b=d(s);f=c(s,b-k*f);m.call(i);f!=b&&g.trigger("fractionChange")},opening:function(){var i=a.entry||a.speed,b=d(s),f=a.opening;c(s,b-i*a.opening);c(ia,f*F(H));I.bind(M,w.opening_tick)},opening_tick:function(i){var b=(a.entry||a.speed)/F(H)*(a.cw?-1:1),f=d(s);c(s,f+b);b=c(ia,d(ia)-1);g.trigger("fractionChange");m.call(i);if(!(b>1)){I.unbind(M,w.opening_tick);g.trigger("openingDone")}},
play:function(i){var b=c(La,true);c(Ka,!b);$();m.call(i)},pause:function(i){c(La,false);y();m.call(i)},stop:function(i){var b=c(Ka,true);c(La,!b);m.call(i)},down:function(i,b,f,k){if(a.draggable){c(ma,d(G));c(R,0);na=oa(b,f,d(s),d(ea),d(E));y();ja();if(!k){ka.css({cursor:va(Kb)+", "+Ia}).bind(Ga,function(j){g.trigger("pan",[j.clientX,j.clientY]);m.call(j);return false});a.clickfree||ka.bind(Fa,function(j){g.trigger("up");m.call(j)})}}m.call(i)},up:function(i,b){if(!a.draggable)return m.call(i);c(ma,
false);c(Z,false);var f=c(R,!a.throwable?0:z(aa[0]+aa[1])/60);K=f?1:0;f?$():y();ja();!b&&ka.unbind(Fa).unbind(Ga)&&d(db).css({cursor:va(eb)+", "+Ia});m.call(i)},pan:function(i,b,f){if(a.draggable&&Ja){Ja=false;y();var k={x:b-na.x,y:f-na.y};if(z(k.x)>0||z(k.y)>0){na={x:b,y:f};var j=d(ea),l=d(hb),n=d(S),p=c(s,ib(n?f-l.y:b-l.x,d(Ma),j,d(Na),d(Oa),d(ha)));c(Z,d(Z)||d(G)!=d(ma));(k=gb(n?k.y:k.x||0))&&c(L,k<0);if(a.orbital&&d(Ea)){c(S,z(f-l.y)>z(b-l.x));l=oa(b,f,p,j,d(E))}if(a.rows>1){k=d(Q).y;n=d(jb);
var r=-n*k;c(E,h.reel.math.envelope(f-l.y,n,k,r,r+k,-1))}!(p%1)&&!a.loops&&oa(b,f,p,j,d(E));g.trigger("fractionChange")}}m.call(i)},wheel:function(i,b){var f=Wa(Lb(z(b))/2);f=wa(f,b>0);b=0.2*d(ea);oa(q,q,d(s),b,d(E));c(s,ib(f,d(Ma),b,d(Na),d(Oa),d(ha)));f&&c(L,f<0);c(R,0);y();m.call(i);g.trigger("fractionChange");return false},fractionChange:function(i,b){b=c(s,pa.fraction(b,a,d));var f=c(G,1+T(b/d(fa))),k=a.rows>1,j=a.orbital;c(Ea,!!j&&(f<=j||f>=a.footage-j+2));if(!a.loops&&a.rebound){!x&&!(b%1)?
Pa++:(Pa=0);Pa>=a.rebound*1E3/F(H)&&c(L,!d(L))}g.trigger(k?"rowChange":"frameChange");m.call(i)},rowChange:function(i,b){var f=d(s)/d(fa)+1;b=c(E,pa.row(b,a,d));b=P(0,a.rows-1,T(b*a.rows));c(G,T(f+b*a.frames));m.call(i);g.trigger("frameChange")},frameChange:function(i,b){var f=c(s,pa.fraction(!b?q:d(fa)*(b-1),a,d)),k=d(kb);b=c(kb,c(G,pa.frame(b,a,d)));var j=a.images,l=a.footage,n=d(Q),p=a.rows>1,r=a.horizontal;if(d(S)){b=a.inversed?l+1-b:b;b+=l}var B=(d(S)?n.y:n.x)-a.indicator,D=P(0,B,N(h.reel.math.interpolate(d(s),
-1,B+2)));D=!a.cw||a.stitched?D:B-D;h(ta(Qa+".x"),d(ga)).css(d(S)?{left:0,top:D}:{left:D,top:n.y-a.indicator});if(p){p=n.y-a.indicator;p=P(0,p,N(h.reel.math.interpolate(d(E),-1,p+2)));h(ta(Qa+".y"),d(ga)).css({top:p})}if(b!=k){h(d(ga)).removeClass(lb+k).addClass(lb+b);if(j.length)g.attr({src:a.path+j[b-1]});else{if(a.stitched)j=[-N(f*d(ab))+U,0+U];else{f=b%l-1;f=f<0?l-1:f;l=T((b-0.1)/l);l+=a.rows>1?0:d(L)?0:d(Ba);b=d($a);l=l*((r?n.y:n.x)+b);n=f*((r?n.x:n.y)+b);j=j.length?[0,0]:r?[-n+U,-l+U]:[-l+U,
-n+U]}g.css({backgroundPosition:j.join(za)})}}m.call(i)}},m=function(i){mb||delete this;return i},x,K=0,$=function(){return x=0},y=function(){clearTimeout(O);I.unbind(M,w.opening_tick);g.trigger("play");return x=-a.timeout*F(H)},O,da=function(){O=setTimeout(function(){g.trigger("play")},a.delay*1E3||0)},J,v,C=function(i){return h(Y,{"class":[Qa,i].join(za),css:{width:a.indicator,height:a.indicator,overflow:fb,top:d(Q).y-a.indicator,left:0,position:la,backgroundColor:Ha}})},Pa=0,na={x:0,y:0},gb=function(i){return aa.push(i)&&
aa.shift()&&i},ja=function(){return aa=[0,0]},aa=ja(),ib=a.graph||h.reel.math[a.loops?"hatch":"envelope"],pa=h.reel.normal,oa=function(i,b,f,k,j){c(Ma,f);c(jb,j);c(Na,a.loops?0:-f*k);c(Oa,a.loops?k:k-f*k);return i&&c(hb,{x:i,y:b})||q},Ja=true,ka=h.browser.opera?I:h.unique(I.add(nb.top.document));w.setup()});qa=qa||function g(){var t=+new Date,c=F(H);if(c){I.trigger(M);h.reel.cost=(+new Date+h.reel.cost-t)/2;return qa=setTimeout(g,W(4,1E3/c-h.reel.cost))}else return qa=q}();return h(o)};h.reel.math=
{envelope:function(e,a,o,g,t,c){return a+W(g,Ra(t,-e*c))/o},hatch:function(e,a,o,g,t,c){e=(e<g?t:0)+e%t;e=a+-e*c/o;return e-T(e)},interpolate:function(e,a,o){return a+e*(o-a)}};h.reel.preload={linear:function(e){return e},fidelity:function(e,a){function o(m,x,K){function $(C){for(;!(C>=1&&C<=J);)C+=C<1?+J:-J;return w[K+C]||(w[K+C]=!!y.push(C))}if(!m.length)return[];var y=[],O=4*x,da=a.frame,J=m.length;x=J/O;for(var v=0;v<O;v++)$(da+N(v*x));for(;x>1;){v=0;O=y.length;for(x/=2;v<O;v++)$(N(y[v]+x))}for(v=
0;v<y.length;v++)y[v]=m[y[v]-1];return y}var g=a.orbital?2:a.rows||1,t=a.orbital?a.footage:a.frames,c=(a.row-1)*t,d=[].concat(e),w=new Array(e.length);e=g<2?[]:d.slice(c,c+t);return o(e,1,c).concat(o(d,g,0))}};h.reel.normal={fraction:function(e,a,o){e=e!=q?e:o(s);return a.loops?e-T(e):P(0,1,e)},row:function(e,a,o){return P(0,1,e!=q?(e-1)/(a.rows-1):o(E))},frame:function(e,a,o){e=N(e)||o(G);for(o=o(xa)*(a.orbital?2:a.rows||1);e<1;)e+=o;return a.loops?e%o:P(0,o,e)}};h.reel.touchy=/iphone|ipod|ipad|android/i.test(navigator.userAgent);
h.reel.lazy=/iphone|ipod|android/i.test(navigator.userAgent);h.reel.instances=h();h.reel.cost=0;h.reel.leader=F;sb("mousewheel disableTextSelect enableTextSelect".split(/ /));var I=h(ra);ra=+h.browser.version.split(".").slice(0,2).join(".");var mb=h.browser.msie,qb=!(mb&&ra<8),Ia="ew-resize",qa,A="jquery-reel",ub=A+"-overlay",Qa=A+"-indicator",Ib=A+"-preloader",Hb=A+"-monitor",wb=A+"-interface",lb="frame-",Jb=sa("CAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7")||ua("blank.gif"),eb=sa("EAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAI3lC8AeBDvgosQxQtne7yvLWGStVBelXBKqDJpNzLKq3xWBlU2nUs4C/O8cCvU0EfZGUwt19FYAAA7")||
ua("jquery.reel.cursor-drag.gif"),Kb=sa("EAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAIslI95EB3MHECxNjBVdE/5b2zcRV1QBabqhwltq41St4hj5konmVioZ6OtEgUAOw==")||ua("jquery.reel.cursor-drag-down.gif"),N=Math.round,T=Math.floor,Wa=Math.ceil,Ra=Math.min,W=Math.max,z=Math.abs,Lb=Math.sqrt,ca=parseInt,db="area",cb="backup",L="backwards",fa="bit",bb="brake",Ea="center",ma="clicked",hb="clicked_location",Ma="clicked_on",jb="clicked_row",ha="cwish",Q="dimensions",s="fraction",G="frame",kb="_frame",xa="frames",
Oa="hi",fb="hidden",Ya="image",Za="images",ia="opening_ticks",Na="lo",La="playing",Z="reeling",ea="revolution",E="row",Ba="rows",$a="spacing",Da="speed",ga="stage",Aa="steps",Ca="stitched",ab="stitched_travel",Ka="stopped",H="tempo",R="velocity",S="vertical",vb="wheel_step",u=".reel",Cb="dblclick"+u,Eb="mousedown"+u,Db="mouseenter"+u,Fb="mouseleave"+u,Ga="mousemove"+u,Fa="mouseup"+u,Bb="mousewheel"+u,M="tick"+u,Ab="touchcancel"+u,zb="touchend"+u,xb="touchstart"+u,yb="touchmove"+u,Va="",za=" ",la=
"absolute",Y=rb("div"),Ua="height",Ha="#000",V="id",tb="img",U="px",Sa="src",Gb="title",Ta="width"}(jQuery,window,document);
