/*
 Copyright (c) 2009-2010 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 http://jquery.vostrel.cz/reel
 Version: "Dancer" (will be 1.1 on release)
 Updated: 2010-07-17

 Requires jQuery 1.4.x
*/
(function(k,gb,Ja,y){function Ka(n){return"<"+n+"/>"}function ja(n){return"."+n}function T(n){return"url("+n+")"}function U(n,a){return+a.toFixed(n)}function ka(n,a,J){return K(n,la(a,J))}function La(n){function a(){k.fn[this]||(k.fn[this]=function(){return this})}k.each(n,a)}var Ma=k.reel={footage:6,frame:1,frames:36,hint:"",horizontal:true,hotspot:y,indicator:0,klass:"",loops:true,reversed:false,sensitivity:20,spacing:0,stitched:y,suffix:"-reel",tooltip:"",delay:-1,friction:0.9,image:y,images:[],
inertia:true,monitor:y,path:"",preloader:4,rebound:0.5,revolution:y,speed:0,step:y,steps:y,tempo:25,timeout:2};k.fn.reel=function(n){var a=k.extend({},Ma,n);n=function(d){var c=[];d.filter(Na).each(function(){var e=k(this),m=a.images.length&&a.images||a.image||e.attr(ma),z=L(e.css(na)),x=L(e.css(oa));!m||m==pa||!z||!x||c.push(e)});d.filter(qa+ja(E)).each(function(){c.push(k(this))});return k(c)}(this);var J=[];V=V||function d(){F.trigger(W);return setTimeout(d,1E3/a.tempo)}();n.each(function(){var d=
k(this),c=function(g,b){d.data(g,b);d.trigger("store");return b},e=function(g){d.trigger("recall");return d.data(g)},m=function(g){delete this;return g},z={setup:function(g){if(d.hasClass(E))return m.call(g);var b=d.attr(ma),f=d.attr(Oa);d.attr(Pa);var h=d.attr("style"),i=a.images,l={x:L(d.css(na)),y:L(d.css(oa))},j={display:"block",width:l.x+q,height:l.y+q};j=d.attr({src:a.images?Qa:b}).bind(z).addClass(E).css(j);j=j.bind(ra,M).bind(sa,ta);instances_count=J.push(j[0]);c(X,i.length&&i.length||a.image||
b.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2"));c(D,a.frame);c(G,i.length||a.frames);c(ua,a.spacing);c(N,l);c(p,0);c(O,a.steps||a.frames);c(P,"#"+f+a.suffix);c(A,c(Y,a.speed)<0);c(va,{src:b,style:h||pa});V&&F.bind(W,z.tick);m.call(g);d.trigger("start")},teardown:function(g){k(e(P)).remove();d.removeClass(E).unbind(v).unbind(z).unbind(ra,M).unbind(sa,ta).attr(d.data(va)).enableTextSelect().removeData();Z();F.unbind($).unbind(Q).unbind(W,z.tick);m.call(g)},start:function(g){var b=e(N),
f=e(G),h=K(f,e(O));h=c(p,1/h*((a.step||a.frame)-1));c(D,h*f+1);f=e(X);h=a.images;f=!h.length?[f]:[].concat(h);var i;d.attr("id");var l=d[0];l.frames=f.length;l.preloads=l.preloads||[];l.preloaded=l.preloaded||0;h=f.length!=l.preloads.length;var j=e(P).substr(1);j=k(H,{className:Ra,id:j,css:{position:"relative",width:b.x}}).insertAfter(d);var t=k(H,{className:Sa,css:{position:R,left:0,top:-b.y,width:b.x,height:b.y}}).appendTo(j);t=c(aa,k(a.hotspot||t));Ta?t.css({WebkitUserSelect:"none"}).each(function(){function o(r,
B){k.each(B,function(Ua){r.addEventListener(Ua,this,false)})}function w(r){return r.cancelable&&r.preventDefault()||false}function S(r){var B=r.touches[0];d.trigger("down",[B.clientX,B.clientY,true]);return w(r)}function s(r){var B=r.touches[0];d.trigger("drag",[B.clientX,B.clientY,true]);return w(r)}function u(r){d.trigger("up",[true]);return w(r)}o(this,{touchstart:S,touchmove:s,touchend:u,touchcancel:u})}):t.css({cursor:"url("+wa+"), "+ba}).bind(Va,function(){d.trigger("enter")}).bind(Wa,function(){d.trigger("leave")}).bind(Q,
function(o){d.trigger("over",[o.pageX,o.pageY])}).bind(Xa,function(o,w){d.trigger("wheel",[w]);return false}).bind(Ya,function(){d.trigger("animate")}).bind(Za,function(o){d.trigger("down",[o.clientX,o.clientY]);return false}).disableTextSelect();(a.hint||a.tooltip)&&t.attr($a,a.hint||a.tooltip);a.monitor&&j.append(ca=k(H,{className:ab,css:{position:R,left:0,top:-b.y}}))||(ca=k());a.indicator&&j.append(k(H,{className:xa,css:{width:a.indicator+q,height:a.indicator+q,top:-a.indicator+q,position:R,backgroundColor:ya}}));
h&&j.append(i=k(H,{className:bb,css:{position:R,left:0,top:-a.preloader,height:a.preloader,backgroundColor:ya}}));if(h)for(;f.length;){h=new Image;j=a.path+f.shift();k(h).load(function(){l.preloaded++;i.css({width:1/l.frames*l.preloaded*b.x});l.frames==l.preloaded&&i.remove()});h.src=j;l.preloads.push(h)}a.delay>0&&M();m.call(g);d.trigger("frameChange")},animate:function(){},tick:function(g){var b=e(I);b-=b*cb;b=za=b==za?0:b;b=c(I,(b<0?la:K)(0,U(3,b))||0);var f=(e(da)?b:b+db())/a.tempo;ca.text(e(a.monitor));
Aa(0);x&&x++;if(x&&!b)return m.call(g);if(e(ea))return m.call(g,M());c(p,e(p)+f);m.call(g);d.trigger("fractionChange")},play:function(g){var b=c(fa,true);c(da,!b);m.call(g)},pause:function(g){c(fa,false);m.call(g)},stop:function(g){var b=c(da,true);c(fa,!b);m.call(g)},down:function(g,b,f,h){f=e(aa);c(ea,true);c(Ba,b);c(I,0);c(ga,c(Ca,e(p)));!h&&F.bind(Q,function(i){d.trigger("drag",[i.clientX,i.clientY])}).bind($,function(){d.trigger("up")})&&f.css({cursor:T(eb)+", "+ba});m.call(g)},up:function(g,
b){var f=e(aa);c(ea,false);var h=(C[0]+C[1]+C[2])/C.length/(b?15:20),i=(a.reversed?-1:1)*(a.stitched?-1:1);c(I,a.inertia?h*i:0);Z();!b&&F.unbind($).unbind(Q)&&f.css({cursor:T(wa)+", "+ba});m.call(g)},drag:function(g,b){var f=e(Ba),h=e(Ca),i=a.stitched,l=e(N);l=a.revolution||i/2||l.x;var j=e(Da);f=b-f;i=(a.reversed?-1:1)*(i?-1:1);c(A,f<j);h=h+i/l*f;c(Da,f);c(p,h);Aa(b-Ea);Ea=b;m.call(g);d.trigger("fractionChange")},wheel:function(g,b){c(I,0);var f=e(p),h=1/K(e(G),e(O)),i=Fa(fb(Ga(b))/2);i=b<0?-i:i;
c(A,i>0);c(p,f+i*h);m.call(g);d.trigger("fractionChange");return false},fractionChange:function(g,b){b=!b?e(p):c(p,b);var f=e(ga);if(b-f===0)return m.call(g);b=a.loops?b-Ha(b):ka(0,1,b);!a.loops&&a.rebound&&ha==a.rebound*1E3/a.tempo&&c(A,!e(A));b=c(ga,c(p,U(6,b)));c(D,b*(e(G)-1)+1);!x&&(ha=b==0||b==1?ha+1:0);m.call(g);d.trigger("frameChange")},frameChange:function(g,b){var f=e(G),h=!b?e(p):c(p,U(6,(b-1)/(f-1)));b=!b?e(D):c(D,b);b=c(D,ia(b));var i=e(X),l=a.images,j=e(N);e(O);var t=e(ua),o=e(A),w=a.footage;
if(a.stitched){f=a.loops?a.stitched:a.stitched-j.x;s=ia(h*f);u=0;o=[-s+q,u+q]}else{s=Ha((b-0.1)/w);var S=a.horizontal?j.y:j.x,s=-s*(t+S),u=-(b%w-1)*(t+(a.horizontal?j.x:j.y));f=Fa(f/w)*(S+t)-t;s=o&&a.horizontal?s-f:s;u=o&&!a.horizontal?u-f:u;o=l.length?[0,0]:a.horizontal?[u+q,s+q]:[s+q,u+q]}b=l[b-1]||i;f=j.x-a.indicator;h=ka(0,f,ia(h*(f+2))-1);j={background:T(a.path+b)+Ia+o.join(Ia)};a.images.length?d.attr({src:a.path+b}):d.css(j);m.call(g);k(ja(xa),e(P)).css({left:h+q})}},x,ta=function(){return x=
0},M=function(){return x=-a.timeout*a.tempo},cb=a.friction/a.tempo,db=function(){return c(Y,(e(A)?-1:1)*Ga(e(Y)))},ca,ha=0,Ea=0,za=0,Aa=function(g){C.push(g)&&C.shift()},Z=function(){return C=[0,0,0]},C=Z();z.setup()});return k(J)};La("mousewheel disableTextSelect enableTextSelect".split(/ /));var v=".reel",E="jquery-reel",Ra=E+"-overlay",xa="indicator",bb="preloader",ab="monitor",Sa="interface",W="tick"+v,ra="down drag up wheel pause",sa="play",F=k(Ja),Ta=/iphone|ipod|ipad|android/i.test(navigator.userAgent),
ba="w-resize",V,Qa="data:image/gif;base64,R0lGODlhCAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7",wa="data:image/gif;base64,R0lGODlhEAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAI3lC8AeBDvgosQxQtne7yvLWGStVBelXBKqDJpNzLKq3xWBlU2nUs4C/O8cCvU0EfZGUwt19FYAAA7",eb="data:image/gif;base64,R0lGODlhEAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAIslI95EB3MHECxNjBVdE/5b2zcRV1QBabqhwltq41St4hj5konmVioZ6OtEgUAOw==",ia=Math.round,Ha=Math.floor,Fa=Math.ceil,la=Math.min,K=Math.max,Ga=Math.abs,fb=
Math.sqrt,L=parseInt,va="backup",ea="clicked",Ba="clicked_location",Ca="clicked_on",N="dimensions",Da="distance_dragged",p="fraction",D="frame",G="frames",aa="hotspot",X="image",ga="last_fraction",fa="playing",A="reversed",ua="spacing",Y="speed",P="stage",O="steps",da="stopped",I="velocity",Ya="dblclick"+v,Za="mousedown"+v,Va="mouseenter"+v,Wa="mouseleave"+v,Q="mousemove"+v,$="mouseup"+v,Xa="mousewheel"+v,pa="",Ia=" ",R="absolute",Pa="class",qa="div",H=Ka(qa),oa="height",ya="#000",Oa="id",Na="img",
q="px",ma="src",$a="title",na="width"})(jQuery,window,document);
