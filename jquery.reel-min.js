/*
 Copyright (c) 2009-2010 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 http://jquery.vostrel.cz/reel
 Version: "Dancer" (will be 1.1 on release)
 Updated: 2010-08-06

 Requires jQuery 1.4.x
*/
(function(k,pb,Qa,o){function Ra(j){return"<"+j+"/>"}function Z(j){return"."+j}function $(j){return"url("+j+")"}function z(j){return+j.toFixed(4)}function O(j,a,t){return P(j,wa(a,t))}function Sa(j){function a(){k.fn[this]||(k.fn[this]=function(){return this})}k.each(j,a)}function aa(j,a){return A(j)*(a?-1:1)}function Q(j){return j.originalEvent.touches[0]}var Ta=k.reel={footage:6,frame:1,frames:36,hint:"",horizontal:true,hotspot:o,indicator:0,klass:"",loops:true,reversed:o,spacing:0,stitched:o,suffix:"-reel",
tooltip:"",brake:0.5,cw:false,delay:-1,draggable:true,graph:o,image:o,images:[],monitor:o,maximum:100,minimum:0,path:"",preloader:4,rebound:0.5,revolution:o,row:1,rows:0,speed:0,step:o,steps:o,tempo:25,timeout:2,throwable:true,value:o,wheelable:true};k.fn.reel=function(j){var a=k.extend({},Ta,j);j=function(f){var d=[];f.filter(Ua).each(function(){var c=k(this),n=a.images.length&&a.images||a.image||c.attr(xa),w=R(c.css(ya)),u=R(c.css(za));!n||n==Aa||!w||!u||d.push(c)});f.filter(Ba+Z(G)).each(function(){d.push(k(this))});
return k(d)}(this);var t=[];a.reversed&&(a.cw=true);a.tooltip&&(a.hint=a.tooltip);ba=ba||function f(){H.trigger(ca);return setTimeout(f,1E3/a.tempo)}();j.each(function(){var f=k(this),d=function(e,b){f.data(e,b);f.trigger("store");return b},c=function(e){f.trigger("recall");return f.data(e)},n=function(e){delete this;return e},w={setup:function(e){if(f.hasClass(G))return n.call(e);var b=f.attr(xa),g=f.attr(Va),i=f.attr("style"),h=a.images,l=a.stitched,p=a.loops,m={x:R(f.css(ya)),y:R(f.css(za))},s=
{display:"block",width:m.x,height:m.y};s=f.attr({src:a.images?Wa:b}).bind(w).addClass(G).css(s);t.push(s[0]);d(da,h.length&&h.length||a.image||b.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2"));d(B,a.frame);d(Ca,a.spacing);d(I,m);d(q,0);d(ea,a.steps||a.frames);d(S,a.revolution||l/2||m.x);d(Da,Ea(d(T,h.length||a.frames)/a.footage));d(U,1/(c(T)-(p&&!l?0:1)));d(Xa,1/P(c(T),c(ea)));d(Fa,l-(p?0:m.x));d(Ga,m.x-a.indicator);d(J,"#"+g+a.suffix);d(x,d(fa,a.speed)<0);d(C,0);d(v,(a.row-1)/(a.rows-
1));d(D,a.value||0);d(V,aa(1,!a.cw&&!l));d(Ha,{src:b,style:i||Aa});ba&&H.bind(ca,w.tick);n.call(e);f.trigger("start")},teardown:function(e){k(c(J)).remove();f.removeClass(G).unbind(r).unbind(w).attr(f.data(Ha)).enableTextSelect().removeData();W();H.unbind(ga).unbind(X).unbind(ca,w.tick);n.call(e)},start:function(e){var b=c(I),g=c(T),i=P(g,c(ea));i=d(q,1/i*((a.step||a.frame)-1));d(B,i*g+1);g=c(da);i=a.images;g=!i.length?[g]:[].concat(i);f.attr("id");var h=f[0];h.frames=g.length;h.preloads=h.preloads||
[];h.preloaded=h.preloaded||0;i=g.length!=h.preloads.length;var l=c(J).substr(1);l=k(K,{className:Ya,id:l,css:{position:"relative",width:b.x}}).insertAfter(f);var p=k(K,{className:Za,css:{position:Y,left:0,top:-b.y,width:b.x,height:b.y}}).appendTo(l);p=d(ha,k(a.hotspot||p));$a?p.css({WebkitUserSelect:"none"}).bind(ab,function(m){f.trigger("down",[Q(m).clientX,Q(m).clientY,true]);return false}).bind(bb,function(m){f.trigger("drag",[Q(m).clientX,Q(m).clientY,true]);return false}).bind(cb,function(){f.trigger("up",
[true]);return false}).bind(db,function(){f.trigger("up",[true]);return false}):p.css({cursor:"url("+Ia+"), "+ia}).bind(eb,function(){f.trigger("enter")}).bind(fb,function(){f.trigger("leave")}).bind(X,function(m){f.trigger("over",[m.pageX,m.pageY])}).bind(gb,function(m,s){f.trigger("wheel",[s]);return false}).bind(hb,function(){f.trigger("animate")}).bind(ib,function(m){f.trigger("down",[m.clientX,m.clientY]);return false}).disableTextSelect();a.hint&&p.attr(jb,a.hint);a.monitor&&l.append(ja=k(K,
{className:kb,css:{position:Y,left:0,top:-b.y}}))||(ja=k());a.indicator&&l.append(Ja("x"));a.rows&&a.indicator&&l.append(Ja("y"));if(i)for(l.append(ka=k(K,{className:lb,css:{position:Y,left:0,top:-a.preloader,height:a.preloader,backgroundColor:Ka}}));g.length;){i=new Image;l=a.path+g.shift();k(i).load(function(){h.preloaded++;ka.css({width:1/h.frames*h.preloaded*b.x});h.frames==h.preloaded&&ka.remove()});i.src=l;h.preloads.push(i)}a.delay>0&&y();a.value!=o&&f.trigger("valueChange",c(D));n.call(e);
f.trigger(a.rows&&!a.stitched?"rowChange":"frameChange")},animate:function(){},tick:function(e){var b=c(C);if(L){var g=z(b-mb*L);b=!(b*g<=0||b<A(g))&&d(C,b>A(c(fa))?g:(L=u=0))}ja.text(c(a.monitor));b&&L++;u&&u++;La(0);f[0].value!=c(D)&&f.trigger("valueChange",f[0].value);if(u&&!b)return n.call(e);if(c(la))return n.call(e,y());g=c(V)*aa(1,c(x));b=(c(ma)?b:A(c(fa))+b)/a.tempo;d(q,c(q)-b*g);n.call(e);f.trigger("fractionChange")},play:function(e){var b=d(na,true);d(ma,!b);Ma();n.call(e)},pause:function(e){d(na,
false);y();n.call(e)},stop:function(e){var b=d(ma,true);d(na,!b);n.call(e)},down:function(e,b,g,i){if(!a.draggable)return n.call(e);d(la,true);d(C,0);oa(b,g,c(q),c(S),c(v));pa=o;y();W();!i&&H.bind(X,function(h){f.trigger("drag",[h.clientX,h.clientY]);n.call(h)}).bind(ga,function(h){f.trigger("up");n.call(h)})&&c(ha).css({cursor:$(nb)+", "+ia});n.call(e)},up:function(e,b){if(!a.draggable)return n.call(e);d(la,false);var g=d(C,!a.throwable?0:A(E[0]+E[1]+E[2])/60);L=g?1:0;g?Ma():y();W();!b&&H.unbind(ga).unbind(X)&&
c(ha).css({cursor:$(Ia)+", "+ia});n.call(e)},drag:function(e,b,g){if(!a.draggable)return n.call(e);var i=c(S),h=c(Na),l=La(b-pa||0),p=d(q,Oa(b-h.x,c(qa),i,c(ra),c(sa),c(V)));l&&d(x,l<0);if(a.rows){l=c(I).y;var m=c(Pa),s=-m*l;d(v,z(k.reel.math.envelope(g-h.y,m,l,s,s+l,-1)))}!(p%1)&&!a.loops&&oa(b,g,p,i,c(v));y();pa=b;n.call(e);f.trigger("fractionChange")},wheel:function(e,b){if(!a.wheelable)return n.call(e);var g=Ea(ob(A(b))/2);g=aa(g,b>0);b=0.2*c(S);oa(o,o,c(q),b,c(v));d(q,Oa(g,c(qa),b,c(ra),c(sa),
c(V)));g&&d(x,g<0);d(C,0);y();n.call(e);f.trigger("fractionChange");return false},fractionChange:function(e,b){b=!b?c(q):d(q,b);b=a.loops?b-M(b):O(0,1,b);b=d(q,z(b));d(B,1+M(b/c(U)));d(D,z(k.reel.math.interpolate(b,a.minimum,a.maximum)));if(!a.loops&&a.rebound){!u&&!(b%1)?ta++:(ta=0);ta>=a.rebound*1E3/a.tempo&&d(x,!c(x))}n.call(e);f.trigger("valueChange");f.trigger(a.rows&&!a.stitched?"rowChange":"frameChange")},rowChange:function(e,b){var g=M(c(q)/c(U))+1;b=d(v,O(0,1,z(b!=o?(b-1)/(a.rows-1):c(v))));
d(B,g+(!a.rows?0:N(b*(a.rows-1))*a.frames));n.call(e);f.trigger("frameChange")},frameChange:function(e,b){var g=!b?c(q):d(q,z(c(U)*(b-1)));b=d(B,N(b?b:c(B)));var i=a.images,h=a.footage,l=a.horizontal;if(a.stitched)l=[-N(g*c(Fa))+F,0+F];else{var p=b%h-1;p=p<0?h-1:p;var m=M((b-0.1)/h);m+=a.rows?0:c(x)?0:c(Da);h=c(I);var s=c(Ca);m=m*((l?h.y:h.x)+s);p=p*((l?h.x:h.y)+s);l=i.length?[0,0]:l?[-p+F,-m+F]:[-m+F,-p+F]}b=i[b-1]||c(da);i=c(Ga);g=O(0,i,N(k.reel.math.interpolate(g,-1,i+2)));g=!a.cw||a.stitched?
g:i-g;i={background:$(a.path+b)+ua+l.join(ua)};a.images.length?f.attr({src:a.path+b}):f.css(i);k(Z(va+".x"),c(J)).css({left:g});if(!a.rows)return n.call(e);g=c(I).y-a.indicator;b=O(0,g,N(k.reel.math.interpolate(c(v),-1,g+2)));k(Z(va+".y"),c(J)).css({top:b-g-a.indicator});n.call(e)},valueChange:function(e,b){e=b!==o&&d(q,b/(a.maximum-a.minimum));f[0].value=b===o?c(D):d(D,b);e===false||f.trigger("fractionChange")}},u,L=0,Ma=function(){return u=0},y=function(){return u=-a.timeout*a.tempo},ja,ka,Ja=function(e){return k(K,
{className:[va,e].join(ua),css:{width:a.indicator,height:a.indicator,top:e=="y"?o:-a.indicator,left:e=="x"?o:0,position:Y,backgroundColor:Ka}})},ta=0,pa=0,La=function(e){return E.push(e)&&E.shift()&&e},W=function(){return E=[0,0,0]},E=W(),mb=a.brake/a.tempo,Oa=a.graph||k.reel.math[a.loops?"hatch":"envelope"],oa=function(e,b,g,i,h){d(qa,g);d(Pa,h);d(ra,a.loops?0:-g*i);d(sa,a.loops?i:i-g*i);return e&&d(Na,{x:e,y:b})||o};w.setup()});return k(t)};k.reel.math={envelope:function(j,a,t,f,d,c){return a+P(f,
wa(d,-j*c))/t},hatch:function(j,a,t,f,d,c){j=(j<f?d:0)+j%d;j=a+-j*c/t;return j-M(j)},interpolate:function(j,a,t){return a+j*(t-a)}};Sa("mousewheel disableTextSelect enableTextSelect".split(/ /));var H=k(Qa),$a=/iphone|ipod|ipad|android/i.test(navigator.userAgent),ia="ew-resize",ba,G="jquery-reel",Ya=G+"-overlay",va="indicator",lb="preloader",kb="monitor",Za="interface",Wa="data:image/gif;base64,R0lGODlhCAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7",Ia="data:image/gif;base64,R0lGODlhEAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAI3lC8AeBDvgosQxQtne7yvLWGStVBelXBKqDJpNzLKq3xWBlU2nUs4C/O8cCvU0EfZGUwt19FYAAA7",
nb="data:image/gif;base64,R0lGODlhEAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAIslI95EB3MHECxNjBVdE/5b2zcRV1QBabqhwltq41St4hj5konmVioZ6OtEgUAOw==",N=Math.round,M=Math.floor,Ea=Math.ceil,wa=Math.min,P=Math.max,A=Math.abs,ob=Math.sqrt,R=parseInt,Ha="backup",x="backwards",U="bit",la="clicked",Na="clicked_location",qa="clicked_on",Pa="clicked_row",V="cwish",I="dimensions",q="fraction",B="frame",T="frames",sa="hi",ha="hotspot",da="image",Ga="indicator_travel",ra="lo",na="playing",S="revolution",v=
"row",Da="rows",Ca="spacing",fa="speed",J="stage",ea="steps",Fa="stitched_travel",ma="stopped",D="value",C="velocity",Xa="wheel_step",r=".reel",hb="dblclick"+r,ib="mousedown"+r,eb="mouseenter"+r,fb="mouseleave"+r,X="mousemove"+r,ga="mouseup"+r,gb="mousewheel"+r,ca="tick"+r,db="touchcancel"+r,cb="touchend"+r,ab="touchstart"+r,bb="touchmove"+r,Aa="",ua=" ",Y="absolute",Ba="div",K=Ra(Ba),za="height",Ka="#000",Va="id",Ua="img",F="px",xa="src",jb="title",ya="width"})(jQuery,window,document);
