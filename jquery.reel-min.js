/*
 Copyright (c) 2009-2010 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 http://jquery.vostrel.cz/reel
 Version: 1.1 RC
 Updated: 2010-10-28

 Requires jQuery 1.4.x
*/
(function(j,vb,Va,n){function Wa(k){return"<"+k+"/>"}function aa(k){return"."+k}function ba(k){return"url("+k+")"}function z(k){return+k.toFixed(4)}function N(k,a,t){return O(k,Aa(a,t))}function Xa(k){function a(){j.fn[this]||(j.fn[this]=function(){return this})}j.each(k,a)}function ca(k,a){return A(k)*(a?-1:1)}function P(k){return k.originalEvent.touches[0]}var Ya=j.reel={footage:6,frame:1,frames:36,hint:"",horizontal:true,hotspot:n,indicator:0,klass:"",loops:true,reversed:n,spacing:0,stitched:n,
suffix:"-reel",tooltip:"",area:n,brake:0.5,clickfree:false,couple:n,cw:false,delay:-1,directional:false,dragable:true,graph:n,image:n,images:[],monitor:n,maximum:100,minimum:0,path:"",preloader:4,rebound:0.5,revolution:n,row:1,rows:0,speed:0,step:n,steps:n,tempo:25,timeout:2,throwable:true,value:n,wheelable:true};j.fn.reel=function(k){var a=j.extend({},Ya,k);k=function(g){var d=[];g.filter(Za).each(function(){var c=j(this),l=a.images.length&&a.images||a.image||c.attr(Ba),B=Q(c.css(Ca)),u=Q(c.css(Da));
!l||l==Ea||!B||!u||d.push(c)});g.filter(Fa+aa(v)).each(function(){d.push(j(this))});return j(d)}(this);var t=[];a.reversed&&(a.cw=true);a.tooltip&&(a.hint=a.tooltip);a.hotspot&&(a.area=a.hotspot);da=da||function g(){C.trigger(ea);return setTimeout(g,1E3/a.tempo)}();k.each(function(){var g=j(this),d=function(f,b){g.data(f,b);g.trigger("store");return b},c=function(f){g.trigger("recall");return g.data(f)},l=function(f){$a||delete this;return f},B={setup:function(f){if(g.hasClass(v))return l.call(f);
var b=g.attr(Ba),e=g.attr(ab),i=g.attr("style"),h=a.images,m=a.stitched,p=a.loops,o={x:Q(g.css(Ca)),y:Q(g.css(Da))},q=a.images?bb:b,r=d(R,h.length||a.frames);r=m?1:Ga(r/a.footage);var fa={display:"block",width:o.x,height:o.y};e="#"+e+a.suffix;var Ha=g.attr("className"),ga={position:"relative",width:o.x,height:o.y};ga=j(J,{id:e.substr(1),className:Ha+S+cb,css:ga});q=g.wrap(ga).attr({src:q,className:v,style:fa}).bind(B);t.push(q[0]);d(ha,h.length&&h.length||a.image||b.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,
"$1"+a.suffix+".$2"));d(Ia,Ha);d(D,a.frame);d(Ja,a.spacing);d(E,o);d(s,0);d(ia,a.steps||a.frames);d(T,a.revolution||m/2||o.x);d(ja,r);d(U,1/(c(R)-(p&&!m?0:1)));d(db,1/O(c(R),c(ia)));d(Ka,m);d(La,m-(p?0:o.x));d(Ma,o.x-a.indicator);d(V,e);d(x,d(ka,a.speed)<0);d(F,0);d(w,(a.row-1)/(a.rows-1));d(G,a.value||0);d(W,ca(1,!a.cw&&!m));d(Na,{src:b,style:i||Ea});da&&C.bind(ea,B.tick);l.call(f);g.trigger("start")},teardown:function(f){j(c(V)).replaceWith(j(g.clone()).attr(g.data(Na)).removeClass(v).addClass(c(Ia)));
X();C.unbind(Y).unbind(Z).unbind(ea,B.tick);l.call(f)},start:function(f){var b=c(E),e=c(R),i=O(e,c(ia));i=d(s,1/i*((a.step||a.frame)-1));d(D,i*e+1);e=c(ha);i=a.images;e=!i.length?[e]:[].concat(i);g.attr("id");var h=g[0];h.frames=e.length;h.preloads=h.preloads||[];h.preloaded=h.preloaded||0;var m=e.length!=h.preloads.length,p=g.parent(),o=j(J,{className:eb,css:{position:$,left:0,top:0,width:b.x,height:b.y,background:la,opacity:0}}).appendTo(p);o=d(ma,j(a.area||o));var q=g.add(a.couple);fb?hotspot.css({WebkitUserSelect:"none",
WebkitBackgroundSize:i.length?"auto":c(Ka)||b.x*a.footage+"px "+b.y*c(ja)*(a.rows||1)*(a.directional?2:1)+"px"}).bind(gb,function(r){q.trigger("down",[P(r).clientX,P(r).clientY,true]);return false}).bind(hb,function(r){q.trigger("slide",[P(r).clientX,P(r).clientY,true]);return false}).bind(ib,function(){q.trigger("up",[true]);return false}).bind(jb,function(){q.trigger("up",[true]);return false}):o.css({cursor:"url("+Oa+"), "+na}).bind(Z,function(r){q.trigger("over",[r.pageX,r.pageY])}).bind(kb,function(r,
fa){q.trigger("wheel",[fa]);return false}).bind(lb,function(){q.trigger("play")}).bind(a.clickfree?mb:nb,function(r){q.trigger("down",[r.clientX,r.clientY]);return false}).bind(a.clickfree?ob:Y,function(){q.trigger("up");return false}).disableTextSelect();a.hint&&o.attr(pb,a.hint);a.monitor&&p.append(oa=j(J,{className:qb,css:{position:$,left:0,top:0}}))||(oa=j());a.indicator&&p.append(Pa("x"));a.rows&&a.indicator&&p.append(Pa("y"));if(m)for(p.append(pa=j(J,{className:rb,css:{position:$,left:0,top:b.y-
a.preloader,height:a.preloader,backgroundColor:la}}));e.length;){i=new Image;m=a.path+e.shift();j(i).load(function(){h.preloaded++;pa.css({width:1/h.frames*h.preloaded*b.x});h.frames==h.preloaded&&pa.remove()});i.src=m;h.preloads.push(i)}a.delay>0&&y();a.value!=n&&g.trigger("valueChange",c(G));l.call(f);g.trigger(a.rows&&!a.stitched?"rowChange":"frameChange")},tick:function(f){var b=c(F);if(K){var e=z(b-sb*K);b=!(b*e<=0||b<A(e))&&d(F,b>A(c(ka))?e:(K=u=0))}oa.text(c(a.monitor));b&&K++;u&&u++;Qa(0);
g[0].value!=c(G)&&g.trigger("valueChange",g[0].value);if(u&&!b)return l.call(f);if(c(qa))return l.call(f,y());e=c(W)*ca(1,c(x));b=(c(ra)?b:A(c(ka))+b)/a.tempo;d(s,c(s)-b*e);l.call(f);g.trigger("fractionChange")},play:function(f){var b=d(sa,true);d(ra,!b);Ra();l.call(f)},pause:function(f){d(sa,false);y();l.call(f)},stop:function(f){var b=d(ra,true);d(sa,!b);l.call(f)},down:function(f,b,e,i){if(!a.dragable)return l.call(f);d(qa,true);d(F,0);ta(b,e,c(s),c(T),c(w));ua=n;y();X();!i&&C.bind(Z,function(h){g.trigger("slide",
[h.clientX,h.clientY]);l.call(h)}).css({cursor:ba(tb)+", "+na})&&!a.clickfree&&C.bind(Y,function(h){g.trigger("up");l.call(h)})&&c(ma);l.call(f)},up:function(f,b){if(!a.dragable)return l.call(f);d(qa,false);var e=d(F,!a.throwable?0:A(H[0]+H[1]+H[2])/60);K=e?1:0;e?Ra():y();X();!b&&C.unbind(Y).unbind(Z)&&c(ma).css({cursor:ba(Oa)+", "+na});l.call(f)},slide:function(f,b,e){if(!a.dragable)return l.call(f);var i=c(T),h=c(Sa),m=Qa(b-ua||0),p=d(s,Ta(b-h.x,c(va),i,c(wa),c(xa),c(W)));m&&d(x,m<0);if(a.rows){m=
c(E).y;var o=c(Ua),q=-o*m;d(w,z(j.reel.math.envelope(e-h.y,o,m,q,q+m,-1)))}!(p%1)&&!a.loops&&ta(b,e,p,i,c(w));y();ua=b;l.call(f);g.trigger("fractionChange")},wheel:function(f,b){if(!a.wheelable)return l.call(f);var e=Ga(ub(A(b))/2);e=ca(e,b>0);b=0.2*c(T);ta(n,n,c(s),b,c(w));d(s,Ta(e,c(va),b,c(wa),c(xa),c(W)));e&&d(x,e<0);d(F,0);y();l.call(f);g.trigger("fractionChange");return false},fractionChange:function(f,b,e){b=!b?c(s):d(s,b);b=a.loops?b-L(b):N(0,1,b);b=d(s,z(b));d(D,1+L(b/c(U)));d(G,z(j.reel.math.interpolate(b,
a.minimum,a.maximum)));if(!a.loops&&a.rebound){!u&&!(b%1)?ya++:(ya=0);ya>=a.rebound*1E3/a.tempo&&d(x,!c(x))}l.call(f);e||g.trigger("valueChange");g.trigger(a.rows&&!a.stitched?"rowChange":"frameChange")},rowChange:function(f,b){var e=L(c(s)/c(U))+1;b=d(w,N(0,1,z(b!=n?(b-1)/(a.rows-1):c(w))));d(D,e+(!a.rows?0:M(b*(a.rows-1))*a.frames));l.call(f);g.trigger("frameChange")},frameChange:function(f,b){var e=!b?c(s):d(s,z(c(U)*(b-1)));b=d(D,M(b?b:c(D)));var i=a.images,h=a.footage,m=a.horizontal;if(a.stitched)m=
[-M(e*c(La))+I,0+I];else{var p=b%h-1;p=p<0?h-1:p;var o=L((b-0.1)/h);o+=a.rows?0:c(x)?0:c(ja);h=c(E);var q=c(Ja);o=o*((m?h.y:h.x)+q);p=p*((m?h.x:h.y)+q);m=i.length?[0,0]:m?[-p+I,-o+I]:[-o+I,-p+I]}b=i[b-1]||c(ha);i=c(Ma);e=N(0,i,M(j.reel.math.interpolate(e,-1,i+2)));e=!a.cw||a.stitched?e:i-e;i={background:ba(a.path+b)+S+m.join(S)};a.images.length?g.attr({src:a.path+b}):g.css(i);j(aa(za+".x"),c(V)).css({left:e});if(!a.rows)return l.call(f);e=c(E).y-a.indicator;e=N(0,e,M(j.reel.math.interpolate(c(w),
-1,e+2)));j(aa(za+".y"),c(V)).css({top:e});l.call(f)},valueChange:function(f,b){f=b!==n&&d(s,b/(a.maximum-a.minimum));g[0].value=b===n?c(G):d(G,b);f===false||g.trigger("fractionChange",[n,true])}},u,K=0,Ra=function(){return u=0},y=function(){return u=-a.timeout*a.tempo},oa,pa,Pa=function(f){return j(J,{className:[za,f].join(S),css:{width:a.indicator,height:a.indicator,top:f=="y"?n:c(E).y-a.indicator,left:f=="x"?n:0,position:$,backgroundColor:la}})},ya=0,ua=0,Qa=function(f){return H.push(f)&&H.shift()&&
f},X=function(){return H=[0,0,0]},H=X(),sb=a.brake/a.tempo,Ta=a.graph||j.reel.math[a.loops?"hatch":"envelope"],ta=function(f,b,e,i,h){d(va,e);d(Ua,h);d(wa,a.loops?0:-e*i);d(xa,a.loops?i:i-e*i);return f&&d(Sa,{x:f,y:b})||n};B.setup()});return j(t)};j.reel.math={envelope:function(k,a,t,g,d,c){return a+O(g,Aa(d,-k*c))/t},hatch:function(k,a,t,g,d,c){k=(k<g?d:0)+k%d;k=a+-k*c/t;return k-L(k)},interpolate:function(k,a,t){return a+k*(t-a)}};Xa("mousewheel disableTextSelect enableTextSelect".split(/ /));var C=
j(Va),fb=/iphone|ipod|ipad|android/i.test(navigator.userAgent),$a=j.browser.msie,na="ew-resize",da,v="jquery-reel",cb=v+"-overlay",za=v+"-indicator",rb=v+"-preloader",qb=v+"-monitor",eb=v+"-interface",bb="data:image/gif;base64,R0lGODlhCAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7",Oa="data:image/gif;base64,R0lGODlhEAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAI3lC8AeBDvgosQxQtne7yvLWGStVBelXBKqDJpNzLKq3xWBlU2nUs4C/O8cCvU0EfZGUwt19FYAAA7",tb="data:image/gif;base64,R0lGODlhEAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAIslI95EB3MHECxNjBVdE/5b2zcRV1QBabqhwltq41St4hj5konmVioZ6OtEgUAOw==",
M=Math.round,L=Math.floor,Ga=Math.ceil,Aa=Math.min,O=Math.max,A=Math.abs,ub=Math.sqrt,Q=parseInt,ma="area",Na="backup",x="backwards",U="bit",Ia="classes",qa="clicked",Sa="clicked_location",va="clicked_on",Ua="clicked_row",W="cwish",E="dimensions",s="fraction",D="frame",R="frames",xa="hi",ha="image",Ma="indicator_travel",wa="lo",sa="playing",T="revolution",w="row",ja="rows",Ja="spacing",ka="speed",V="stage",ia="steps",Ka="stitched",La="stitched_travel",ra="stopped",G="value",F="velocity",db="wheel_step",
lb="dblclick.reel",nb="mousedown.reel",mb="mouseenter.reel",ob="mouseleave.reel",Z="mousemove.reel",Y="mouseup.reel",kb="mousewheel.reel",ea="tick.reel",jb="touchcancel.reel",ib="touchend.reel",gb="touchstart.reel",hb="touchmove.reel",Ea="",S=" ",$="absolute",Fa="div",J=Wa(Fa),Da="height",la="#000",ab="id",Za="img",I="px",Ba="src",pb="title",Ca="width"})(jQuery,window,document);
