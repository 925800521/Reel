/* Copyright (c) 2009-2010 Petr Vostrel (http://www.pisi.cz/)
 * Dual licensed under the MIT (MIT-LICENSE.txt)
 * and GPL (GPL-LICENSE.txt) licenses.
 *
 * http://www.vostrel.cz/jquery/reel/
 * Version: 1.0.3.GH-4-patch
 * Updated: 2010-04-17
 *
 * Requires jQuery 1.3.x or higher
 */
(function(k){function n(p){return+p.toString().replace(/[^0-9]+/,"")}k.fn.reel=function(p){var s={footage:6,frame:1,frames:36,horizontal:true,hotspot:undefined,hint:"",indicator:0,klass:"",loops:true,reversed:false,saves:false,sensitivity:20,spacing:0,stitched:undefined,suffix:"-reel",tooltip:""};return function(c){var a=[];c.filter("img").each(function(){var m=k(this),f=m.attr("src"),h=n(m.css("width")),o=n(m.css("height"));!f||f==""||!h||!o||a.push(m)});return k(a)}(this).each(function(){var c=
k(this),a=k.extend(s,p),m=k(document),f=function(d,b){c.data(d,b);c.trigger("store");return b},h=function(d){d=c.data(d);c.trigger("recall");return d},o={init:function(){var d=c.attr("class"),b=c.attr("src").replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2"),e={x:n(c.css("width")),y:n(c.css("height"))};d=k("<div>").attr("class",d).addClass("jquery-reel").addClass(a.klass);var l=a.saves?{opacity:0}:{display:"none"};c=c.wrap(d).css(l).parent().css({width:e.x+"px",height:e.y+"px",backgroundImage:"url("+
b+")"});for(var j in o)c.bind(j,o[j]);k.each(["mousewheel","disableTextSelect"],function(q,g){k.fn[g]||(k.fn[g]=function(){return this})});c.trigger("setup")},setup:function(){var d={x:n(c.css("width")),y:n(c.css("height"))};f("frames",a.frames);f("spacing",a.spacing);f("offset",c.offset());f("dimensions",d);c.trigger("start")},start:function(){var d=a.hotspot?a.hotspot:c,b=h("dimensions");d.css({cursor:"ew-resize"}).mouseenter(function(){c.trigger("enter")}).mouseleave(function(){c.trigger("leave")}).mousemove(function(e){c.trigger("over",
[e.clientX,e.clientY])}).mousewheel(function(e,l){c.trigger("wheel",[l]);return false}).dblclick(function(){c.trigger("animate")}).mousedown(function(e){c.trigger("down",[e.clientX,e.clientY])}).disableTextSelect();if(a.hint||a.tooltip)d.attr("title",a.hint||a.tooltip);a.indicator&&c.append(k("<div>").addClass("indicator").css({width:a.indicator+"px",height:a.indicator+"px",top:b.y-a.indicator+"px",position:"relative",backgroundColor:"#000"}));c.trigger("frameChange",a.frame)},animate:function(){},
down:function(d,b){f("clicked",true);f("clicked_location",b);f("last_frame",f("clicked_on_frame",h("frame")));m.mousemove(function(e){c.trigger("drag",[e.clientX,e.clientY])}).mouseup(function(){c.trigger("up")})},up:function(){f("clicked",false);m.unbind("mousemove mouseup")},drag:function(d,b){var e=h("clicked_location");d=h("clicked_on_frame");h("frames");b=Math.round((e-b)/a.sensitivity);f("frame",d-(a.reversed?-1:1)*(a.stitched?-1:1)*b);c.trigger("frameChange")},frameChange:function(d,b){b=!b?
h("frame"):f("frame",b);var e=h("last_frame");d=h("frames");var l=h("dimensions"),j=h("spacing");b=!a.loops&&b>d?d:b;b=!a.loops&&b<1?1:b;b-=Math.floor(b/d)*d;b=f("last_frame",f("frame",b<1?d:b));e=b-e;e=Math.abs(e)>10?0-e:e;e=f("reversed",e!=0?e>0:h("reversed"));if(a.stitched){g=Math.round((b-1)*(-(a.stitched-l.x)/d));i=0;j=g+"px "+i+"px"}else{g=Math.floor(b/a.footage);i=b-g*a.footage-1;g=i==-1?g+i:g;i=i==-1?a.footage+i:i;var q=a.horizontal?l.y:l.x,g=-g*(j+q),i=-i*(j+(a.horizontal?l.x:l.y)),r=Math.ceil(d/
a.footage);j=r*q+(r-1)*j;g=e&&a.horizontal?g-j:g;i=e&&!a.horizontal?i-j:i;j=a.horizontal?i+"px "+g+"px":g+"px "+i+"px"}b=(l.x-a.indicator)/(d-1)*(b-1)+"px";c.css({backgroundPosition:j}).find(".indicator").css({left:b})},wheel:function(d,b){d=h("frame");h("frames");var e=Math.ceil(Math.sqrt(Math.abs(b)));e=b<0?-e:e;f("frame",d-(a.reversed?-1:1)*e);c.trigger("frameChange");return false}};c.ready(o.init)})}})(jQuery);
