/*
 Copyright (c) 2009-2012 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 jQuery Reel
 http://jquery.vostrel.cz/reel
 Version: 1.1.3-devel
 Updated: 2012-01-28

 Requires jQuery 1.5 or higher
*/
jQuery.reel||function(k,Lb,Oa,p){function Mb(f){return o.instances.push(f[0])&&f}function Nb(f){return(o.instances=o.instances.not(ma(f.attr(ea))))&&f}function O(f){return o.instances.length?o.instances.first().data(f):null}function Ob(f){return"data:image/gif;base64,R0lGODlh"+f}function P(f){return"<"+f+"/>"}function s(f){return"."+(f||"")}function va(f){return o.cdn+f}function wa(f){return"url("+f+")"}function fa(f,j,q){return na(f,Pa(j,q))}function Pb(f){function j(){k.fn[this]||(k.fn[this]=function(){return this})}
k.each(f,j)}function Qa(f,j){return Q(f)*(j?-1:1)}function xa(f){return ya?f.touch||f.originalEvent.touches[0]:f}function V(f){return f===p||typeof f==kb?f:f+W}function ma(f){return"#"+f}if(+k().jquery.replace(s(),"").substr(0,2)<15)throw"VersionError: far too old jQuery for running Reel";var o=k.reel={version:"1.2alpha",def:{area:p,brake:0.23,clickfree:false,cw:false,delay:-1,directional:false,draggable:true,footage:6,entry:p,frame:1,frames:36,graph:p,hint:"",horizontal:true,image:p,images:[],indicator:0,
inversed:false,klass:"",laziness:6,loops:true,monitor:p,opening:0,orbital:0,path:"",preloader:2,rebound:0.5,revolution:p,row:1,rows:0,spacing:0,speed:0,step:p,steps:p,stitched:0,suffix:"-reel",tempo:36,timeout:2,throwable:true,vertical:false,wheelable:true,annotations:p,attr:{},cursor:p,preload:"fidelity",scrollable:true,steppable:true,sequence:"",velocity:0},fn:{reel:function(){var f=arguments,j=k(this),q=j.data(),r=f[0],t=f[1];if(f.length==2){if(t!==p){try{t=o.normal[r](t,q)}catch(F){}if(q[r]!==
t)if(q[r]===p)q[r]=t;else j.trigger(r+"Change",[p,q[r]=t])}return j.trigger("store",[r,t])}else if(typeof r=="string"){t=q[r];j.trigger("recall",[r,t]);return t}else{var a=k.extend({},o.def,r);f=function(i){var d=[];i.filter(Ra).each(function(){var c=k(this),v=a.images.length&&a.images||a.sequence||a.image||a.attr.src||c.attr(lb),D=za(a.attr.width||c.css(Sa)),z=za(a.attr.height||c.css(mb));v&&v!=G&&D&&z&&d.push(c)});i.filter(s(w)).each(function(){d.push(k(this).unreel())});return k(d)}(this);var J=
[];a.tooltip&&(a.hint=a.tooltip);a.hotspot&&(a.area=a.hotspot);f.each(function(){var i=k(this),d=function(b,e){return i.reel(b,e)&&e},c=function(b){return i.reel(b)},v={setup:function(){if(!i.hasClass(w)){var b=i.attr(a.attr).attr(lb),e=d(ea,i.attr(ea)||i.attr(ea,w+"-"+ +new Date).attr(ea)),h=i.attr(oa),g=k.extend({},i.data()),l=o.re.sequence.exec(d(Qb,a.sequence));l=d(X,l?o.sequence(l,a,c):a.images);var n=a.stitched,m=a.loops,y={x:za(i.css(Sa)||a.attr.width),y:za(i.css(mb)||a.attr.height)},A=d(pa,
a.frame),R=d(Aa,a.orbital&&a.footage||a.rows<=1&&l.length||a.frames),ga=n?1:nb(R/a.footage);e=ma(e+a.suffix);var ob=i.attr("class")||G;A=k(P(qa),{id:e.substr(1),"class":ob+B+Rb+B+pb+A});A=i.wrap(A.addClass(a.klass)).attr({"class":w});J.push(Mb(A)[0]);A=A.parent().bind(v.instance);d(Ta,a);d(Ua,l.length?G:a.image||b.replace(o.re.image,"$1"+a.suffix+".$2"));d(qb,[]);d(rb,a.spacing);d(H,y);d(u,0);d(Va,a.steps||a.frames);d(Ba,a.revolution||n/2||y.x*2);d(Wa,ga);d(Ca,1/(R-(m&&!n?0:1)));d(Sb,1/na(R,c(Va)));
d(Xa,n);d(sb,n-(m?0:y.x));d(Ya,e);d(K,d(Da,a.speed)<0);d(Y,a.velocity||0);d(ha,a.vertical);d(Z,0);d(L,(a.row-1)/(a.rows-1));d(ia,Qa(1,!a.cw&&!n));d(Za,{});d(ra,false);d(Ea,d($a,0));d(Fa,d(Ga,0));d(sa,false);d(tb,a.brake);d(ab,!!a.orbital);d(S,a.tempo/(o.lazy?a.laziness:1));d($,-1);d(Ha,a.annotations)||A.unbind(s(Ha));d(ub,{src:b,classes:ob,style:h||G,data:g});a.steppable||A.unbind("click.steppable");C(G,{width:y.x,height:y.y,overflow:bb,position:"relative"});C(aa+B+s(w),{display:vb});M.bind(v.pool);
i.trigger("setup")}},instance:{teardown:function(){var b=i.data(ub);i.parent().unbind(v.instance);c(oa).remove();c(wb).enableTextSelect();Nb(i.unbind(T).removeData().siblings().unbind(T).remove().end().attr({"class":b.classes,src:b.src,style:b.style}).data(b.data).unwrap());Ia();M.unbind(v.pool);N.unbind(U)},setup:function(){function b(n){return function(m){if(m.button==Tb)return m.preventDefault()||i.trigger("down",[xa(m).clientX,xa(m).clientY])&&n}}var e=c(H),h=c(Aa);h=na(h,c(Va));i.attr(ea);var g=
i.parent();area=d(wb,k(a.area||g));if(ya){C(B+s(w),{WebkitUserSelect:Ja,WebkitBackgroundSize:c(X).length?p:c(Xa)&&V(c(Xa))+B+V(e.y)||V(e.x*a.footage)+B+V(e.y*c(Wa)*(a.rows||1)*(a.directional?2:1))});area.bind(Ub,b())}else{e=a.cursor==xb?Vb:a.cursor||Wb;var l=a.cursor==xb?Xb+B+"!important":p;C(G,{cursor:e});C(s(cb),{cursor:Yb});C(s(Ka)+aa+s(Ka)+" *",{cursor:l||e},true);area.bind(a.wheelable?Zb:G,function(n,m){return n.preventDefault()||!m||i.trigger("wheel",[m])&&false}).bind(a.clickfree?$b:ac,b()).disableTextSelect()}a.hint&&
area.attr(bc,a.hint);a.indicator&&g.append(ta(cc));a.rows>1&&a.indicator&&g.append(ta(dc));a.monitor&&g.append(yb=k(P(qa),{"class":zb}))&&C(B+s(zb),{position:La,left:0,top:0});C(B+s(Ab),{display:Ja});d(u,1/h*((a.step||a.frame)-1))},preload:function(){var b=c(H),e=i.parent(),h=c(Ua),g=c(X),l=!g.length,n=c(Aa),m=o.preload[a.preload]||o.preload[o.def.preload];h=l?[h]:m(g.slice(0),a,c);d(Z,l?0.5:0);g=[];e.addClass(cb).append(ja());for(i.trigger("stop");h.length;){var y=a.path+h.shift(),A=b.x*(!l?1:a.footage),
R=b.y*(!l?1:n/a.footage)*(!a.directional?1:2),ga=k(P(Ra)).attr({"class":Ab}).appendTo(e);setTimeout(function(){if(ga.parent().length){ga.attr({src:y,width:A,height:R});i.reelTriggerOnce("preloaded",function(){return!!ga.parent().length&&ga[0].complete})}},g.length-h.length);g.push(y)}d(qb,g);d(oa,k("<"+oa+' type="text/css">'+C.rules.join("\n")+"</"+oa+">").prependTo(db))},preloaded:function(){var b=c(X).length||1;if(d(Z,Pa(c(Z)+1,b))===b){i.parent().removeClass(cb);i.unbind(Z,v.instance.preloaded).trigger("loaded")}},
loaded:function(){c(X).length>1||i.css({backgroundImage:wa(a.path+c(Ua))}).attr({src:ec})},opening:function(){if(!a.opening)return i.trigger("openingDone");var b=a.entry||a.speed,e=c(u),h=a.opening;d(u,e-b*a.opening);d($,h*O(S))},openingDone:function(){if(a.delay)I=setTimeout(function(){i.trigger("play")},a.delay*1E3);else i.trigger("play")},play:function(b,e){e=d(Da,e||c(Da));b=d(eb,!!e);d(fb,!b);ba()},pause:function(){d(eb,false);E()},stop:function(){var b=d(fb,true);d(eb,!b)},down:function(b,e,
h){function g(n){return function(m){m.preventDefault();i.trigger("pan",[xa(m).clientX,xa(m).clientY,m]);return n}}function l(n){return function(m){m.preventDefault();i.trigger("up");return n}}if(a.draggable){d(ra,c(pa));d(Y,0);b=!c(sa)||a.rows<=1||!a.orbital||a.scrollable;Ma=Na(e,h,c(u),c(Ba),c(L));E();Ia();x=false;k(Bb,N).addClass(Ka);ya?N.bind(fc,g(!b)).bind(gc+B+hc,l()):N.bind(ic,g()).bind(a.clickfree?jc:kc,l())}},up:function(){if(a.draggable){d(ra,false);d(sa,false);var b=d(Y,!a.throwable?0:Q(ua[0]+
ua[1])/60);ca=b?1:0;b?ba():E();Ia();k(Bb,N).removeClass(Ka);N.unbind(U)}},pan:function(b,e,h,g){if(a.draggable&&gb){gb=false;E();b=g&&!k(g.currentTarget).is(M)?lc.offset():{left:0,top:0};e-=b.left;h-=b.top;var l={x:e-Ma.x,y:h-Ma.y};if(Q(l.x)>0||Q(l.y)>0){x=true;Ma={x:e,y:h};b=c(Ba);g=c(Za);var n=c(ha),m=Cb(n?h-g.y:e-g.x,c(Ea),b,c(Fa),c(Ga),c(ia),n?h-g.y:e-g.x);d(sa,c(sa)||c(pa)!=c(ra));(l=Db(n?l.y:l.x||0))&&d(K,l<0);if(a.orbital&&c(ab)){d(ha,Q(h-g.y)>Q(e-g.x));g=Na(e,h,m,b,c(L))}if(a.rows>1){l=c(H).y;
l=a.rows>3?l:l/(5-a.rows);n=c($a);var y=-n*l;d(L,o.math.envelope(h-g.y,n,l,y,y+l,-1))}!(m%1)&&!a.loops&&Na(e,h,m,b,c(L));d(u,m)}}},wheel:function(b,e){b=nb(mc(Q(e))/2);b=Qa(b,e>0);e=0.0833*c(Ba);Na(p,p,c(u),e,c(L));b&&d(K,b<0);d(Y,0);d(u,Cb(b,c(Ea),e,c(Fa),c(Ga),c(ia)));E();i.trigger("up");return false},fractionChange:function(b,e,h){if(e!==p)return d(u,e);b=1+ka(h/c(Ca));e=a.rows>1;var g=a.orbital;d(ab,!!g&&(b<=g||b>=a.footage-g+2));if(!a.loops&&a.rebound){!z&&!(h%1)?hb++:(hb=0);hb>=a.rebound*1E3/
O(S)&&d(K,!c(K))}if(e){h=fa(0,a.rows-1,ka(c(L)*a.rows));b=ka(b+h*a.frames)}d(pa,b)},rowChange:function(b,e){if(e!==p)return d(L,e)},frameChange:function(b,e,h){if(e!==p)return d(pa,e);b=c(u);var g=a.footage;if(a.orbital&&c(ha)){h=a.inversed?g+1-h:h;h+=g}var l=a.horizontal,n=c(X),m=!n.length;e=c(H);if(m){if(a.stitched)e=[-da(b*c(sb))+W,0+W];else{m=h%g-1;m=m<0?g-1:m;g=ka((h-0.1)/g);g+=a.rows>1?0:c(K)?0:c(Wa);h=c(rb);g=g*((l?e.y:e.x)+h);e=m*((l?e.x:e.y)+h);e=n.length?[0,0]:l?[-e+W,-g+W]:[-g+W,-e+W]}i.css({backgroundPosition:e.join(B)})}else i.attr({src:a.path+
n[h-1]});if(a.indicator){c(Ya);l=a.rows>1;e=c(H);n=(c(ha)?e.y:e.x)-a.indicator;b=fa(0,n,da(o.math.interpolate(b,-1,n+2)));b=!a.cw||a.stitched?b:n-b;ta.$x.css(c(ha)?{left:0,top:b}:{left:b,top:e.y-a.indicator});if(l){b=e.y-a.indicator;b=fa(0,b,da(o.math.interpolate(c(L),-1,b+2)));ta.$y.css({top:b})}}},stepLeft:function(){E();d(K,false);d(u,c(u)-c(Ca)*c(ia))},stepRight:function(){E();d(K,true);d(u,c(u)+c(Ca)*c(ia))},"click.steppable":function(b){if(x)return D(b,false);i.trigger(b.clientX-i.offset().left>
0.5*c(H).x?"stepRight":"stepLeft")},"setup.annotations":function(){c(H);var b=i.parent();k.each(c(Ha),function(e,h){var g=typeof h.node==kb?k(h.node):h.node||{};g=g.jquery?g:k(P(qa),g);g=g.attr({id:e}).addClass(nc);var l=h.image?k(P(Ra),h.image):k(),n=h.link?k(P(oc),h.link):k();C(ma(e),{display:Ja,position:La},true);g.bind({"click.annotations":function(m){m.stopPropagation()}});h.image||h.link&&g.append(n);h.link||h.image&&g.append(l);h.link&&h.image&&g.append(n.append(l));g.appendTo(b)})},"frameChange.annotations":function(b,
e){this.className=this.className.replace(o.re.frame_klass,pb+e);c(Y)||k.each(c(Ha),function(h,g){h=k(ma(h));var l=g.start||1,n=g.end,m=e-1,y=g.at?g.at[m]=="+":false;m=g.at?m:m-l+1;var A=typeof g.x!=Eb?g.x:g.x[m],R=typeof g.y!=Eb?g.y:g.y[m];g={display:A!==p&&R!==p&&(g.at?y:m>=0&&(!n||m<=n-l))?vb:Ja,left:V(A)||0,top:V(R)||0};h.css(g)})},"setup.fu":function(){i.trigger("preload")},"loaded.fu":function(){i.trigger("opening")}},pool:{"tick.reel":function(b){var e=c(Y);if(ca){e=e-c(tb)/O(S)*ca;e=d(Y,e>
0.1?e:(ca=z=0))}a.monitor&&yb.text(c(a.monitor));e&&ca++;z&&z++;Db(0);gb=true;if(z&&!e)return D(b);if(c(ra))return D(b,E());if(!(c($)>0)){b=c(ia)*Qa(1,c(K));e=(c(fb)?e:Q(c(Da))+e)/O(S);d(u,c(u)-e*b)}},"tick.reel.preload":function(){var b=c(H),e=parseInt(ja.$.css(Sa)),h=c(X).length||1,g=da(1/h*c(Z)*b.x);ja.$.css({width:e+(g-e)/3+1});if(c(Z)===h&&e>b.x-2){ja.$.fadeOut(300,function(){ja.$.remove()});M.unbind(la+s(Fb),v.pool[la+s(Fb)])}},"tick.reel.opening":function(){var b=la+s(ib);if(!a.opening||!c($))return M.unbind(b,
v.pool[b]);b=(a.entry||a.speed)/O(S)*(a.cw?-1:1);var e=c(u);d(u,e+b);e=d($,c($)-1);d(u,c(u)+b);e||i.trigger("openingDone")}}},D=function(b,e){return b.stopImmediatePropagation()||e},z,ca=0,ba=function(){return z=0},E=function(){clearTimeout(I);M.unbind(la+s(ib),v.pool[la+s(ib)]);d($,0);i.trigger("play");return z=-a.timeout*O(S)},x=false,I,yb=k(),ja=function(){C(B+s(Gb),{position:La,left:0,top:c(H).y-a.preloader,height:a.preloader,overflow:bb,backgroundColor:Hb});return ja.$=k(P(qa),{"class":Gb})},
ta=function(b){C(B+s(Ib)+s(b),{position:La,width:a.indicator,height:a.indicator,overflow:bb,backgroundColor:Hb});return ta["$"+b]=k(P(qa),{"class":Ib+B+b})},C=function(b,e,h){function g(l){var n=[];k.each(l,function(m,y){n.push(m.replace(/([A-Z])/g,"-$1").toLowerCase()+":"+V(y)+";")});return"{"+n.join(G)+"}"}h=h?G:c(Ya);b=b.replace(/^/,h).replace(aa,aa+h);return C.rules.push(b+g(e))&&e},hb=0,Ma={x:0,y:0},Db=function(b){return ua.push(b)&&ua.shift()&&b},Ia=function(){return ua=[0,0]},ua=Ia(),Cb=a.graph||
o.math[a.loops?"hatch":"envelope"],Na=function(b,e,h,g,l){d(Ea,h);d($a,l);d(Fa,a.loops?0:-h*g);d(Ga,a.loops?g:g-h*g);return b&&d(Za,{x:b,y:e})||p},gb=true,N;try{N=k.unique(M.add(Lb.top.document))}catch(qc){N=M}var lc=top===self?k():function(b){k("iframe",N.last()).each(function(){try{if(k(this).contents().find(db).html()==k(db).html())return(b=k(this))&&false}catch(e){}});return b}();C.rules=[];v.setup()});Jb=Jb||function i(){var d=+new Date,c=O(S),v;if(c){M.trigger(la);o.cost=(+new Date+o.cost-d)/
2;v=setTimeout(i,na(4,1E3/c-o.cost))}return v}();return k(J)}},unreel:function(){return this.trigger("teardown")}},re:{image:/^(.*)\.(jpg|jpeg|png|gif)$/,touchy_agent:/iphone|ipod|ipad|android/i,lazy_agent:/iphone|ipod|android/i,frame_klass:/frame-\d+/,sequence:/(^[^#|]*([#]+)[^#|]*)($|[|]([0-9]+)\.\.([0-9]+))($|[|]([0-9]+)$)/},cdn:"http://code.vostrel.cz/",math:{envelope:function(f,j,q,r,t,F){return j+na(r,Pa(t,-f*F))/q},hatch:function(f,j,q,r,t,F){f=(f<r?t:0)+f%t;f=j+-f*F/q;return f-ka(f)},interpolate:function(f,
j,q){return j+f*(q-j)}},preload:{linear:function(f){return f},fidelity:function(f,j){function q(i,d,c){function v(I){for(;!(I>=1&&I<=ba);)I+=I<1?+ba:-ba;return J[c+I]||(J[c+I]=!!D.push(I))}if(!i.length)return[];var D=[],z=4*d,ca=j.frame,ba=i.length;d=true;for(var E=ba/z,x=0;x<z;x++)v(ca+da(x*E));for(;E>1;){x=0;z=D.length;E/=2;for(d=!d;x<z;x++)v(D[x]+(d?1:-1)*da(E))}for(x=0;x<D.length;x++)D[x]=i[D[x]-1];return D}var r=j.orbital?2:j.rows||1,t=j.orbital?j.footage:j.frames,F=(j.row-1)*t,a=[].concat(f),
J=new Array(f.length);f=r<2?[]:a.slice(F,F+t);return q(f,1,F).concat(q(a,r,0))}},normal:{fraction:function(f,j){return j[Ta].loops?f-ka(f):fa(0,1,f)},row:function(f){return fa(0,1,f)},frame:function(f,j){var q=j[Ta];j=j[Aa]*(q.orbital?2:q.rows||1);f=da(q.loops?f%j||j:fa(1,j,f));return f<0?f+j:f}},sequence:function(f,j){function q(i,d,c){for(;i.length<d;)i=c+i;return i}if(f.length<=1)return j.images;var r=[],t=f[1],F=f[2],a=+f[4]||1,J=j.orbital?2:j.rows||1;j=j.orbital?j.footage:j.frames;J=+(f[5]||
J*j);f=+f[7]||1;for(j=0;j<J;){r.push(t.replace(F,q(a+j+G,F.length,"0")));j+=f}return r},instances:k(),leader:O,cost:0},M=k(Oa);Oa=+k.browser.version.split(s()).slice(0,2).join(s());var pc=k.browser.msie,Kb=navigator.userAgent,ya=o.touchy,Jb,w="reel",Rb=w+"-overlay",Ib=w+"-indicator",Gb=w+"-preloader",Ab=w+"-cached",zb=w+"-monitor",nc=w+"-annotation",Ka=w+"-panning",cb=w+"-loading",pb="frame-",da=Math.round,ka=Math.floor,nb=Math.ceil,Pa=Math.min,na=Math.max,Q=Math.abs,mc=Math.sqrt,za=parseInt,Ha="annotations",
wb="area",ub="backup",K="backwards",Ca="bit",tb="brake",qb="cached",ab="center",ra="clicked",Za="clicked_location",Ea="clicked_on",$a="clicked_row",ia="cwish",H="dimensions",u="fraction",pa="frame",Aa="frames",db="head",Ga="hi",bb="hidden",Ua="image",X="images",$="opening_ticks",Fa="lo",Ta="options",eb="playing",Z="preloaded",sa="reeling",Ba="revolution",L="row",Wa="rows",Qb="sequence",rb="spacing",Da="speed",Ya="stage",Va="steps",Xa="stitched",sb="stitched_travel",fb="stopped",oa="style",S="tempo",
Y="velocity",ha="vertical",Sb="wheel_step",T=s(w),U=".pan"+T,ac="mousedown"+T,$b="mouseenter"+T,jc="mouseleave"+U,ic="mousemove"+U,kc="mouseup"+U,Zb="mousewheel"+T,la="tick"+T,hc="touchcancel"+U,gc="touchend"+U,Ub="touchstart"+T,fc="touchmove"+U,G="",B=" ",aa=",",La="absolute",oc="a",vb="block",qa="div",xb="hand",mb="height",Hb=ma("000"),Bb="html",ea="id",Ra="img",jb="jquery."+w,Ja="none",Eb="object",ib="opening",Fb="preload",W="px",lb="src",kb="string",bc="title",Sa="width",cc="x",dc="y",ec=Ob("CAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7")||
va("blank.gif"),Yb="wait",Wb=wa(va(jb+s("cur")))+aa+"move",Vb=wa(va(jb+"-drag"+s("cur")))+aa+"move",Xb=wa(va(jb+"-drag-down"+s("cur")))+aa+"move",Tb=ya?p:pc&&Oa<=8?1:0;o.touchy=o.re.touchy_agent.test(Kb);o.lazy=o.re.lazy_agent.test(Kb);Pb("disableTextSelect enableTextSelect".split(/ /));k.extend(k.fn,o.fn);k.fn.reelTriggerOnce=function(f,j){return function q(r){j()?r.trigger(f):setTimeout(function(){q(r)},100);return r}(k(this))}}(jQuery,window,document);
