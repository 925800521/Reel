/*
 Copyright (c) 2009-2012 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 jQuery Reel
 http://jquery.vostrel.cz/reel
 Version: 1.1.3-devel
 Updated: 2012-01-07

 Requires jQuery 1.4.3 or higher
*/
jQuery.reel||function(g,Ib,Ma,r){function K(e){return g.reel.instances.length?g.reel.instances.first().data(e):null}function Jb(e){return g.reel.instances.push(e[0])&&e}function Kb(e){return(g.reel.instances=g.reel.instances.not(ga(e.attr(aa))))&&e}function Lb(e){return"data:image/gif;base64,R0lGODlh"+e}function S(e){return"<"+e+"/>"}function q(e){return"."+(e||"")}function qa(e){return g.reel.cdn+e}function ra(e){return"url("+e+")"}function ba(e,a,p){return ha(e,gb(a,p))}function Mb(e){function a(){g.fn[this]||
(g.fn[this]=function(){return this})}g.each(e,a)}function Na(e,a){return L(e)*(a?-1:1)}function sa(e){return e.originalEvent.touches[0]}function T(e){return e===r||typeof e=="string"?e:e+U}function ga(e){return"#"+e}function Nb(e){var a=[];g.each(e,function(p,h){a.push(p.replace(/([A-Z])/g,"-$1").toLowerCase()+":"+T(h))});return"{"+a.join(";")+";}"}function Ob(){var e=g().jquery.split(".");if(e=+e[0]<=1&&(+e[1]<4||+e[1]==4&&+e[2]<3))try{console.error("FATAL: jQuery Reel plug-in requires at least jQuery 1.4.3")}catch(a){}return e}
if(!Ob()){g.reel={version:"1.2alpha",def:{area:r,brake:0.23,clickfree:false,cw:false,delay:-1,directional:false,draggable:true,footage:6,entry:r,frame:1,frames:36,graph:r,hint:"",horizontal:true,image:r,images:[],indicator:0,inversed:false,klass:"",laziness:6,loops:true,monitor:r,opening:0,orbital:0,path:"",preloader:4,rebound:0.5,revolution:r,row:1,rows:0,spacing:0,speed:0,step:r,steps:r,stitched:0,suffix:"-reel",tempo:36,timeout:2,throwable:true,vertical:false,wheelable:true,annotations:r,attr:{},
cursor:r,preload:"fidelity",scrollable:true,steppable:true,sequence:"",velocity:0}};g.fn.reel=function(e){var a=g.extend({},g.reel.def,e);e=function(h){var u=[];h.filter(hb).each(function(){var c=g(this),d=a.images.length&&a.images||a.image||a.attr.src||c.attr(ib),v=ta(a.attr.width||c.css(jb)),o=ta(a.attr.height||c.css(kb));!d||d==M||!v||!o||u.push(c)});h.filter(q(z)).each(function(){u.push(g(this).unreel())});return g(u)}(this);var p=[];a.tooltip&&(a.hint=a.tooltip);a.hotspot&&(a.area=a.hotspot);
e.each(function(){var h=g(this),u=h.data(),c=function(i,b){u[i]=b;h.trigger("store",[i,b]);return b},d=function(i){var b=u[i];h.trigger("recall",[i,b]);return b},v={setup:function(i){if(h.hasClass(z))return o.call(i);var b=h.attr(a.attr).attr(ib),f=c(aa,h.attr(aa)||h.attr(aa,z+"-"+ +new Date).attr(aa)),j=h.attr(ia),k=g.extend({},h.data()),m=g.reel.sequence_pattern.exec(c(Pb,a.sequence));m=c(Oa,m?g.reel.build_sequence(m,a,d):a.images);var l=a.stitched,n=a.loops,s={x:ta(h.css(jb)||a.attr.width),y:ta(h.css(kb)||
a.attr.height)},x=c(H,a.frame),N=c(ua,a.orbital&&a.footage||a.rows<=1&&m.length||a.frames),Pa=l?1:lb(N/a.footage);f=ga(f+a.suffix);var va=h.attr("class")||"";x=g(S(ja),{id:f.substr(1),"class":va+C+Qb+C+mb+x});x=h.wrap(x.addClass(a.klass)).attr({"class":z});p.push(Jb(x)[0]);x=x.parent().bind(v.instance);c(Rb,a);c(nb,m.length?M:a.image||b.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2"));c(Qa,[]);c(Ra,0);c(ob,a.spacing);c(O,s);c(t,0);c(Sa,a.steps||a.frames);c(wa,a.revolution||l/2||s.x*2);c(Ta,
Pa);c(ca,1/(N-(n&&!l?0:1)));c(Sb,1/ha(N,d(Sa)));c(Ua,l);c(pb,l-(n?0:s.x));c(Va,f);c(I,c(xa,a.speed)<0);c(V,a.velocity||0);c(da,a.vertical);c(J,(a.row-1)/(a.rows-1));c(ea,Na(1,!a.cw&&!l));c(ka,false);c(ya,c(Wa,0));c(za,c(Aa,0));c(la,false);c(qb,a.brake);c(Xa,!!a.orbital);c(P,a.tempo/(g.reel.lazy?a.laziness:1));c(W,-1);c(Ya,a.annotations)||x.unbind(".annotations");c(rb,{src:b,classes:va,style:j||M,data:k});a.steppable||x.unbind("click.steppable");E(true,M,{width:s.x,height:s.y,overflow:Za,position:"relative"});
E(true,X+C+q(z),{display:sb});Q.bind(v.pool);o.call(i);h.trigger("setup")},instance:{teardown:function(i){var b=h.data(rb);h.parent().unbind(v.instance);d(ia).remove();Kb(h.unbind(y).siblings().unbind(y).remove().end().attr({"class":b.classes,src:b.src,style:b.style}).data(b.data).unwrap());Ba();Q.unbind(v.pool);Y.unbind(Ca).unbind($a);o.call(i)},setup:function(){var i=d(O),b=d(ua),f=ha(b,d(Sa));f=c(t,1/f*((a.step||a.frame)-1));c(H,Z(f*b)+1);h.attr(aa);b=h.parent();var j=!d(la)||a.rows<=1||!a.orbital||
a.scrollable;f=c(Tb,g(a.area||b));if(g.reel.touchy){E(true,C+q(z),{WebkitUserSelect:Da,WebkitBackgroundSize:a.images.length?"auto":d(Ua)&&T(d(Ua))+C+T(i.y)||T(i.x*a.footage)+C+T(i.y*d(Ta)*(a.rows||1)*(a.directional?2:1))});f.bind(Ub,function(l){h.trigger("down",[sa(l).clientX,sa(l).clientY,true])}).bind(Vb,function(l){h.trigger("pan",[sa(l).clientX,sa(l).clientY,true]);return!j}).bind(Wb,function(){h.trigger("up",[true]);return false}).bind(Xb,function(){h.trigger("up",[true]);return false})}else{var k=
a.cursor==tb?ra(Yb)+X+ab:a.cursor||ra(Zb)+X+ab,m=a.cursor==tb?ra($b)+X+ab+" !important":false;E(true,M,{cursor:k});E(true,q(bb),{cursor:ac});E(false,q(Ea)+X+q(Ea)+" *",{cursor:m||k});f.bind(a.wheelable?bc:M,function(l,n){return!n||h.trigger("wheel",[n])&&false}).bind(a.clickfree?cc:dc,function(l){if(!(ec?!l.button:!!l.button)){h.trigger("down",[l.clientX,l.clientY]);return false}}).bind(a.clickfree?fc:M,function(){h.trigger("up");return false}).disableTextSelect()}a.hint&&f.attr(gc,a.hint);a.monitor&&
b.append(w=g(S(ja),{"class":ub}))||(w=g());E(true,C+q(ub),{position:Fa,left:0,top:0});E(true,C+q(vb),{display:Da});E(true,C+q(wb),{position:Fa,left:0,top:i.y-a.preloader,height:a.preloader,overflow:Za,backgroundColor:xb});a.indicator&&b.append(yb(zb));a.rows>1&&a.indicator&&b.append(yb(Ab))},preload:function(i){var b=d(O),f=h.parent(),j=d(nb),k=d(Oa),m=!k.length,l=d(ua),n=g.reel.preload[a.preload]||g.reel.preload[g.reel.def.preload];k=m?[j]:n(k,a,d);n=[];var s=h[0];s.frames=k.length;s.preloaded=0;
f.addClass(bb).append(F=g(S(ja),{"class":wb}));for(h.trigger("stop");k.length;){var x=a.path+k.shift(),N=b.x*(!m?1:a.footage),Pa=b.y*(!m?1:l/a.footage)*(!a.directional?1:2);N=g(new Image).addClass(vb).attr({width:N,height:Pa}).bind("load"+y,function(){s.preloaded++;g(this).unbind(y);F.css({width:1/s.frames*s.preloaded*b.x});if(s.frames==s.preloaded){F.remove();m&&h.css({backgroundImage:ra(a.path+j)}).attr({src:hc});f.removeClass(bb);h.trigger("loaded");o.call(i)}});f.append(N);n.push(x);setTimeout(function(va,
ic){return function(){va.attr({src:ic})}}(N,x),0)}c(Qa,n);c(ia,g("<"+ia+' type="text/css">'+Bb.join("\n")+"</"+ia+">").prependTo("head"))},opening:function(){if(!a.opening)return h.trigger("openingDone");var i=a.entry||a.speed,b=d(t),f=a.opening;c(t,b-i*a.opening);c(W,f*K(P))},openingDone:function(){if(a.delay)$=setTimeout(function(){h.trigger("play")},a.delay*1E3);else h.trigger("play")},play:function(i,b){b=c(xa,b||d(xa));b=c(cb,!!b);c(db,!b);h.trigger("frameChange");G();o.call(i)},pause:function(i){c(cb,
false);A();o.call(i)},stop:function(i){var b=c(db,true);c(cb,!b);o.call(i)},down:function(i,b,f,j){if(a.draggable){c(ka,d(H));c(V,0);Ga=Ha(b,f,d(t),d(wa),d(J));A();Ba();ma=false;Cb.addClass(Ea);if(!j){Y.bind($a,function(k){h.trigger("pan",[k.clientX,k.clientY]);o.call(k);return false});a.clickfree||Y.bind(Ca,function(k){h.trigger("up");o.call(k)})}}o.call(i)},up:function(i,b){if(!a.draggable)return o.call(i);c(ka,false);c(la,false);var f=c(V,!a.throwable?0:L(na[0]+na[1])/60);R=f?1:0;f?G():A();Ba();
Cb.removeClass(Ea);!b&&Y.unbind(Ca).unbind($a);o.call(i)},pan:function(i,b,f){if(a.draggable&&eb){eb=false;A();var j={x:b-Ga.x,y:f-Ga.y};if(L(j.x)>0||L(j.y)>0){ma=true;Ga={x:b,y:f};var k=d(wa),m=d(Db),l=d(da),n=c(t,Eb(l?f-m.y:b-m.x,d(ya),k,d(za),d(Aa),d(ea),l?f-m.y:b-m.x));c(la,d(la)||d(H)!=d(ka));(j=Fb(l?j.y:j.x||0))&&c(I,j<0);if(a.orbital&&d(Xa)){c(da,L(f-m.y)>L(b-m.x));m=Ha(b,f,n,k,d(J))}if(a.rows>1){j=d(O).y;l=d(Wa);var s=-l*j;c(J,g.reel.math.envelope(f-m.y,l,j,s,s+j,-1))}!(n%1)&&!a.loops&&Ha(b,
f,n,k,d(J));h.trigger("fractionChange")}}o.call(i)},wheel:function(i,b){var f=lb(jc(L(b))/2);f=Na(f,b>0);b=0.0833*d(wa);Ha(r,r,d(t),b,d(J));c(t,Eb(f,d(ya),b,d(za),d(Aa),d(ea)));f&&c(I,f<0);c(V,0);A();o.call(i);Y.trigger(Ca);h.trigger("fractionChange");return false},fractionChange:function(i,b){b=c(t,Ia.fraction(b,a,d));var f=c(H,1+fa(b/d(ca))),j=a.rows>1,k=a.orbital;c(Xa,!!k&&(f<=k||f>=a.footage-k+2));if(!a.loops&&a.rebound){!D&&!(b%1)?fb++:(fb=0);fb>=a.rebound*1E3/K(P)&&c(I,!d(I))}h.trigger(j?"rowChange":
"frameChange");o.call(i)},rowChange:function(i,b){var f=d(t)/d(ca)+1;b=c(J,Ia.row(b,a,d));b=ba(0,a.rows-1,fa(b*a.rows));c(H,fa(f+b*a.frames));o.call(i);h.trigger("frameChange")},frameChange:function(i,b){var f=c(t,Ia.fraction(!b?r:d(ca)*(b-1),a,d));b=Ia.frame(b,a,d);var j=d(Qa).length==1,k=a.footage;if(d(da)){b=a.inversed?k+1-b:b;b+=k}if(b==d(Ra))B(i);else{var m=a.horizontal,l=d(Oa),n=d(O);b=c(Ra,c(H,b));if(j){if(a.stitched)n=[-Z(f*d(pb))+U,0+U];else{f=b%k-1;f=f<0?k-1:f;k=fa((b-0.1)/k);k+=a.rows>
1?0:d(I)?0:d(Ta);b=d(ob);k=k*((m?n.y:n.x)+b);n=f*((m?n.x:n.y)+b);n=l.length?[0,0]:m?[-n+U,-k+U]:[-k+U,-n+U]}h.css({backgroundPosition:n.join(C)})}else h.attr({src:a.path+l[b-1]})}if(a.indicator){m=d(Va);l=a.rows>1;n=d(O);f=(d(da)?n.y:n.x)-a.indicator;b=ba(0,f,Z(g.reel.math.interpolate(d(t),-1,f+2)));b=!a.cw||a.stitched?b:f-b;g(q(Ja+q(zb)),m).css(d(da)?{left:0,top:b}:{left:b,top:n.y-a.indicator});if(l){n=n.y-a.indicator;n=ba(0,n,Z(g.reel.math.interpolate(d(J),-1,n+2)));g(q(Ja+q(Ab)),m).css({top:n})}}o.call(i)},
stepLeft:function(){A();c(I,false);h.trigger("fractionChange",d(t)-d(ca)*d(ea))},stepRight:function(){A();c(I,true);h.trigger("fractionChange",d(t)+d(ca)*d(ea))},"click.steppable":function(i){if(ma)return B(i);h.trigger(i.clientX-h.offset().left>0.5*d(O).x?"stepRight":"stepLeft")},"setup.annotations":function(){d(O);var i=h.parent();g.each(d(Ya),function(b,f){var j=g(S(ja),f.node).attr({id:b}).addClass(kc),k=f.image?g(S(hb),f.image):g(),m=f.link?g(S(lc),f.link):g();E(false,ga(b),{display:Da,position:Fa});
m.bind({"click.annotations":function(l){l.stopPropagation()}});f.image||f.link&&j.append(m);f.link||f.image&&j.append(k);f.link&&f.image&&j.append(m.append(k));j.appendTo(i)});h.trigger("frameChange.annotations")},"frameChange.annotations":function(i,b){b=b||d(H);this.className=this.className.replace(mc,mb+b);d(V)||g.each(d(Ya),function(f,j){f=g(ga(f));var k=j.start||1,m=j.end,l=b-1,n=j.at?j.at[l]=="+":false;l=j.at?l:l-k+1;var s=typeof j.x!=Gb?j.x:j.x[l],x=typeof j.y!=Gb?j.y:j.y[l];j={display:s!==
r&&x!==r&&(j.at?n:l>=0&&(!m||l<=m-k))?sb:Da,left:T(s)||0,top:T(x)||0};f.css(j)})},"setup.fu":function(){h.trigger("preload")},"loaded.fu":function(){h.trigger("opening")}},pool:{"tick.reel":function(i){var b=d(V);if(R){var f=b-d(qb)/K(P)*R;b=c(V,f>0.1?f:(R=D=0))}w.text(d(a.monitor));b&&R++;D&&D++;Fb(0);eb=true;if(D&&!b)return B(i);if(d(ka))return B(i,A());if(!(d(W)>0)){f=d(ea)*Na(1,d(I));b=(d(db)?b:L(d(xa))+b)/K(P);var j=d(t);c(t,j-b*f);o.call(i)}},"tick.reel.opening":function(i){if(a.opening){if(d(W)<=
0)return;var b=(a.entry||a.speed)/K(P)*(a.cw?-1:1),f=d(t);c(t,f+b);b=c(W,d(W)-1);o.call(i);if(b>0)return;h.trigger("openingDone")}Q.unbind(oa+q(Ka),v.pool[oa+q(Ka)])},"tick.reel.fu":function(){h.trigger("fractionChange")}}},o=function(i){Hb||delete this;return i},B=function(i,b){return i.stopImmediatePropagation()||o.call(i)||b},D,R=0,G=function(){return D=0},A=function(){clearTimeout($);Q.unbind(oa+q(Ka),v.pool[oa+q(Ka)]);c(W,0);h.trigger("play");return D=-a.timeout*K(P)},ma=false,$,w,F,yb=function(i){E(true,
C+q(Ja)+q(i),{position:Fa,width:a.indicator,height:a.indicator,overflow:Za,backgroundColor:xb});return g(S(ja),{"class":[Ja,i].join(C)})},Bb=[],E=function(i,b,f){var j=d(Va);b=b.split(X);i&&g.each(b,function(k,m){b[k]=j+m});Bb.push(b.join(X)+Nb(f));return f},fb=0,Ga={x:0,y:0},Fb=function(i){return na.push(i)&&na.shift()&&i},Ba=function(){return na=[0,0]},na=Ba(),Eb=a.graph||g.reel.math[a.loops?"hatch":"envelope"],Ia=g.reel.normal,Ha=function(i,b,f,j,k){c(ya,f);c(Wa,k);c(za,a.loops?0:-f*j);c(Aa,a.loops?
j:j-f*j);return i&&c(Db,{x:i,y:b})||r},eb=true,Y;try{Y=g.browser.opera?Q:g.unique(Q.add(Ib.top.document))}catch(nc){Y=Q}v.setup()});La=La||function h(){var u=+new Date,c=K(P);if(c){Q.trigger(oa);g.reel.cost=(+new Date+g.reel.cost-u)/2;return La=setTimeout(h,ha(4,1E3/c-g.reel.cost))}else return La=r}();return g(p)};g.fn.unreel=function(){return this.trigger("teardown")};g.reel.math={envelope:function(e,a,p,h,u,c){return a+ha(h,gb(u,-e*c))/p},hatch:function(e,a,p,h,u,c){e=(e<h?u:0)+e%u;e=a+-e*c/p;return e-
fa(e)},interpolate:function(e,a,p){return a+e*(p-a)}};g.reel.preload={linear:function(e){return e},fidelity:function(e,a){function p(o,B,D){function R(F){for(;!(F>=1&&F<=$);)F+=F<1?+$:-$;return v[D+F]||(v[D+F]=!!G.push(F))}if(!o.length)return[];var G=[],A=4*B,ma=a.frame,$=o.length;B=$/A;for(var w=0;w<A;w++)R(ma+Z(w*B));for(;B>1;){w=0;A=G.length;for(B/=2;w<A;w++)R(Z(G[w]+B))}for(w=0;w<G.length;w++)G[w]=o[G[w]-1];return G}var h=a.orbital?2:a.rows||1,u=a.orbital?a.footage:a.frames,c=(a.row-1)*u,d=[].concat(e),
v=new Array(e.length);e=h<2?[]:d.slice(c,c+u);return p(e,1,c).concat(p(d,h,0))}};g.reel.normal={fraction:function(e,a,p){e=e!=r?e:p(t);return a.loops?e-fa(e):ba(0,1,e)},row:function(e,a,p){return ba(0,1,e!=r?(e-1)/(a.rows-1):p(J))},frame:function(e,a,p){e=e!=r?Z(e):p(H);var h=a.orbital?2:a.rows||1;p=p(ua)*h;e=a.loops?e%p||p:ba(1,p,e);return e<0?e+p:e}};g.reel.sequence_pattern=/(^[^#|]*([#]+)[^#|]*)($|[|]([0-9]+)\.\.([0-9]+))($|[|]([0-9]+)$)/;g.reel.build_sequence=function(e,a){function p(o,B,D){for(;o.length<
B;)o=D+o;return o}if(e.length<=1)return a.images;var h=[],u=e[1],c=e[2],d=+e[4]||1,v=a.orbital?2:a.rows||1;a=a.orbital?a.footage:a.frames;v=+(e[5]||v*a);e=+e[7]||1;for(a=0;a<v;){h.push(u.replace(c,p(d+a+M,c.length,"0")));a+=e}return h};g.reel.touchy=/iphone|ipod|ipad|android/i.test(navigator.userAgent);g.reel.lazy=/iphone|ipod|android/i.test(navigator.userAgent);g.reel.cdn="http://code.vostrel.cz/";g.reel.instances=g();g.reel.cost=0;g.reel.leader=K;Mb("mousewheel disableTextSelect enableTextSelect".split(/ /));
var Q=g(Ma),Cb=g("html");Ma=+g.browser.version.split(q()).slice(0,2).join(q());var Hb=g.browser.msie,pa=navigator.userAgent;pa={linux:/linux/i.test(pa),windows:/windows/i.test(pa),mac:/macintosh/i.test(pa)};var ec=Hb&&Ma<=8,La,z="reel",Qb=z+"-overlay",Ja=z+"-indicator",wb=z+"-preloader",vb=z+"-cached",ub=z+"-monitor",kc=z+"-annotation",Ea=z+"-panning",bb=z+"-loading",mb="frame-",mc=/frame-\d+/,Z=Math.round,fa=Math.floor,lb=Math.ceil,gb=Math.min,ha=Math.max,L=Math.abs,jc=Math.sqrt,ta=parseInt,Ya="annotations",
Tb="area",rb="backup",I="backwards",ca="bit",qb="brake",Qa="cached",Xa="center",ka="clicked",Db="clicked_location",ya="clicked_on",Wa="clicked_row",ea="cwish",O="dimensions",t="fraction",H="frame",Ra="_frame",ua="frames",Aa="hi",Za="hidden",nb="image",Oa="images",W="opening_ticks",za="lo",Rb="options",cb="playing",la="reeling",wa="revolution",J="row",Ta="rows",Pb="sequence",ob="spacing",xa="speed",Va="stage",Sa="steps",Ua="stitched",pb="stitched_travel",db="stopped",ia="style",P="tempo",V="velocity",
da="vertical",Sb="wheel_step",y=".reel",dc="mousedown"+y,cc="mouseenter"+y,fc="mouseleave"+y,$a="mousemove"+y,Ca="mouseup"+y,bc="mousewheel"+y,oa="tick"+y,Xb="touchcancel"+y,Wb="touchend"+y,Ub="touchstart"+y,Vb="touchmove"+y,M="",C=" ",X=",",Fa="absolute",lc="a",sb="block",ja="div",tb="hand",kb="height",xb=ga("000"),aa="id",hb="img",ab="move",Da="none",Gb="object",Ka="opening",U="px",ib="src",gc="title",jb="width",zb="x",Ab="y",hc=Lb("CAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7")||qa("blank.gif"),
ac="wait",Zb=qa("jquery.reel-"+(pa.mac?"black":"white")+q("cur")),Yb=qa("jquery.reel-drag"+q("cur")),$b=qa("jquery.reel-drag-down"+q("cur"))}}(jQuery,window,document);
