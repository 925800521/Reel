/*
 Copyright (c) 2009-2011 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 jQuery Reel
 http://jquery.vostrel.cz/reel
 Version: 1.1.3-devel
 Updated: 2011-12-17

 Requires jQuery 1.4.3 or higher
*/
jQuery.reel||function(h,zb,ka,q){function L(e){return h.reel.instances.length?h.reel.instances.first().data(e):null}function Ab(e){return h.reel.instances.push(e[0])&&e}function Bb(e){return(h.reel.instances=h.reel.instances.not(aa(e.attr(ba))))&&e}function wa(e){return Cb&&"data:image/gif;base64,R0lGODlh"+e}function xa(e){return"<"+e+"/>"}function A(e){return"."+e}function ya(e){return"http://code.vostrel.cz/"+e}function Za(e){return"url("+e+")"}function S(e,a,n){return ca(e,$a(a,n))}function Db(e){function a(){h.fn[this]||
(h.fn[this]=function(){return this})}h.each(e,a)}function za(e,a){return D(e)*(a?-1:1)}function la(e){return e.originalEvent.touches[0]}function Aa(e){return e===q||typeof e=="string"?e:e+"px"}function aa(e){return"#"+e}function Eb(e){var a=[];h.each(e,function(n,g){a.push(n.replace(/([A-Z])/g,"-$1").toLowerCase()+":"+Aa(g))});return"{"+a.join(";")+";}"}function Fb(){var e=h().jquery.split(".");if(e=+e[0]<=1&&(+e[1]<4||+e[1]==4&&+e[2]<3))try{console.error("FATAL: jQuery Reel plug-in requires at least jQuery 1.4.3")}catch(a){}return e}
if(!Fb()){h.reel={version:"1.1.3-devel",def:{area:q,brake:0.5,clickfree:false,cw:false,delay:-1,directional:false,draggable:true,footage:6,entry:q,frame:1,frames:36,graph:q,hint:"",horizontal:true,image:q,images:[],indicator:0,inversed:false,klass:"",laziness:6,loops:true,monitor:q,opening:0,orbital:0,path:"",preloader:4,rebound:0.5,revolution:q,row:1,rows:0,spacing:0,speed:0,step:q,steps:q,stitched:0,suffix:"-reel",tempo:36,timeout:2,throwable:true,vertical:false,wheelable:true,annotations:q,attr:{},
preload:"fidelity",scrollable:true,steppable:true,velocity:0}};h.fn.reel=function(e){var a=h.extend({},h.reel.def,e);e=function(g){var t=[];g.filter(Ba).each(function(){var c=h(this),d=a.images.length&&a.images||a.image||a.attr.src||c.attr(ab),z=ma(a.attr.width||c.css(bb)),o=ma(a.attr.height||c.css(cb));!d||d==Ca||!z||!o||t.push(c)});g.filter(A(x)).each(function(){t.push(h(this).unreel())});return h(t)}(this);var n=[];a.tooltip&&(a.hint=a.tooltip);a.hotspot&&(a.area=a.hotspot);e.each(function(){var g=
h(this),t=g.data(),c=function(i,b){t[i]=b;g.trigger("store",[i,b]);return b},d=function(i){var b=t[i];g.trigger("recall",[i,b]);return b},z={setup:function(i){if(g.hasClass(x))return o.call(i);var b=g.attr(a.attr).attr(ab),f=c(ba,g.attr(ba)||g.attr(ba,x+"-"+ +new Date).attr(ba)),j=g.attr("style"),k=h.extend({},g.data()),l=a.images,p=a.stitched,m=a.loops,v={x:ma(g.css(bb)||a.attr.width),y:ma(g.css(cb)||a.attr.height)},s=c(E,a.frame),da=c(Da,a.orbital&&a.footage||a.rows<=1&&l.length||a.frames),Ea=p?
1:db(da/a.footage);f=aa(f+a.suffix);var eb=g.attr("class")||"";s=h(ea,{id:f.substr(1),"class":eb+F+Gb+F+fb+s});s=g.wrap(s.addClass(a.klass)).attr({"class":x});n.push(Ab(s)[0]);s=s.parent().bind(z.instance);c(gb,l.length&&l.length||a.image||b.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2"));c(hb,[]);c(E,a.frame);c(Fa,0);c(ib,a.spacing);c(P,v);c(r,0);c(Ga,a.steps||a.frames);c(na,a.revolution||p/2||v.x*2);c(Ha,Ea);c(T,1/(da-(m&&!p?0:1)));c(Hb,1/ca(da,d(Ga)));c(Ia,p);c(jb,p-(m?0:v.x));c(Ja,
f);c(J,c(fa,a.speed)<0);c(U,a.velocity||0);c(V,a.vertical);c(K,(a.row-1)/(a.rows-1));c(W,za(1,!a.cw&&!p));c(ga,false);c(kb,a.brake);c(Ka,!!a.orbital);c(M,a.tempo/(h.reel.lazy?a.laziness:1));c(X,0);c(La,a.annotations)||s.unbind(".annotations");c(lb,{src:b,classes:eb,style:j||Ca,data:k});a.steppable||s.unbind("click.steppable");G(true,Ca,{width:v.x,height:v.y,overflow:Ma});G(true,","+F+A(x),{display:"block",position:"relative"});N.bind(z.pool);o.call(i);g.trigger("setup")},instance:{teardown:function(i){var b=
g.data(lb);g.parent().unbind(z.instance).children(Ba).unbind(w);d(mb).remove();g.unbind(w).attr({"class":b.classes,src:b.src,style:b.style}).removeClass(x);g.data(b.data).siblings().remove();g.unwrap();Bb(g);oa();N.unbind(z.pool);Y.unbind(Na).unbind(Oa);o.call(i)},setup:function(){var i=d(P),b=d(Da),f=ca(b,d(Ga));f=c(r,1/f*((a.step||a.frame)-1));c(E,Q(f*b)+1);g.attr("id");b=g.parent();var j=!d(ga)||a.rows<=1||!a.orbital||a.scrollable;f=c(Pa,h(a.area||b));if(h.reel.touchy){G(true,F+A(x),{WebkitUserSelect:"none",
WebkitBackgroundSize:a.images.length?"auto":d(Ia)&&d(Ia)+"px "+i.y+"px"||i.x*a.footage+"px "+i.y*d(Ha)*(a.rows||1)*(a.directional?2:1)+"px"});f.bind(Ib,function(k){g.trigger("down",[la(k).clientX,la(k).clientY,true])}).bind(Jb,function(k){g.trigger("pan",[la(k).clientX,la(k).clientY,true]);return!j}).bind(Kb,function(){g.trigger("up",[true]);return false}).bind(Lb,function(){g.trigger("up",[true]);return false})}else{G(true,"",{cursor:"url("+Mb+"), "+nb});f.bind(a.wheelable?Nb:"",function(k,l){g.trigger("wheel",
[l]);return false}).bind(a.clickfree?Ob:Pb,function(k){if(!(Qb?!k.button:!!k.button)){g.trigger("down",[k.clientX,k.clientY]);return false}}).bind(a.clickfree?Rb:"",function(){g.trigger("up");return false}).disableTextSelect()}a.hint&&f.attr(Sb,a.hint);a.monitor&&b.append(u=h(ea,{"class":ob}))||(u=h());G(true,F+A(ob),{position:pa,left:0,top:0});G(true,F+A(pb),{display:"none"});G(true,F+A(qb),{position:pa,left:0,top:i.y-a.preloader,height:a.preloader,overflow:Ma,backgroundColor:rb});G(true,A(Qa),{cursor:Za(Tb)+
", "+nb});a.indicator&&b.append(sb("x"));a.rows>1&&a.indicator&&b.append(sb("y"))},preload:function(i){var b=d(P),f=g.parent(),j=d(gb),k=a.images,l=h.reel.preload[a.preload]||h.reel.preload[h.reel.def.preload];l=!k.length?[j]:l(k,a,d);var p=[],m=g[0];m.frames=l.length;m.preloaded=0;f.append(B=h(ea,{"class":qb}));for(g.trigger("stop");l.length;){var v=a.path+l.shift(),s=h(new Image).addClass(pb).attr({width:b.x,height:b.y}).bind("load"+w,function(){m.preloaded++;h(this).unbind(w);B.css({width:1/m.frames*
m.preloaded*b.x});if(m.frames==m.preloaded){B.remove();k.length||g.attr({src:Ub}).css({backgroundImage:Za(a.path+j)});g.trigger("loaded");o.call(i)}});f.append(s);p.push(v);setTimeout(function(da,Ea){return function(){da.attr({src:Ea})}}(s,v),0)}c(hb,p);c(mb,h('<style type="text/css">'+tb.join("\n")+"</style>").insertBefore(h("head link, head style").first()))},opening:function(){if(!a.opening)return g.trigger("openingDone");var i=a.entry||a.speed,b=d(r),f=a.opening;c(r,b-i*a.opening);c(X,f*L(M))},
openingDone:function(){R=setTimeout(function(){g.trigger("play")},a.delay*1E3||0)},play:function(i,b){b=c(fa,b||d(fa));b=c(Ra,!!b);c(Sa,!b);H();o.call(i)},pause:function(i){c(Ra,false);y();o.call(i)},stop:function(i){var b=c(Sa,true);c(Ra,!b);o.call(i)},down:function(i,b,f,j){if(a.draggable){c(qa,d(E));c(U,0);ra=sa(b,f,d(r),d(na),d(K));y();oa();ha=false;d(Pa).addClass(Qa);if(!j){Y.bind(Oa,function(k){g.trigger("pan",[k.clientX,k.clientY]);o.call(k);return false});a.clickfree||Y.bind(Na,function(k){g.trigger("up");
o.call(k)})}}o.call(i)},up:function(i,b){if(!a.draggable)return o.call(i);c(qa,false);c(ga,false);var f=c(U,!a.throwable?0:D(ia[0]+ia[1])/60);O=f?1:0;f?H():y();oa();d(Pa).removeClass(Qa);!b&&Y.unbind(Na).unbind(Oa);o.call(i)},pan:function(i,b,f){if(a.draggable&&Ta){Ta=false;y();var j={x:b-ra.x,y:f-ra.y};if(D(j.x)>0||D(j.y)>0){ha=true;ra={x:b,y:f};var k=d(na),l=d(ub),p=d(V),m=c(r,vb(p?f-l.y:b-l.x,d(Ua),k,d(Va),d(Wa),d(W)));c(ga,d(ga)||d(E)!=d(qa));(j=wb(p?j.y:j.x||0))&&c(J,j<0);if(a.orbital&&d(Ka)){c(V,
D(f-l.y)>D(b-l.x));l=sa(b,f,m,k,d(K))}if(a.rows>1){j=d(P).y;p=d(xb);var v=-p*j;c(K,h.reel.math.envelope(f-l.y,p,j,v,v+j,-1))}!(m%1)&&!a.loops&&sa(b,f,m,k,d(K));g.trigger("fractionChange")}}o.call(i)},wheel:function(i,b){var f=db(Vb(D(b))/2);f=za(f,b>0);b=0.0833*d(na);sa(q,q,d(r),b,d(K));c(r,vb(f,d(Ua),b,d(Va),d(Wa),d(W)));f&&c(J,f<0);c(U,0);y();o.call(i);g.trigger("fractionChange");return false},fractionChange:function(i,b){b=c(r,ta.fraction(b,a,d));var f=c(E,1+Z(b/d(T))),j=a.rows>1,k=a.orbital;c(Ka,
!!k&&(f<=k||f>=a.footage-k+2));if(!a.loops&&a.rebound){!I&&!(b%1)?Xa++:(Xa=0);Xa>=a.rebound*1E3/L(M)&&c(J,!d(J))}g.trigger(j?"rowChange":"frameChange");o.call(i)},rowChange:function(i,b){var f=d(r)/d(T)+1;b=c(K,ta.row(b,a,d));b=S(0,a.rows-1,Z(b*a.rows));c(E,Z(f+b*a.frames));o.call(i);g.trigger("frameChange")},frameChange:function(i,b){var f=c(r,ta.fraction(!b?q:d(T)*(b-1),a,d));b=ta.frame(b,a,d);footage=a.footage;if(d(V)){b=a.inversed?footage+1-b:b;b+=footage}if(b==d(Fa))return C(i);var j=a.horizontal,
k=d(Ja),l=a.rows>1,p=a.images,m=d(P);b=c(Fa,c(E,b));var v=(d(V)?m.y:m.x)-a.indicator,s=S(0,v,Q(h.reel.math.interpolate(d(r),-1,v+2)));s=!a.cw||a.stitched?s:v-s;h(A(ua+".x"),k).css(d(V)?{left:0,top:s}:{left:s,top:m.y-a.indicator});if(l){l=m.y-a.indicator;l=S(0,l,Q(h.reel.math.interpolate(d(K),-1,l+2)));h(A(ua+".y"),k).css({top:l})}if(p.length)g.attr({src:a.path+p[b-1]});else{if(a.stitched)j=[-Q(f*d(jb))+$,0+$];else{f=b%footage-1;f=f<0?footage-1:f;k=Z((b-0.1)/footage);k+=a.rows>1?0:d(J)?0:d(Ha);b=d(ib);
k=k*((j?m.y:m.x)+b);m=f*((j?m.x:m.y)+b);j=p.length?[0,0]:j?[-m+$,-k+$]:[-k+$,-m+$]}g.css({backgroundPosition:j.join(F)})}o.call(i)},stepLeft:function(){y();c(J,false);g.trigger("fractionChange",d(r)-d(T)*d(W))},stepRight:function(){y();c(J,true);g.trigger("fractionChange",d(r)+d(T)*d(W))},"click.steppable":function(i){if(ha)return C(i);g.trigger(i.clientX-g.offset().left>0.5*d(P).x?"stepRight":"stepLeft")},"setup.annotations":function(){d(P);var i=g.parent();h.each(d(La),function(b,f){var j=h(ea,
f.node).attr({id:b}).addClass(Wb),k=f.image?h(xa(Ba),f.image):h(),l=f.link?h(xa(Xb),f.link):h();G(false,aa(b),{display:"none",position:pa});l.bind({"click.annotations":function(p){p.stopPropagation()}});f.image||f.link&&j.append(l);f.link||f.image&&j.append(k);f.link&&f.image&&j.append(l.append(k));j.appendTo(i)});g.trigger("frameChange.annotations")},"frameChange.annotations":function(i,b){b=b||d(E);this.className=this.className.replace(/frame-\d+/,fb+b);h.each(d(La),function(f,j){f=h(aa(f));var k=
j.start,l=j.end,p=b-(k||1),m=typeof j.x!=yb?j.x:j.x[p];j=typeof j.y!=yb?j.y:j.y[p];j={display:m!==q&&j!==q&&p>=0&&(!l||p<=l-k)?"block":"none",left:Aa(m)||0,top:Aa(j)||0};f.css(j)})},"setup.fu":function(){g.trigger("preload")},"loaded.fu":function(){g.trigger(a.rows>1&&!a.stitched?"rowChange":"frameChange").trigger("opening")}},pool:{"tick.reel":function(i){var b=d(U);if(O){var f=b-d(kb)/L(M)*O;b=!(b*f<=0||b<D(f))&&c(U,b>D(d(fa))?f:(O=I=0))}u.text(d(a.monitor));b&&O++;I&&I++;wb(0);Ta=true;if(I&&!b)return C(i);
if(d(qa))return C(i,y());if(!d(X)){f=d(W)*za(1,d(J));b=(d(Sa)?b:D(d(fa))+b)/L(M);var j=d(r);c(r,j-b*f);o.call(i)}},"tick.reel.opening":function(i){var b=(a.entry||a.speed)/L(M)*(a.cw?-1:1),f=d(r);c(r,f+b);b=c(X,d(X)-1);o.call(i);if(!b){g.trigger("openingDone");N.unbind(ja+".opening",z.pool[ja+".opening"])}},"tick.reel.fu":function(){g.trigger("fractionChange")}}},o=function(i){Ya||delete this;return i},C=function(i,b){return i.stopImmediatePropagation()||o.call(i)||b},I,O=0,H=function(){return I=
0},y=function(){clearTimeout(R);N.unbind(ja+".opening",z.pool[ja+".opening"]);c(X,0);g.trigger("play");return I=-a.timeout*L(M)},ha=false,R,u,B,sb=function(i){G(true,F+A(ua)+A(i),{position:pa,width:a.indicator,height:a.indicator,overflow:Ma,backgroundColor:rb});return h(ea,{"class":[ua,i].join(F)})},tb=[],G=function(i,b,f){var j=d(Ja);b=b.split(",");i&&h.each(b,function(k,l){b[k]=j+l});tb.push(b.join(",")+Eb(f));return f},Xa=0,ra={x:0,y:0},wb=function(i){return ia.push(i)&&ia.shift()&&i},oa=function(){return ia=
[0,0]},ia=oa(),vb=a.graph||h.reel.math[a.loops?"hatch":"envelope"],ta=h.reel.normal,sa=function(i,b,f,j,k){c(Ua,f);c(xb,k);c(Va,a.loops?0:-f*j);c(Wa,a.loops?j:j-f*j);return i&&c(ub,{x:i,y:b})||q},Ta=true,Y;try{Y=h.browser.opera?N:h.unique(N.add(zb.top.document))}catch(Yb){Y=N}z.setup()});va=va||function g(){var t=+new Date,c=L(M);if(c){N.trigger(ja);h.reel.cost=(+new Date+h.reel.cost-t)/2;return va=setTimeout(g,ca(4,1E3/c-h.reel.cost))}else return va=q}();return h(n)};h.fn.unreel=function(){return this.trigger("teardown")};
h.reel.math={envelope:function(e,a,n,g,t,c){return a+ca(g,$a(t,-e*c))/n},hatch:function(e,a,n,g,t,c){e=(e<g?t:0)+e%t;e=a+-e*c/n;return e-Z(e)},interpolate:function(e,a,n){return a+e*(n-a)}};h.reel.preload={linear:function(e){return e},fidelity:function(e,a){function n(o,C,I){function O(B){for(;!(B>=1&&B<=R);)B+=B<1?+R:-R;return z[I+B]||(z[I+B]=!!H.push(B))}if(!o.length)return[];var H=[],y=4*C,ha=a.frame,R=o.length;C=R/y;for(var u=0;u<y;u++)O(ha+Q(u*C));for(;C>1;){u=0;y=H.length;for(C/=2;u<y;u++)O(Q(H[u]+
C))}for(u=0;u<H.length;u++)H[u]=o[H[u]-1];return H}var g=a.orbital?2:a.rows||1,t=a.orbital?a.footage:a.frames,c=(a.row-1)*t,d=[].concat(e),z=new Array(e.length);e=g<2?[]:d.slice(c,c+t);return n(e,1,c).concat(n(d,g,0))}};h.reel.normal={fraction:function(e,a,n){e=e!=q?e:n(r);return a.loops?e-Z(e):S(0,1,e)},row:function(e,a,n){return S(0,1,e!=q?(e-1)/(a.rows-1):n(K))},frame:function(e,a,n){e=e!=q?Q(e):n(E);var g=a.orbital?2:a.rows||1;n=n(Da)*g;e=a.loops?e%n||n:S(1,n,e);return e<0?e+n:e}};h.reel.touchy=
/iphone|ipod|ipad|android/i.test(navigator.userAgent);h.reel.lazy=/iphone|ipod|android/i.test(navigator.userAgent);h.reel.instances=h();h.reel.cost=0;h.reel.leader=L;Db("mousewheel disableTextSelect enableTextSelect".split(/ /));var N=h(ka);ka=+h.browser.version.split(".").slice(0,2).join(".");var Ya=h.browser.msie,Cb=!(Ya&&ka<8),Qb=Ya&&ka<=8,nb="ew-resize",va,x="reel",Gb=x+"-overlay",ua=x+"-indicator",qb=x+"-preloader",pb=x+"-cached",ob=x+"-monitor",Wb=x+"-annotation",Qa=x+"-panning",fb="frame-",
Ub=wa("CAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7")||ya("blank.gif"),Mb=wa("EAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAI3lC8AeBDvgosQxQtne7yvLWGStVBelXBKqDJpNzLKq3xWBlU2nUs4C/O8cCvU0EfZGUwt19FYAAA7")||ya("jquery.reel.cursor-drag.gif"),Tb=wa("EAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAIslI95EB3MHECxNjBVdE/5b2zcRV1QBabqhwltq41St4hj5konmVioZ6OtEgUAOw==")||ya("jquery.reel.cursor-drag-down.gif"),Q=Math.round,Z=Math.floor,db=Math.ceil,$a=Math.min,ca=Math.max,D=Math.abs,Vb=Math.sqrt,
ma=parseInt,La="annotations",Pa="area",lb="backup",J="backwards",T="bit",kb="brake",Ka="center",qa="clicked",ub="clicked_location",Ua="clicked_on",xb="clicked_row",W="cwish",P="dimensions",r="fraction",E="frame",Fa="_frame",Da="frames",Wa="hi",Ma="hidden",gb="image",hb="images",X="opening_ticks",Va="lo",Ra="playing",ga="reeling",na="revolution",K="row",Ha="rows",ib="spacing",fa="speed",Ja="stage",Ga="steps",Ia="stitched",jb="stitched_travel",Sa="stopped",mb="style",M="tempo",U="velocity",V="vertical",
Hb="wheel_step",w=".reel",Pb="mousedown"+w,Ob="mouseenter"+w,Rb="mouseleave"+w,Oa="mousemove"+w,Na="mouseup"+w,Nb="mousewheel"+w,ja="tick"+w,Lb="touchcancel"+w,Kb="touchend"+w,Ib="touchstart"+w,Jb="touchmove"+w,Ca="",F=" ",pa="absolute",Xb="a",ea=xa("div"),cb="height",rb=aa("000"),ba="id",Ba="img",yb="object",$="px",ab="src",Sb="title",bb="width"}}(jQuery,window,document);
