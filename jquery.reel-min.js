/*
 Copyright (c) 2009-2010 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 http://jquery.vostrel.cz/reel
 Version: "Dancer" (will be 1.1 on release)
 Updated: 2010-06-15

 Requires jQuery 1.4.x
*/
(function(j,P,za,w){function Aa(k){return"<"+k+"/>"}function Q(k){return"."+k}function R(k){return"url("+k+")"}function S(k,a){return+a.toFixed(k)}function da(k,a,H){return I(k,ea(a,H))}function Ba(k,a){return k*a>0?a:-a}function Ca(k){function a(){j.fn[this]||(j.fn[this]=function(){return this})}j.each(k,a)}var Da={footage:6,frame:1,frames:36,hint:"",horizontal:true,hotspot:w,indicator:0,klass:"",loops:true,reversed:false,sensitivity:20,spacing:0,stitched:w,suffix:"-reel",tooltip:"",delay:-1,friction:0.9,
image:w,images:[],inertia:true,monitor:w,path:"",rebound:0.5,revolution:w,speed:0,step:w,steps:w,tempo:25,timeout:2};j.fn.reel=function(k){var a=j.extend({},Da,k);k=function(c){var f=[];c.filter(Ea).each(function(){var g=j(this),u=a.images.length&&a.images||a.image||g.attr(fa),x=J(g.css(ga)),y=J(g.css(ha));!u||u==ia||!x||!y||f.push(g)});c.filter(ja+Q(C)).each(function(){f.push(j(this))});return j(f)}(this);var H=[];T=T||function c(){D.trigger(U);return setTimeout(c,1E3/a.tempo)}();k.each(function(){var c=
j(this),f=function(d,b){c.data(d,b);c.trigger("store");return b},g=function(d){c.trigger("recall");return c.data(d)},u={setup:function(){if(!c.hasClass(C)){var d=c.attr(fa),b=c.attr(Fa);c.attr(Ga);var e=c.attr("style"),h=a.images,n={x:J(c.css(ga)),y:J(c.css(ha))},i={display:"block",width:n.x+r,height:n.y+r};i=c.attr({src:a.images?Ha:d}).bind(u).addClass(C).css(i);H.push(i[0]);f(V,h.length&&h.length||a.image||d.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2"));f(B,a.frame);f(E,h.length||a.frames);
f(ka,a.spacing);f(K,n);f(q,0);f(L,a.steps||a.frames);f(F,"#"+b+a.suffix);f(la,a.speed<0);f(ma,{src:d,style:e||ia});T&&D.bind(U,u.tick);c.trigger("start")}},teardown:function(){j(g(F)).remove();c.removeClass(C).unbind(t).unbind(u).attr(c.data(ma)).enableTextSelect().removeData();W();D.unbind(X).unbind(M).unbind(U,u.tick)},start:function(){var d=a.hotspot||c,b=g(K),e=g(E),h=I(e,g(L));h=f(q,1/h*((a.step||a.frame)-1));f(B,h*e+1);e=g(V);h=a.images;e=!h.length?[e]:[].concat(h);var n;c.attr("id");var i=
c[0];i.frames=e.length;i.preloads=i.preloads||[];i.preloaded=i.preloaded||0;h=e.length!=i.preloads.length;var l=g(F).substr(1);l=j(N,{className:Ia,id:l,css:{position:"relative",width:b.x}}).insertAfter(c);Ja?d.css({WebkitUserSelect:"none"}).each(function(){function p(s,z){j.each(z,function(Ka){s.addEventListener(Ka,this,false)})}function v(s){return s.cancelable&&s.preventDefault()||false}function o(s){var z=s.touches[0];c.trigger("down",[z.clientX,z.clientY,true]);return v(s)}function m(s){var z=
s.touches[0];c.trigger("drag",[z.clientX,z.clientY,true]);return v(s)}function na(s){c.trigger("up",[true]);return v(s)}p(this,{touchstart:o,touchmove:m,touchend:na,touchcancel:na})}):d.css({cursor:"url("+oa+"), "+Y}).bind(La,function(){c.trigger("enter")}).bind(Ma,function(){c.trigger("leave")}).bind(M,function(p){c.trigger("over",[p.pageX,p.pageY])}).bind(Na,function(p,v){c.trigger("wheel",[v]);return false}).bind(Oa,function(){c.trigger("animate")}).bind(Pa,function(p){c.trigger("down",[p.clientX,
p.clientY]);return false}).disableTextSelect();(a.hint||a.tooltip)&&d.attr(Qa,a.hint||a.tooltip);a.monitor&&l.append(j(N,{className:pa,css:{position:Z,left:0,top:-b.y}}));a.indicator&&l.append(j(N,{className:qa,css:{width:a.indicator+r,height:a.indicator+r,top:-a.indicator+r,position:Z,backgroundColor:ra}}));h&&l.append(n=j(N,{className:Ra,css:{position:Z,left:0,top:-0.5*a.indicator,height:0.5*a.indicator,backgroundColor:ra}}));if(h)for(;e.length;){d=new Image;h=a.path+e.shift();j(d).load(function(){i.preloaded++;
n.css({width:1/i.frames*i.preloaded*b.x});i.frames==i.preloaded&&n.remove()});d.src=h;i.preloads.push(d)}c.trigger("frameChange")},animate:function(){},tick:function(){var d=a.speed,b=a.friction/a.tempo,e=g(G),h=e<0;e-=e*b;e=sa=e==sa?0:e;e=(h?ea:I)(0,S(3,e))||0;e=f(G,e);step=(d+e)/a.tempo;j(Q(pa),g(F)).text(g(a.monitor));ta(0);x&&x++;if(!(x&&!e)){if(g($))return y();f(q,g(q)+step);c.trigger("fractionChange")}},down:function(d,b,e,h){y();d=a.hotspot||c;f($,true);f(ua,b);f(G,0);f(aa,f(va,g(q)));!h&&
D.bind(M,function(n){c.trigger("drag",[n.clientX,n.clientY])}).bind(X,function(){c.trigger("up")})&&d.css({cursor:R(Sa)+", "+Y})},up:function(d,b){d=a.hotspot||c;f($,false);var e=(A[0]+A[1]+A[2])/A.length/(b?15:20),h=(a.reversed?-1:1)*(a.stitched?-1:1);f(G,a.inertia?e*h:0);W();y();!b&&D.unbind(X).unbind(M)&&d.css({cursor:R(oa)+", "+Y})},drag:function(d,b){y();d=g(ua);var e=g(va),h=a.stitched,n=g(K);f(q,e+(a.reversed?-1:1)*(h?-1:1)/(a.revolution||h/2||n.x)*(b-d));ta(b-wa);wa=b;c.trigger("fractionChange")},
wheel:function(d,b){y();f(G,0);d=g(q);var e=1/I(g(E),g(L)),h=ba(Ta(Ua(b))/2);h=b<0?-h:h;f(q,d+h*e);c.trigger("fractionChange");return false},fractionChange:function(d,b){b=!b?g(q):f(q,b);d=g(aa);d=a.speed=Ba(b-d,a.speed);b=a.loops?b-(b<0?ba:xa)(b):da(0,1,b);a.speed=!a.loops&&a.rebound&&ca==a.rebound*1E3/a.tempo?-d:d;b=!a.loops?b:b>=0?b:1+b;b=f(aa,f(q,S(6,b)));f(B,b*(g(E)-1)+1);!x&&(ca=b==0||b==1?ca+1:0);c.trigger("frameChange")},frameChange:function(d,b){var e=g(E);d=!b?g(q):f(q,S(6,(b-1)/(e-1)));
b=!b?g(B):f(B,b);b=f(B,O(b));var h=g(V),n=a.images,i=g(K);g(L);var l=g(ka),p=g(la);if(a.stitched){l=a.loops?a.stitched:a.stitched-i.x;o=O(d*l);m=0;p=[-o+r,m+r]}else{o=xa(b/a.footage);m=b-o*a.footage-1;o=m==-1?o+m:o;m=m==-1?a.footage+m:m;var v=a.horizontal?i.y:i.x,o=-o*(l+v),m=-m*(l+(a.horizontal?i.x:i.y));e=ba(e/a.footage);l=e*v+(e-1)*l;o=p&&a.horizontal?o-l:o;m=p&&!a.horizontal?m-l:m;p=n.length?[0,0]:a.horizontal?[m+r,o+r]:[o+r,m+r]}b=n[b-1]||h;l=i.x-a.indicator;d=da(0,l,O(d*(l+2))-1);i={background:R(a.path+
b)+ya+p.join(ya)};a.images.length?c.attr({src:a.path+b}):c.css(i);j(Q(qa),g(F)).css({left:d+r})}},x=a.delay>0?-O(a.delay*a.tempo):0,y=function(){return x=-a.timeout*a.tempo},ca=0,wa=0,sa=0,ta=function(d){A.push(d)&&A.shift()},W=function(){return A=[0,0,0]},A=W();u.setup()});return j(H)};Ca("mousewheel disableTextSelect enableTextSelect".split(/ /));var t=".reel",C="jquery-reel",Ia=C+"-overlay",qa="indicator",Ra="preloader",pa="monitor",U="tick"+t,D=j(za),Ja=/iphone|ipod|ipad|android/i.test(navigator.userAgent),
Y="w-resize",T,Ha="data:image/gif;base64,R0lGODlhCAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7",oa="data:image/gif;base64,R0lGODlhEAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAI3lC8AeBDvgosQxQtne7yvLWGStVBelXBKqDJpNzLKq3xWBlU2nUs4C/O8cCvU0EfZGUwt19FYAAA7",Sa="data:image/gif;base64,R0lGODlhEAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAIslI95EB3MHECxNjBVdE/5b2zcRV1QBabqhwltq41St4hj5konmVioZ6OtEgUAOw==",O=Math.round,xa=Math.floor,ba=Math.ceil,ea=Math.min,I=Math.max,Ua=Math.abs,Ta=
Math.sqrt,J=parseInt,ma="backup",$="clicked",ua="clicked_location",va="clicked_on",K="dimensions",q="fraction",B="frame",E="frames",V="image",aa="last_fraction",la="reversed",ka="spacing",F="stage",L="steps",G="velocity",Oa="dblclick"+t,Pa="mousedown"+t,La="mouseenter"+t,Ma="mouseleave"+t,M="mousemove"+t,X="mouseup"+t,Na="mousewheel"+t,ia="",ya=" ",Z="absolute",Ga="class",ja="div",N=Aa(ja),ha="height",ra="#000",Fa="id",Ea="img",r="px",fa="src",Qa="title",ga="width"})(jQuery,window,document);
function log(j,P){console.log(j,P);return P};
