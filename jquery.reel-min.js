/*
 Copyright (c) 2009-2011 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 jQuery Reel
 http://jquery.vostrel.cz/reel
 Version: 1.1.3-devel
 Updated: 2011-11-09

 Requires jQuery 1.4.2 or higher
*/
jQuery.reel||function(e,tb,ta,r){function G(f){return e.reel.instances.length?e.reel.instances.first().data(f):null}function ub(f){return e.reel.instances.push(f[0])&&f}function vb(f){return(e.reel.instances=e.reel.instances.not("#"+f.attr(Z)))&&f}function ua(f){return wb&&"data:image/gif;base64,R0lGODlh"+f}function va(f){return"<"+f+"/>"}function wa(f){return"."+f}function xa(f){return"http://code.vostrel.cz/"+f}function ya(f){return"url("+f+")"}function T(f,a,p){return $(f,Ta(a,p))}function xb(f){function a(){e.fn[this]||
(e.fn[this]=function(){return this})}e.each(f,a)}function za(f,a){return E(f)*(a?-1:1)}function ea(f){return f.originalEvent.touches[0]}e.reel={version:"1.1.3-devel",def:{footage:6,frame:1,frames:36,hint:"",horizontal:true,hotspot:r,indicator:0,klass:"",loops:true,reversed:r,spacing:0,stitched:0,suffix:"-reel",tooltip:"",area:r,brake:0.5,clickfree:false,cw:false,delay:-1,directional:false,draggable:true,entry:r,graph:r,image:r,images:[],inversed:false,laziness:6,monitor:r,opening:0,orbital:0,path:"",
preloader:4,rebound:0.5,revolution:r,row:1,rows:0,speed:0,step:r,steps:r,tempo:36,timeout:2,throwable:true,vertical:false,wheelable:true,annotations:r,attr:{},preload:"fidelity",scrollable:true,velocity:0}};e.fn.reel=function(f){var a=e.extend({},e.reel.def,f);f=function(h){var t=[];h.filter(Ua).each(function(){var c=e(this),d=a.images.length&&a.images||a.image||a.attr.src||c.attr(Va),w=fa(a.attr.width||c.css(Wa)),o=fa(a.attr.height||c.css(Xa));!d||d==Ya||!w||!o||t.push(c)});h.filter(wa(B)).each(function(){t.push(e(this).trigger("teardown"))});
return e(t)}(this);var p=[];a.reversed&&(a.cw=true);a.tooltip&&(a.hint=a.tooltip);a.hotspot&&(a.area=a.hotspot);f.each(function(){var h=e(this),t=h.data(),c=function(i,b){t[i]=b;h.trigger("store",[i,b]);return b},d=function(i){var b=t[i];h.trigger("recall",[i,b]);return b},w={setup:function(i){if(h.hasClass(B))return o.call(i);var b=h.attr(a.attr).attr(Va),g=c(Z,h.attr(Z)||h.attr(Z,B+"-"+ +new Date).attr(Z)),k=h.attr("style"),m=e.extend({},h.data()),n=a.images,j=a.stitched,l=a.loops,q={x:fa(h.css(Wa)||
a.attr.width),y:fa(h.css(Xa)||a.attr.height)},A=c(Aa,a.orbital&&a.footage||a.rows<=1&&n.length||a.frames),M=j?1:Za(A/a.footage),C={display:"block",width:q.x,height:q.y};g="#"+g+a.suffix;var N=h.attr("class")||"",x={position:"relative",width:q.x,height:q.y};x=e(O,{id:g.substr(1),"class":N+Ba+yb,css:x}).bind("openingDone",ga);C=h.wrap(x).attr({"class":B}).css(C).bind(w);p.push(ub(C)[0]);c($a,n.length&&n.length||a.image||b.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2"));c(ab,[]);c(H,a.frame);
c(bb,a.spacing);c(U,q);c(s,0);c(Ca,a.steps||a.frames);c(ha,a.revolution||j/2||q.x*2);c(Da,M);c(ia,1/(A-(l&&!j?0:1)));c(zb,1/$(A,d(Ca)));c(Ea,j);c(cb,j-(l?0:q.x));c(Fa,g);c(P,c(Ga,a.speed)<0);c(V,a.velocity||0);c(W,a.vertical);c(F,(a.row-1)/(a.rows-1));c(ja,za(1,!a.cw&&!j));c(aa,false);c(db,a.brake);c(Ha,!!a.orbital);c(I,a.tempo/(e.reel.lazy?a.laziness:1));c(ka,0);c(eb,{src:b,classes:N,style:k||Ya,data:m});J.bind(Q,w.tick);o.call(i);h.trigger("start")},teardown:function(i){var b=h.data(eb);h.parent().unbind("openingDone",
ga).children("img").unbind(u);h.unbind(u).unbind(w).attr({"class":b.classes,src:b.src,style:b.style}).removeClass(B);h.data(b.data).siblings().remove();h.unwrap();vb(h);la();J.unbind(Q,w.tick).unbind(Q,w.opening_tick);ma.unbind(Ia).unbind(Ja);o.call(i)},start:function(){var i=d(U),b=d(Aa),g=$(b,d(Ca));g=c(s,1/g*((a.step||a.frame)-1));c(H,R(g*b)+1);h.attr("id");b={position:ba,width:i.x,height:i.y,left:0,top:0};g=h.parent();var k=e(O,{"class":Ab,css:b}).appendTo(g),m=!d(aa)||a.rows<=1||!a.orbital||
a.scrollable,n=c(fb,e(a.area||k));if(e.reel.touchy){h.css({WebkitUserSelect:"none",WebkitBackgroundSize:a.images.length?"auto":d(Ea)&&d(Ea)+"px "+i.y+"px"||i.x*a.footage+"px "+i.y*d(Da)*(a.rows||1)*(a.directional?2:1)+"px"});n.bind(Bb,function(j){h.trigger("down",[ea(j).clientX,ea(j).clientY,true])}).bind(Cb,function(j){h.trigger("pan",[ea(j).clientX,ea(j).clientY,true]);return!m}).bind(Db,function(){h.trigger("up",[true]);return false}).bind(Eb,function(){h.trigger("up",[true]);return false})}else n.css({cursor:"url("+
gb+"), "+Ka}).bind(a.wheelable?Fb:"",function(j,l){h.trigger("wheel",[l]);return false}).bind(Gb,function(){h.trigger("play")}).bind(a.clickfree?Hb:Ib,function(j){if(j.which==1){h.trigger("down",[j.clientX,j.clientY]);return false}}).bind(a.clickfree?Jb:"",function(){h.trigger("up");return false}).disableTextSelect();a.hint&&n.attr(Kb,a.hint);a.monitor&&g.append(K=e(O,{"class":Lb,css:{position:ba,left:0,top:0}}))||(K=e());if(a.annotations){k.append(v=e(O,{"class":Mb,css:b}))||(v=e());e.each(a.annotations,
function(j,l){j=e(O,l.holder).attr({id:j});var q=l.image?e(va(Ua),l.image):e(),A=l.link?e(va(Nb),l.link):e();l.image||l.link&&j.append(A);l.link||l.image&&j.append(q);l.link&&l.image&&j.append(A.append(q));j.hide().appendTo(v)})}a.indicator&&g.append(hb("x"));a.rows>1&&a.indicator&&g.append(hb("y"));h.trigger("preload")},preload:function(i){var b=d(U),g=h.parent(),k=d($a),m=a.images,n=e.reel.preload[a.preload]||e.reel.preload[e.reel.def.preload];n=!m.length?[k]:n(m,a,d);var j=[],l=h[0];l.frames=n.length;
l.preloaded=0;h.trigger("stop");for(g.append(D=e(O,{"class":Ob,css:{position:ba,left:0,top:b.y-a.preloader,height:a.preloader,overflow:ib,backgroundColor:jb}}));n.length;){var q=a.path+n.shift(),A=e(new Image).hide().attr({width:b.x,height:b.y}).bind("load"+u,function(){l.preloaded++;e(this).unbind(u);D.css({width:1/l.frames*l.preloaded*b.x});if(l.frames==l.preloaded){D.remove();m.length||h.attr({src:Pb}).css({backgroundImage:ya(a.path+k)});h.trigger(a.rows>1&&!a.stitched?"rowChange":"frameChange").trigger("loaded").trigger("opening");
o.call(i)}});g.append(A);j.push(q);setTimeout(function(M,C){return function(){M.attr({src:C})}}(A,q),0)}c(ab,j)},tick:function(i){var b=d(V);if(L){var g=b-d(db)/G(I)*L;b=!(b*g<=0||b<E(g))&&c(V,b>E(d(Ga))?g:(L=y=0))}K.text(d(a.monitor));b&&L++;y&&y++;kb(0);La=true;if(y&&!b)return o.call(i);if(d(na))return o.call(i,z());g=d(ja)*za(1,d(P));var k=(d(Ma)?b:E(d(Ga))+b)/G(I);b=d(s);g=c(s,b-k*g);o.call(i);g!=b&&h.trigger("fractionChange")},opening:function(){var i=a.entry||a.speed,b=d(s),g=a.opening;c(s,
b-i*a.opening);c(ka,g*G(I));J.bind(Q,w.opening_tick)},opening_tick:function(i){var b=(a.entry||a.speed)/G(I)*(a.cw?-1:1),g=d(s);c(s,g+b);b=c(ka,d(ka)-1);h.trigger("fractionChange");o.call(i);if(!(b>1)){J.unbind(Q,w.opening_tick);h.trigger("openingDone")}},play:function(i){var b=c(Na,true);c(Ma,!b);ca();o.call(i)},pause:function(i){c(Na,false);z();o.call(i)},stop:function(i){var b=c(Ma,true);c(Na,!b);o.call(i)},down:function(i,b,g,k){if(a.draggable){c(na,d(H));c(V,0);oa=pa(b,g,d(s),d(ha),d(F));z();
la();if(!k){ma.css({cursor:ya(Qb)+", "+Ka}).bind(Ja,function(m){h.trigger("pan",[m.clientX,m.clientY]);o.call(m);return false});a.clickfree||ma.bind(Ia,function(m){h.trigger("up");o.call(m)})}}o.call(i)},up:function(i,b){if(!a.draggable)return o.call(i);c(na,false);c(aa,false);var g=c(V,!a.throwable?0:E(da[0]+da[1])/60);L=g?1:0;g?ca():z();la();!b&&ma.unbind(Ia).unbind(Ja)&&d(fb).css({cursor:ya(gb)+", "+Ka});o.call(i)},pan:function(i,b,g){if(a.draggable&&La){La=false;z();var k={x:b-oa.x,y:g-oa.y};
if(E(k.x)>0||E(k.y)>0){oa={x:b,y:g};var m=d(ha),n=d(lb),j=d(W),l=c(s,mb(j?g-n.y:b-n.x,d(Oa),m,d(Pa),d(Qa),d(ja)));c(aa,d(aa)||d(H)!=d(na));(k=kb(j?k.y:k.x||0))&&c(P,k<0);if(a.orbital&&d(Ha)){c(W,E(g-n.y)>E(b-n.x));n=pa(b,g,l,m,d(F))}if(a.rows>1){k=d(U).y;j=d(nb);var q=-j*k;c(F,e.reel.math.envelope(g-n.y,j,k,q,q+k,-1))}!(l%1)&&!a.loops&&pa(b,g,l,m,d(F));h.trigger("fractionChange")}}o.call(i)},wheel:function(i,b){var g=Za(Rb(E(b))/2);g=za(g,b>0);b=0.2*d(ha);pa(r,r,d(s),b,d(F));c(s,mb(g,d(Oa),b,d(Pa),
d(Qa),d(ja)));g&&c(P,g<0);c(V,0);z();o.call(i);h.trigger("fractionChange");return false},fractionChange:function(i,b){b=c(s,qa.fraction(b,a,d));var g=c(H,1+X(b/d(ia))),k=a.rows>1,m=a.orbital;c(Ha,!!m&&(g<=m||g>=a.footage-m+2));if(!a.loops&&a.rebound){!y&&!(b%1)?Ra++:(Ra=0);Ra>=a.rebound*1E3/G(I)&&c(P,!d(P))}h.trigger(k?"rowChange":"frameChange");o.call(i)},rowChange:function(i,b){var g=d(s)/d(ia)+1;b=c(F,qa.row(b,a,d));b=T(0,a.rows-1,X(b*a.rows));c(H,X(g+b*a.frames));o.call(i);h.trigger("frameChange")},
frameChange:function(i,b){var g=c(s,qa.fraction(!b?r:d(ia)*(b-1),a,d)),k=d(ob);b=c(ob,c(H,qa.frame(b,a,d)));var m=a.images,n=a.footage,j=d(U),l=a.rows>1,q=d(Fa),A=a.horizontal;if(d(W)){b=a.inversed?n+1-b:b;b+=n}var M=(d(W)?j.y:j.x)-a.indicator,C=T(0,M,R(e.reel.math.interpolate(d(s),-1,M+2)));C=!a.cw||a.stitched?C:M-C;e(wa(Sa+".x"),q).css(d(W)?{left:0,top:C}:{left:C,top:j.y-a.indicator});if(l){l=j.y-a.indicator;l=T(0,l,R(e.reel.math.interpolate(d(F),-1,l+2)));e(wa(Sa+".y"),q).css({top:l})}if(b!=k){e(d(Fa)).removeClass(pb+
k).addClass(pb+b);if(m.length)h.attr({src:a.path+m[b-1]});else{if(a.stitched)m=[-R(g*d(cb))+Y,0+Y];else{g=b%n-1;g=g<0?n-1:g;k=X((b-0.1)/n);k+=a.rows>1?0:d(P)?0:d(Da);n=d(bb);k=k*((A?j.y:j.x)+n);j=g*((A?j.x:j.y)+n);m=m.length?[0,0]:A?[-j+Y,-k+Y]:[-k+Y,-j+Y]}h.css({backgroundPosition:m.join(Ba)})}}a.annotations&&e.each(a.annotations,function(N,x){var ra=typeof x.x!=qb?x.x:x.x[b-x.start],rb=typeof x.y!=qb?x.y:x.y[b-x.start];x=ra&&rb;ra={position:ba,left:ra,top:rb};N=e("#"+N,q).css(ra);x&&N.filter(":hidden").show()||
N.filter(":visible").hide()});o.call(i)}},o=function(i){sb||delete this;return i},y,L=0,ca=function(){return y=0},z=function(){clearTimeout(S);J.unbind(Q,w.opening_tick);h.trigger("play");return y=-a.timeout*G(I)},S,ga=function(){S=setTimeout(function(){h.trigger("play")},a.delay*1E3||0)},K,v,D,hb=function(i){return e(O,{"class":[Sa,i].join(Ba),css:{width:a.indicator,height:a.indicator,overflow:ib,top:d(U).y-a.indicator,left:0,position:ba,backgroundColor:jb}})},Ra=0,oa={x:0,y:0},kb=function(i){return da.push(i)&&
da.shift()&&i},la=function(){return da=[0,0]},da=la(),mb=a.graph||e.reel.math[a.loops?"hatch":"envelope"],qa=e.reel.normal,pa=function(i,b,g,k,m){c(Oa,g);c(nb,m);c(Pa,a.loops?0:-g*k);c(Qa,a.loops?k:k-g*k);return i&&c(lb,{x:i,y:b})||r},La=true,ma=e.browser.opera?J:e.unique(J.add(tb.top.document));w.setup()});sa=sa||function h(){var t=+new Date,c=G(I);if(c){J.trigger(Q);e.reel.cost=(+new Date+e.reel.cost-t)/2;return sa=setTimeout(h,$(4,1E3/c-e.reel.cost))}else return sa=r}();return e(p)};e.reel.math=
{envelope:function(f,a,p,h,t,c){return a+$(h,Ta(t,-f*c))/p},hatch:function(f,a,p,h,t,c){f=(f<h?t:0)+f%t;f=a+-f*c/p;return f-X(f)},interpolate:function(f,a,p){return a+f*(p-a)}};e.reel.preload={linear:function(f){return f},fidelity:function(f,a){function p(o,y,L){function ca(D){for(;!(D>=1&&D<=K);)D+=D<1?+K:-K;return w[L+D]||(w[L+D]=!!z.push(D))}if(!o.length)return[];var z=[],S=4*y,ga=a.frame,K=o.length;y=K/S;for(var v=0;v<S;v++)ca(ga+R(v*y));for(;y>1;){v=0;S=z.length;for(y/=2;v<S;v++)ca(R(z[v]+y))}for(v=
0;v<z.length;v++)z[v]=o[z[v]-1];return z}var h=a.orbital?2:a.rows||1,t=a.orbital?a.footage:a.frames,c=(a.row-1)*t,d=[].concat(f),w=new Array(f.length);f=h<2?[]:d.slice(c,c+t);return p(f,1,c).concat(p(d,h,0))}};e.reel.normal={fraction:function(f,a,p){f=f!=r?f:p(s);return a.loops?f-X(f):T(0,1,f)},row:function(f,a,p){return T(0,1,f!=r?(f-1)/(a.rows-1):p(F))},frame:function(f,a,p){f=R(f)||p(H);for(p=p(Aa)*(a.orbital?2:a.rows||1);f<1;)f+=p;return a.loops?f%p:T(0,p,f)}};e.reel.touchy=/iphone|ipod|ipad|android/i.test(navigator.userAgent);
e.reel.lazy=/iphone|ipod|android/i.test(navigator.userAgent);e.reel.instances=e();e.reel.cost=0;e.reel.leader=G;xb("mousewheel disableTextSelect enableTextSelect".split(/ /));var J=e(ta);ta=+e.browser.version.split(".").slice(0,2).join(".");var sb=e.browser.msie,wb=!(sb&&ta<8),Ka="ew-resize",sa,B="jquery-reel",yb=B+"-overlay",Sa=B+"-indicator",Ob=B+"-preloader",Lb=B+"-monitor",Ab=B+"-interface",Mb=B+"-annotations",pb="frame-",Pb=ua("CAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7")||xa("blank.gif"),
gb=ua("EAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAI3lC8AeBDvgosQxQtne7yvLWGStVBelXBKqDJpNzLKq3xWBlU2nUs4C/O8cCvU0EfZGUwt19FYAAA7")||xa("jquery.reel.cursor-drag.gif"),Qb=ua("EAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAIslI95EB3MHECxNjBVdE/5b2zcRV1QBabqhwltq41St4hj5konmVioZ6OtEgUAOw==")||xa("jquery.reel.cursor-drag-down.gif"),R=Math.round,X=Math.floor,Za=Math.ceil,Ta=Math.min,$=Math.max,E=Math.abs,Rb=Math.sqrt,fa=parseInt,fb="area",eb="backup",P="backwards",ia="bit",db="brake",Ha="center",
na="clicked",lb="clicked_location",Oa="clicked_on",nb="clicked_row",ja="cwish",U="dimensions",s="fraction",H="frame",ob="_frame",Aa="frames",Qa="hi",ib="hidden",$a="image",ab="images",ka="opening_ticks",Pa="lo",Na="playing",aa="reeling",ha="revolution",F="row",Da="rows",bb="spacing",Ga="speed",Fa="stage",Ca="steps",Ea="stitched",cb="stitched_travel",Ma="stopped",I="tempo",V="velocity",W="vertical",zb="wheel_step",u=".reel",Gb="dblclick"+u,Ib="mousedown"+u,Hb="mouseenter"+u,Jb="mouseleave"+u,Ja="mousemove"+
u,Ia="mouseup"+u,Fb="mousewheel"+u,Q="tick"+u,Eb="touchcancel"+u,Db="touchend"+u,Bb="touchstart"+u,Cb="touchmove"+u,Ya="",Ba=" ",ba="absolute",Nb="a",O=va("div"),Xa="height",jb="#000",Z="id",Ua="img",qb="object",Y="px",Va="src",Kb="title",Wa="width"}(jQuery,window,document);
