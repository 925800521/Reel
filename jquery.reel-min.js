/*
 Copyright (c) 2009-2010 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 http://jquery.vostrel.cz/reel
 Version: 1.1 RC 2
 Updated: 2010-11-22

 Requires jQuery 1.4.2
*/
jQuery.fn.reel||function(k,fa,ab,n){function bb(l){return"<"+l+"/>"}function ga(l){return"."+l}function ha(l){return"url("+l+")"}function E(l){return+l.toFixed(4)}function T(l,a,v){return U(l,Fa(a,v))}function cb(l){function a(){k.fn[this]||(k.fn[this]=function(){return this})}k.each(l,a)}function ia(l,a){return w(l)*(a?-1:1)}function V(l){return l.originalEvent.touches[0]}var db=k.reel={footage:6,frame:1,frames:36,hint:"",horizontal:true,hotspot:n,indicator:0,klass:"",loops:true,reversed:n,spacing:0,
stitched:n,suffix:"-reel",tooltip:"",area:n,brake:0.5,clickfree:false,couple:n,cw:false,delay:-1,directional:false,draggable:true,entry:n,graph:n,image:n,images:[],inversed:false,laziness:8,monitor:n,maximum:100,minimum:0,opening:0,path:"",perpendicular:0,preloader:4,rebound:0.5,revolution:n,row:1,rows:0,speed:0,step:n,steps:n,tempo:36,timeout:2,throwable:true,value:n,vertical:false,wheelable:true};k.fn.reel=function(l){var a=k.extend({},db,l);l=function(g){var e=[];g.filter(eb).each(function(){var c=
k(this),m=a.images.length&&a.images||a.image||c.attr(Ga),s=W(c.css(Ha)),x=W(c.css(Ia));!m||m==Ja||!s||!x||e.push(c)});g.filter(Ka+ga(y)).each(function(){e.push(k(this))});return k(e)}(this);var v=[],H=a.tempo/=fb?a.laziness:1,I=1E3/H;a.reversed&&(a.cw=true);a.tooltip&&(a.hint=a.tooltip);a.hotspot&&(a.area=a.hotspot);ja=ja||function g(){z.trigger(F);return setTimeout(g,I)}();l.each(function(){var g=k(this),e=function(f,b){g.data(f,b);g.trigger("store");return b},c=function(f){g.trigger("recall");return g.data(f)},
m=function(f){gb||delete this;return f},s={setup:function(f){if(g.hasClass(y))return m.call(f);var b=g.attr(Ga),d=g.attr(hb),h=g.attr("style"),i=a.images,j=a.stitched,q=a.loops,t={x:W(g.css(Ha)),y:W(g.css(Ia))},r=e(La,a.perpendicular&&a.footage||a.rows<=1&&i.length||a.frames),B=j?1:Ma(r/a.footage),u={display:"block",width:t.x,height:t.y};d="#"+d+a.suffix;var Na=g.attr("className"),ka={position:"relative",width:t.x,height:t.y};ka=k(O,{id:d.substr(1),className:Na+X+ib,css:ka});u=g.wrap(ka).attr({className:y}).css(u).bind(s);
v.push(u[0]);e(la,i.length&&i.length||a.image||b.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2"));e(Oa,Na);e(C,a.frame);e(Pa,a.spacing);e(D,t);e(o,0);e(ma,a.steps||a.frames);e(Y,a.revolution||j/2||t.x*2);e(na,B);e(Z,1/(r-(q&&!j?0:1)));e(jb,1/U(r,c(ma)));e(oa,j);e(Qa,j-(q?0:t.x));e($,d);e(G,e(pa,a.speed)<0);e(J,0);e(A,(a.row-1)/(a.rows-1));e(K,a.value||0);e(L,a.vertical);e(aa,ia(1,!a.cw&&!j));e(Ra,{src:b,style:h||Ja});ja&&z.bind(F,s.tick);m.call(f);g.trigger("start")},teardown:function(f){g.unbind(p).unbind(s);
var b=g.data("events"),d=g.clone().attr(g.data(Ra)).removeClass(y).addClass(c(Oa));for(var h in b)k.each(b[h],function(i,j){d.bind(h+"."+j.namespace,j.handler,j.data)});k("img:hidden",g.parent()).remove();k(c($)).before(d).detach();ba();z.unbind(qa).unbind(ra).unbind(F,s.tick).unbind(F,s.opening_tick);m.call(f)},start:function(){var f=c(D),b=c(La),d=U(b,c(ma));d=e(o,1/d*((a.step||a.frame)-1));e(C,d*b+1);g.attr("id");b=g.parent();d=k(O,{className:kb,css:{position:ca,left:0,top:0,width:f.x,height:f.y,
background:sa,opacity:0}}).appendTo(b);d=e(Sa,k(a.area||d));var h=g.add(a.couple);if(lb){g.css({WebkitUserSelect:"none",WebkitBackgroundSize:a.images.length?"auto":c(oa)&&c(oa)+"px "+f.y+"px"||f.x*a.footage+"px "+f.y*c(na)*(a.rows||1)*(a.directional?2:1)+"px"});d.bind(mb,function(i){h.trigger("down",[V(i).clientX,V(i).clientY,true]);return false}).bind(nb,function(i){h.trigger("slide",[V(i).clientX,V(i).clientY,true]);return false}).bind(ob,function(){h.trigger("up",[true]);return false}).bind(pb,
function(){h.trigger("up",[true]);return false})}else d.css({cursor:"url("+Ta+"), "+ta}).bind(qb,function(i,j){h.trigger("wheel",[j]);return false}).bind(rb,function(){h.trigger("play")}).bind(a.clickfree?sb:tb,function(i){h.trigger("down",[i.clientX,i.clientY]);return false}).bind(a.clickfree?ub:"",function(){h.trigger("up");return false}).disableTextSelect();a.hint&&d.attr(vb,a.hint);a.monitor&&b.append(ua=k(O,{className:wb,css:{position:ca,left:0,top:0}}))||(ua=k());a.indicator&&b.append(Ua("x"));
a.rows>1&&a.indicator&&b.append(Ua("y"));g.trigger("preload")},preload:function(f){var b=c(D),d=g.parent(),h=c(la),i=a.images;h=!i.length?[h]:[].concat(i);var j=g[0];j.frames=h.length;j.preloaded=0;g.trigger("stop");for(d.append(va=k(O,{className:xb,css:{position:ca,left:0,top:b.y-a.preloader,height:a.preloader,backgroundColor:sa}}));h.length;){i=a.path+h.shift();var q=k(new Image).bind("load"+p,function(){j.preloaded++;k(this).unbind(p);va.css({width:1/j.frames*j.preloaded*b.x});if(j.frames==j.preloaded){va.remove();
a.value!=n&&g.trigger("valueChange",c(K));g.trigger(a.rows>1&&!a.stitched?"rowChange":"frameChange");g.attr({src:yb}).trigger("loaded");g.trigger("opening");m.call(f)}});d.append(q.hide().attr({src:i}))}},tick:function(f){var b=c(J);if(P){var d=E(b-zb*P);b=!(b*d<=0||b<w(d))&&e(J,b>w(c(pa))?d:(P=x=0))}ua.text(c(a.monitor));b&&P++;x&&x++;Va(0);slidable=true;g[0].value!=c(K)&&g.trigger("valueChange",g[0].value);if(x&&!b)return m.call(f);if(c(wa))return m.call(f,M());d=c(aa)*ia(1,c(G));var h=(c(xa)?b:
w(c(pa))+b)/a.tempo;b=c(o);d=e(o,b-h*d);m.call(f);d!=b&&g.trigger("fractionChange")},opening:function(){var f=a.entry||a.speed,b=c(o),d=a.opening;e(o,b-f*a.opening);e(ya,d*H);z.bind(F,s.opening_tick)},opening_tick:function(f){var b=(a.entry||a.speed)/a.tempo*(a.cw?-1:1),d=c(o);e(o,E(d+b));b=e(ya,c(ya)-1);g.trigger("fractionChange");m.call(f);if(!(b>1)){z.unbind(F,s.opening_tick);Ab()}},play:function(f){var b=e(za,true);e(xa,!b);Wa();m.call(f)},pause:function(f){e(za,false);M();m.call(f)},stop:function(f){var b=
e(xa,true);e(za,!b);m.call(f)},down:function(f,b,d,h){if(a.draggable){e(wa,true);e(J,0);da=ea(b,d,c(o),c(Y),c(A));M();ba();if(!h){z.css({cursor:ha(Bb)+", "+ta}).bind(ra,function(i){g.trigger("slide",[i.clientX,i.clientY]);m.call(i);return false});a.clickfree||z.bind(qa,function(i){g.trigger("up");m.call(i)})}}m.call(f)},up:function(f,b){if(!a.draggable)return m.call(f);e(wa,false);var d=e(J,!a.throwable?0:w(Q[0]+Q[1])/60);P=d?1:0;d?Wa():M();ba();!b&&z.unbind(qa).unbind(ra)&&c(Sa).css({cursor:ha(Ta)+
", "+ta});m.call(f)},slide:function(f,b,d){if(a.draggable&&slidable){slidable=false;M();var h={x:b-da.x,y:d-da.y};if(w(h.x)>0||w(h.y)>0){da={x:b,y:d};var i=c(Y),j=c(Xa),q=c(L),t=e(o,Ya(q?d-j.y:b-j.x,c(Aa),i,c(Ba),c(Ca),c(aa)));(h=Va(q?h.y:h.x||0))&&e(G,h<0);if(a.perpendicular)var r=a.perpendicular,B=a.footage,u=c(C);if(a.perpendicular&&(u<=r||u>=B-r+2&&u<=B+r-1||u==2*B-r+2)){e(L,w(d-j.y)>w(b-j.x));j=ea(b,d,t,i,c(A))}if(a.rows>1){r=c(D).y;B=c(Za);u=-B*r;e(A,E(k.reel.math.envelope(d-j.y,B,r,u,u+r,-1)))}!(t%
1)&&!a.loops&&ea(b,d,t,i,c(A));g.trigger("fractionChange")}}m.call(f)},wheel:function(f,b){if(!a.wheelable)return m.call(f);var d=Ma(Cb(w(b))/2);d=ia(d,b>0);b=0.2*c(Y);ea(n,n,c(o),b,c(A));e(o,Ya(d,c(Aa),b,c(Ba),c(Ca),c(aa)));d&&e(G,d<0);e(J,0);M();m.call(f);g.trigger("fractionChange");return false},fractionChange:function(f,b,d){b=!b?c(o):e(o,b);b=a.loops?b-R(b):T(0,1,b);b=e(o,E(b));var h=c(C),i=e(C,1+R(b/c(Z)));e(K,E(k.reel.math.interpolate(b,a.minimum,a.maximum)));if(!a.loops&&a.rebound){!x&&!(b%
1)?Da++:(Da=0);Da>=a.rebound*1E3/a.tempo&&e(G,!c(G))}d||g.trigger("valueChange");d=c(D);var j=(c(L)?d.y:d.x)-a.indicator;b=T(0,j,S(k.reel.math.interpolate(b,-1,j+2)));b=!a.cw||a.stitched?b:j-b;k(ga(Ea+".x"),c($)).css(c(L)?{left:0,top:b}:{left:b,top:d.y-a.indicator});if(a.rows>1){b=c(D).y-a.indicator;b=T(0,b,S(k.reel.math.interpolate(c(A),-1,b+2)));k(ga(Ea+".y"),c($)).css({top:b})}if(i==h)return m.call(f);g.trigger(a.rows>1?"rowChange":"frameChange");m.call(f)},rowChange:function(f,b){var d=R(c(o)/
c(Z))+1;b=e(A,T(0,1,E(b!=n?(b-1)/(a.rows-1):c(A))));e(C,d+(a.rows<=1?0:S(b*(a.rows-1))*a.frames));m.call(f);g.trigger("frameChange")},frameChange:function(f,b){var d=!b?c(o):e(o,E(c(Z)*(b-1)));b=e(C,S(b?b:c(C)));var h=a.images,i=a.footage,j=c(D),q=a.horizontal;if(c(L)){b=a.inversed?i+1-b:b;b+=i}if(h.length){h=h[b-1];g.attr({src:a.path+h})}else{if(a.stitched)q=[-S(d*c(Qa))+N,0+N];else{d=b%i-1;d=d<0?i-1:d;i=R((b-0.1)/i);i+=a.rows>1?0:c(G)?0:c(na);b=c(Pa);i=i*((q?j.y:j.x)+b);j=d*((q?j.x:j.y)+b);q=h.length?
[0,0]:q?[-j+N,-i+N]:[-i+N,-j+N]}h=c(la);g.css({background:ha(a.path+h)+X+q.join(X)})}m.call(f)},valueChange:function(f,b){f=b!==n&&e(o,b/(a.maximum-a.minimum));g[0].value=b===n?c(K):e(K,b);f===false||g.trigger("fractionChange",[n,true])}},x,P=0,Wa=function(){return x=0},M=function(){clearTimeout($a);z.unbind(F,s.opening_tick);g.trigger("play");return x=-a.timeout*a.tempo},$a,Ab=function(){$a=setTimeout(function(){g.trigger("play")},a.delay*1E3||0)},ua,va,Ua=function(f){return k(O,{className:[Ea,f].join(X),
css:{width:a.indicator,height:a.indicator,top:c(D).y-a.indicator,left:0,position:ca,backgroundColor:sa}})},Da=0,da={x:0,y:0},Va=function(f){return Q.push(f)&&Q.shift()&&f},ba=function(){return Q=[0,0]},Q=ba(),zb=a.brake/a.tempo,Ya=a.graph||k.reel.math[a.loops?"hatch":"envelope"],ea=function(f,b,d,h,i){e(Aa,d);e(Za,i);e(Ba,a.loops?0:-d*h);e(Ca,a.loops?h:h-d*h);return f&&e(Xa,{x:f,y:b})||n};s.setup()});return k(v)};k.reel.math={envelope:function(l,a,v,H,I,g){return a+U(H,Fa(I,-l*g))/v},hatch:function(l,
a,v,H,I,g){l=(l<H?I:0)+l%I;l=a+-l*g/v;return l-R(l)},interpolate:function(l,a,v){return a+l*(v-a)}};cb("mousewheel disableTextSelect enableTextSelect".split(/ /));var z=k(ab);fa=navigator.userAgent;var lb=/iphone|ipod|ipad|android/i.test(fa),fb=/iphone|ipod|ipad/i.test(fa),gb=k.browser.msie,ta="ew-resize",ja,y="jquery-reel",ib=y+"-overlay",Ea=y+"-indicator",xb=y+"-preloader",wb=y+"-monitor",kb=y+"-interface",yb="data:image/gif;base64,R0lGODlhCAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7",
Ta="data:image/gif;base64,R0lGODlhEAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAI3lC8AeBDvgosQxQtne7yvLWGStVBelXBKqDJpNzLKq3xWBlU2nUs4C/O8cCvU0EfZGUwt19FYAAA7",Bb="data:image/gif;base64,R0lGODlhEAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAIslI95EB3MHECxNjBVdE/5b2zcRV1QBabqhwltq41St4hj5konmVioZ6OtEgUAOw==",S=Math.round,R=Math.floor,Ma=Math.ceil,Fa=Math.min,U=Math.max,w=Math.abs,Cb=Math.sqrt,W=parseInt,Sa="area",Ra="backup",G="backwards",Z="bit",Oa="classes",wa="clicked",Xa="clicked_location",
Aa="clicked_on",Za="clicked_row",aa="cwish",D="dimensions",o="fraction",C="frame",La="frames",Ca="hi",la="image",ya="opening_ticks",Ba="lo",za="playing",Y="revolution",A="row",na="rows",Pa="spacing",pa="speed",$="stage",ma="steps",oa="stitched",Qa="stitched_travel",xa="stopped",K="value",J="velocity",L="vertical",jb="wheel_step",p=".reel",rb="dblclick"+p,tb="mousedown"+p,sb="mouseenter"+p,ub="mouseleave"+p,ra="mousemove"+p,qa="mouseup"+p,qb="mousewheel"+p,F="tick"+p,pb="touchcancel"+p,ob="touchend"+
p,mb="touchstart"+p,nb="touchmove"+p,Ja="",X=" ",ca="absolute",Ka="div",O=bb(Ka),Ia="height",sa="#000",hb="id",eb="img",N="px",Ga="src",vb="title",Ha="width"}(jQuery,window,document);
