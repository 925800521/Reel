/*
 Copyright (c) 2009-2011 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 jQuery Reel
 http://jquery.vostrel.cz/reel
 Version: 1.1.3-devel
 Updated: 2011-05-08

 Requires jQuery 1.4.2 or higher
*/
jQuery.reel||function(h,kb,ia,q){function B(i){return h.reel.instances.length?h.reel.instances.first().data(i):null}function lb(i){return h.reel.instances.push(i[0])&&i}function mb(i){return(h.reel.instances=h.reel.instances.not("#"+i.attr(O)))&&i}function ja(i){return nb&&"data:image/gif;base64,R0lGODlh"+i}function ob(i){return"<"+i+"/>"}function ka(i){return"."+i}function la(i){return"http://code.vostrel.cz/"+i}function ma(i){return"url("+i+")"}function P(i,a,v){return Q(i,La(a,v))}function pb(i){function a(){h.fn[this]||
(h.fn[this]=function(){return this})}h.each(i,a)}function na(i,a){return w(i)*(a?-1:1)}function W(i){return i.originalEvent.touches[0]}h.reel={version:"1.1.3-devel",def:{footage:6,frame:1,frames:36,hint:"",horizontal:true,hotspot:q,indicator:0,klass:"",loops:true,reversed:q,spacing:0,stitched:0,suffix:"-reel",tooltip:"",area:q,brake:0.5,clickfree:false,cw:false,delay:-1,directional:false,draggable:true,entry:q,graph:q,image:q,images:[],inversed:false,laziness:6,monitor:q,opening:0,orbital:0,path:"",
preloader:4,rebound:0.5,revolution:q,row:1,rows:0,speed:0,step:q,steps:q,tempo:36,timeout:2,throwable:true,vertical:false,scrollable:true,wheelable:true}};h.fn.reel=function(i){var a=h.extend({},h.reel.def,i);i=function(f){var t=[];f.filter(qb).each(function(){var c=h(this),d=a.images.length&&a.images||a.image||c.attr(Ma),u=X(c.css(Na)),n=X(c.css(Oa));!d||d==Pa||!u||!n||t.push(c)});f.filter(Qa+ka(x)).each(function(){t.push(h(this))});return h(t)}(this);var v=[];a.reversed&&(a.cw=true);a.tooltip&&
(a.hint=a.tooltip);a.hotspot&&(a.area=a.hotspot);i.each(function(){var f=h(this),t=f.data(),c=function(g,b){t[g]=b;f.trigger("store",[g,b]);return b},d=function(g){var b=t[g];f.trigger("recall",[g,b]);return b},u={setup:function(g){if(f.hasClass(x))return n.call(g);var b=f.attr(Ma),e=c(O,f.attr(O)||f.attr(O,x+"-"+ +new Date).attr(O)),l=f.attr("style"),j=h.extend({},f.data()),m=a.images,k=a.stitched,r=a.loops,p={x:X(f.css(Na)),y:X(f.css(Oa))},y=c(Ra,a.orbital&&a.footage||a.rows<=1&&m.length||a.frames),
z=k?1:Sa(y/a.footage),oa={display:"block",width:p.x,height:p.y};e="#"+e+a.suffix;var Ta=f.attr("class"),pa={position:"relative",width:p.x,height:p.y};pa=h(R,{id:e.substr(1),"class":Ta+qa+rb,css:pa});oa=f.wrap(pa).attr({"class":x}).css(oa).bind(u);v.push(lb(oa)[0]);c(Ua,m.length&&m.length||a.image||b.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2"));c(C,a.frame);c(Va,a.spacing);c(I,p);c(o,0);c(ra,a.steps||a.frames);c(Y,a.revolution||k/2||p.x*2);c(sa,z);c(Z,1/(y-(r&&!k?0:1)));c(sb,1/Q(y,d(ra)));
c(ta,k);c(Wa,k-(r?0:p.x));c(ua,e);c(F,c(va,a.speed)<0);c(J,0);c(K,a.vertical);c(A,(a.row-1)/(a.rows-1));c($,na(1,!a.cw&&!k));c(S,false);c(Xa,a.brake);c(wa,!!a.orbital);c(D,a.tempo/(h.reel.lazy?a.laziness:1));c(aa,0);c(Ya,{src:b,classes:Ta,style:l||Pa,data:j});E.bind(G,u.tick);n.call(g);f.trigger("start")},teardown:function(g){var b=f.data(Ya);f.unbind(s).unbind(u).attr({"class":b.classes,src:b.src,style:b.style}).removeClass(x);f.data(b.data).siblings().remove();f.unwrap();mb(f);ba();E.unbind(G,u.tick).unbind(G,
u.opening_tick);ca.unbind(xa).unbind(ya);n.call(g)},start:function(){var g=d(I),b=d(Ra),e=Q(b,d(ra));e=c(o,1/e*((a.step||a.frame)-1));c(C,T(e*b)+1);f.attr("id");b=f.parent();e=h(R,{"class":tb,css:{position:da,left:0,top:0,width:g.x,height:g.y,background:za,opacity:0}}).appendTo(b);var l=!d(S)||a.rows<=1||!a.orbital||a.scrollable;e=c(Za,h(a.area||e));if(h.reel.touchy){f.css({WebkitUserSelect:"none",WebkitBackgroundSize:a.images.length?"auto":d(ta)&&d(ta)+"px "+g.y+"px"||g.x*a.footage+"px "+g.y*d(sa)*
(a.rows||1)*(a.directional?2:1)+"px"});e.bind(ub,function(j){f.trigger("down",[W(j).clientX,W(j).clientY,true])}).bind(vb,function(j){f.trigger("slide",[W(j).clientX,W(j).clientY,true]);return!l}).bind(wb,function(){f.trigger("up",[true]);return false}).bind(xb,function(){f.trigger("up",[true]);return false})}else e.css({cursor:"url("+$a+"), "+Aa}).bind(a.wheelable?yb:"",function(j,m){f.trigger("wheel",[m]);return false}).bind(zb,function(){f.trigger("play")}).bind(a.clickfree?Ab:Bb,function(j){f.trigger("down",
[j.clientX,j.clientY]);return false}).bind(a.clickfree?Cb:"",function(){f.trigger("up");return false}).disableTextSelect();a.hint&&e.attr(Db,a.hint);a.monitor&&b.append(Ba=h(R,{"class":Eb,css:{position:da,left:0,top:0}}))||(Ba=h());a.indicator&&b.append(ab("x"));a.rows>1&&a.indicator&&b.append(ab("y"));f.trigger("preload")},preload:function(g){var b=d(I),e=f.parent(),l=d(Ua),j=a.images,m=!j.length?[l]:[].concat(j),k=f[0];k.frames=m.length;k.preloaded=0;f.trigger("stop");for(e.append(Ca=h(R,{"class":Fb,
css:{position:da,left:0,top:b.y-a.preloader,height:a.preloader,overflow:bb,backgroundColor:za}}));m.length;){var r=a.path+m.shift(),p=h(new Image).hide().bind("load"+s,function(){k.preloaded++;h(this).unbind(s);Ca.css({width:1/k.frames*k.preloaded*b.x});if(k.frames==k.preloaded){Ca.remove();j.length||f.css({backgroundImage:ma(a.path+l)});f.attr({src:Gb}).trigger(a.rows>1&&!a.stitched?"rowChange":"frameChange").trigger("loaded").trigger("opening");n.call(g)}});e.append(p);setTimeout(function(y,z){return function(){y.attr({src:z})}}(p,
r),0)}},tick:function(g){var b=d(J);if(U){var e=b-d(Xa)/B(D)*U;b=!(b*e<=0||b<w(e))&&c(J,b>w(d(va))?e:(U=H=0))}Ba.text(d(a.monitor));b&&U++;H&&H++;cb(0);Da=true;if(H&&!b)return n.call(g);if(d(ea))return n.call(g,L());e=d($)*na(1,d(F));var l=(d(Ea)?b:w(d(va))+b)/B(D);b=d(o);e=c(o,b-l*e);n.call(g);e!=b&&f.trigger("fractionChange")},opening:function(){var g=a.entry||a.speed,b=d(o),e=a.opening;c(o,b-g*a.opening);c(aa,e*B(D));E.bind(G,u.opening_tick)},opening_tick:function(g){var b=(a.entry||a.speed)/B(D)*
(a.cw?-1:1),e=d(o);c(o,e+b);b=c(aa,d(aa)-1);f.trigger("fractionChange");n.call(g);if(!(b>1)){E.unbind(G,u.opening_tick);Hb()}},play:function(g){var b=c(Fa,true);c(Ea,!b);db();n.call(g)},pause:function(g){c(Fa,false);L();n.call(g)},stop:function(g){var b=c(Ea,true);c(Fa,!b);n.call(g)},down:function(g,b,e,l){if(a.draggable){c(ea,d(C));c(J,0);fa=ga(b,e,d(o),d(Y),d(A));L();ba();if(!l){ca.css({cursor:ma(Ib)+", "+Aa}).bind(ya,function(j){f.trigger("slide",[j.clientX,j.clientY]);n.call(j);return false});
a.clickfree||ca.bind(xa,function(j){f.trigger("up");n.call(j)})}}n.call(g)},up:function(g,b){if(!a.draggable)return n.call(g);c(ea,false);c(S,false);var e=c(J,!a.throwable?0:w(V[0]+V[1])/60);U=e?1:0;e?db():L();ba();!b&&ca.unbind(xa).unbind(ya)&&d(Za).css({cursor:ma($a)+", "+Aa});n.call(g)},slide:function(g,b,e){if(a.draggable&&Da){Da=false;L();var l={x:b-fa.x,y:e-fa.y};if(w(l.x)>0||w(l.y)>0){fa={x:b,y:e};var j=d(Y),m=d(eb),k=d(K),r=c(o,fb(k?e-m.y:b-m.x,d(Ga),j,d(Ha),d(Ia),d($)));c(S,d(S)||d(C)!=d(ea));
(l=cb(k?l.y:l.x||0))&&c(F,l<0);if(a.orbital&&d(wa)){c(K,w(e-m.y)>w(b-m.x));m=ga(b,e,r,j,d(A))}if(a.rows>1){l=d(I).y;k=d(gb);var p=-k*l;c(A,h.reel.math.envelope(e-m.y,k,l,p,p+l,-1))}!(r%1)&&!a.loops&&ga(b,e,r,j,d(A));f.trigger("fractionChange")}}n.call(g)},wheel:function(g,b){var e=Sa(Jb(w(b))/2);e=na(e,b>0);b=0.2*d(Y);ga(q,q,d(o),b,d(A));c(o,fb(e,d(Ga),b,d(Ha),d(Ia),d($)));e&&c(F,e<0);c(J,0);L();n.call(g);f.trigger("fractionChange");return false},fractionChange:function(g,b){b=!b?d(o):c(o,b);b=c(o,
a.loops?b-M(b):P(0,1,b));var e=c(C,1+M(b/d(Z))),l=a.rows>1,j=a.orbital;c(wa,!!j&&(e<=j||e>=a.footage-j+2));if(!a.loops&&a.rebound){!H&&!(b%1)?Ja++:(Ja=0);Ja>=a.rebound*1E3/B(D)&&c(F,!d(F))}f.trigger(l?"rowChange":"frameChange");n.call(g)},rowChange:function(g,b){var e=d(o)/d(Z)+1;b=c(A,P(0,1,b!=q?(b-1)/(a.rows-1):d(A)));b=P(0,a.rows-1,M(b*a.rows));c(C,M(e+b*a.frames));n.call(g);f.trigger("frameChange")},frameChange:function(g,b){var e=!b?d(o):c(o,d(Z)*(b-1)),l=d(hb);b=c(hb,c(C,T(b?b:d(C))));var j=
a.images,m=a.footage,k=d(I),r=a.rows>1,p=a.horizontal;if(d(K)){b=a.inversed?m+1-b:b;b+=m}var y=(d(K)?k.y:k.x)-a.indicator,z=P(0,y,T(h.reel.math.interpolate(d(o),-1,y+2)));z=!a.cw||a.stitched?z:y-z;h(ka(Ka+".x"),d(ua)).css(d(K)?{left:0,top:z}:{left:z,top:k.y-a.indicator});if(r){r=k.y-a.indicator;r=P(0,r,T(h.reel.math.interpolate(d(A),-1,r+2)));h(ka(Ka+".y"),d(ua)).css({top:r})}if(b!=l)if(j.length)f.attr({src:a.path+j[b-1]});else{if(a.stitched)j=[-T(e*d(Wa))+N,0+N];else{e=b%m-1;e=e<0?m-1:e;m=M((b-0.1)/
m);m+=a.rows>1?0:d(F)?0:d(sa);b=d(Va);m=m*((p?k.y:k.x)+b);k=e*((p?k.x:k.y)+b);j=j.length?[0,0]:p?[-k+N,-m+N]:[-m+N,-k+N]}f.css({backgroundPosition:j.join(qa)})}n.call(g)}},n=function(g){ib||delete this;return g},H,U=0,db=function(){return H=0},L=function(){clearTimeout(jb);E.unbind(G,u.opening_tick);f.trigger("play");return H=-a.timeout*B(D)},jb,Hb=function(){jb=setTimeout(function(){f.trigger("play")},a.delay*1E3||0)},Ba,Ca,ab=function(g){return h(R,{"class":[Ka,g].join(qa),css:{width:a.indicator,
height:a.indicator,overflow:bb,top:d(I).y-a.indicator,left:0,position:da,backgroundColor:za}})},Ja=0,fa={x:0,y:0},cb=function(g){return V.push(g)&&V.shift()&&g},ba=function(){return V=[0,0]},V=ba(),fb=a.graph||h.reel.math[a.loops?"hatch":"envelope"],ga=function(g,b,e,l,j){c(Ga,e);c(gb,j);c(Ha,a.loops?0:-e*l);c(Ia,a.loops?l:l-e*l);return g&&c(eb,{x:g,y:b})||q},Da=true,ca=h.browser.opera?E:h.unique(E.add(kb.top.document));u.setup()});ha=ha||function f(){var t=+new Date,c=B(D);if(c){E.trigger(G);h.reel.cost=
(+new Date+h.reel.cost-t)/2;return ha=setTimeout(f,Q(4,1E3/c-h.reel.cost))}else return ha=q}();return h(v)};h.reel.math={envelope:function(i,a,v,f,t,c){return a+Q(f,La(t,-i*c))/v},hatch:function(i,a,v,f,t,c){i=(i<f?t:0)+i%t;i=a+-i*c/v;return i-M(i)},interpolate:function(i,a,v){return a+i*(v-a)}};h.reel.touchy=/iphone|ipod|ipad|android/i.test(navigator.userAgent);h.reel.lazy=/iphone|ipod|android/i.test(navigator.userAgent);h.reel.instances=h();h.reel.cost=0;h.reel.leader=B;pb("mousewheel disableTextSelect enableTextSelect".split(/ /));
var E=h(ia);ia=+h.browser.version.split(".").slice(0,2).join(".");var ib=h.browser.msie,nb=!(ib&&ia<8),Aa="ew-resize",ha,x="jquery-reel",rb=x+"-overlay",Ka=x+"-indicator",Fb=x+"-preloader",Eb=x+"-monitor",tb=x+"-interface",Gb=ja("CAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7")||la("blank.gif"),$a=ja("EAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAI3lC8AeBDvgosQxQtne7yvLWGStVBelXBKqDJpNzLKq3xWBlU2nUs4C/O8cCvU0EfZGUwt19FYAAA7")||la("jquery.reel.cursor-drag.gif"),Ib=ja("EAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAIslI95EB3MHECxNjBVdE/5b2zcRV1QBabqhwltq41St4hj5konmVioZ6OtEgUAOw==")||
la("jquery.reel.cursor-drag-down.gif"),T=Math.round,M=Math.floor,Sa=Math.ceil,La=Math.min,Q=Math.max,w=Math.abs,Jb=Math.sqrt,X=parseInt,Za="area",Ya="backup",F="backwards",Z="bit",Xa="brake",wa="center",ea="clicked",eb="clicked_location",Ga="clicked_on",gb="clicked_row",$="cwish",I="dimensions",o="fraction",C="frame",hb="_frame",Ra="frames",Ia="hi",bb="hidden",Ua="image",aa="opening_ticks",Ha="lo",Fa="playing",S="reeling",Y="revolution",A="row",sa="rows",Va="spacing",va="speed",ua="stage",ra="steps",
ta="stitched",Wa="stitched_travel",Ea="stopped",D="tempo",J="velocity",K="vertical",sb="wheel_step",s=".reel",zb="dblclick"+s,Bb="mousedown"+s,Ab="mouseenter"+s,Cb="mouseleave"+s,ya="mousemove"+s,xa="mouseup"+s,yb="mousewheel"+s,G="tick"+s,xb="touchcancel"+s,wb="touchend"+s,ub="touchstart"+s,vb="touchmove"+s,Pa="",qa=" ",da="absolute",Qa="div",R=ob(Qa),Oa="height",za="#000",O="id",qb="img",N="px",Ma="src",Db="title",Na="width"}(jQuery,window,document);
