/*
 Copyright (c) 2009-2012 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 jQuery Reel
 http://jquery.vostrel.cz/reel
 Version: 1.1.3-devel
 Updated: 2012-01-28

 Requires jQuery 1.5 or higher
*/
jQuery.reel||function(k,Nb,Ra,o){function Ob(f){return p.instances.push(f[0])&&f}function Pb(f){return(p.instances=p.instances.not(oa(f.attr(ha))))&&f}function Q(f){return p.instances.length?p.instances.first().data(f):null}function Qb(f){return"data:image/gif;base64,R0lGODlh"+f}function R(f){return"<"+f+"/>"}function s(f){return"."+(f||"")}function xa(f){return p.cdn+f}function ya(f){return"url("+f+")"}function W(f,j,q){return pa(f,Sa(j,q))}function Rb(f){function j(){k.fn[this]||(k.fn[this]=function(){return this})}
k.each(f,j)}function Ta(f,j){return S(f)*(j?-1:1)}function za(f){return Aa?f.touch||f.originalEvent.touches[0]:f}function X(f){return f===o||typeof f==mb?f:f+Y}function oa(f){return"#"+f}function nb(f){try{console.warn("Deprecation - Please consult https://github.com/pisi/Reel/wiki/Deprecations")}catch(j){}return f}if(+k().jquery.replace(s(),"").substr(0,2)<15)throw"VersionError: far too old jQuery for running Reel";var p=k.reel={version:"1.2alpha",def:{area:o,brake:0.23,clickfree:false,cw:false,
delay:-1,directional:false,draggable:true,footage:6,entry:o,frame:1,frames:36,graph:o,hint:"",horizontal:true,image:o,images:[],indicator:0,inversed:false,klass:"",laziness:6,loops:true,monitor:o,opening:0,orbital:0,path:"",preloader:2,rebound:0.5,revolution:o,row:1,rows:0,spacing:0,speed:0,step:o,steps:o,stitched:0,suffix:"-reel",tempo:36,timeout:2,throwable:true,vertical:false,wheelable:true,annotations:o,attr:{},cursor:o,preload:"fidelity",scrollable:true,steppable:true,sequence:"",velocity:0},
fn:{reel:function(){var f=arguments,j=k(this),q=j.data(),r=f[0],t=f[1];if(f.length==2){if(t!==o){try{t=p.normal[r](t,q)}catch(E){}if(q[r]!==t)if(q[r]===o)q[r]=t;else j.trigger(r+"Change",[o,q[r]=t])}return j.trigger("store",[r,t])}else if(typeof r=="string"){t=q[r];j.trigger("recall",[r,t]);return t}else{var a=k.extend({},p.def,r),L=[];(function(i){var d=[];i.filter(Ua).each(function(){var c=k(this),u=a.images.length&&a.images||a.sequence||a.image||a.attr.src||c.attr(ob),C=Ba(a.attr.width||c.css(Va)),
z=Ba(a.attr.height||c.css(pb));u&&u!=G&&C&&z&&d.push(c)});i.filter(s(w)).each(function(){d.push(k(this).unreel())});return k(d)})(this).each(function(){var i=k(this),d=function(b,e){return i.reel(b,e)&&e},c=function(b){return i.reel(b)},u={setup:function(){if(!i.hasClass(w)){d(Wa,a);var b=i.attr(a.attr).attr(ob),e=d(ha,i.attr(ha)||i.attr(ha,w+"-"+ +new Date).attr(ha)),h=i.attr(qa),g=k.extend({},i.data()),l=p.re.sequence.exec(d(Sb,a.sequence));l=d(Z,l?p.sequence(l,a,c):a.images);var n=a.stitched,m=
a.loops,x={x:Ba(i.css(Va)||a.attr.width),y:Ba(i.css(pb)||a.attr.height)},H=d(ra,a.orbital&&a.footage||a.rows<=1&&l.length||a.frames),ia=n?1:qb(H/a.footage);e=oa(e+a.suffix);var Ca=i.attr("class")||G,M=k(R(sa),{id:e.substr(1),"class":Ca+A+Tb+A+rb+"0"});M=i.wrap(M.addClass(a.klass)).attr({"class":w});L.push(Ob(M)[0]);M=M.parent().bind(u.instance);d(Xa,l.length?G:a.image||b.replace(p.re.image,"$1"+a.suffix+".$2"));d(sb,[]);d(tb,a.spacing);d(I,x);d($,o);d(v,o);d(J,o);d(Ya,a.steps||a.frames);d(Da,a.revolution||
n/2||x.x*2);d(Za,ia);d(Ea,1/(H-(m&&!n?0:1)));d(Ub,1/pa(H,c(Ya)));d($a,n);d(ub,n-(m?0:x.x));d(ab,e);d(N,d(Fa,a.speed)<0);d(aa,a.velocity||0);d(ja,a.vertical);d(ba,0);d(ka,Ta(1,!a.cw&&!n));d(bb,{});d(ta,false);d(Ga,d(cb,0));d(Ha,d(Ia,0));d(ua,false);d(vb,a.brake);d(db,!!a.orbital);d(T,a.tempo/(p.lazy?a.laziness:1));d(ca,-1);d(Ja,a.annotations||M.unbind(s(Ja))&&{});d(wb,{src:b,classes:Ca,style:h||G,data:g});a.steppable||M.unbind("click.steppable");B(G,{width:x.x,height:x.y,overflow:eb,position:"relative"});
B(da+A+s(w),{display:xb});O.bind(u.pool);i.trigger("setup")}},instance:{teardown:function(){var b=i.data(wb);i.parent().unbind(u.instance);c(qa).remove();c(yb).enableTextSelect();Pb(i.unbind(U).removeData().siblings().unbind(U).remove().end().attr({"class":b.classes,src:b.src,style:b.style}).data(b.data).unwrap());Ka();O.unbind(u.pool);P.unbind(V)},setup:function(){function b(n){return function(m){if(m.button==Vb)return m.preventDefault()||i.trigger("down",[za(m).clientX,za(m).clientY])&&n}}var e=
c(I),h=c(ra);h=pa(h,c(Ya));i.attr(ha);var g=i.parent();area=d(yb,k(a.area||g));if(Aa){B(A+s(w),{WebkitUserSelect:La,WebkitBackgroundSize:c(Z).length?o:c($a)&&X(c($a))+A+X(e.y)||X(e.x*a.footage)+A+X(e.y*c(Za)*(a.rows||1)*(a.directional?2:1))});area.bind(Wb,b())}else{e=a.cursor==zb?Xb:a.cursor||Yb;var l=a.cursor==zb?Zb+A+"!important":o;B(G,{cursor:e});B(s(fb),{cursor:$b});B(s(Ma)+da+s(Ma)+" *",{cursor:l||e},true);area.bind(a.wheelable?ac:G,function(n,m){return n.preventDefault()||!m||i.trigger("wheel",
[m])&&false}).bind(a.clickfree?bc:cc,b()).disableTextSelect()}a.hint&&area.attr(dc,a.hint);a.indicator&&g.append(va(ec));a.rows>1&&a.indicator&&g.append(va(fc));a.monitor&&g.append(Ab=k(R(sa),{"class":Bb}))&&B(A+s(Bb),{position:Na,left:0,top:0});B(A+s(Cb),{display:La});d(J,(a.row-1)/(a.rows-1));d(v,1/h*((a.step||a.frame)-1))},preload:function(){var b=c(I),e=i.parent(),h=c(Xa),g=c(Z),l=!g.length,n=c(ra),m=p.preload[a.preload]||p.preload[p.def.preload],x=l?[h]:m(g.slice(0),a,c);d(ba,l?0.5:0);var H=
[];e.addClass(fb).append(la());for(i.trigger("stop");x.length;){h=a.path+x.shift();var ia=b.x*(!l?1:a.footage),Ca=b.y*(!l?1:n/a.footage)*(!a.directional?1:2);g=k(R(Ua)).attr({"class":Cb}).appendTo(e);M(h,g);H.push(h);function M(gc,Oa){setTimeout(function(){if(Oa.parent().length){Oa.attr({src:gc,width:ia,height:Ca});i.reelTriggerOnce("preloaded",function(){return!!Oa.parent().length&&Oa[0].complete})}},H.length-x.length)}}d(sb,H);d(qa,k("<"+qa+' type="text/css">'+B.rules.join("\n")+"</"+qa+">").prependTo(gb))},
preloaded:function(){var b=c(Z).length||1;if(d(ba,Sa(c(ba)+1,b))===b){i.parent().removeClass(fb).unbind(ba,u.instance.preloaded);i.trigger("loaded")}},loaded:function(){c(Z).length>1||i.css({backgroundImage:ya(a.path+c(Xa))}).attr({src:hc})},opening:function(){if(!a.opening)return i.trigger("openingDone");var b=a.entry||a.speed,e=c(v),h=a.opening;d(v,e-b*a.opening);d(ca,h*Q(T))},openingDone:function(){if(a.delay)K=setTimeout(function(){i.trigger("play")},a.delay*1E3);else i.trigger("play")},play:function(b,
e){e=d(Fa,e||c(Fa));b=d(hb,!!e);d(ib,!b);ea()},pause:function(){d(hb,false);D()},stop:function(){var b=d(ib,true);d(hb,!b)},down:function(b,e,h){function g(n){return function(m){m.preventDefault();i.trigger("pan",[za(m).clientX,za(m).clientY,m]);return n}}function l(n){return function(m){m.preventDefault();i.trigger("up");return n}}if(a.draggable){d(ta,c($));d(aa,0);b=!c(ua)||a.rows<=1||!a.orbital||a.scrollable;Pa=Qa(e,h,c(v),c(Da),c(J));D();Ka();y=false;k(Db,P).addClass(Ma);Aa?P.bind(ic,g(!b)).bind(jc+
A+kc,l()):P.bind(lc,g()).bind(a.clickfree?mc:nc,l())}},up:function(){if(a.draggable){d(ta,false);d(ua,false);var b=d(aa,!a.throwable?0:S(wa[0]+wa[1])/60);fa=b?1:0;b?ea():D();Ka();k(Db,P).removeClass(Ma);P.unbind(V)}},pan:function(b,e,h,g){if(a.draggable&&jb){jb=false;D();b=g&&!k(g.currentTarget).is(O)?oc.offset():{left:0,top:0};e-=b.left;h-=b.top;var l={x:e-Pa.x,y:h-Pa.y};if(S(l.x)>0||S(l.y)>0){y=true;Pa={x:e,y:h};b=c(Da);g=c(bb);var n=c(ja),m=Eb(n?h-g.y:e-g.x,c(Ga),b,c(Ha),c(Ia),c(ka),n?h-g.y:e-
g.x);d(ua,c(ua)||c($)!=c(ta));(l=Fb(n?l.y:l.x||0))&&d(N,l<0);if(a.orbital&&c(db)){d(ja,S(h-g.y)>S(e-g.x));g=Qa(e,h,m,b,c(J))}if(a.rows>1){l=c(I).y;l=a.rows>3?l:l/(5-a.rows);n=c(cb);var x=-n*l;d(J,p.math.envelope(h-g.y,n,l,x,x+l,-1))}!(m%1)&&!a.loops&&Qa(e,h,m,b,c(J));d(v,m)}}},wheel:function(b,e){b=qb(pc(S(e))/2);b=Ta(b,e>0);e=0.0833*c(Da);Qa(o,o,c(v),e,c(J));b&&d(N,b<0);d(aa,0);d(v,Eb(b,c(Ga),e,c(Ha),c(Ia),c(ka)));D();i.trigger("up");return false},fractionChange:function(b,e,h){if(e!==o)return nb(d(v,
e));b=1+ma(h/c(Ea));e=a.rows>1;var g=a.orbital;d(db,!!g&&(b<=g||b>=a.footage-g+2));if(!a.loops&&a.rebound){!z&&!(h%1)?kb++:(kb=0);kb>=a.rebound*1E3/Q(T)&&d(N,!c(N))}if(e){h=W(0,a.rows-1,ma(c(J)*a.rows));b+=h*a.frames}d($,b)},rowChange:function(b,e,h){if(e!==o)return d(J,e);b=c(ra);b=c($)%b||b;h=W(0,a.rows-1,ma(h*a.rows));d($,b+h*a.frames)},frameChange:function(b,e,h){if(e!==o)return nb(d($,e));this.className=this.className.replace(p.re.frame_klass,rb+h);b=c(v);var g=a.footage;if(a.orbital&&c(ja)){h=
a.inversed?g+1-h:h;h+=g}var l=a.horizontal,n=c(Z),m=!n.length;e=c(I);if(m){if(a.stitched)e=[-ga(b*c(ub))+Y,0+Y];else{m=h%g-1;m=m<0?g-1:m;g=ma((h-0.1)/g);g+=a.rows>1?0:c(N)?0:c(Za);h=c(tb);g=g*((l?e.y:e.x)+h);e=m*((l?e.x:e.y)+h);e=n.length?[0,0]:l?[-e+Y,-g+Y]:[-g+Y,-e+Y]}i.css({backgroundPosition:e.join(A)})}else i.attr({src:a.path+n[h-1]});if(a.indicator){c(ab);l=a.rows>1;e=c(I);n=(c(ja)?e.y:e.x)-a.indicator;b=W(0,n,ga(p.math.interpolate(b,-1,n+2)));b=!a.cw||a.stitched?b:n-b;va.$x.css(c(ja)?{left:0,
top:b}:{left:b,top:e.y-a.indicator});if(l){b=e.y-a.indicator;b=W(0,b,ga(p.math.interpolate(c(J),-1,b+2)));va.$y.css({top:b})}}},"click.steppable":function(b){if(y)return C(b,false);i.trigger(b.clientX-i.offset().left>0.5*c(I).x?"stepRight":"stepLeft")},"stepLeft stepRight":function(){D()},stepLeft:function(){d(N,false);d(v,c(v)-c(Ea)*c(ka))},stepRight:function(){d(N,true);d(v,c(v)+c(Ea)*c(ka))},"setup.annotations":function(){c(I);var b=i.parent();k.each(c(Ja),function(e,h){var g=typeof h.node==mb?
k(h.node):h.node||{};g=g.jquery?g:k(R(sa),g);g=g.attr({id:e}).addClass(qc);var l=h.image?k(R(Ua),h.image):k(),n=h.link?k(R(rc),h.link):k();B(oa(e),{display:La,position:Na},true);g.bind({"click.annotations":function(m){m.stopPropagation()}});h.image||h.link&&g.append(n);h.link||h.image&&g.append(l);h.link&&h.image&&g.append(n.append(l));g.appendTo(b)})},"frameChange.annotations":function(b,e){c(aa)||k.each(c(Ja),function(h,g){h=k(oa(h));var l=g.start||1,n=g.end,m=e-1,x=g.at?g.at[m]=="+":false;m=g.at?
m:m-l+1;var H=typeof g.x!=Gb?g.x:g.x[m],ia=typeof g.y!=Gb?g.y:g.y[m];g={display:H!==o&&ia!==o&&(g.at?x:m>=0&&(!n||m<=n-l))?xb:La,left:X(H)||0,top:X(ia)||0};h.css(g)})},"setup.fu":function(){i.trigger("preload")},"loaded.fu":function(){i.trigger("opening")}},pool:{"tick.reel.preload":function(){var b=c(I),e=parseInt(la.$.css(Va)),h=c(Z).length||1,g=ga(1/h*c(ba)*b.x);la.$.css({width:e+(g-e)/3+1});if(c(ba)===h&&e>b.x-1){la.$.fadeOut(300,function(){la.$.remove()});O.unbind(na+s(Hb),u.pool[na+s(Hb)])}},
"tick.reel":function(b){var e=c(aa);if(fa){e=e-c(vb)/Q(T)*fa;e=d(aa,e>0.1?e:(fa=z=0))}a.monitor&&Ab.text(c(a.monitor));e&&fa++;z&&z++;Fb(0);jb=true;if(z&&!e)return C(b);if(c(ta))return C(b,D());if(!(c(ca)>0)){b=c(ka)*Ta(1,c(N));e=(c(ib)?e:S(c(Fa))+e)/Q(T);d(v,c(v)-e*b)}},"tick.reel.opening":function(){var b=na+s(lb);if(!a.opening||!c(ca))return O.unbind(b,u.pool[b]);b=(a.entry||a.speed)/Q(T)*(a.cw?-1:1);var e=d(ca,c(ca)-1);d(v,c(v)+b);e||i.trigger("openingDone")}}},C=function(b,e){return b.stopImmediatePropagation()||
e},z,fa=0,ea=function(){return z=0},D=function(){clearTimeout(K);O.unbind(na+s(lb),u.pool[na+s(lb)]);d(ca,0);i.trigger("play");return z=-a.timeout*Q(T)},y=false,K,Ab=k(),la=function(){B(A+s(Ib),{position:Na,left:0,top:c(I).y-a.preloader,height:a.preloader,overflow:eb,backgroundColor:Jb});return la.$=k(R(sa),{"class":Ib})},va=function(b){B(A+s(Kb)+s(b),{position:Na,width:a.indicator,height:a.indicator,overflow:eb,backgroundColor:Jb});return va["$"+b]=k(R(sa),{"class":Kb+A+b})},B=function(b,e,h){function g(l){var n=
[];k.each(l,function(m,x){n.push(m.replace(/([A-Z])/g,"-$1").toLowerCase()+":"+X(x)+";")});return"{"+n.join(G)+"}"}h=h?G:c(ab);b=b.replace(/^/,h).replace(da,da+h);return B.rules.push(b+g(e))&&e},kb=0,Pa={x:0,y:0},Fb=function(b){return wa.push(b)&&wa.shift()&&b},Ka=function(){return wa=[0,0]},wa=Ka(),Eb=a.graph||p.math[a.loops?"hatch":"envelope"],Qa=function(b,e,h,g,l){d(Ga,h);d(cb,l);d(Ha,a.loops?0:-h*g);d(Ia,a.loops?g:g-h*g);return b&&d(bb,{x:b,y:e})||o},jb=true,P;try{P=k.unique(O.add(Nb.top.document))}catch(tc){P=
O}var oc=top===self?k():function(b){k("iframe",P.last()).each(function(){try{if(k(this).contents().find(gb).html()==k(gb).html())return(b=k(this))&&false}catch(e){}});return b}();B.rules=[];u.setup()});Lb=Lb||function i(){var d=+new Date,c=Q(T),u;if(c){O.trigger(na);p.cost=(+new Date+p.cost-d)/2;u=setTimeout(i,pa(4,1E3/c-p.cost))}return u}();return k(L)}},unreel:function(){return this.trigger("teardown")}},re:{image:/^(.*)\.(jpg|jpeg|png|gif)$/,touchy_agent:/iphone|ipod|ipad|android/i,lazy_agent:/iphone|ipod|android/i,
frame_klass:/frame-\d+/,sequence:/(^[^#|]*([#]+)[^#|]*)($|[|]([0-9]+)\.\.([0-9]+))($|[|]([0-9]+)$)/},cdn:"http://code.vostrel.cz/",math:{envelope:function(f,j,q,r,t,E){return j+pa(r,Sa(t,-f*E))/q},hatch:function(f,j,q,r,t,E){f=(f<r?t:0)+f%t;f=j+-f*E/q;return f-ma(f)},interpolate:function(f,j,q){return j+f*(q-j)}},preload:{linear:function(f){return f},fidelity:function(f,j){function q(i,d,c){function u(K){for(;!(K>=1&&K<=ea);)K+=K<1?+ea:-ea;return L[c+K]||(L[c+K]=!!C.push(K))}if(!i.length)return[];
var C=[],z=4*d,fa=j.frame,ea=i.length;d=true;for(var D=ea/z,y=0;y<z;y++)u(fa+ga(y*D));for(;D>1;){y=0;z=C.length;D/=2;for(d=!d;y<z;y++)u(C[y]+(d?1:-1)*ga(D))}for(y=0;y<C.length;y++)C[y]=i[C[y]-1];return C}var r=j.orbital?2:j.rows||1,t=j.orbital?j.footage:j.frames,E=(j.row-1)*t,a=[].concat(f),L=new Array(f.length);f=r<2?[]:a.slice(E,E+t);return q(f,1,E).concat(q(a,r,0))}},normal:{fraction:function(f,j){return j[Wa].loops?f-ma(f):W(0,1,f)},row:function(f){return W(0,1,f)},frame:function(f,j){var q=j[Wa];
j=j[ra]*(q.orbital?2:q.rows||1);f=ga(q.loops?f%j||j:W(1,j,f));return f<0?f+j:f}},sequence:function(f,j){function q(i,d,c){for(;i.length<d;)i=c+i;return i}if(f.length<=1)return j.images;var r=[],t=f[1],E=f[2],a=+f[4]||1,L=j.orbital?2:j.rows||1;j=j.orbital?j.footage:j.frames;L=+(f[5]||L*j);f=+f[7]||1;for(j=0;j<L;){r.push(t.replace(E,q(a+j+G,E.length,"0")));j+=f}return r},instances:k(),leader:Q,cost:0},O=k(Ra);Ra=+k.browser.version.split(s()).slice(0,2).join(s());var sc=k.browser.msie,Mb=navigator.userAgent,
Lb,w="reel",Tb=w+"-overlay",Kb=w+"-indicator",Ib=w+"-preloader",Cb=w+"-cached",Bb=w+"-monitor",qc=w+"-annotation",Ma=w+"-panning",fb=w+"-loading",rb="frame-",F=Math,ga=F.round,ma=F.floor,qb=F.ceil,Sa=F.min,pa=F.max,S=F.abs,pc=F.sqrt,Ba=parseInt,Ja="annotations",yb="area",wb="backup",N="backwards",Ea="bit",vb="brake",sb="cached",db="center",ta="clicked",bb="clicked_location",Ga="clicked_on",cb="clicked_row",ka="cwish",I="dimensions",v="fraction",$="frame",ra="frames",gb="head",Ia="hi",eb="hidden",
Xa="image",Z="images",ca="opening_ticks",Ha="lo",Wa="options",hb="playing",ba="preloaded",ua="reeling",Da="revolution",J="row",Za="rows",Sb="sequence",tb="spacing",Fa="speed",ab="stage",Ya="steps",$a="stitched",ub="stitched_travel",ib="stopped",qa="style",T="tempo",aa="velocity",ja="vertical",Ub="wheel_step",U=s(w),V=".pan"+U,cc="mousedown"+U,bc="mouseenter"+U,mc="mouseleave"+V,lc="mousemove"+V,nc="mouseup"+V,ac="mousewheel"+U,na="tick"+U,kc="touchcancel"+V,jc="touchend"+V,Wb="touchstart"+U,ic="touchmove"+
V,G="",A=" ",da=",",Na="absolute",rc="a",xb="block",sa="div",zb="hand",pb="height",Jb=oa("000"),Db="html",ha="id",Ua="img";F="jquery."+w;var La="none",Gb="object",lb="opening",Hb="preload",Y="px",ob="src",mb="string",dc="title",Va="width",ec="x",fc="y",hc=Qb("CAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7")||xa("blank.gif"),$b="wait",Yb=ya(xa(F+s("cur")))+da+"move",Xb=ya(xa(F+"-drag"+s("cur")))+da+"move",Zb=ya(xa(F+"-drag-down"+s("cur")))+da+"move",Aa=p.touchy=p.re.touchy_agent.test(Mb);
p.lazy=p.re.lazy_agent.test(Mb);var Vb=Aa?o:sc&&Ra<=8?1:0;Rb("disableTextSelect enableTextSelect".split(/ /));k.extend(k.fn,p.fn);k.fn.reelTriggerOnce=function(f,j){return function q(r){j()?r.trigger(f):setTimeout(function(){q(r)},100);return r}(k(this))}}(jQuery,window,document);
