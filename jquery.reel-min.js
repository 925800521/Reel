/*
 Copyright (c) 2009-2012 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 jQuery Reel
 http://jquery.vostrel.cz/reel
 Version: 1.1.3-devel
 Updated: 2012-01-16

 Requires jQuery 1.4.3 or higher
*/
jQuery.reel||function(g,Jb,Pa,r){function L(e){return g.reel.instances.length?g.reel.instances.first().data(e):null}function Kb(e){return g.reel.instances.push(e[0])&&e}function Lb(e){return(g.reel.instances=g.reel.instances.not(ka(e.attr(ca))))&&e}function Mb(e){return"data:image/gif;base64,R0lGODlh"+e}function M(e){return"<"+e+"/>"}function q(e){return"."+(e||"")}function ua(e){return g.reel.cdn+e}function va(e){return"url("+e+")"}function da(e,a,p){return la(e,Qa(a,p))}function Nb(e){function a(){g.fn[this]||
(g.fn[this]=function(){return this})}g.each(e,a)}function Ra(e,a){return N(e)*(a?-1:1)}function wa(e){return xa?e.touch||e.originalEvent.touches[0]:e}function U(e){return e===r||typeof e=="string"?e:e+V}function ka(e){return"#"+e}function Ob(e){var a=[];g.each(e,function(p,h){a.push(p.replace(/([A-Z])/g,"-$1").toLowerCase()+":"+U(h))});return"{"+a.join(";")+";}"}function Pb(){var e=g().jquery.split(".");if(e=+e[0]<=1&&(+e[1]<4||+e[1]==4&&+e[2]<3))try{console.error("FATAL: jQuery Reel plug-in requires at least jQuery 1.4.3")}catch(a){}return e}
if(!Pb()){g.reel={version:"1.2alpha",def:{area:r,brake:0.23,clickfree:false,cw:false,delay:-1,directional:false,draggable:true,footage:6,entry:r,frame:1,frames:36,graph:r,hint:"",horizontal:true,image:r,images:[],indicator:0,inversed:false,klass:"",laziness:6,loops:true,monitor:r,opening:0,orbital:0,path:"",preloader:2,rebound:0.5,revolution:r,row:1,rows:0,spacing:0,speed:0,step:r,steps:r,stitched:0,suffix:"-reel",tempo:36,timeout:2,throwable:true,vertical:false,wheelable:true,annotations:r,attr:{},
cursor:r,preload:"fidelity",scrollable:true,steppable:true,sequence:"",velocity:0}};g.fn.reel=function(e){var a=g.extend({},g.reel.def,e);e=function(h){var t=[];h.filter(Sa).each(function(){var d=g(this),c=a.images.length&&a.images||a.image||a.attr.src||d.attr(mb),u=ya(a.attr.width||d.css(Ta)),o=ya(a.attr.height||d.css(nb));!c||c==W||!u||!o||t.push(d)});h.filter(q(w)).each(function(){t.push(g(this).unreel())});return g(t)}(this);var p=[];a.tooltip&&(a.hint=a.tooltip);a.hotspot&&(a.area=a.hotspot);
e.each(function(){var h=g(this),t=h.data(),d=function(i,b){t[i]=b;h.trigger("store",[i,b]);return b},c=function(i){var b=t[i];h.trigger("recall",[i,b]);return b},u={setup:function(i){if(h.hasClass(w))return o.call(i);var b=h.attr(a.attr).attr(mb),f=d(ca,h.attr(ca)||h.attr(ca,w+"-"+ +new Date).attr(ca)),j=h.attr(ma),k=g.extend({},h.data()),m=g.reel.sequence_pattern.exec(d(Qb,a.sequence));m=d(ea,m?g.reel.build_sequence(m,a,c):a.images);var n=a.stitched,l=a.loops,x={x:ya(h.css(Ta)||a.attr.width),y:ya(h.css(nb)||
a.attr.height)},y=d(G,a.frame),X=d(za,a.orbital&&a.footage||a.rows<=1&&m.length||a.frames),Rb=n?1:ob(X/a.footage);f=ka(f+a.suffix);var pb=h.attr("class")||"";y=g(M(na),{id:f.substr(1),"class":pb+z+Sb+z+qb+y});y=h.wrap(y.addClass(a.klass)).attr({"class":w});p.push(Kb(y)[0]);y=y.parent().bind(u.instance);d(Tb,a);d(Ua,m.length?W:a.image||b.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2"));d(Va,[]);d(Wa,0);d(rb,a.spacing);d(H,x);d(s,0);d(Xa,a.steps||a.frames);d(Aa,a.revolution||n/2||x.x*2);d(Ya,
Rb);d(fa,1/(X-(l&&!n?0:1)));d(Ub,1/la(X,c(Xa)));d(Za,n);d(sb,n-(l?0:x.x));d($a,f);d(I,d(Ba,a.speed)<0);d(Y,a.velocity||0);d(ga,a.vertical);d(ha,0);d(J,(a.row-1)/(a.rows-1));d(ia,Ra(1,!a.cw&&!n));d(ab,{});d(oa,false);d(Ca,d(bb,0));d(Da,d(Ea,0));d(pa,false);d(tb,a.brake);d(cb,!!a.orbital);d(O,a.tempo/(g.reel.lazy?a.laziness:1));d(Z,-1);d(db,a.annotations)||y.unbind(".annotations");d(ub,{src:b,classes:pb,style:j||W,data:k});a.steppable||y.unbind("click.steppable");D(true,W,{width:x.x,height:x.y,overflow:eb,
position:"relative"});D(true,$+z+q(w),{display:vb});K.bind(u.pool);o.call(i);h.trigger("setup")},instance:{teardown:function(i){var b=h.data(ub);h.parent().unbind(u.instance);c(ma).remove();Lb(h.unbind(P).siblings().unbind(P).remove().end().attr({"class":b.classes,src:b.src,style:b.style}).data(b.data).unwrap());Fa();K.unbind(u.pool);aa.unbind(Q);o.call(i)},setup:function(){function i(n){return function(l){if(l.button==Vb)return l.preventDefault()||h.trigger("down",[wa(l).clientX,wa(l).clientY])&&
o.call(l)||n}}var b=c(H),f=c(za),j=la(f,c(Xa));j=d(s,1/j*((a.step||a.frame)-1));d(G,R(j*f)+1);h.attr(ca);f=h.parent();j=d(Wb,g(a.area||f));if(xa){D(true,z+q(w),{WebkitUserSelect:Ga,WebkitBackgroundSize:a.images.length?"auto":c(Za)&&U(c(Za))+z+U(b.y)||U(b.x*a.footage)+z+U(b.y*c(Ya)*(a.rows||1)*(a.directional?2:1))});j.bind(Xb,i())}else{var k=a.cursor==wb?va(Yb)+$+fb:a.cursor||va(Zb)+$+fb,m=a.cursor==wb?va($b)+$+fb+" !important":false;D(true,W,{cursor:k});D(true,q(gb),{cursor:ac});D(false,q(Ha)+$+q(Ha)+
" *",{cursor:m||k});j.bind(a.wheelable?bc:W,function(n,l){return!l||h.trigger("wheel",[l])&&false}).bind(a.clickfree?cc:dc,i()).disableTextSelect()}a.hint&&j.attr(ec,a.hint);a.monitor&&f.append(S=g(M(na),{"class":xb}))||(S=g());D(true,z+q(xb),{position:Ia,left:0,top:0});D(true,z+q(yb),{display:Ga});D(true,z+q(zb),{position:Ia,left:0,top:b.y-a.preloader,height:a.preloader,overflow:eb,backgroundColor:Ab});a.indicator&&f.append(E(Bb));a.rows>1&&a.indicator&&f.append(E(Cb))},preload:function(i){var b=
c(H),f=h.parent(),j=c(Ua),k=c(ea),m=!k.length,n=c(za),l=g.reel.preload[a.preload]||g.reel.preload[g.reel.def.preload];j=m?[j]:l(k.slice(),a,c);d(ha,m?0.5:0);k=[];f.addClass(gb).append(v=g(M(na),{"class":zb}));for(h.trigger("stop");j.length;){var x=a.path+j.shift();l=b.x*(!m?1:a.footage);var y=b.y*(!m?1:n/a.footage)*(!a.directional?1:2),X=g(M(Sa)).attr({"class":yb,width:l,height:y}).appendTo(f);setTimeout(function(){X.attr({src:x});h.triggerAfter("preloaded",function(){return!!X.parent().length&&X[0].complete})},
k.length-j.length);k.push(x)}d(Va,k);d(ma,g("<"+ma+' type="text/css">'+Db.join("\n")+"</"+ma+">").prependTo(hb));o.call(i)},preloaded:function(i){var b=c(ea).length;if(d(ha,Qa(c(ha)+1,b))===b){h.unbind("preloaded",u.instance.preloaded);b>1||h.css({backgroundImage:va(a.path+c(Ua))}).attr({src:fc});h.parent().removeClass(gb);h.trigger("loaded");o.call(i)}},opening:function(){if(!a.opening)return h.trigger("openingDone");var i=a.entry||a.speed,b=c(s),f=a.opening;d(s,b-i*a.opening);d(Z,f*L(O))},openingDone:function(){if(a.delay)ba=
setTimeout(function(){h.trigger("play")},a.delay*1E3);else h.trigger("play")},play:function(i,b){b=d(Ba,b||c(Ba));b=d(ib,!!b);d(jb,!b);h.trigger("frameChange");F();o.call(i)},pause:function(i){d(ib,false);A();o.call(i)},stop:function(i){var b=d(jb,true);d(ib,!b);o.call(i)},down:function(i,b,f){if(a.draggable){d(oa,c(G));d(Y,0);var j=!c(pa)||a.rows<=1||!a.orbital||a.scrollable;Ja=Ka(b,f,c(s),c(Aa),c(J));A();Fa();qa=false;Eb.addClass(Ha);xa?aa.bind(gc,k(!j)).bind(hc+z+ic,m()):aa.bind(jc,k()).bind(a.clickfree?
kc:lc,m());function k(n){return function(l){l.preventDefault();h.trigger("pan",[wa(l).clientX,wa(l).clientY,l]);o.call(l);return n}}function m(n){return function(l){l.preventDefault();h.trigger("up");o.call(l);return n}}}o.call(i)},up:function(i){if(!a.draggable)return o.call(i);d(oa,false);d(pa,false);var b=d(Y,!a.throwable?0:N(ra[0]+ra[1])/60);T=b?1:0;b?F():A();Fa();Eb.removeClass(Ha);aa.unbind(Q);o.call(i)},pan:function(i,b,f,j){if(a.draggable&&kb){kb=false;A();j=!g(j.currentTarget).is(K)?mc.offset():
{left:0,top:0};f-=j.top;b-=j.left;var k={x:b-Ja.x,y:f-Ja.y};if(N(k.x)>0||N(k.y)>0){qa=true;Ja={x:b,y:f};j=c(Aa);var m=c(ab),n=c(ga),l=d(s,Fb(n?f-m.y:b-m.x,c(Ca),j,c(Da),c(Ea),c(ia),n?f-m.y:b-m.x));d(pa,c(pa)||c(G)!=c(oa));(k=Gb(n?k.y:k.x||0))&&d(I,k<0);if(a.orbital&&c(cb)){d(ga,N(f-m.y)>N(b-m.x));m=Ka(b,f,l,j,c(J))}if(a.rows>1){k=c(H).y;n=c(bb);var x=-n*k;d(J,g.reel.math.envelope(f-m.y,n,k,x,x+k,-1))}!(l%1)&&!a.loops&&Ka(b,f,l,j,c(J));h.trigger("fractionChange")}}o.call(i)},wheel:function(i,b){var f=
ob(nc(N(b))/2);f=Ra(f,b>0);b=0.0833*c(Aa);Ka(r,r,c(s),b,c(J));d(s,Fb(f,c(Ca),b,c(Da),c(Ea),c(ia)));f&&d(I,f<0);d(Y,0);A();o.call(i);h.trigger("up");h.trigger("fractionChange");return false},fractionChange:function(i,b){b=d(s,La.fraction(b,a,c));var f=d(G,1+ja(b/c(fa))),j=a.rows>1,k=a.orbital;d(cb,!!k&&(f<=k||f>=a.footage-k+2));if(!a.loops&&a.rebound){!B&&!(b%1)?lb++:(lb=0);lb>=a.rebound*1E3/L(O)&&d(I,!c(I))}h.trigger(j?"rowChange":"frameChange");o.call(i)},rowChange:function(i,b){var f=c(s)/c(fa)+
1;b=d(J,La.row(b,a,c));b=da(0,a.rows-1,ja(b*a.rows));d(G,ja(f+b*a.frames));o.call(i);h.trigger("frameChange")},frameChange:function(i,b){var f=d(s,La.fraction(!b?r:c(fa)*(b-1),a,c));b=La.frame(b,a,c);var j=c(Va).length==1,k=a.footage;if(c(ga)){b=a.inversed?k+1-b:b;b+=k}if(b==c(Wa))C(i);else{var m=a.horizontal,n=c(ea),l=c(H);b=d(Wa,d(G,b));if(j){if(a.stitched)l=[-R(f*c(sb))+V,0+V];else{f=b%k-1;f=f<0?k-1:f;k=ja((b-0.1)/k);k+=a.rows>1?0:c(I)?0:c(Ya);b=c(rb);k=k*((m?l.y:l.x)+b);l=f*((m?l.x:l.y)+b);l=
n.length?[0,0]:m?[-l+V,-k+V]:[-k+V,-l+V]}h.css({backgroundPosition:l.join(z)})}else h.attr({src:a.path+n[b-1]})}if(a.indicator){m=c($a);n=a.rows>1;l=c(H);f=(c(ga)?l.y:l.x)-a.indicator;b=da(0,f,R(g.reel.math.interpolate(c(s),-1,f+2)));b=!a.cw||a.stitched?b:f-b;g(q(Ma+q(Bb)),m).css(c(ga)?{left:0,top:b}:{left:b,top:l.y-a.indicator});if(n){l=l.y-a.indicator;l=da(0,l,R(g.reel.math.interpolate(c(J),-1,l+2)));g(q(Ma+q(Cb)),m).css({top:l})}}o.call(i)},stepLeft:function(){A();d(I,false);h.trigger("fractionChange",
c(s)-c(fa)*c(ia))},stepRight:function(){A();d(I,true);h.trigger("fractionChange",c(s)+c(fa)*c(ia))},"click.steppable":function(i){if(qa)return C(i);h.trigger(i.clientX-h.offset().left>0.5*c(H).x?"stepRight":"stepLeft")},"setup.annotations":function(){c(H);var i=h.parent();g.each(c(db),function(b,f){var j=g(M(na),f.node).attr({id:b}).addClass(oc),k=f.image?g(M(Sa),f.image):g(),m=f.link?g(M(pc),f.link):g();D(false,ka(b),{display:Ga,position:Ia});m.bind({"click.annotations":function(n){n.stopPropagation()}});
f.image||f.link&&j.append(m);f.link||f.image&&j.append(k);f.link&&f.image&&j.append(m.append(k));j.appendTo(i)});h.trigger("frameChange.annotations")},"frameChange.annotations":function(i,b){b=b||c(G);this.className=this.className.replace(qc,qb+b);c(Y)||g.each(c(db),function(f,j){f=g(ka(f));var k=j.start||1,m=j.end,n=b-1,l=j.at?j.at[n]=="+":false;n=j.at?n:n-k+1;var x=typeof j.x!=Hb?j.x:j.x[n],y=typeof j.y!=Hb?j.y:j.y[n];j={display:x!==r&&y!==r&&(j.at?l:n>=0&&(!m||n<=m-k))?vb:Ga,left:U(x)||0,top:U(y)||
0};f.css(j)})},"setup.fu":function(){h.trigger("preload")},"loaded.fu":function(){h.trigger("opening")}},pool:{"tick.reel":function(i){var b=c(Y);if(T){var f=b-c(tb)/L(O)*T;b=d(Y,f>0.1?f:(T=B=0))}S.text(c(a.monitor));b&&T++;B&&B++;Gb(0);kb=true;if(B&&!b)return C(i);if(c(oa))return C(i,A());if(!(c(Z)>0)){f=c(ia)*Ra(1,c(I));b=(c(jb)?b:N(c(Ba))+b)/L(O);var j=c(s);d(s,j-b*f);o.call(i)}},"tick.reel.preload":function(){var i=c(H),b=parseInt(v.css(Ta)),f=R(1/c(ea).length*c(ha)*i.x);v.css({width:b+(f-b)/
3+1});if(c(ha)===c(ea).length&&b>i.x-2){v.fadeOut(300,function(){v.remove()});K.unbind("tick.reel.preload",u.pool["tick.reel.preload"])}},"tick.reel.opening":function(i){if(a.opening){if(c(Z)<=0)return;var b=(a.entry||a.speed)/L(O)*(a.cw?-1:1),f=c(s);d(s,f+b);b=d(Z,c(Z)-1);o.call(i);if(b>0)return;h.trigger("openingDone")}K.unbind(sa+q(Na),u.pool[sa+q(Na)])},"tick.reel.fu":function(){h.trigger("fractionChange")}}},o=function(i){Ib||delete this;return i},C=function(i,b){return i.stopImmediatePropagation()||
o.call(i)||b},B,T=0,F=function(){return B=0},A=function(){clearTimeout(ba);K.unbind(sa+q(Na),u.pool[sa+q(Na)]);d(Z,0);h.trigger("play");return B=-a.timeout*L(O)},qa=false,ba,S,v,E=function(i){D(true,z+q(Ma)+q(i),{position:Ia,width:a.indicator,height:a.indicator,overflow:eb,backgroundColor:Ab});return g(M(na),{"class":[Ma,i].join(z)})},Db=[],D=function(i,b,f){var j=c($a);b=b.split($);i&&g.each(b,function(k,m){b[k]=j+m});Db.push(b.join($)+Ob(f));return f},lb=0,Ja={x:0,y:0},Gb=function(i){return ra.push(i)&&
ra.shift()&&i},Fa=function(){return ra=[0,0]},ra=Fa(),Fb=a.graph||g.reel.math[a.loops?"hatch":"envelope"],La=g.reel.normal,Ka=function(i,b,f,j,k){d(Ca,f);d(bb,k);d(Da,a.loops?0:-f*j);d(Ea,a.loops?j:j-f*j);return i&&d(ab,{x:i,y:b})||r},kb=true,aa;try{aa=g.unique(K.add(Jb.top.document))}catch(rc){aa=K}var mc=top===self?g():function(i){g("iframe",aa.last()).each(function(){try{if(g(this).contents().find(hb).html()==g(hb).html())return(i=g(this))&&false}catch(b){}});return i}();u.setup()});Oa=Oa||function h(){var t=
+new Date,d=L(O);if(d){K.trigger(sa);g.reel.cost=(+new Date+g.reel.cost-t)/2;return Oa=setTimeout(h,la(4,1E3/d-g.reel.cost))}else return Oa=r}();return g(p)};g.fn.unreel=function(){return this.trigger("teardown")};g.reel.math={envelope:function(e,a,p,h,t,d){return a+la(h,Qa(t,-e*d))/p},hatch:function(e,a,p,h,t,d){e=(e<h?t:0)+e%t;e=a+-e*d/p;return e-ja(e)},interpolate:function(e,a,p){return a+e*(p-a)}};g.reel.preload={linear:function(e){return e},fidelity:function(e,a){function p(o,C,B){function T(E){for(;!(E>=
1&&E<=ba);)E+=E<1?+ba:-ba;return u[B+E]||(u[B+E]=!!F.push(E))}if(!o.length)return[];var F=[],A=4*C,qa=a.frame,ba=o.length;C=true;for(var S=ba/A,v=0;v<A;v++)T(qa+R(v*S));for(;S>1;){v=0;A=F.length;S/=2;for(C=!C;v<A;v++)T(F[v]+(C?1:-1)*R(S))}for(v=0;v<F.length;v++)F[v]=o[F[v]-1];return F}var h=a.orbital?2:a.rows||1,t=a.orbital?a.footage:a.frames,d=(a.row-1)*t,c=[].concat(e),u=new Array(e.length);e=h<2?[]:c.slice(d,d+t);return p(e,1,d).concat(p(c,h,0))}};g.reel.normal={fraction:function(e,a,p){e=e!=r?
e:p(s);return a.loops?e-ja(e):da(0,1,e)},row:function(e,a,p){return da(0,1,e!=r?(e-1)/(a.rows-1):p(J))},frame:function(e,a,p){e=e!=r?R(e):p(G);var h=a.orbital?2:a.rows||1;p=p(za)*h;e=a.loops?e%p||p:da(1,p,e);return e<0?e+p:e}};g.reel.sequence_pattern=/(^[^#|]*([#]+)[^#|]*)($|[|]([0-9]+)\.\.([0-9]+))($|[|]([0-9]+)$)/;g.reel.build_sequence=function(e,a){function p(o,C,B){for(;o.length<C;)o=B+o;return o}if(e.length<=1)return a.images;var h=[],t=e[1],d=e[2],c=+e[4]||1,u=a.orbital?2:a.rows||1;a=a.orbital?
a.footage:a.frames;u=+(e[5]||u*a);e=+e[7]||1;for(a=0;a<u;){h.push(t.replace(d,p(c+a+W,d.length,"0")));a+=e}return h};g.reel.touchy=/iphone|ipod|ipad|android/i.test(navigator.userAgent);g.reel.lazy=/iphone|ipod|android/i.test(navigator.userAgent);g.reel.cdn="http://code.vostrel.cz/";g.reel.instances=g();g.reel.cost=0;g.reel.leader=L;Nb("mousewheel disableTextSelect enableTextSelect".split(/ /));var K=g(Pa),Eb=g("html");Pa=+g.browser.version.split(q()).slice(0,2).join(q());var Ib=g.browser.msie,ta=
navigator.userAgent;ta={linux:/linux/i.test(ta),windows:/windows/i.test(ta),mac:/macintosh/i.test(ta)};var xa=g.reel.touchy,Oa,w="reel",Sb=w+"-overlay",Ma=w+"-indicator",zb=w+"-preloader",yb=w+"-cached",xb=w+"-monitor",oc=w+"-annotation",Ha=w+"-panning",gb=w+"-loading",qb="frame-",qc=/frame-\d+/,R=Math.round,ja=Math.floor,ob=Math.ceil,Qa=Math.min,la=Math.max,N=Math.abs,nc=Math.sqrt,ya=parseInt,db="annotations",Wb="area",ub="backup",I="backwards",fa="bit",tb="brake",Va="cached",cb="center",oa="clicked",
ab="clicked_location",Ca="clicked_on",bb="clicked_row",ia="cwish",H="dimensions",s="fraction",G="frame",Wa="_frame",za="frames",hb="head",Ea="hi",eb="hidden",Ua="image",ea="images",Z="opening_ticks",Da="lo",Tb="options",ib="playing",ha="preloaded",pa="reeling",Aa="revolution",J="row",Ya="rows",Qb="sequence",rb="spacing",Ba="speed",$a="stage",Xa="steps",Za="stitched",sb="stitched_travel",jb="stopped",ma="style",O="tempo",Y="velocity",ga="vertical",Ub="wheel_step",P=".reel",Q=".pan"+P,dc="mousedown"+
P,cc="mouseenter"+P,kc="mouseleave"+Q,jc="mousemove"+Q,lc="mouseup"+Q,bc="mousewheel"+P,sa="tick"+P,ic="touchcancel"+Q,hc="touchend"+Q,Xb="touchstart"+P,gc="touchmove"+Q,W="",z=" ",$=",",Ia="absolute",pc="a",vb="block",na="div",wb="hand",nb="height",Ab=ka("000"),ca="id",Sa="img",fb="move",Ga="none",Hb="object",Na="opening",V="px",mb="src",ec="title",Ta="width",Bb="x",Cb="y",fc=Mb("CAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7")||ua("blank.gif"),ac="wait",Zb=ua("jquery.reel-"+(ta.mac?"black":
"white")+q("cur")),Yb=ua("jquery.reel-drag"+q("cur")),$b=ua("jquery.reel-drag-down"+q("cur")),Vb=xa?r:Ib&&Pa<=8?1:0;g.fn.triggerAfter=function(e,a){function p(h){a()?h.trigger(e):setTimeout(function(){p(h)},100);return h}return p(g(this))}}}(jQuery,window,document);
