/*
 Copyright (c) 2009-2012 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 jQuery Reel
 http://jquery.vostrel.cz/reel
 Version: 1.1.3-devel
 Updated: 2012-01-16

 Requires jQuery 1.4.3 or higher
*/
jQuery.reel||function(g,Ib,Oa,r){function K(e){return g.reel.instances.length?g.reel.instances.first().data(e):null}function Jb(e){return g.reel.instances.push(e[0])&&e}function Kb(e){return(g.reel.instances=g.reel.instances.not(ja(e.attr(ba))))&&e}function Lb(e){return"data:image/gif;base64,R0lGODlh"+e}function L(e){return"<"+e+"/>"}function q(e){return"."+(e||"")}function ta(e){return g.reel.cdn+e}function ua(e){return"url("+e+")"}function ca(e,a,p){return ka(e,Pa(a,p))}function Mb(e){function a(){g.fn[this]||
(g.fn[this]=function(){return this})}g.each(e,a)}function Qa(e,a){return M(e)*(a?-1:1)}function va(e){return wa?e.touch||e.originalEvent.touches[0]:e}function U(e){return e===r||typeof e=="string"?e:e+V}function ja(e){return"#"+e}function Nb(e){var a=[];g.each(e,function(p,h){a.push(p.replace(/([A-Z])/g,"-$1").toLowerCase()+":"+U(h))});return"{"+a.join(";")+";}"}function Ob(){var e=g().jquery.split(".");if(e=+e[0]<=1&&(+e[1]<4||+e[1]==4&&+e[2]<3))try{console.error("FATAL: jQuery Reel plug-in requires at least jQuery 1.4.3")}catch(a){}return e}
if(!Ob()){g.reel={version:"1.2alpha",def:{area:r,brake:0.23,clickfree:false,cw:false,delay:-1,directional:false,draggable:true,footage:6,entry:r,frame:1,frames:36,graph:r,hint:"",horizontal:true,image:r,images:[],indicator:0,inversed:false,klass:"",laziness:6,loops:true,monitor:r,opening:0,orbital:0,path:"",preloader:2,rebound:0.5,revolution:r,row:1,rows:0,spacing:0,speed:0,step:r,steps:r,stitched:0,suffix:"-reel",tempo:36,timeout:2,throwable:true,vertical:false,wheelable:true,annotations:r,attr:{},
cursor:r,preload:"fidelity",scrollable:true,steppable:true,sequence:"",velocity:0}};g.fn.reel=function(e){var a=g.extend({},g.reel.def,e);e=function(h){var t=[];h.filter(Ra).each(function(){var d=g(this),c=a.images.length&&a.images||a.image||a.attr.src||d.attr(kb),v=xa(a.attr.width||d.css(Sa)),o=xa(a.attr.height||d.css(lb));!c||c==W||!v||!o||t.push(d)});h.filter(q(w)).each(function(){t.push(g(this).unreel())});return g(t)}(this);var p=[];a.tooltip&&(a.hint=a.tooltip);a.hotspot&&(a.area=a.hotspot);
e.each(function(){var h=g(this),t=h.data(),d=function(i,b){t[i]=b;h.trigger("store",[i,b]);return b},c=function(i){var b=t[i];h.trigger("recall",[i,b]);return b},v={setup:function(i){if(h.hasClass(w))return o.call(i);var b=h.attr(a.attr).attr(kb),f=d(ba,h.attr(ba)||h.attr(ba,w+"-"+ +new Date).attr(ba)),j=h.attr(la),l=g.extend({},h.data()),m=g.reel.sequence_pattern.exec(d(Pb,a.sequence));m=d(da,m?g.reel.build_sequence(m,a,c):a.images);var n=a.stitched,k=a.loops,x={x:xa(h.css(Sa)||a.attr.width),y:xa(h.css(lb)||
a.attr.height)},y=d(G,a.frame),X=d(ya,a.orbital&&a.footage||a.rows<=1&&m.length||a.frames),Qb=n?1:mb(X/a.footage);f=ja(f+a.suffix);var nb=h.attr("class")||"";y=g(L(ma),{id:f.substr(1),"class":nb+z+Rb+z+ob+y});y=h.wrap(y.addClass(a.klass)).attr({"class":w});p.push(Jb(y)[0]);y=y.parent().bind(v.instance);d(Sb,a);d(Ta,m.length?W:a.image||b.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2"));d(Ua,[]);d(Va,0);d(pb,a.spacing);d(H,x);d(s,0);d(Wa,a.steps||a.frames);d(za,a.revolution||n/2||x.x*2);d(Xa,
Qb);d(ea,1/(X-(k&&!n?0:1)));d(Tb,1/ka(X,c(Wa)));d(Ya,n);d(qb,n-(k?0:x.x));d(Za,f);d(I,d(Aa,a.speed)<0);d(Y,a.velocity||0);d(fa,a.vertical);d(ga,0);d(J,(a.row-1)/(a.rows-1));d(ha,Qa(1,!a.cw&&!n));d($a,{});d(na,false);d(Ba,d(ab,0));d(Ca,d(Da,0));d(oa,false);d(rb,a.brake);d(bb,!!a.orbital);d(N,a.tempo/(g.reel.lazy?a.laziness:1));d(Z,-1);d(cb,a.annotations)||y.unbind(".annotations");d(sb,{src:b,classes:nb,style:j||W,data:l});a.steppable||y.unbind("click.steppable");D(true,W,{width:x.x,height:x.y,overflow:db,
position:"relative"});D(true,$+z+q(w),{display:tb});O.bind(v.pool);o.call(i);h.trigger("setup")},instance:{teardown:function(i){var b=h.data(sb);h.parent().unbind(v.instance);c(la).remove();Kb(h.unbind(P).siblings().unbind(P).remove().end().attr({"class":b.classes,src:b.src,style:b.style}).data(b.data).unwrap());Ea();pools.unbind(Q);o.call(i)},setup:function(){function i(n){return function(k){if(k.button==Ub)return k.preventDefault()||h.trigger("down",[va(k).clientX,va(k).clientY])&&o.call(k)||n}}
var b=c(H),f=c(ya),j=ka(f,c(Wa));j=d(s,1/j*((a.step||a.frame)-1));d(G,R(j*f)+1);h.attr(ba);f=h.parent();j=d(Vb,g(a.area||f));if(wa){D(true,z+q(w),{WebkitUserSelect:Fa,WebkitBackgroundSize:a.images.length?"auto":c(Ya)&&U(c(Ya))+z+U(b.y)||U(b.x*a.footage)+z+U(b.y*c(Xa)*(a.rows||1)*(a.directional?2:1))});j.bind(Wb,i())}else{var l=a.cursor==ub?ua(Xb)+$+eb:a.cursor||ua(Yb)+$+eb,m=a.cursor==ub?ua(Zb)+$+eb+" !important":false;D(true,W,{cursor:l});D(true,q(fb),{cursor:$b});D(false,q(Ga)+$+q(Ga)+" *",{cursor:m||
l});j.bind(a.wheelable?ac:W,function(n,k){return!k||h.trigger("wheel",[k])&&false}).bind(a.clickfree?bc:cc,i()).disableTextSelect()}a.hint&&j.attr(dc,a.hint);a.monitor&&f.append(S=g(L(ma),{"class":vb}))||(S=g());D(true,z+q(vb),{position:Ha,left:0,top:0});D(true,z+q(wb),{display:Fa});D(true,z+q(xb),{position:Ha,left:0,top:b.y-a.preloader,height:a.preloader,overflow:db,backgroundColor:yb});a.indicator&&f.append(E(zb));a.rows>1&&a.indicator&&f.append(E(Ab))},preload:function(i){var b=c(H),f=h.parent(),
j=c(Ta),l=c(da),m=!l.length,n=c(ya),k=g.reel.preload[a.preload]||g.reel.preload[g.reel.def.preload];j=m?[j]:k(l.slice(),a,c);d(ga,m?0.5:0);l=[];f.addClass(fb).append(u=g(L(ma),{"class":xb}));for(h.trigger("stop");j.length;){var x=a.path+j.shift();k=b.x*(!m?1:a.footage);var y=b.y*(!m?1:n/a.footage)*(!a.directional?1:2),X=g(L(Ra)).attr({"class":wb,width:k,height:y}).appendTo(f);setTimeout(function(){X.attr({src:x});h.triggerAfter("preloaded",function(){return!!X.parent().length&&X[0].complete})},l.length-
j.length);l.push(x)}d(Ua,l);d(la,g("<"+la+' type="text/css">'+Bb.join("\n")+"</"+la+">").prependTo("head"));o.call(i)},preloaded:function(i){var b=c(da).length;if(d(ga,Pa(c(ga)+1,b))===b){h.unbind("preloaded",v.instance.preloaded);b>1||h.css({backgroundImage:ua(a.path+c(Ta))}).attr({src:ec});h.parent().removeClass(fb);h.trigger("loaded");o.call(i)}},opening:function(){if(!a.opening)return h.trigger("openingDone");var i=a.entry||a.speed,b=c(s),f=a.opening;d(s,b-i*a.opening);d(Z,f*K(N))},openingDone:function(){if(a.delay)aa=
setTimeout(function(){h.trigger("play")},a.delay*1E3);else h.trigger("play")},play:function(i,b){b=d(Aa,b||c(Aa));b=d(gb,!!b);d(hb,!b);h.trigger("frameChange");F();o.call(i)},pause:function(i){d(gb,false);A();o.call(i)},stop:function(i){var b=d(hb,true);d(gb,!b);o.call(i)},down:function(i,b,f){if(a.draggable){d(na,c(G));d(Y,0);var j=!c(oa)||a.rows<=1||!a.orbital||a.scrollable;Ia=Ja(b,f,c(s),c(za),c(J));A();Ea();pa=false;Cb.addClass(Ga);wa?pools.bind(fc,l(!j)).bind(gc+z+hc,m()):pools.bind(ic,l()).bind(a.clickfree?
jc:kc,m());function l(n){return function(k){k.preventDefault();h.trigger("pan",[va(k).clientX,va(k).clientY,k]);o.call(k);return n}}function m(n){return function(k){k.preventDefault();h.trigger("up");o.call(k);return n}}}o.call(i)},up:function(i){if(!a.draggable)return o.call(i);d(na,false);d(oa,false);var b=d(Y,!a.throwable?0:M(qa[0]+qa[1])/60);T=b?1:0;b?F():A();Ea();Cb.removeClass(Ga);pools.unbind(Q);o.call(i)},pan:function(i,b,f){if(a.draggable&&ib){ib=false;A();var j={x:b-Ia.x,y:f-Ia.y};if(M(j.x)>
0||M(j.y)>0){pa=true;Ia={x:b,y:f};var l=c(za),m=c($a),n=c(fa),k=d(s,Db(n?f-m.y:b-m.x,c(Ba),l,c(Ca),c(Da),c(ha),n?f-m.y:b-m.x));d(oa,c(oa)||c(G)!=c(na));(j=Eb(n?j.y:j.x||0))&&d(I,j<0);if(a.orbital&&c(bb)){d(fa,M(f-m.y)>M(b-m.x));m=Ja(b,f,k,l,c(J))}if(a.rows>1){j=c(H).y;n=c(ab);var x=-n*j;d(J,g.reel.math.envelope(f-m.y,n,j,x,x+j,-1))}!(k%1)&&!a.loops&&Ja(b,f,k,l,c(J));h.trigger("fractionChange")}}o.call(i)},wheel:function(i,b){var f=mb(lc(M(b))/2);f=Qa(f,b>0);b=0.0833*c(za);Ja(r,r,c(s),b,c(J));d(s,
Db(f,c(Ba),b,c(Ca),c(Da),c(ha)));f&&d(I,f<0);d(Y,0);A();o.call(i);h.trigger("up");h.trigger("fractionChange");return false},fractionChange:function(i,b){b=d(s,Ka.fraction(b,a,c));var f=d(G,1+ia(b/c(ea))),j=a.rows>1,l=a.orbital;d(bb,!!l&&(f<=l||f>=a.footage-l+2));if(!a.loops&&a.rebound){!B&&!(b%1)?jb++:(jb=0);jb>=a.rebound*1E3/K(N)&&d(I,!c(I))}h.trigger(j?"rowChange":"frameChange");o.call(i)},rowChange:function(i,b){var f=c(s)/c(ea)+1;b=d(J,Ka.row(b,a,c));b=ca(0,a.rows-1,ia(b*a.rows));d(G,ia(f+b*a.frames));
o.call(i);h.trigger("frameChange")},frameChange:function(i,b){var f=d(s,Ka.fraction(!b?r:c(ea)*(b-1),a,c));b=Ka.frame(b,a,c);var j=c(Ua).length==1,l=a.footage;if(c(fa)){b=a.inversed?l+1-b:b;b+=l}if(b==c(Va))C(i);else{var m=a.horizontal,n=c(da),k=c(H);b=d(Va,d(G,b));if(j){if(a.stitched)k=[-R(f*c(qb))+V,0+V];else{f=b%l-1;f=f<0?l-1:f;l=ia((b-0.1)/l);l+=a.rows>1?0:c(I)?0:c(Xa);b=c(pb);l=l*((m?k.y:k.x)+b);k=f*((m?k.x:k.y)+b);k=n.length?[0,0]:m?[-k+V,-l+V]:[-l+V,-k+V]}h.css({backgroundPosition:k.join(z)})}else h.attr({src:a.path+
n[b-1]})}if(a.indicator){m=c(Za);n=a.rows>1;k=c(H);f=(c(fa)?k.y:k.x)-a.indicator;b=ca(0,f,R(g.reel.math.interpolate(c(s),-1,f+2)));b=!a.cw||a.stitched?b:f-b;g(q(La+q(zb)),m).css(c(fa)?{left:0,top:b}:{left:b,top:k.y-a.indicator});if(n){k=k.y-a.indicator;k=ca(0,k,R(g.reel.math.interpolate(c(J),-1,k+2)));g(q(La+q(Ab)),m).css({top:k})}}o.call(i)},stepLeft:function(){A();d(I,false);h.trigger("fractionChange",c(s)-c(ea)*c(ha))},stepRight:function(){A();d(I,true);h.trigger("fractionChange",c(s)+c(ea)*c(ha))},
"click.steppable":function(i){if(pa)return C(i);h.trigger(i.clientX-h.offset().left>0.5*c(H).x?"stepRight":"stepLeft")},"setup.annotations":function(){c(H);var i=h.parent();g.each(c(cb),function(b,f){var j=g(L(ma),f.node).attr({id:b}).addClass(mc),l=f.image?g(L(Ra),f.image):g(),m=f.link?g(L(nc),f.link):g();D(false,ja(b),{display:Fa,position:Ha});m.bind({"click.annotations":function(n){n.stopPropagation()}});f.image||f.link&&j.append(m);f.link||f.image&&j.append(l);f.link&&f.image&&j.append(m.append(l));
j.appendTo(i)});h.trigger("frameChange.annotations")},"frameChange.annotations":function(i,b){b=b||c(G);this.className=this.className.replace(oc,ob+b);c(Y)||g.each(c(cb),function(f,j){f=g(ja(f));var l=j.start||1,m=j.end,n=b-1,k=j.at?j.at[n]=="+":false;n=j.at?n:n-l+1;var x=typeof j.x!=Fb?j.x:j.x[n],y=typeof j.y!=Fb?j.y:j.y[n];j={display:x!==r&&y!==r&&(j.at?k:n>=0&&(!m||n<=m-l))?tb:Fa,left:U(x)||0,top:U(y)||0};f.css(j)})},"setup.fu":function(){h.trigger("preload")},"loaded.fu":function(){h.trigger("opening")}},
pool:{"tick.reel":function(i){var b=c(Y);if(T){var f=b-c(rb)/K(N)*T;b=d(Y,f>0.1?f:(T=B=0))}S.text(c(a.monitor));b&&T++;B&&B++;Eb(0);ib=true;if(B&&!b)return C(i);if(c(na))return C(i,A());if(!(c(Z)>0)){f=c(ha)*Qa(1,c(I));b=(c(hb)?b:M(c(Aa))+b)/K(N);var j=c(s);d(s,j-b*f);o.call(i)}},"tick.reel.preload":function(){var i=c(H),b=parseInt(u.css(Sa)),f=R(1/c(da).length*c(ga)*i.x);u.css({width:b+(f-b)/3+1});if(c(ga)===c(da).length&&b>i.x-2){u.fadeOut(300,function(){u.remove()});O.unbind("tick.reel.preload",
v.pool["tick.reel.preload"])}},"tick.reel.opening":function(i){if(a.opening){if(c(Z)<=0)return;var b=(a.entry||a.speed)/K(N)*(a.cw?-1:1),f=c(s);d(s,f+b);b=d(Z,c(Z)-1);o.call(i);if(b>0)return;h.trigger("openingDone")}O.unbind(ra+q(Ma),v.pool[ra+q(Ma)])},"tick.reel.fu":function(){h.trigger("fractionChange")}}},o=function(i){Gb||delete this;return i},C=function(i,b){return i.stopImmediatePropagation()||o.call(i)||b},B,T=0,F=function(){return B=0},A=function(){clearTimeout(aa);O.unbind(ra+q(Ma),v.pool[ra+
q(Ma)]);d(Z,0);h.trigger("play");return B=-a.timeout*K(N)},pa=false,aa,S,u,E=function(i){D(true,z+q(La)+q(i),{position:Ha,width:a.indicator,height:a.indicator,overflow:db,backgroundColor:yb});return g(L(ma),{"class":[La,i].join(z)})},Bb=[],D=function(i,b,f){var j=c(Za);b=b.split($);i&&g.each(b,function(l,m){b[l]=j+m});Bb.push(b.join($)+Nb(f));return f},jb=0,Ia={x:0,y:0},Eb=function(i){return qa.push(i)&&qa.shift()&&i},Ea=function(){return qa=[0,0]},qa=Ea(),Db=a.graph||g.reel.math[a.loops?"hatch":
"envelope"],Ka=g.reel.normal,Ja=function(i,b,f,j,l){d(Ba,f);d(ab,l);d(Ca,a.loops?0:-f*j);d(Da,a.loops?j:j-f*j);return i&&d($a,{x:i,y:b})||r},ib=true,Hb;try{Hb=g.browser.opera?O:g.unique(O.add(Ib.top.document))}catch(pc){Hb=O}v.setup()});Na=Na||function h(){var t=+new Date,d=K(N);if(d){O.trigger(ra);g.reel.cost=(+new Date+g.reel.cost-t)/2;return Na=setTimeout(h,ka(4,1E3/d-g.reel.cost))}else return Na=r}();return g(p)};g.fn.unreel=function(){return this.trigger("teardown")};g.reel.math={envelope:function(e,
a,p,h,t,d){return a+ka(h,Pa(t,-e*d))/p},hatch:function(e,a,p,h,t,d){e=(e<h?t:0)+e%t;e=a+-e*d/p;return e-ia(e)},interpolate:function(e,a,p){return a+e*(p-a)}};g.reel.preload={linear:function(e){return e},fidelity:function(e,a){function p(o,C,B){function T(E){for(;!(E>=1&&E<=aa);)E+=E<1?+aa:-aa;return v[B+E]||(v[B+E]=!!F.push(E))}if(!o.length)return[];var F=[],A=4*C,pa=a.frame,aa=o.length;C=true;for(var S=aa/A,u=0;u<A;u++)T(pa+R(u*S));for(;S>1;){u=0;A=F.length;S/=2;for(C=!C;u<A;u++)T(F[u]+(C?1:-1)*
R(S))}for(u=0;u<F.length;u++)F[u]=o[F[u]-1];return F}var h=a.orbital?2:a.rows||1,t=a.orbital?a.footage:a.frames,d=(a.row-1)*t,c=[].concat(e),v=new Array(e.length);e=h<2?[]:c.slice(d,d+t);return p(e,1,d).concat(p(c,h,0))}};g.reel.normal={fraction:function(e,a,p){e=e!=r?e:p(s);return a.loops?e-ia(e):ca(0,1,e)},row:function(e,a,p){return ca(0,1,e!=r?(e-1)/(a.rows-1):p(J))},frame:function(e,a,p){e=e!=r?R(e):p(G);var h=a.orbital?2:a.rows||1;p=p(ya)*h;e=a.loops?e%p||p:ca(1,p,e);return e<0?e+p:e}};g.reel.sequence_pattern=
/(^[^#|]*([#]+)[^#|]*)($|[|]([0-9]+)\.\.([0-9]+))($|[|]([0-9]+)$)/;g.reel.build_sequence=function(e,a){function p(o,C,B){for(;o.length<C;)o=B+o;return o}if(e.length<=1)return a.images;var h=[],t=e[1],d=e[2],c=+e[4]||1,v=a.orbital?2:a.rows||1;a=a.orbital?a.footage:a.frames;v=+(e[5]||v*a);e=+e[7]||1;for(a=0;a<v;){h.push(t.replace(d,p(c+a+W,d.length,"0")));a+=e}return h};g.reel.touchy=/iphone|ipod|ipad|android/i.test(navigator.userAgent);g.reel.lazy=/iphone|ipod|android/i.test(navigator.userAgent);g.reel.cdn=
"http://code.vostrel.cz/";g.reel.instances=g();g.reel.cost=0;g.reel.leader=K;Mb("mousewheel disableTextSelect enableTextSelect".split(/ /));var O=g(Oa),Cb=g("html");Oa=+g.browser.version.split(q()).slice(0,2).join(q());var Gb=g.browser.msie,sa=navigator.userAgent;sa={linux:/linux/i.test(sa),windows:/windows/i.test(sa),mac:/macintosh/i.test(sa)};var wa=g.reel.touchy,Na,w="reel",Rb=w+"-overlay",La=w+"-indicator",xb=w+"-preloader",wb=w+"-cached",vb=w+"-monitor",mc=w+"-annotation",Ga=w+"-panning",fb=
w+"-loading",ob="frame-",oc=/frame-\d+/,R=Math.round,ia=Math.floor,mb=Math.ceil,Pa=Math.min,ka=Math.max,M=Math.abs,lc=Math.sqrt,xa=parseInt,cb="annotations",Vb="area",sb="backup",I="backwards",ea="bit",rb="brake",Ua="cached",bb="center",na="clicked",$a="clicked_location",Ba="clicked_on",ab="clicked_row",ha="cwish",H="dimensions",s="fraction",G="frame",Va="_frame",ya="frames",Da="hi",db="hidden",Ta="image",da="images",Z="opening_ticks",Ca="lo",Sb="options",gb="playing",ga="preloaded",oa="reeling",
za="revolution",J="row",Xa="rows",Pb="sequence",pb="spacing",Aa="speed",Za="stage",Wa="steps",Ya="stitched",qb="stitched_travel",hb="stopped",la="style",N="tempo",Y="velocity",fa="vertical",Tb="wheel_step",P=".reel",Q=".pan"+P,cc="mousedown"+P,bc="mouseenter"+P,jc="mouseleave"+Q,ic="mousemove"+Q,kc="mouseup"+Q,ac="mousewheel"+P,ra="tick"+P,hc="touchcancel"+Q,gc="touchend"+Q,Wb="touchstart"+P,fc="touchmove"+Q,W="",z=" ",$=",",Ha="absolute",nc="a",tb="block",ma="div",ub="hand",lb="height",yb=ja("000"),
ba="id",Ra="img",eb="move",Fa="none",Fb="object",Ma="opening",V="px",kb="src",dc="title",Sa="width",zb="x",Ab="y",ec=Lb("CAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7")||ta("blank.gif"),$b="wait",Yb=ta("jquery.reel-"+(sa.mac?"black":"white")+q("cur")),Xb=ta("jquery.reel-drag"+q("cur")),Zb=ta("jquery.reel-drag-down"+q("cur")),Ub=wa?r:Gb&&Oa<=8?1:0;g.fn.triggerAfter=function(e,a){function p(h){a()?h.trigger(e):setTimeout(function(){p(h)},100);return h}return p(g(this))}}}(jQuery,window,document);
