/*
 Copyright (c) 2009-2010 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 http://jquery.vostrel.cz/reel
 Version: "Dancer" (will be 1.1 on release)
 Updated: 2010-08-11

 Requires jQuery 1.4.x
*/
(function(k,qb,Qa,o){function Ra(j){return"<"+j+"/>"}function $(j){return"."+j}function aa(j){return"url("+j+")"}function z(j){return+j.toFixed(4)}function O(j,a,t){return P(j,wa(a,t))}function Sa(j){function a(){k.fn[this]||(k.fn[this]=function(){return this})}k.each(j,a)}function ba(j,a){return A(j)*(a?-1:1)}function Q(j){return j.originalEvent.touches[0]}var Ta=k.reel={footage:6,frame:1,frames:36,hint:"",horizontal:true,hotspot:o,indicator:0,klass:"",loops:true,reversed:o,spacing:0,stitched:o,
suffix:"-reel",tooltip:"",brake:0.5,clickfree:false,couple:o,cw:false,delay:-1,draggable:true,graph:o,image:o,images:[],monitor:o,maximum:100,minimum:0,path:"",preloader:4,rebound:0.5,revolution:o,row:1,rows:0,speed:0,step:o,steps:o,tempo:25,timeout:2,throwable:true,value:o,wheelable:true};k.fn.reel=function(j){var a=k.extend({},Ta,j);j=function(g){var d=[];g.filter(Ua).each(function(){var c=k(this),m=a.images.length&&a.images||a.image||c.attr(xa),w=R(c.css(ya)),u=R(c.css(za));!m||m==Aa||!w||!u||
d.push(c)});g.filter(Ba+$(G)).each(function(){d.push(k(this))});return k(d)}(this);var t=[];a.reversed&&(a.cw=true);a.tooltip&&(a.hint=a.tooltip);ca=ca||function g(){H.trigger(da);return setTimeout(g,1E3/a.tempo)}();j.each(function(){var g=k(this),d=function(e,b){g.data(e,b);g.trigger("store");return b},c=function(e){g.trigger("recall");return g.data(e)},m=function(e){delete this;return e},w={setup:function(e){if(g.hasClass(G))return m.call(e);var b=g.attr(xa),f=g.attr(Va),i=g.attr("style"),h=a.images,
l=a.stitched,q=a.loops,n={x:R(g.css(ya)),y:R(g.css(za))},p={display:"block",width:n.x,height:n.y};p=g.attr({src:a.images?Wa:b}).bind(w).addClass(G).css(p);t.push(p[0]);d(ea,h.length&&h.length||a.image||b.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2"));d(B,a.frame);d(Ca,a.spacing);d(I,n);d(r,0);d(fa,a.steps||a.frames);d(S,a.revolution||l/2||n.x);d(Da,Ea(d(T,h.length||a.frames)/a.footage));d(U,1/(c(T)-(q&&!l?0:1)));d(Xa,1/P(c(T),c(fa)));d(Fa,l-(q?0:n.x));d(Ga,n.x-a.indicator);d(J,"#"+f+a.suffix);
d(x,d(ga,a.speed)<0);d(C,0);d(v,(a.row-1)/(a.rows-1));d(D,a.value||0);d(V,ba(1,!a.cw&&!l));d(Ha,{src:b,style:i||Aa});ca&&H.bind(da,w.tick);m.call(e);g.trigger("start")},teardown:function(e){k(c(J)).remove();g.removeClass(G).unbind(s).unbind(w).attr(g.data(Ha)).enableTextSelect().removeData();W();H.unbind(X).unbind(Y).unbind(da,w.tick);m.call(e)},start:function(e){var b=c(I),f=c(T),i=P(f,c(fa));i=d(r,1/i*((a.step||a.frame)-1));d(B,i*f+1);f=c(ea);i=a.images;f=!i.length?[f]:[].concat(i);g.attr("id");
var h=g[0];h.frames=f.length;h.preloads=h.preloads||[];h.preloaded=h.preloaded||0;i=f.length!=h.preloads.length;var l=c(J).substr(1);l=k(K,{className:Ya,id:l,css:{position:"relative",width:b.x}}).insertAfter(g);var q=k(K,{className:Za,css:{position:Z,left:0,top:-b.y,width:b.x,height:b.y}}).appendTo(l);q=d(ha,k(a.hotspot||q));var n=g.add(a.couple);$a?q.css({WebkitUserSelect:"none"}).bind(ab,function(p){n.trigger("down",[Q(p).clientX,Q(p).clientY,true]);return false}).bind(bb,function(p){n.trigger("drag",
[Q(p).clientX,Q(p).clientY,true]);return false}).bind(cb,function(){n.trigger("up",[true]);return false}).bind(db,function(){n.trigger("up",[true]);return false}):q.css({cursor:"url("+Ia+"), "+ia}).bind(Y,function(p){n.trigger("over",[p.pageX,p.pageY])}).bind(eb,function(p,fb){n.trigger("wheel",[fb]);return false}).bind(gb,function(){n.trigger("play")}).bind(a.clickfree?hb:ib,function(p){n.trigger("down",[p.clientX,p.clientY]);return false}).bind(a.clickfree?jb:X,function(){n.trigger("up");return false}).disableTextSelect();
a.hint&&q.attr(kb,a.hint);a.monitor&&l.append(ja=k(K,{className:lb,css:{position:Z,left:0,top:-b.y}}))||(ja=k());a.indicator&&l.append(Ja("x"));a.rows&&a.indicator&&l.append(Ja("y"));if(i)for(l.append(ka=k(K,{className:mb,css:{position:Z,left:0,top:-a.preloader,height:a.preloader,backgroundColor:Ka}}));f.length;){i=new Image;l=a.path+f.shift();k(i).load(function(){h.preloaded++;ka.css({width:1/h.frames*h.preloaded*b.x});h.frames==h.preloaded&&ka.remove()});i.src=l;h.preloads.push(i)}a.delay>0&&y();
a.value!=o&&g.trigger("valueChange",c(D));m.call(e);g.trigger(a.rows&&!a.stitched?"rowChange":"frameChange")},tick:function(e){var b=c(C);if(L){var f=z(b-nb*L);b=!(b*f<=0||b<A(f))&&d(C,b>A(c(ga))?f:(L=u=0))}ja.text(c(a.monitor));b&&L++;u&&u++;La(0);g[0].value!=c(D)&&g.trigger("valueChange",g[0].value);if(u&&!b)return m.call(e);if(c(la))return m.call(e,y());f=c(V)*ba(1,c(x));b=(c(ma)?b:A(c(ga))+b)/a.tempo;d(r,c(r)-b*f);m.call(e);g.trigger("fractionChange")},play:function(e){var b=d(na,true);d(ma,!b);
Ma();m.call(e)},pause:function(e){d(na,false);y();m.call(e)},stop:function(e){var b=d(ma,true);d(na,!b);m.call(e)},down:function(e,b,f,i){if(!a.draggable)return m.call(e);d(la,true);d(C,0);oa(b,f,c(r),c(S),c(v));pa=o;y();W();!i&&H.bind(Y,function(h){g.trigger("drag",[h.clientX,h.clientY]);m.call(h)}).bind(X,function(h){g.trigger("up");m.call(h)})&&c(ha).css({cursor:aa(ob)+", "+ia});m.call(e)},up:function(e,b){if(!a.draggable)return m.call(e);d(la,false);var f=d(C,!a.throwable?0:A(E[0]+E[1]+E[2])/
60);L=f?1:0;f?Ma():y();W();!b&&H.unbind(X).unbind(Y)&&c(ha).css({cursor:aa(Ia)+", "+ia});m.call(e)},drag:function(e,b,f){if(!a.draggable)return m.call(e);var i=c(S),h=c(Na),l=La(b-pa||0),q=d(r,Oa(b-h.x,c(qa),i,c(ra),c(sa),c(V)));l&&d(x,l<0);if(a.rows){l=c(I).y;var n=c(Pa),p=-n*l;d(v,z(k.reel.math.envelope(f-h.y,n,l,p,p+l,-1)))}!(q%1)&&!a.loops&&oa(b,f,q,i,c(v));y();pa=b;m.call(e);g.trigger("fractionChange")},wheel:function(e,b){if(!a.wheelable)return m.call(e);var f=Ea(pb(A(b))/2);f=ba(f,b>0);b=0.2*
c(S);oa(o,o,c(r),b,c(v));d(r,Oa(f,c(qa),b,c(ra),c(sa),c(V)));f&&d(x,f<0);d(C,0);y();m.call(e);g.trigger("fractionChange");return false},fractionChange:function(e,b,f){b=!b?c(r):d(r,b);b=a.loops?b-M(b):O(0,1,b);b=d(r,z(b));d(B,1+M(b/c(U)));d(D,z(k.reel.math.interpolate(b,a.minimum,a.maximum)));if(!a.loops&&a.rebound){!u&&!(b%1)?ta++:(ta=0);ta>=a.rebound*1E3/a.tempo&&d(x,!c(x))}m.call(e);f||g.trigger("valueChange");g.trigger(a.rows&&!a.stitched?"rowChange":"frameChange")},rowChange:function(e,b){var f=
M(c(r)/c(U))+1;b=d(v,O(0,1,z(b!=o?(b-1)/(a.rows-1):c(v))));d(B,f+(!a.rows?0:N(b*(a.rows-1))*a.frames));m.call(e);g.trigger("frameChange")},frameChange:function(e,b){var f=!b?c(r):d(r,z(c(U)*(b-1)));b=d(B,N(b?b:c(B)));var i=a.images,h=a.footage,l=a.horizontal;if(a.stitched)l=[-N(f*c(Fa))+F,0+F];else{var q=b%h-1;q=q<0?h-1:q;var n=M((b-0.1)/h);n+=a.rows?0:c(x)?0:c(Da);h=c(I);var p=c(Ca);n=n*((l?h.y:h.x)+p);q=q*((l?h.x:h.y)+p);l=i.length?[0,0]:l?[-q+F,-n+F]:[-n+F,-q+F]}b=i[b-1]||c(ea);i=c(Ga);f=O(0,i,
N(k.reel.math.interpolate(f,-1,i+2)));f=!a.cw||a.stitched?f:i-f;i={background:aa(a.path+b)+ua+l.join(ua)};a.images.length?g.attr({src:a.path+b}):g.css(i);k($(va+".x"),c(J)).css({left:f});if(!a.rows)return m.call(e);f=c(I).y-a.indicator;b=O(0,f,N(k.reel.math.interpolate(c(v),-1,f+2)));k($(va+".y"),c(J)).css({top:b-f-a.indicator});m.call(e)},valueChange:function(e,b){e=b!==o&&d(r,b/(a.maximum-a.minimum));g[0].value=b===o?c(D):d(D,b);e===false||g.trigger("fractionChange",[o,true])}},u,L=0,Ma=function(){return u=
0},y=function(){return u=-a.timeout*a.tempo},ja,ka,Ja=function(e){return k(K,{className:[va,e].join(ua),css:{width:a.indicator,height:a.indicator,top:e=="y"?o:-a.indicator,left:e=="x"?o:0,position:Z,backgroundColor:Ka}})},ta=0,pa=0,La=function(e){return E.push(e)&&E.shift()&&e},W=function(){return E=[0,0,0]},E=W(),nb=a.brake/a.tempo,Oa=a.graph||k.reel.math[a.loops?"hatch":"envelope"],oa=function(e,b,f,i,h){d(qa,f);d(Pa,h);d(ra,a.loops?0:-f*i);d(sa,a.loops?i:i-f*i);return e&&d(Na,{x:e,y:b})||o};w.setup()});
return k(t)};k.reel.math={envelope:function(j,a,t,g,d,c){return a+P(g,wa(d,-j*c))/t},hatch:function(j,a,t,g,d,c){j=(j<g?d:0)+j%d;j=a+-j*c/t;return j-M(j)},interpolate:function(j,a,t){return a+j*(t-a)}};Sa("mousewheel disableTextSelect enableTextSelect".split(/ /));var H=k(Qa),$a=/iphone|ipod|ipad|android/i.test(navigator.userAgent),ia="ew-resize",ca,G="jquery-reel",Ya=G+"-overlay",va="indicator",mb="preloader",lb="monitor",Za="interface",Wa="data:image/gif;base64,R0lGODlhCAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7",
Ia="data:image/gif;base64,R0lGODlhEAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAI3lC8AeBDvgosQxQtne7yvLWGStVBelXBKqDJpNzLKq3xWBlU2nUs4C/O8cCvU0EfZGUwt19FYAAA7",ob="data:image/gif;base64,R0lGODlhEAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAIslI95EB3MHECxNjBVdE/5b2zcRV1QBabqhwltq41St4hj5konmVioZ6OtEgUAOw==",N=Math.round,M=Math.floor,Ea=Math.ceil,wa=Math.min,P=Math.max,A=Math.abs,pb=Math.sqrt,R=parseInt,Ha="backup",x="backwards",U="bit",la="clicked",Na="clicked_location",qa="clicked_on",Pa=
"clicked_row",V="cwish",I="dimensions",r="fraction",B="frame",T="frames",sa="hi",ha="hotspot",ea="image",Ga="indicator_travel",ra="lo",na="playing",S="revolution",v="row",Da="rows",Ca="spacing",ga="speed",J="stage",fa="steps",Fa="stitched_travel",ma="stopped",D="value",C="velocity",Xa="wheel_step",s=".reel",gb="dblclick"+s,ib="mousedown"+s,hb="mouseenter"+s,jb="mouseleave"+s,Y="mousemove"+s,X="mouseup"+s,eb="mousewheel"+s,da="tick"+s,db="touchcancel"+s,cb="touchend"+s,ab="touchstart"+s,bb="touchmove"+
s,Aa="",ua=" ",Z="absolute",Ba="div",K=Ra(Ba),za="height",Ka="#000",Va="id",Ua="img",F="px",xa="src",kb="title",ya="width"})(jQuery,window,document);
