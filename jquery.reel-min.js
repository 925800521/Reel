/*
 Copyright (c) 2009-2010 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 http://jquery.vostrel.cz/reel
 Version: "Dancer" (will be 1.1 on release)
 Updated: 2010-06-07

 Requires jQuery 1.4.x
*/
(function(l){function x(m){return"."+m}function pa(m){return"url("+m+")"}function J(m,r){return+r.toFixed(m)}function U(m,r,a){return y(m,V(r,a))}function qa(m,r){return m*r>0?r:-r}function ra(m){function r(){l.fn[this]||(l.fn[this]=function(){return this})}l.each(m,r)}var sa={footage:6,frame:1,frames:36,hint:"",horizontal:true,hotspot:undefined,indicator:0,klass:"",loops:true,reversed:false,saves:false,sensitivity:20,spacing:0,stitched:undefined,suffix:"-reel",tooltip:"",delay:-1,friction:0.9,inertial:true,
maximum:100,minimum:0,monitor:undefined,rebound:0.5,revolution:undefined,speed:0,step:undefined,steps:undefined,tempo:25,timeout:2};l.fn.reel=function(m){var r=function(c){var e=[];c.filter(W).each(function(){var g=l(this),s=g.attr(X),u=D(g.css(Y)),w=D(g.css(Z));!s||s==E||!u||!w||e.push(g)});c.filter($+x(K)).each(function(){e.push(l(this))});return l(e)}(this),a=l.extend({},sa,m),aa=[];F=F||function(){return setInterval(function(){z.trigger(L)},1E3/a.tempo)}();r.each(function(){var c=l(this),e=function(d,
b){c.data(d,b);c.trigger("store");return b},g=function(d){c.trigger("recall");return c.data(d)},s={setup:function(){if(!c.hasClass(K)){var d=c.attr(X),b=c.attr(M),f=c.attr(ba),i=c.attr("style");d=d.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2");var h={x:D(c.css(Y)),y:D(c.css(Z))},n=l(N).attr(ba,f).addClass(K).addClass(a.klass),j=ca||!a.saves?{display:"none"}:{opacity:0};aa.push((c=c.attr(M,E).wrap(n).css(j).parent().attr(M,b).bind(s).css({display:"block",width:h.x+p,height:h.y+p,backgroundImage:pa(d)}))[0]);
e(A,a.frames);e(da,a.spacing);e(G,h);e(o,0);e(H,a.steps||a.frames);e("resolution",y(a.steps,a.frames));e(ea,a.speed<0);e(fa,{id:b,"class":f||E,style:i||E});F&&z.bind(L,s.tick);c.trigger("start")}},teardown:function(){c=c.unbind(s).find(x(O)+", "+x(P)).remove().end().find(W).attr(c.data(fa)).unwrap().bind("setup",function(){c.unbind("setup");s.setup()});F&&z.unbind(L,s.tick)},start:function(){c.css({position:"relative"});var d=a.hotspot?a.hotspot:c,b=g(G),f=g(A),i=y(f,g(H));i=e(o,1/i*((a.step||a.frame)-
1));e(B,i*f+1);ca?d.each(function(){function h(q,v){l.each(v,function(ta){q.addEventListener(ta,this,false)})}function n(q){return q.cancelable&&q.preventDefault()||false}function j(q){var v=q.touches[0];c.trigger("down",[v.clientX,v.clientY,true]);return n(q)}function k(q){var v=q.touches[0];c.trigger("drag",[v.clientX,v.clientY,true]);return n(q)}function ga(q){c.trigger("up",[true]);return n(q)}h(this,{touchstart:j,touchmove:k,touchend:ga,touchcancel:ga})}):d.css({cursor:"ew-resize"}).mouseenter(function(){c.trigger("enter")}).mouseleave(function(){c.trigger("leave")}).mousemove(function(h){c.trigger("over",
[h.clientX,h.clientY])}).mousewheel(function(h,n){c.trigger("wheel",[n]);return false}).dblclick(function(){c.trigger("animate")}).mousedown(function(h){c.trigger("down",[h.clientX,h.clientY])}).disableTextSelect();(a.hint||a.tooltip)&&d.attr(ua,a.hint||a.tooltip);a.monitor&&c.append(l(N,{className:P,css:{position:ha,left:0,top:0}}));a.indicator&&c.append(l(N).addClass(O).css({width:a.indicator+p,height:a.indicator+p,top:b.y-a.indicator+p,position:ha,backgroundColor:va}));c.trigger("frameChange")},
animate:function(){},tick:function(){var d=a.speed,b=a.friction/a.tempo,f=g(C),i=f<0;f-=f*b;f=ia=f==ia?0:f;f=(i?V:y)(0,J(3,f))||0;f=e(C,f);step=(d+f)/a.tempo;l(x(P),c).text(g(a.monitor));ja(0);u&&u++;if(!(u&&!f)){if(g(Q))return w();e(o,g(o)+step);c.trigger("fractionChange")}},down:function(d,b,f,i){w();e(Q,true);e(ka,b);e(C,0);e(R,e(la,g(o)));!i&&z.mousemove(function(h){c.trigger("drag",[h.clientX,h.clientY])}).mouseup(function(){c.trigger("up")})},up:function(d,b){e(Q,false);d=t[1]+t[2]!=0;var f=
(t[0]+t[1]+t[2])/t.length/(b?5:20);e(C,a.inertial&&d?a.stitched?-f:f:0);ma();u=0;!b&&z.unbind("mousemove mouseup")},drag:function(d,b){w();d=g(ka);var f=g(la),i=a.stitched,h=g(G);e(o,f+(a.reversed?-1:1)*(i?-1:1)/(a.revolution||i/2||h.x)*(b-d));ja(b-na);na=b;c.trigger("fractionChange")},wheel:function(d,b){w();e(C,0);d=g(o);var f=1/y(g(A),g(H)),i=S(wa(xa(b))/2);i=b<0?-i:i;e(o,d+i*f);c.trigger("fractionChange");return false},fractionChange:function(d,b){b=!b?g(o):e(o,b);d=g(R);d=a.speed=qa(b-d,a.speed);
b=a.loops?b-(b<0?S:oa)(b):U(0,1,b);a.speed=!a.loops&&a.rebound&&T==a.rebound*1E3/a.tempo?-d:d;b=!a.loops?b:b>=0?b:1+b;b=e(R,e(o,J(6,b)));e(B,b*(g(A)-1)+1);!u&&(T=b==0||b==1?T+1:0);c.trigger("frameChange")},frameChange:function(d,b){var f=g(A);d=!b?g(o):e(o,J(6,(b-1)/(f-1)));b=!b?g(B):e(B,b);b=e(B,I(b));var i=g(G);g(H);var h=g(da),n=g(ea);if(a.stitched){h=a.loops?a.stitched:a.stitched-i.x;j=I(d*h);k=0;n=[-j+p,k+p]}else{j=oa(b/a.footage);k=b-j*a.footage-1;j=k==-1?j+k:j;k=k==-1?a.footage+k:k;b=a.horizontal?
i.y:i.x;var j=-j*(h+b),k=-k*(h+(a.horizontal?i.x:i.y));f=S(f/a.footage);h=f*b+(f-1)*h;j=n&&a.horizontal?j-h:j;k=n&&!a.horizontal?k-h:k;n=a.horizontal?[k+p,j+p]:[j+p,k+p]}h=i.x-a.indicator;d=U(0,h,I(d*(h+2))-1);c.css({backgroundPosition:n.join(" ")}).find(x(O)).css({left:d+p})}},u=a.delay>0?-I(a.delay*a.tempo):0,w=function(){return u=-a.timeout*a.tempo},T=0,na=0,ia=0,ja=function(d){t.push(d)&&t.shift()},ma=function(){return t=[0,0,0]},t=ma();c.ready(s.setup)});return l(aa)};ra("mousewheel disableTextSelect".split(/ /));
var K="jquery-reel",O="indicator",P="monitor",L="tick.reel",z=l(document),ca=/iphone|ipod|ipad|android/i.test(navigator.userAgent),F,I=Math.round,oa=Math.floor,S=Math.ceil,V=Math.min,y=Math.max,xa=Math.abs,wa=Math.sqrt,D=parseInt,fa="backup",Q="clicked",ka="clicked_location",la="clicked_on",G="dimensions",o="fraction",B="frame",A="frames",R="last_fraction",ea="reversed",da="spacing",H="steps",C="velocity",E="",ha="absolute",ba="class",$="div",N="<"+$+"/>",Z="height",va="#000",M="id",W="img",p="px",
X="src",ua="title",Y="width"})(jQuery);
