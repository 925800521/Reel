/*
 Copyright (c) 2009-2011 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 jQuery Reel
 http://jquery.vostrel.cz/reel
 Version: 1.1.3-devel
 Updated: 2011-11-26

 Requires jQuery 1.4.3 or higher
*/
jQuery.reel||function(h,yb,wa,q){function K(e){return h.reel.instances.length?h.reel.instances.first().data(e):null}function zb(e){return h.reel.instances.push(e[0])&&e}function Ab(e){return(h.reel.instances=h.reel.instances.not("#"+e.attr(ba)))&&e}function xa(e){return Bb&&"data:image/gif;base64,R0lGODlh"+e}function ya(e){return"<"+e+"/>"}function z(e){return"."+e}function za(e){return"http://code.vostrel.cz/"+e}function Va(e){return"url("+e+")"}function U(e,a,n){return ca(e,Wa(a,n))}function Cb(e){function a(){h.fn[this]||
(h.fn[this]=function(){return this})}h.each(e,a)}function Aa(e,a){return E(e)*(a?-1:1)}function ka(e){return e.originalEvent.touches[0]}function da(e){return e===q||typeof e=="string"?e:e+"px"}function Db(e){var a=[];h.each(e,function(n,g){a.push(n.replace(/([A-Z])/g,"-$1").toLowerCase()+":"+da(g))});return"{"+a.join(";")+";}"}h.reel={version:"1.1.3-devel",def:{area:q,brake:0.5,clickfree:false,cw:false,delay:-1,directional:false,draggable:true,footage:6,entry:q,frame:1,frames:36,graph:q,hint:"",horizontal:true,
image:q,images:[],indicator:0,inversed:false,klass:"",laziness:6,loops:true,monitor:q,opening:0,orbital:0,path:"",preloader:4,rebound:0.5,revolution:q,row:1,rows:0,spacing:0,speed:0,step:q,steps:q,stitched:0,suffix:"-reel",tempo:36,timeout:2,throwable:true,vertical:false,wheelable:true,annotations:q,attr:{},crop:true,preload:"fidelity",scrollable:true,steppable:true,velocity:0}};h.fn.reel=function(e){var a=h.extend({},h.reel.def,e);e=function(g){var t=[];g.filter(Ba).each(function(){var d=h(this),
c=a.images.length&&a.images||a.image||a.attr.src||d.attr(Xa),A=la(a.attr.width||d.css(Ya)),o=la(a.attr.height||d.css(Za));!c||c==$a||!A||!o||t.push(d)});g.filter(z(w)).each(function(){t.push(h(this).trigger("teardown"))});return h(t)}(this);var n=[];a.tooltip&&(a.hint=a.tooltip);a.hotspot&&(a.area=a.hotspot);e.each(function(){var g=h(this),t=g.data(),d=function(f,b){t[f]=b;g.trigger("store",[f,b]);return b},c=function(f){var b=t[f];g.trigger("recall",[f,b]);return b},A={setup:function(f){if(g.hasClass(w))return o.call(f);
var b=g.attr(a.attr).attr(Xa),i=d(ba,g.attr(ba)||g.attr(ba,w+"-"+ +new Date).attr(ba)),k=g.attr("style"),j=h.extend({},g.data()),l=a.images,m=a.stitched,p=a.loops,x={x:la(g.css(Ya)||a.attr.width),y:la(g.css(Za)||a.attr.height)},F=d(Ca,a.orbital&&a.footage||a.rows<=1&&l.length||a.frames),P=m?1:ab(F/a.footage);i="#"+i+a.suffix;var G=g.attr("class")||"",Q=h(V,{id:i.substr(1),"class":G+B+Eb});Q=g.wrap(Q).attr({"class":w});n.push(zb(Q)[0]);Q=Q.parent().bind(A.instance);d(bb,l.length&&l.length||a.image||
b.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2"));d(cb,[]);d(H,a.frame);d(db,a.spacing);d(R,x);d(r,0);d(Da,a.steps||a.frames);d(ma,a.revolution||m/2||x.x*2);d(Ea,P);d(W,1/(F-(p&&!m?0:1)));d(Fb,1/ca(F,c(Da)));d(Fa,m);d(eb,m-(p?0:x.x));d(Ga,i);d(I,d(Ha,a.speed)<0);d(X,a.velocity||0);d(Y,a.vertical);d(J,(a.row-1)/(a.rows-1));d(Z,Aa(1,!a.cw&&!m));d(ea,false);d(fb,a.brake);d(Ia,!!a.orbital);d(L,a.tempo/(h.reel.lazy?a.laziness:1));d(fa,q);d(gb,{src:b,classes:G,style:k||$a,data:j});a.steppable||
Q.unbind("click.steppable");a.annotations||Q.unbind(".annotations");C(true,"",{width:x.x,height:x.y});C(true,","+B+z(w),{display:"block",position:"relative"});S.bind(A.pool);o.call(f);g.trigger("setup")},instance:{teardown:function(f){var b=g.data(gb);g.parent().unbind(A.instance).children(Ba).unbind(v);c(hb).remove();g.unbind(v).attr({"class":b.classes,src:b.src,style:b.style}).removeClass(w);g.data(b.data).siblings().remove();g.unwrap();Ab(g);na();S.unbind(A.pool);oa.unbind(Ja).unbind(Ka);o.call(f)},
start:function(){var f=c(R),b=c(Ca),i=ca(b,c(Da));i=d(r,1/i*((a.step||a.frame)-1));d(H,T(i*b)+1);g.attr("id");b=g.parent();var k=!c(ea)||a.rows<=1||!a.orbital||a.scrollable;i=d(La,h(a.area||b));if(h.reel.touchy){C(true,B+z(w),{WebkitUserSelect:"none",WebkitBackgroundSize:a.images.length?"auto":c(Fa)&&c(Fa)+"px "+f.y+"px"||f.x*a.footage+"px "+f.y*c(Ea)*(a.rows||1)*(a.directional?2:1)+"px"});i.bind(Gb,function(j){g.trigger("down",[ka(j).clientX,ka(j).clientY,true])}).bind(Hb,function(j){g.trigger("pan",
[ka(j).clientX,ka(j).clientY,true]);return!k}).bind(Ib,function(){g.trigger("up",[true]);return false}).bind(Jb,function(){g.trigger("up",[true]);return false})}else{C(true,"",{cursor:"url("+Kb+"), "+ib});i.bind(a.wheelable?Lb:"",function(j,l){g.trigger("wheel",[l]);return false}).bind(a.clickfree?Mb:Nb,function(j){if(!j.button){g.trigger("down",[j.clientX,j.clientY]);return false}}).bind(a.clickfree?Ob:"",function(){g.trigger("up");return false}).disableTextSelect()}a.hint&&i.attr(Pb,a.hint);a.monitor&&
b.append(M=h(V,{"class":jb}))||(M=h());C(true,B+z(jb),{position:ga,left:0,top:0});C(true,B+z(kb),{display:"none"});C(true,B+z(lb),{position:ga,left:0,top:f.y-a.preloader,height:a.preloader,overflow:mb,backgroundColor:nb});C(true,z(Ma),{cursor:Va(Qb)+", "+ib});a.indicator&&b.append(ob("x"));a.rows>1&&a.indicator&&b.append(ob("y"))},preload:function(f){var b=c(R),i=g.parent(),k=c(bb),j=a.images,l=h.reel.preload[a.preload]||h.reel.preload[h.reel.def.preload];l=!j.length?[k]:l(j,a,c);var m=[],p=g[0];
p.frames=l.length;p.preloaded=0;g.trigger("stop");for(i.append(D=h(V,{"class":lb}));l.length;){var x=a.path+l.shift(),F=h(new Image).addClass(kb).attr({width:b.x,height:b.y}).bind("load"+v,function(){p.preloaded++;h(this).unbind(v);D.css({width:1/p.frames*p.preloaded*b.x});if(p.frames==p.preloaded){D.remove();j.length||g.attr({src:Rb}).css({backgroundImage:Va(a.path+k)});g.trigger("loaded");o.call(f)}});i.append(F);m.push(x);setTimeout(function(P,G){return function(){P.attr({src:G})}}(F,x),0)}d(cb,
m);d(hb,h('<style type="text/css">'+pb.join("\n")+"</style>").insertBefore(h("head link, head style").first()))},opening:function(){var f=a.entry||a.speed,b=c(r),i=a.opening;d(r,b-f*a.opening);d(fa,i*K(L))},openingDone:function(){pa=setTimeout(function(){g.trigger("play")},a.delay*1E3||0)},play:function(f){var b=d(Na,true);d(Oa,!b);ha();o.call(f)},pause:function(f){d(Na,false);u();o.call(f)},stop:function(f){var b=d(Oa,true);d(Na,!b);o.call(f)},down:function(f,b,i,k){if(a.draggable){d(qa,c(H));d(X,
0);ra=sa(b,i,c(r),c(ma),c(J));u();na();N=false;c(La).addClass(Ma);if(!k){oa.bind(Ka,function(j){g.trigger("pan",[j.clientX,j.clientY]);o.call(j);return false});a.clickfree||oa.bind(Ja,function(j){g.trigger("up");o.call(j)})}}o.call(f)},up:function(f,b){if(!a.draggable)return o.call(f);d(qa,false);d(ea,false);var i=d(X,!a.throwable?0:E(ia[0]+ia[1])/60);O=i?1:0;i?ha():u();na();c(La).removeClass(Ma);!b&&oa.unbind(Ja).unbind(Ka);o.call(f)},pan:function(f,b,i){if(a.draggable&&Pa){Pa=false;u();var k={x:b-
ra.x,y:i-ra.y};if(E(k.x)>0||E(k.y)>0){N=true;ra={x:b,y:i};var j=c(ma),l=c(qb),m=c(Y),p=d(r,rb(m?i-l.y:b-l.x,c(Qa),j,c(Ra),c(Sa),c(Z)));d(ea,c(ea)||c(H)!=c(qa));(k=sb(m?k.y:k.x||0))&&d(I,k<0);if(a.orbital&&c(Ia)){d(Y,E(i-l.y)>E(b-l.x));l=sa(b,i,p,j,c(J))}if(a.rows>1){k=c(R).y;m=c(tb);var x=-m*k;d(J,h.reel.math.envelope(i-l.y,m,k,x,x+k,-1))}!(p%1)&&!a.loops&&sa(b,i,p,j,c(J));g.trigger("fractionChange")}}o.call(f)},wheel:function(f,b){var i=ab(Sb(E(b))/2);i=Aa(i,b>0);b=0.2*c(ma);sa(q,q,c(r),b,c(J));
d(r,rb(i,c(Qa),b,c(Ra),c(Sa),c(Z)));i&&d(I,i<0);d(X,0);u();o.call(f);g.trigger("fractionChange");return false},fractionChange:function(f,b){b=d(r,ta.fraction(b,a,c));var i=d(H,1+$(b/c(W))),k=a.rows>1,j=a.orbital;d(Ia,!!j&&(i<=j||i>=a.footage-j+2));if(!a.loops&&a.rebound){!y&&!(b%1)?Ta++:(Ta=0);Ta>=a.rebound*1E3/K(L)&&d(I,!c(I))}g.trigger(k?"rowChange":"frameChange");o.call(f)},rowChange:function(f,b){var i=c(r)/c(W)+1;b=d(J,ta.row(b,a,c));b=U(0,a.rows-1,$(b*a.rows));d(H,$(i+b*a.frames));o.call(f);
g.trigger("frameChange")},frameChange:function(f,b){var i=d(r,ta.fraction(!b?q:c(W)*(b-1),a,c)),k=c(ub);b=ta.frame(b,a,c);var j=a.images,l=a.footage,m=c(R),p=a.rows>1,x=c(Ga),F=a.horizontal;if(c(Y)){b=a.inversed?l+1-b:b;b+=l}b=d(ub,d(H,b));var P=(c(Y)?m.y:m.x)-a.indicator,G=U(0,P,T(h.reel.math.interpolate(c(r),-1,P+2)));G=!a.cw||a.stitched?G:P-G;h(z(ua+".x"),x).css(c(Y)?{left:0,top:G}:{left:G,top:m.y-a.indicator});if(p){p=m.y-a.indicator;p=U(0,p,T(h.reel.math.interpolate(c(J),-1,p+2)));h(z(ua+".y"),
x).css({top:p})}if(b==k)f.stopPropagation();else if(j.length)g.attr({src:a.path+j[b-1]});else{if(a.stitched)j=[-T(i*c(eb))+aa,0+aa];else{i=b%l-1;i=i<0?l-1:i;l=$((b-0.1)/l);l+=a.rows>1?0:c(I)?0:c(Ea);b=c(db);l=l*((F?m.y:m.x)+b);m=i*((F?m.x:m.y)+b);j=j.length?[0,0]:F?[-m+aa,-l+aa]:[-l+aa,-m+aa]}g.css({backgroundPosition:j.join(B)})}o.call(f)},stepLeft:function(){u();d(I,false);g.trigger("fractionChange",c(r)-c(W)*c(Z))},stepRight:function(){u();d(I,true);g.trigger("fractionChange",c(r)+c(W)*c(Z))},
"click.steppable":function(f){if(N)return f.stopPropagation();g.trigger(f.clientX-g.offset().left>0.5*c(R).x?"stepRight":"stepLeft")},"setup.annotations":function(){var f=c(R),b=g.parent(),i={position:ga,width:f.x,height:f.y,left:0,top:0};C(true,B+z(Ua),i);a.crop&&C(true,B+z(Ua),{clip:"rect(0 "+da(f.x)+" "+da(f.y)+" 0)"});b.append(s=h(V,{"class":Ua+B+vb+a.frame}))||(s=h());h.each(a.annotations,function(k,j){var l=h(V,j.node).attr({id:k}),m=j.image?h(ya(Ba),j.image):h(),p=j.link?h(ya(Tb),j.link):h();
C(false,"#"+k,{display:"none",position:ga});j.image||j.link&&l.append(p);j.link||j.image&&l.append(m);j.link&&j.image&&l.append(p.append(m));l.appendTo(s)})},"frameChange.annotations":function(f,b){b=b||c(H);s[0].className=s[0].className.replace(/frame-\d+/g,vb+b);h.each(a.annotations,function(i,k){i=h("#"+i,s);var j=k.start,l=k.end,m=b-(j||0),p=typeof k.x!=wb?k.x:k.x[m-1];k=typeof k.y!=wb?k.y:k.y[m-1];k={display:p!==q&&k!==q&&m>=0&&(!l||m<=l-j)?"block":"none",left:da(p)||0,top:da(k)||0};i.css(k)})},
"setup.fu":function(){g.trigger("start")},"start.fu":function(){g.trigger("preload")},"loaded.fu":function(){g.trigger(a.rows>1&&!a.stitched?"rowChange":"frameChange").trigger("opening")}},pool:{"tick.reel":function(f){var b=c(X);if(O){var i=b-c(fb)/K(L)*O;b=!(b*i<=0||b<E(i))&&d(X,b>E(c(Ha))?i:(O=y=0))}M.text(c(a.monitor));b&&O++;y&&y++;sb(0);Pa=true;if(y&&!b)return o.call(f);if(c(qa))return o.call(f,u());i=c(Z)*Aa(1,c(I));b=(c(Oa)?b:E(c(Ha))+b)/K(L);var k=c(r);d(r,k-b*i);o.call(f)},"tick.reel.fu":function(f){g.trigger("fractionChange");
c(fa)===q&&f.stopImmediatePropagation()},"tick.reel.opening":function(f){var b=(a.entry||a.speed)/K(L)*(a.cw?-1:1),i=c(r);d(r,i+b);b=d(fa,c(fa)-1);o.call(f);if(!(b>1)){S.unbind(ja+".opening",A.pool[ja+".opening"]);g.trigger("openingDone")}}}},o=function(f){xb||delete this;return f},y,O=0,ha=function(){return y=0},u=function(){clearTimeout(pa);S.unbind(ja+".opening",A.pool[ja+".opening"]);g.trigger("play");return y=-a.timeout*K(L)},N=false,pa,M,s,D,ob=function(f){C(true,B+z(ua)+z(f),{position:ga,width:a.indicator,
height:a.indicator,overflow:mb,backgroundColor:nb});return h(V,{"class":[ua,f].join(B)})},pb=[],C=function(f,b,i){var k=c(Ga);b=b.split(",");f&&h.each(b,function(j,l){b[j]=k+l});pb.push(b.join(",")+Db(i));return i},Ta=0,ra={x:0,y:0},sb=function(f){return ia.push(f)&&ia.shift()&&f},na=function(){return ia=[0,0]},ia=na(),rb=a.graph||h.reel.math[a.loops?"hatch":"envelope"],ta=h.reel.normal,sa=function(f,b,i,k,j){d(Qa,i);d(tb,j);d(Ra,a.loops?0:-i*k);d(Sa,a.loops?k:k-i*k);return f&&d(qb,{x:f,y:b})||q},
Pa=true,oa=h.browser.opera?S:h.unique(S.add(yb.top.document));A.setup()});va=va||function g(){var t=+new Date,d=K(L);if(d){S.trigger(ja);h.reel.cost=(+new Date+h.reel.cost-t)/2;return va=setTimeout(g,ca(4,1E3/d-h.reel.cost))}else return va=q}();return h(n)};h.reel.math={envelope:function(e,a,n,g,t,d){return a+ca(g,Wa(t,-e*d))/n},hatch:function(e,a,n,g,t,d){e=(e<g?t:0)+e%t;e=a+-e*d/n;return e-$(e)},interpolate:function(e,a,n){return a+e*(n-a)}};h.reel.preload={linear:function(e){return e},fidelity:function(e,
a){function n(o,y,O){function ha(D){for(;!(D>=1&&D<=M);)D+=D<1?+M:-M;return A[O+D]||(A[O+D]=!!u.push(D))}if(!o.length)return[];var u=[],N=4*y,pa=a.frame,M=o.length;y=M/N;for(var s=0;s<N;s++)ha(pa+T(s*y));for(;y>1;){s=0;N=u.length;for(y/=2;s<N;s++)ha(T(u[s]+y))}for(s=0;s<u.length;s++)u[s]=o[u[s]-1];return u}var g=a.orbital?2:a.rows||1,t=a.orbital?a.footage:a.frames,d=(a.row-1)*t,c=[].concat(e),A=new Array(e.length);e=g<2?[]:c.slice(d,d+t);return n(e,1,d).concat(n(c,g,0))}};h.reel.normal={fraction:function(e,
a,n){e=e!=q?e:n(r);return a.loops?e-$(e):U(0,1,e)},row:function(e,a,n){return U(0,1,e!=q?(e-1)/(a.rows-1):n(J))},frame:function(e,a,n){e=e!=q?T(e):n(H);var g=a.orbital?2:a.rows||1;n=n(Ca)*g;e=a.loops?e%n||n:U(1,n,e);return e<0?e+n:e}};h.reel.touchy=/iphone|ipod|ipad|android/i.test(navigator.userAgent);h.reel.lazy=/iphone|ipod|android/i.test(navigator.userAgent);h.reel.instances=h();h.reel.cost=0;h.reel.leader=K;Cb("mousewheel disableTextSelect enableTextSelect".split(/ /));var S=h(wa);wa=+h.browser.version.split(".").slice(0,
2).join(".");var xb=h.browser.msie,Bb=!(xb&&wa<8),ib="ew-resize",va,w="jquery-reel",Eb=w+"-overlay",ua=w+"-indicator",lb=w+"-preloader",kb=w+"-cached",jb=w+"-monitor",Ua=w+"-annotations",Ma=w+"-panning",vb="frame-",Rb=xa("CAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7")||za("blank.gif"),Kb=xa("EAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAI3lC8AeBDvgosQxQtne7yvLWGStVBelXBKqDJpNzLKq3xWBlU2nUs4C/O8cCvU0EfZGUwt19FYAAA7")||za("jquery.reel.cursor-drag.gif"),Qb=xa("EAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAIslI95EB3MHECxNjBVdE/5b2zcRV1QBabqhwltq41St4hj5konmVioZ6OtEgUAOw==")||
za("jquery.reel.cursor-drag-down.gif"),T=Math.round,$=Math.floor,ab=Math.ceil,Wa=Math.min,ca=Math.max,E=Math.abs,Sb=Math.sqrt,la=parseInt,La="area",gb="backup",I="backwards",W="bit",fb="brake",Ia="center",qa="clicked",qb="clicked_location",Qa="clicked_on",tb="clicked_row",Z="cwish",R="dimensions",r="fraction",H="frame",ub="_frame",Ca="frames",Sa="hi",mb="hidden",bb="image",cb="images",fa="opening_ticks",Ra="lo",Na="playing",ea="reeling",ma="revolution",J="row",Ea="rows",db="spacing",Ha="speed",Ga=
"stage",Da="steps",Fa="stitched",eb="stitched_travel",Oa="stopped",hb="style",L="tempo",X="velocity",Y="vertical",Fb="wheel_step",v=".reel",Nb="mousedown"+v,Mb="mouseenter"+v,Ob="mouseleave"+v,Ka="mousemove"+v,Ja="mouseup"+v,Lb="mousewheel"+v,ja="tick"+v,Jb="touchcancel"+v,Ib="touchend"+v,Gb="touchstart"+v,Hb="touchmove"+v,$a="",B=" ",ga="absolute",Tb="a",V=ya("div"),Za="height",nb="#000",ba="id",Ba="img",wb="object",aa="px",Xa="src",Pb="title",Ya="width"}(jQuery,window,document);
