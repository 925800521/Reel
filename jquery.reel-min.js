/*
 Copyright (c) 2009-2012 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 jQuery Reel
 http://jquery.vostrel.cz/reel
 Version: 1.1.3-devel
 Updated: 2012-01-28

 Requires jQuery 1.5 or higher
*/
jQuery.reel||function(k,Lb,Oa,p){function Mb(f){return o.instances.push(f[0])&&f}function Nb(f){return(o.instances=o.instances.not(na(f.attr(ga))))&&f}function O(f){return o.instances.length?o.instances.first().data(f):null}function Ob(f){return"data:image/gif;base64,R0lGODlh"+f}function P(f){return"<"+f+"/>"}function s(f){return"."+(f||"")}function wa(f){return o.cdn+f}function xa(f){return"url("+f+")"}function V(f,j,q){return oa(f,Pa(j,q))}function Pb(f){function j(){k.fn[this]||(k.fn[this]=function(){return this})}
k.each(f,j)}function Qa(f,j){return Q(f)*(j?-1:1)}function ya(f){return za?f.touch||f.originalEvent.touches[0]:f}function W(f){return f===p||typeof f==kb?f:f+X}function na(f){return"#"+f}if(+k().jquery.replace(s(),"").substr(0,2)<15)throw"VersionError: far too old jQuery for running Reel";var o=k.reel={version:"1.2alpha",def:{area:p,brake:0.23,clickfree:false,cw:false,delay:-1,directional:false,draggable:true,footage:6,entry:p,frame:1,frames:36,graph:p,hint:"",horizontal:true,image:p,images:[],indicator:0,
inversed:false,klass:"",laziness:6,loops:true,monitor:p,opening:0,orbital:0,path:"",preloader:2,rebound:0.5,revolution:p,row:1,rows:0,spacing:0,speed:0,step:p,steps:p,stitched:0,suffix:"-reel",tempo:36,timeout:2,throwable:true,vertical:false,wheelable:true,annotations:p,attr:{},cursor:p,preload:"fidelity",scrollable:true,steppable:true,sequence:"",velocity:0},fn:{reel:function(){var f=arguments,j=k(this),q=j.data(),r=f[0],t=f[1];if(f.length==2){if(t!==p){try{t=o.normal[r](t,q)}catch(F){}if(q[r]!==
t)if(q[r]===p)q[r]=t;else j.trigger(r+"Change",[p,q[r]=t])}return j.trigger("store",[r,t])}else if(typeof r=="string"){t=q[r];j.trigger("recall",[r,t]);return t}else{var a=k.extend({},o.def,r);f=function(i){var d=[];i.filter(Ra).each(function(){var c=k(this),u=a.images.length&&a.images||a.sequence||a.image||a.attr.src||c.attr(lb),D=Aa(a.attr.width||c.css(Sa)),z=Aa(a.attr.height||c.css(mb));u&&u!=G&&D&&z&&d.push(c)});i.filter(s(w)).each(function(){d.push(k(this).unreel())});return k(d)}(this);var J=
[];a.tooltip&&(a.hint=a.tooltip);a.hotspot&&(a.area=a.hotspot);f.each(function(){var i=k(this),d=function(b,e){return i.reel(b,e)&&e},c=function(b){return i.reel(b)},u={setup:function(){if(!i.hasClass(w)){d(Ta,a);var b=i.attr(a.attr).attr(lb),e=d(ga,i.attr(ga)||i.attr(ga,w+"-"+ +new Date).attr(ga)),h=i.attr(pa),g=k.extend({},i.data()),l=o.re.sequence.exec(d(Qb,a.sequence));l=d(Y,l?o.sequence(l,a,c):a.images);var n=a.stitched,m=a.loops,y={x:Aa(i.css(Sa)||a.attr.width),y:Aa(i.css(mb)||a.attr.height)},
A=d(Z,a.frame),R=d(qa,a.orbital&&a.footage||a.rows<=1&&l.length||a.frames),ha=n?1:nb(R/a.footage);e=na(e+a.suffix);var ob=i.attr("class")||G;A=k(P(ra),{id:e.substr(1),"class":ob+B+Rb+B+pb+A});A=i.wrap(A.addClass(a.klass)).attr({"class":w});J.push(Mb(A)[0]);A=A.parent().bind(u.instance);d(Ua,l.length?G:a.image||b.replace(o.re.image,"$1"+a.suffix+".$2"));d(qb,[]);d(rb,a.spacing);d(H,y);d(v,0);d(Va,a.steps||a.frames);d(Ba,a.revolution||n/2||y.x*2);d(Wa,ha);d(Ca,1/(R-(m&&!n?0:1)));d(Sb,1/oa(R,c(Va)));
d(Xa,n);d(sb,n-(m?0:y.x));d(Ya,e);d(K,d(Da,a.speed)<0);d($,a.velocity||0);d(ia,a.vertical);d(aa,0);d(L,(a.row-1)/(a.rows-1));d(ja,Qa(1,!a.cw&&!n));d(Za,{});d(sa,false);d(Ea,d($a,0));d(Fa,d(Ga,0));d(ta,false);d(tb,a.brake);d(ab,!!a.orbital);d(S,a.tempo/(o.lazy?a.laziness:1));d(ba,-1);d(Ha,a.annotations||A.unbind(s(Ha))&&{});d(ub,{src:b,classes:ob,style:h||G,data:g});a.steppable||A.unbind("click.steppable");C(G,{width:y.x,height:y.y,overflow:bb,position:"relative"});C(ca+B+s(w),{display:vb});M.bind(u.pool);
i.trigger("setup")}},instance:{teardown:function(){var b=i.data(ub);i.parent().unbind(u.instance);c(pa).remove();c(wb).enableTextSelect();Nb(i.unbind(T).removeData().siblings().unbind(T).remove().end().attr({"class":b.classes,src:b.src,style:b.style}).data(b.data).unwrap());Ia();M.unbind(u.pool);N.unbind(U)},setup:function(){function b(n){return function(m){if(m.button==Tb)return m.preventDefault()||i.trigger("down",[ya(m).clientX,ya(m).clientY])&&n}}var e=c(H),h=c(qa);h=oa(h,c(Va));i.attr(ga);var g=
i.parent();area=d(wb,k(a.area||g));if(za){C(B+s(w),{WebkitUserSelect:Ja,WebkitBackgroundSize:c(Y).length?p:c(Xa)&&W(c(Xa))+B+W(e.y)||W(e.x*a.footage)+B+W(e.y*c(Wa)*(a.rows||1)*(a.directional?2:1))});area.bind(Ub,b())}else{e=a.cursor==xb?Vb:a.cursor||Wb;var l=a.cursor==xb?Xb+B+"!important":p;C(G,{cursor:e});C(s(cb),{cursor:Yb});C(s(Ka)+ca+s(Ka)+" *",{cursor:l||e},true);area.bind(a.wheelable?Zb:G,function(n,m){return n.preventDefault()||!m||i.trigger("wheel",[m])&&false}).bind(a.clickfree?$b:ac,b()).disableTextSelect()}a.hint&&
area.attr(bc,a.hint);a.indicator&&g.append(ua(cc));a.rows>1&&a.indicator&&g.append(ua(dc));a.monitor&&g.append(yb=k(P(ra),{"class":zb}))&&C(B+s(zb),{position:La,left:0,top:0});C(B+s(Ab),{display:Ja});d(v,1/h*((a.step||a.frame)-1))},preload:function(){var b=c(H),e=i.parent(),h=c(Ua),g=c(Y),l=!g.length,n=c(qa),m=o.preload[a.preload]||o.preload[o.def.preload];h=l?[h]:m(g.slice(0),a,c);d(aa,l?0.5:0);g=[];e.addClass(cb).append(ka());for(i.trigger("stop");h.length;){var y=a.path+h.shift(),A=b.x*(!l?1:a.footage),
R=b.y*(!l?1:n/a.footage)*(!a.directional?1:2),ha=k(P(Ra)).attr({"class":Ab}).appendTo(e);setTimeout(function(){if(ha.parent().length){ha.attr({src:y,width:A,height:R});i.reelTriggerOnce("preloaded",function(){return!!ha.parent().length&&ha[0].complete})}},g.length-h.length);g.push(y)}d(qb,g);d(pa,k("<"+pa+' type="text/css">'+C.rules.join("\n")+"</"+pa+">").prependTo(db))},preloaded:function(){var b=c(Y).length||1;if(d(aa,Pa(c(aa)+1,b))===b){i.parent().removeClass(cb);i.unbind(aa,u.instance.preloaded).trigger("loaded")}},
loaded:function(){c(Y).length>1||i.css({backgroundImage:xa(a.path+c(Ua))}).attr({src:ec})},opening:function(){if(!a.opening)return i.trigger("openingDone");var b=a.entry||a.speed,e=c(v),h=a.opening;d(v,e-b*a.opening);d(ba,h*O(S))},openingDone:function(){if(a.delay)I=setTimeout(function(){i.trigger("play")},a.delay*1E3);else i.trigger("play")},play:function(b,e){e=d(Da,e||c(Da));b=d(eb,!!e);d(fb,!b);da()},pause:function(){d(eb,false);E()},stop:function(){var b=d(fb,true);d(eb,!b)},down:function(b,
e,h){function g(n){return function(m){m.preventDefault();i.trigger("pan",[ya(m).clientX,ya(m).clientY,m]);return n}}function l(n){return function(m){m.preventDefault();i.trigger("up");return n}}if(a.draggable){d(sa,c(Z));d($,0);b=!c(ta)||a.rows<=1||!a.orbital||a.scrollable;Ma=Na(e,h,c(v),c(Ba),c(L));E();Ia();x=false;k(Bb,N).addClass(Ka);za?N.bind(fc,g(!b)).bind(gc+B+hc,l()):N.bind(ic,g()).bind(a.clickfree?jc:kc,l())}},up:function(){if(a.draggable){d(sa,false);d(ta,false);var b=d($,!a.throwable?0:
Q(va[0]+va[1])/60);ea=b?1:0;b?da():E();Ia();k(Bb,N).removeClass(Ka);N.unbind(U)}},pan:function(b,e,h,g){if(a.draggable&&gb){gb=false;E();b=g&&!k(g.currentTarget).is(M)?lc.offset():{left:0,top:0};e-=b.left;h-=b.top;var l={x:e-Ma.x,y:h-Ma.y};if(Q(l.x)>0||Q(l.y)>0){x=true;Ma={x:e,y:h};b=c(Ba);g=c(Za);var n=c(ia),m=Cb(n?h-g.y:e-g.x,c(Ea),b,c(Fa),c(Ga),c(ja),n?h-g.y:e-g.x);d(ta,c(ta)||c(Z)!=c(sa));(l=Db(n?l.y:l.x||0))&&d(K,l<0);if(a.orbital&&c(ab)){d(ia,Q(h-g.y)>Q(e-g.x));g=Na(e,h,m,b,c(L))}if(a.rows>
1){l=c(H).y;l=a.rows>3?l:l/(5-a.rows);n=c($a);var y=-n*l;d(L,o.math.envelope(h-g.y,n,l,y,y+l,-1))}!(m%1)&&!a.loops&&Na(e,h,m,b,c(L));d(v,m)}}},wheel:function(b,e){b=nb(mc(Q(e))/2);b=Qa(b,e>0);e=0.0833*c(Ba);Na(p,p,c(v),e,c(L));b&&d(K,b<0);d($,0);d(v,Cb(b,c(Ea),e,c(Fa),c(Ga),c(ja)));E();i.trigger("up");return false},fractionChange:function(b,e,h){if(e!==p)return d(v,e);b=1+la(h/c(Ca));e=a.rows>1;var g=a.orbital;d(ab,!!g&&(b<=g||b>=a.footage-g+2));if(!a.loops&&a.rebound){!z&&!(h%1)?hb++:(hb=0);hb>=
a.rebound*1E3/O(S)&&d(K,!c(K))}if(e){h=V(0,a.rows-1,la(c(L)*a.rows));b+=h*a.frames}d(Z,b)},rowChange:function(b,e,h){if(e!==p)return d(L,e);b=c(qa);b=c(Z)%b||b;h=V(0,a.rows-1,la(h*a.rows));d(Z,b+h*a.frames)},frameChange:function(b,e,h){if(e!==p)return d(Z,e);b=c(v);var g=a.footage;if(a.orbital&&c(ia)){h=a.inversed?g+1-h:h;h+=g}var l=a.horizontal,n=c(Y),m=!n.length;e=c(H);if(m){if(a.stitched)e=[-fa(b*c(sb))+X,0+X];else{m=h%g-1;m=m<0?g-1:m;g=la((h-0.1)/g);g+=a.rows>1?0:c(K)?0:c(Wa);h=c(rb);g=g*((l?
e.y:e.x)+h);e=m*((l?e.x:e.y)+h);e=n.length?[0,0]:l?[-e+X,-g+X]:[-g+X,-e+X]}i.css({backgroundPosition:e.join(B)})}else i.attr({src:a.path+n[h-1]});if(a.indicator){c(Ya);l=a.rows>1;e=c(H);n=(c(ia)?e.y:e.x)-a.indicator;b=V(0,n,fa(o.math.interpolate(b,-1,n+2)));b=!a.cw||a.stitched?b:n-b;ua.$x.css(c(ia)?{left:0,top:b}:{left:b,top:e.y-a.indicator});if(l){b=e.y-a.indicator;b=V(0,b,fa(o.math.interpolate(c(L),-1,b+2)));ua.$y.css({top:b})}}},stepLeft:function(){E();d(K,false);d(v,c(v)-c(Ca)*c(ja))},stepRight:function(){E();
d(K,true);d(v,c(v)+c(Ca)*c(ja))},"click.steppable":function(b){if(x)return D(b,false);i.trigger(b.clientX-i.offset().left>0.5*c(H).x?"stepRight":"stepLeft")},"setup.annotations":function(){c(H);var b=i.parent();k.each(c(Ha),function(e,h){var g=typeof h.node==kb?k(h.node):h.node||{};g=g.jquery?g:k(P(ra),g);g=g.attr({id:e}).addClass(nc);var l=h.image?k(P(Ra),h.image):k(),n=h.link?k(P(oc),h.link):k();C(na(e),{display:Ja,position:La},true);g.bind({"click.annotations":function(m){m.stopPropagation()}});
h.image||h.link&&g.append(n);h.link||h.image&&g.append(l);h.link&&h.image&&g.append(n.append(l));g.appendTo(b)})},"frameChange.annotations":function(b,e){this.className=this.className.replace(o.re.frame_klass,pb+e);c($)||k.each(c(Ha),function(h,g){h=k(na(h));var l=g.start||1,n=g.end,m=e-1,y=g.at?g.at[m]=="+":false;m=g.at?m:m-l+1;var A=typeof g.x!=Eb?g.x:g.x[m],R=typeof g.y!=Eb?g.y:g.y[m];g={display:A!==p&&R!==p&&(g.at?y:m>=0&&(!n||m<=n-l))?vb:Ja,left:W(A)||0,top:W(R)||0};h.css(g)})},"setup.fu":function(){i.trigger("preload")},
"loaded.fu":function(){i.trigger("opening")}},pool:{"tick.reel":function(b){var e=c($);if(ea){e=e-c(tb)/O(S)*ea;e=d($,e>0.1?e:(ea=z=0))}a.monitor&&yb.text(c(a.monitor));e&&ea++;z&&z++;Db(0);gb=true;if(z&&!e)return D(b);if(c(sa))return D(b,E());if(!(c(ba)>0)){b=c(ja)*Qa(1,c(K));e=(c(fb)?e:Q(c(Da))+e)/O(S);d(v,c(v)-e*b)}},"tick.reel.preload":function(){var b=c(H),e=parseInt(ka.$.css(Sa)),h=c(Y).length||1,g=fa(1/h*c(aa)*b.x);ka.$.css({width:e+(g-e)/3+1});if(c(aa)===h&&e>b.x-2){ka.$.fadeOut(300,function(){ka.$.remove()});
M.unbind(ma+s(Fb),u.pool[ma+s(Fb)])}},"tick.reel.opening":function(){var b=ma+s(ib);if(!a.opening||!c(ba))return M.unbind(b,u.pool[b]);b=(a.entry||a.speed)/O(S)*(a.cw?-1:1);var e=d(ba,c(ba)-1);d(v,c(v)+b);e||i.trigger("openingDone")}}},D=function(b,e){return b.stopImmediatePropagation()||e},z,ea=0,da=function(){return z=0},E=function(){clearTimeout(I);M.unbind(ma+s(ib),u.pool[ma+s(ib)]);d(ba,0);i.trigger("play");return z=-a.timeout*O(S)},x=false,I,yb=k(),ka=function(){C(B+s(Gb),{position:La,left:0,
top:c(H).y-a.preloader,height:a.preloader,overflow:bb,backgroundColor:Hb});return ka.$=k(P(ra),{"class":Gb})},ua=function(b){C(B+s(Ib)+s(b),{position:La,width:a.indicator,height:a.indicator,overflow:bb,backgroundColor:Hb});return ua["$"+b]=k(P(ra),{"class":Ib+B+b})},C=function(b,e,h){function g(l){var n=[];k.each(l,function(m,y){n.push(m.replace(/([A-Z])/g,"-$1").toLowerCase()+":"+W(y)+";")});return"{"+n.join(G)+"}"}h=h?G:c(Ya);b=b.replace(/^/,h).replace(ca,ca+h);return C.rules.push(b+g(e))&&e},hb=
0,Ma={x:0,y:0},Db=function(b){return va.push(b)&&va.shift()&&b},Ia=function(){return va=[0,0]},va=Ia(),Cb=a.graph||o.math[a.loops?"hatch":"envelope"],Na=function(b,e,h,g,l){d(Ea,h);d($a,l);d(Fa,a.loops?0:-h*g);d(Ga,a.loops?g:g-h*g);return b&&d(Za,{x:b,y:e})||p},gb=true,N;try{N=k.unique(M.add(Lb.top.document))}catch(qc){N=M}var lc=top===self?k():function(b){k("iframe",N.last()).each(function(){try{if(k(this).contents().find(db).html()==k(db).html())return(b=k(this))&&false}catch(e){}});return b}();
C.rules=[];u.setup()});Jb=Jb||function i(){var d=+new Date,c=O(S),u;if(c){M.trigger(ma);o.cost=(+new Date+o.cost-d)/2;u=setTimeout(i,oa(4,1E3/c-o.cost))}return u}();return k(J)}},unreel:function(){return this.trigger("teardown")}},re:{image:/^(.*)\.(jpg|jpeg|png|gif)$/,touchy_agent:/iphone|ipod|ipad|android/i,lazy_agent:/iphone|ipod|android/i,frame_klass:/frame-\d+/,sequence:/(^[^#|]*([#]+)[^#|]*)($|[|]([0-9]+)\.\.([0-9]+))($|[|]([0-9]+)$)/},cdn:"http://code.vostrel.cz/",math:{envelope:function(f,
j,q,r,t,F){return j+oa(r,Pa(t,-f*F))/q},hatch:function(f,j,q,r,t,F){f=(f<r?t:0)+f%t;f=j+-f*F/q;return f-la(f)},interpolate:function(f,j,q){return j+f*(q-j)}},preload:{linear:function(f){return f},fidelity:function(f,j){function q(i,d,c){function u(I){for(;!(I>=1&&I<=da);)I+=I<1?+da:-da;return J[c+I]||(J[c+I]=!!D.push(I))}if(!i.length)return[];var D=[],z=4*d,ea=j.frame,da=i.length;d=true;for(var E=da/z,x=0;x<z;x++)u(ea+fa(x*E));for(;E>1;){x=0;z=D.length;E/=2;for(d=!d;x<z;x++)u(D[x]+(d?1:-1)*fa(E))}for(x=
0;x<D.length;x++)D[x]=i[D[x]-1];return D}var r=j.orbital?2:j.rows||1,t=j.orbital?j.footage:j.frames,F=(j.row-1)*t,a=[].concat(f),J=new Array(f.length);f=r<2?[]:a.slice(F,F+t);return q(f,1,F).concat(q(a,r,0))}},normal:{fraction:function(f,j){return j[Ta].loops?f-la(f):V(0,1,f)},row:function(f){return V(0,1,f)},frame:function(f,j){var q=j[Ta];j=j[qa]*(q.orbital?2:q.rows||1);f=fa(q.loops?f%j||j:V(1,j,f));return f<0?f+j:f}},sequence:function(f,j){function q(i,d,c){for(;i.length<d;)i=c+i;return i}if(f.length<=
1)return j.images;var r=[],t=f[1],F=f[2],a=+f[4]||1,J=j.orbital?2:j.rows||1;j=j.orbital?j.footage:j.frames;J=+(f[5]||J*j);f=+f[7]||1;for(j=0;j<J;){r.push(t.replace(F,q(a+j+G,F.length,"0")));j+=f}return r},instances:k(),leader:O,cost:0},M=k(Oa);Oa=+k.browser.version.split(s()).slice(0,2).join(s());var pc=k.browser.msie,Kb=navigator.userAgent,za=o.touchy,Jb,w="reel",Rb=w+"-overlay",Ib=w+"-indicator",Gb=w+"-preloader",Ab=w+"-cached",zb=w+"-monitor",nc=w+"-annotation",Ka=w+"-panning",cb=w+"-loading",
pb="frame-",fa=Math.round,la=Math.floor,nb=Math.ceil,Pa=Math.min,oa=Math.max,Q=Math.abs,mc=Math.sqrt,Aa=parseInt,Ha="annotations",wb="area",ub="backup",K="backwards",Ca="bit",tb="brake",qb="cached",ab="center",sa="clicked",Za="clicked_location",Ea="clicked_on",$a="clicked_row",ja="cwish",H="dimensions",v="fraction",Z="frame",qa="frames",db="head",Ga="hi",bb="hidden",Ua="image",Y="images",ba="opening_ticks",Fa="lo",Ta="options",eb="playing",aa="preloaded",ta="reeling",Ba="revolution",L="row",Wa="rows",
Qb="sequence",rb="spacing",Da="speed",Ya="stage",Va="steps",Xa="stitched",sb="stitched_travel",fb="stopped",pa="style",S="tempo",$="velocity",ia="vertical",Sb="wheel_step",T=s(w),U=".pan"+T,ac="mousedown"+T,$b="mouseenter"+T,jc="mouseleave"+U,ic="mousemove"+U,kc="mouseup"+U,Zb="mousewheel"+T,ma="tick"+T,hc="touchcancel"+U,gc="touchend"+U,Ub="touchstart"+T,fc="touchmove"+U,G="",B=" ",ca=",",La="absolute",oc="a",vb="block",ra="div",xb="hand",mb="height",Hb=na("000"),Bb="html",ga="id",Ra="img",jb="jquery."+
w,Ja="none",Eb="object",ib="opening",Fb="preload",X="px",lb="src",kb="string",bc="title",Sa="width",cc="x",dc="y",ec=Ob("CAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7")||wa("blank.gif"),Yb="wait",Wb=xa(wa(jb+s("cur")))+ca+"move",Vb=xa(wa(jb+"-drag"+s("cur")))+ca+"move",Xb=xa(wa(jb+"-drag-down"+s("cur")))+ca+"move",Tb=za?p:pc&&Oa<=8?1:0;o.touchy=o.re.touchy_agent.test(Kb);o.lazy=o.re.lazy_agent.test(Kb);Pb("disableTextSelect enableTextSelect".split(/ /));k.extend(k.fn,o.fn);k.fn.reelTriggerOnce=
function(f,j){return function q(r){j()?r.trigger(f):setTimeout(function(){q(r)},100);return r}(k(this))}}(jQuery,window,document);
