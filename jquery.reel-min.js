/*
 Copyright (c) 2009-2012 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 jQuery Reel
 http://jquery.vostrel.cz/reel
 Version: 1.1.3-devel
 Updated: 2012-01-28

 Requires jQuery 1.5 or higher
*/
jQuery.reel||function(k,Mb,Pa,p){function Nb(f){return o.instances.push(f[0])&&f}function Ob(f){return(o.instances=o.instances.not(oa(f.attr(ha))))&&f}function P(f){return o.instances.length?o.instances.first().data(f):null}function Pb(f){return"data:image/gif;base64,R0lGODlh"+f}function Q(f){return"<"+f+"/>"}function s(f){return"."+(f||"")}function xa(f){return o.cdn+f}function ya(f){return"url("+f+")"}function W(f,j,q){return pa(f,Qa(j,q))}function Qb(f){function j(){k.fn[this]||(k.fn[this]=function(){return this})}
k.each(f,j)}function Ra(f,j){return R(f)*(j?-1:1)}function za(f){return Aa?f.touch||f.originalEvent.touches[0]:f}function X(f){return f===p||typeof f==kb?f:f+Y}function oa(f){return"#"+f}function lb(f){try{console.warn("Deprecation - Please consult https://github.com/pisi/Reel/wiki/Deprecations")}catch(j){}return f}if(+k().jquery.replace(s(),"").substr(0,2)<15)throw"VersionError: far too old jQuery for running Reel";var o=k.reel={version:"1.2alpha",def:{area:p,brake:0.23,clickfree:false,cw:false,
delay:-1,directional:false,draggable:true,footage:6,entry:p,frame:1,frames:36,graph:p,hint:"",horizontal:true,image:p,images:[],indicator:0,inversed:false,klass:"",laziness:6,loops:true,monitor:p,opening:0,orbital:0,path:"",preloader:2,rebound:0.5,revolution:p,row:1,rows:0,spacing:0,speed:0,step:p,steps:p,stitched:0,suffix:"-reel",tempo:36,timeout:2,throwable:true,vertical:false,wheelable:true,annotations:p,attr:{},cursor:p,preload:"fidelity",scrollable:true,steppable:true,sequence:"",velocity:0},
fn:{reel:function(){var f=arguments,j=k(this),q=j.data(),r=f[0],t=f[1];if(f.length==2){if(t!==p){try{t=o.normal[r](t,q)}catch(F){}if(q[r]!==t)if(q[r]===p)q[r]=t;else j.trigger(r+"Change",[p,q[r]=t])}return j.trigger("store",[r,t])}else if(typeof r=="string"){t=q[r];j.trigger("recall",[r,t]);return t}else{var a=k.extend({},o.def,r),K=[];(function(i){var d=[];i.filter(Sa).each(function(){var c=k(this),u=a.images.length&&a.images||a.sequence||a.image||a.attr.src||c.attr(mb),D=Ba(a.attr.width||c.css(Ta)),
z=Ba(a.attr.height||c.css(nb));u&&u!=H&&D&&z&&d.push(c)});i.filter(s(w)).each(function(){d.push(k(this).unreel())});return k(d)})(this).each(function(){var i=k(this),d=function(b,e){return i.reel(b,e)&&e},c=function(b){return i.reel(b)},u={setup:function(){if(!i.hasClass(w)){d(Ua,a);var b=i.attr(a.attr).attr(mb),e=d(ha,i.attr(ha)||i.attr(ha,w+"-"+ +new Date).attr(ha)),h=i.attr(qa),g=k.extend({},i.data()),l=o.re.sequence.exec(d(Rb,a.sequence));l=d(Z,l?o.sequence(l,a,c):a.images);var n=a.stitched,m=
a.loops,y={x:Ba(i.css(Ta)||a.attr.width),y:Ba(i.css(nb)||a.attr.height)},A=d($,a.frame),S=d(ra,a.orbital&&a.footage||a.rows<=1&&l.length||a.frames),ia=n?1:ob(S/a.footage);e=oa(e+a.suffix);var pb=i.attr("class")||H;A=k(Q(sa),{id:e.substr(1),"class":pb+B+Sb+B+qb+A});A=i.wrap(A.addClass(a.klass)).attr({"class":w});K.push(Nb(A)[0]);A=A.parent().bind(u.instance);d(Va,l.length?H:a.image||b.replace(o.re.image,"$1"+a.suffix+".$2"));d(rb,[]);d(sb,a.spacing);d(I,y);d(v,0);d(Wa,a.steps||a.frames);d(Ca,a.revolution||
n/2||y.x*2);d(Xa,ia);d(Da,1/(S-(m&&!n?0:1)));d(Tb,1/pa(S,c(Wa)));d(Ya,n);d(tb,n-(m?0:y.x));d(Za,e);d(L,d(Ea,a.speed)<0);d(aa,a.velocity||0);d(ja,a.vertical);d(ba,0);d(M,(a.row-1)/(a.rows-1));d(ka,Ra(1,!a.cw&&!n));d($a,{});d(ta,false);d(Fa,d(ab,0));d(Ga,d(Ha,0));d(ua,false);d(ub,a.brake);d(bb,!!a.orbital);d(T,a.tempo/(o.lazy?a.laziness:1));d(ca,-1);d(Ia,a.annotations||A.unbind(s(Ia))&&{});d(vb,{src:b,classes:pb,style:h||H,data:g});a.steppable||A.unbind("click.steppable");C(H,{width:y.x,height:y.y,
overflow:cb,position:"relative"});C(da+B+s(w),{display:wb});N.bind(u.pool);i.trigger("setup")}},instance:{teardown:function(){var b=i.data(vb);i.parent().unbind(u.instance);c(qa).remove();c(xb).enableTextSelect();Ob(i.unbind(U).removeData().siblings().unbind(U).remove().end().attr({"class":b.classes,src:b.src,style:b.style}).data(b.data).unwrap());Ja();N.unbind(u.pool);O.unbind(V)},setup:function(){function b(n){return function(m){if(m.button==Ub)return m.preventDefault()||i.trigger("down",[za(m).clientX,
za(m).clientY])&&n}}var e=c(I),h=c(ra);h=pa(h,c(Wa));i.attr(ha);var g=i.parent();area=d(xb,k(a.area||g));if(Aa){C(B+s(w),{WebkitUserSelect:Ka,WebkitBackgroundSize:c(Z).length?p:c(Ya)&&X(c(Ya))+B+X(e.y)||X(e.x*a.footage)+B+X(e.y*c(Xa)*(a.rows||1)*(a.directional?2:1))});area.bind(Vb,b())}else{e=a.cursor==yb?Wb:a.cursor||Xb;var l=a.cursor==yb?Yb+B+"!important":p;C(H,{cursor:e});C(s(db),{cursor:Zb});C(s(La)+da+s(La)+" *",{cursor:l||e},true);area.bind(a.wheelable?$b:H,function(n,m){return n.preventDefault()||
!m||i.trigger("wheel",[m])&&false}).bind(a.clickfree?ac:bc,b()).disableTextSelect()}a.hint&&area.attr(cc,a.hint);a.indicator&&g.append(va(dc));a.rows>1&&a.indicator&&g.append(va(ec));a.monitor&&g.append(zb=k(Q(sa),{"class":Ab}))&&C(B+s(Ab),{position:Ma,left:0,top:0});C(B+s(Bb),{display:Ka});d(v,1/h*((a.step||a.frame)-1))},preload:function(){var b=c(I),e=i.parent(),h=c(Va),g=c(Z),l=!g.length,n=c(ra),m=o.preload[a.preload]||o.preload[o.def.preload];h=l?[h]:m(g.slice(0),a,c);d(ba,l?0.5:0);g=[];e.addClass(db).append(la());
for(i.trigger("stop");h.length;){var y=a.path+h.shift(),A=b.x*(!l?1:a.footage),S=b.y*(!l?1:n/a.footage)*(!a.directional?1:2),ia=k(Q(Sa)).attr({"class":Bb}).appendTo(e);setTimeout(function(){if(ia.parent().length){ia.attr({src:y,width:A,height:S});i.reelTriggerOnce("preloaded",function(){return!!ia.parent().length&&ia[0].complete})}},g.length-h.length);g.push(y)}d(rb,g);d(qa,k("<"+qa+' type="text/css">'+C.rules.join("\n")+"</"+qa+">").prependTo(eb))},preloaded:function(){var b=c(Z).length||1;if(d(ba,
Qa(c(ba)+1,b))===b){i.parent().removeClass(db);i.unbind(ba,u.instance.preloaded).trigger("loaded")}},loaded:function(){c(Z).length>1||i.css({backgroundImage:ya(a.path+c(Va))}).attr({src:fc})},opening:function(){if(!a.opening)return i.trigger("openingDone");var b=a.entry||a.speed,e=c(v),h=a.opening;d(v,e-b*a.opening);d(ca,h*P(T))},openingDone:function(){if(a.delay)J=setTimeout(function(){i.trigger("play")},a.delay*1E3);else i.trigger("play")},play:function(b,e){e=d(Ea,e||c(Ea));b=d(fb,!!e);d(gb,!b);
ea()},pause:function(){d(fb,false);E()},stop:function(){var b=d(gb,true);d(fb,!b)},down:function(b,e,h){function g(n){return function(m){m.preventDefault();i.trigger("pan",[za(m).clientX,za(m).clientY,m]);return n}}function l(n){return function(m){m.preventDefault();i.trigger("up");return n}}if(a.draggable){d(ta,c($));d(aa,0);b=!c(ua)||a.rows<=1||!a.orbital||a.scrollable;Na=Oa(e,h,c(v),c(Ca),c(M));E();Ja();x=false;k(Cb,O).addClass(La);Aa?O.bind(gc,g(!b)).bind(hc+B+ic,l()):O.bind(jc,g()).bind(a.clickfree?
kc:lc,l())}},up:function(){if(a.draggable){d(ta,false);d(ua,false);var b=d(aa,!a.throwable?0:R(wa[0]+wa[1])/60);fa=b?1:0;b?ea():E();Ja();k(Cb,O).removeClass(La);O.unbind(V)}},pan:function(b,e,h,g){if(a.draggable&&hb){hb=false;E();b=g&&!k(g.currentTarget).is(N)?mc.offset():{left:0,top:0};e-=b.left;h-=b.top;var l={x:e-Na.x,y:h-Na.y};if(R(l.x)>0||R(l.y)>0){x=true;Na={x:e,y:h};b=c(Ca);g=c($a);var n=c(ja),m=Db(n?h-g.y:e-g.x,c(Fa),b,c(Ga),c(Ha),c(ka),n?h-g.y:e-g.x);d(ua,c(ua)||c($)!=c(ta));(l=Eb(n?l.y:
l.x||0))&&d(L,l<0);if(a.orbital&&c(bb)){d(ja,R(h-g.y)>R(e-g.x));g=Oa(e,h,m,b,c(M))}if(a.rows>1){l=c(I).y;l=a.rows>3?l:l/(5-a.rows);n=c(ab);var y=-n*l;d(M,o.math.envelope(h-g.y,n,l,y,y+l,-1))}!(m%1)&&!a.loops&&Oa(e,h,m,b,c(M));d(v,m)}}},wheel:function(b,e){b=ob(nc(R(e))/2);b=Ra(b,e>0);e=0.0833*c(Ca);Oa(p,p,c(v),e,c(M));b&&d(L,b<0);d(aa,0);d(v,Db(b,c(Fa),e,c(Ga),c(Ha),c(ka)));E();i.trigger("up");return false},fractionChange:function(b,e,h){if(e!==p)return lb(d(v,e));b=1+ma(h/c(Da));e=a.rows>1;var g=
a.orbital;d(bb,!!g&&(b<=g||b>=a.footage-g+2));if(!a.loops&&a.rebound){!z&&!(h%1)?ib++:(ib=0);ib>=a.rebound*1E3/P(T)&&d(L,!c(L))}if(e){h=W(0,a.rows-1,ma(c(M)*a.rows));b+=h*a.frames}d($,b)},rowChange:function(b,e,h){if(e!==p)return d(M,e);b=c(ra);b=c($)%b||b;h=W(0,a.rows-1,ma(h*a.rows));d($,b+h*a.frames)},frameChange:function(b,e,h){if(e!==p)return lb(d($,e));b=c(v);var g=a.footage;if(a.orbital&&c(ja)){h=a.inversed?g+1-h:h;h+=g}var l=a.horizontal,n=c(Z),m=!n.length;e=c(I);if(m){if(a.stitched)e=[-ga(b*
c(tb))+Y,0+Y];else{m=h%g-1;m=m<0?g-1:m;g=ma((h-0.1)/g);g+=a.rows>1?0:c(L)?0:c(Xa);h=c(sb);g=g*((l?e.y:e.x)+h);e=m*((l?e.x:e.y)+h);e=n.length?[0,0]:l?[-e+Y,-g+Y]:[-g+Y,-e+Y]}i.css({backgroundPosition:e.join(B)})}else i.attr({src:a.path+n[h-1]});if(a.indicator){c(Za);l=a.rows>1;e=c(I);n=(c(ja)?e.y:e.x)-a.indicator;b=W(0,n,ga(o.math.interpolate(b,-1,n+2)));b=!a.cw||a.stitched?b:n-b;va.$x.css(c(ja)?{left:0,top:b}:{left:b,top:e.y-a.indicator});if(l){b=e.y-a.indicator;b=W(0,b,ga(o.math.interpolate(c(M),
-1,b+2)));va.$y.css({top:b})}}},stepLeft:function(){E();d(L,false);d(v,c(v)-c(Da)*c(ka))},stepRight:function(){E();d(L,true);d(v,c(v)+c(Da)*c(ka))},"click.steppable":function(b){if(x)return D(b,false);i.trigger(b.clientX-i.offset().left>0.5*c(I).x?"stepRight":"stepLeft")},"setup.annotations":function(){c(I);var b=i.parent();k.each(c(Ia),function(e,h){var g=typeof h.node==kb?k(h.node):h.node||{};g=g.jquery?g:k(Q(sa),g);g=g.attr({id:e}).addClass(oc);var l=h.image?k(Q(Sa),h.image):k(),n=h.link?k(Q(pc),
h.link):k();C(oa(e),{display:Ka,position:Ma},true);g.bind({"click.annotations":function(m){m.stopPropagation()}});h.image||h.link&&g.append(n);h.link||h.image&&g.append(l);h.link&&h.image&&g.append(n.append(l));g.appendTo(b)})},"frameChange.annotations":function(b,e){this.className=this.className.replace(o.re.frame_klass,qb+e);c(aa)||k.each(c(Ia),function(h,g){h=k(oa(h));var l=g.start||1,n=g.end,m=e-1,y=g.at?g.at[m]=="+":false;m=g.at?m:m-l+1;var A=typeof g.x!=Fb?g.x:g.x[m],S=typeof g.y!=Fb?g.y:g.y[m];
g={display:A!==p&&S!==p&&(g.at?y:m>=0&&(!n||m<=n-l))?wb:Ka,left:X(A)||0,top:X(S)||0};h.css(g)})},"setup.fu":function(){i.trigger("preload")},"loaded.fu":function(){i.trigger("opening")}},pool:{"tick.reel":function(b){var e=c(aa);if(fa){e=e-c(ub)/P(T)*fa;e=d(aa,e>0.1?e:(fa=z=0))}a.monitor&&zb.text(c(a.monitor));e&&fa++;z&&z++;Eb(0);hb=true;if(z&&!e)return D(b);if(c(ta))return D(b,E());if(!(c(ca)>0)){b=c(ka)*Ra(1,c(L));e=(c(gb)?e:R(c(Ea))+e)/P(T);d(v,c(v)-e*b)}},"tick.reel.preload":function(){var b=
c(I),e=parseInt(la.$.css(Ta)),h=c(Z).length||1,g=ga(1/h*c(ba)*b.x);la.$.css({width:e+(g-e)/3+1});if(c(ba)===h&&e>b.x-2){la.$.fadeOut(300,function(){la.$.remove()});N.unbind(na+s(Gb),u.pool[na+s(Gb)])}},"tick.reel.opening":function(){var b=na+s(jb);if(!a.opening||!c(ca))return N.unbind(b,u.pool[b]);b=(a.entry||a.speed)/P(T)*(a.cw?-1:1);var e=d(ca,c(ca)-1);d(v,c(v)+b);e||i.trigger("openingDone")}}},D=function(b,e){return b.stopImmediatePropagation()||e},z,fa=0,ea=function(){return z=0},E=function(){clearTimeout(J);
N.unbind(na+s(jb),u.pool[na+s(jb)]);d(ca,0);i.trigger("play");return z=-a.timeout*P(T)},x=false,J,zb=k(),la=function(){C(B+s(Hb),{position:Ma,left:0,top:c(I).y-a.preloader,height:a.preloader,overflow:cb,backgroundColor:Ib});return la.$=k(Q(sa),{"class":Hb})},va=function(b){C(B+s(Jb)+s(b),{position:Ma,width:a.indicator,height:a.indicator,overflow:cb,backgroundColor:Ib});return va["$"+b]=k(Q(sa),{"class":Jb+B+b})},C=function(b,e,h){function g(l){var n=[];k.each(l,function(m,y){n.push(m.replace(/([A-Z])/g,
"-$1").toLowerCase()+":"+X(y)+";")});return"{"+n.join(H)+"}"}h=h?H:c(Za);b=b.replace(/^/,h).replace(da,da+h);return C.rules.push(b+g(e))&&e},ib=0,Na={x:0,y:0},Eb=function(b){return wa.push(b)&&wa.shift()&&b},Ja=function(){return wa=[0,0]},wa=Ja(),Db=a.graph||o.math[a.loops?"hatch":"envelope"],Oa=function(b,e,h,g,l){d(Fa,h);d(ab,l);d(Ga,a.loops?0:-h*g);d(Ha,a.loops?g:g-h*g);return b&&d($a,{x:b,y:e})||p},hb=true,O;try{O=k.unique(N.add(Mb.top.document))}catch(rc){O=N}var mc=top===self?k():function(b){k("iframe",
O.last()).each(function(){try{if(k(this).contents().find(eb).html()==k(eb).html())return(b=k(this))&&false}catch(e){}});return b}();C.rules=[];u.setup()});Kb=Kb||function i(){var d=+new Date,c=P(T),u;if(c){N.trigger(na);o.cost=(+new Date+o.cost-d)/2;u=setTimeout(i,pa(4,1E3/c-o.cost))}return u}();return k(K)}},unreel:function(){return this.trigger("teardown")}},re:{image:/^(.*)\.(jpg|jpeg|png|gif)$/,touchy_agent:/iphone|ipod|ipad|android/i,lazy_agent:/iphone|ipod|android/i,frame_klass:/frame-\d+/,
sequence:/(^[^#|]*([#]+)[^#|]*)($|[|]([0-9]+)\.\.([0-9]+))($|[|]([0-9]+)$)/},cdn:"http://code.vostrel.cz/",math:{envelope:function(f,j,q,r,t,F){return j+pa(r,Qa(t,-f*F))/q},hatch:function(f,j,q,r,t,F){f=(f<r?t:0)+f%t;f=j+-f*F/q;return f-ma(f)},interpolate:function(f,j,q){return j+f*(q-j)}},preload:{linear:function(f){return f},fidelity:function(f,j){function q(i,d,c){function u(J){for(;!(J>=1&&J<=ea);)J+=J<1?+ea:-ea;return K[c+J]||(K[c+J]=!!D.push(J))}if(!i.length)return[];var D=[],z=4*d,fa=j.frame,
ea=i.length;d=true;for(var E=ea/z,x=0;x<z;x++)u(fa+ga(x*E));for(;E>1;){x=0;z=D.length;E/=2;for(d=!d;x<z;x++)u(D[x]+(d?1:-1)*ga(E))}for(x=0;x<D.length;x++)D[x]=i[D[x]-1];return D}var r=j.orbital?2:j.rows||1,t=j.orbital?j.footage:j.frames,F=(j.row-1)*t,a=[].concat(f),K=new Array(f.length);f=r<2?[]:a.slice(F,F+t);return q(f,1,F).concat(q(a,r,0))}},normal:{fraction:function(f,j){return j[Ua].loops?f-ma(f):W(0,1,f)},row:function(f){return W(0,1,f)},frame:function(f,j){var q=j[Ua];j=j[ra]*(q.orbital?2:
q.rows||1);f=ga(q.loops?f%j||j:W(1,j,f));return f<0?f+j:f}},sequence:function(f,j){function q(i,d,c){for(;i.length<d;)i=c+i;return i}if(f.length<=1)return j.images;var r=[],t=f[1],F=f[2],a=+f[4]||1,K=j.orbital?2:j.rows||1;j=j.orbital?j.footage:j.frames;K=+(f[5]||K*j);f=+f[7]||1;for(j=0;j<K;){r.push(t.replace(F,q(a+j+H,F.length,"0")));j+=f}return r},instances:k(),leader:P,cost:0},N=k(Pa);Pa=+k.browser.version.split(s()).slice(0,2).join(s());var qc=k.browser.msie,Lb=navigator.userAgent,Kb,w="reel",
Sb=w+"-overlay",Jb=w+"-indicator",Hb=w+"-preloader",Bb=w+"-cached",Ab=w+"-monitor",oc=w+"-annotation",La=w+"-panning",db=w+"-loading",qb="frame-",G=Math,ga=G.round,ma=G.floor,ob=G.ceil,Qa=G.min,pa=G.max,R=G.abs,nc=G.sqrt,Ba=parseInt,Ia="annotations",xb="area",vb="backup",L="backwards",Da="bit",ub="brake",rb="cached",bb="center",ta="clicked",$a="clicked_location",Fa="clicked_on",ab="clicked_row",ka="cwish",I="dimensions",v="fraction",$="frame",ra="frames",eb="head",Ha="hi",cb="hidden",Va="image",Z=
"images",ca="opening_ticks",Ga="lo",Ua="options",fb="playing",ba="preloaded",ua="reeling",Ca="revolution",M="row",Xa="rows",Rb="sequence",sb="spacing",Ea="speed",Za="stage",Wa="steps",Ya="stitched",tb="stitched_travel",gb="stopped",qa="style",T="tempo",aa="velocity",ja="vertical",Tb="wheel_step",U=s(w),V=".pan"+U,bc="mousedown"+U,ac="mouseenter"+U,kc="mouseleave"+V,jc="mousemove"+V,lc="mouseup"+V,$b="mousewheel"+U,na="tick"+U,ic="touchcancel"+V,hc="touchend"+V,Vb="touchstart"+U,gc="touchmove"+V,H=
"",B=" ",da=",",Ma="absolute",pc="a",wb="block",sa="div",yb="hand",nb="height",Ib=oa("000"),Cb="html",ha="id",Sa="img";G="jquery."+w;var Ka="none",Fb="object",jb="opening",Gb="preload",Y="px",mb="src",kb="string",cc="title",Ta="width",dc="x",ec="y",fc=Pb("CAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7")||xa("blank.gif"),Zb="wait",Xb=ya(xa(G+s("cur")))+da+"move",Wb=ya(xa(G+"-drag"+s("cur")))+da+"move",Yb=ya(xa(G+"-drag-down"+s("cur")))+da+"move",Aa=o.touchy=o.re.touchy_agent.test(Lb);o.lazy=
o.re.lazy_agent.test(Lb);var Ub=Aa?p:qc&&Pa<=8?1:0;Qb("disableTextSelect enableTextSelect".split(/ /));k.extend(k.fn,o.fn);k.fn.reelTriggerOnce=function(f,j){return function q(r){j()?r.trigger(f):setTimeout(function(){q(r)},100);return r}(k(this))}}(jQuery,window,document);
