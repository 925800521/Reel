/*
 Copyright (c) 2009-2011 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 jQuery Reel
 http://jquery.vostrel.cz/reel
 Version: 1.2alpha
 Updated: 2011-12-30

 Requires jQuery 1.4.3 or higher
*/
jQuery.reel||function(g,Hb,Ja,q){function K(e){return g.reel.instances.length?g.reel.instances.first().data(e):null}function Ib(e){return g.reel.instances.push(e[0])&&e}function Jb(e){return(g.reel.instances=g.reel.instances.not(ha(e.attr(Y))))&&e}function Kb(e){return"data:image/gif;base64,R0lGODlh"+e}function Q(e){return"<"+e+"/>"}function p(e){return"."+(e||"")}function qa(e){return g.reel.cdn+e}function ra(e){return"url("+e+")"}function Z(e,a,n){return ia(e,eb(a,n))}function Lb(e){function a(){g.fn[this]||
(g.fn[this]=function(){return this})}g.each(e,a)}function Ka(e,a){return L(e)*(a?-1:1)}function sa(e){return e.originalEvent.touches[0]}function R(e){return e===q||typeof e=="string"?e:e+S}function ha(e){return"#"+e}function Mb(e){var a=[];g.each(e,function(n,h){a.push(n.replace(/([A-Z])/g,"-$1").toLowerCase()+":"+R(h))});return"{"+a.join(";")+";}"}function Nb(){var e=g().jquery.split(".");if(e=+e[0]<=1&&(+e[1]<4||+e[1]==4&&+e[2]<3))try{console.error("FATAL: jQuery Reel plug-in requires at least jQuery 1.4.3")}catch(a){}return e}
if(!Nb()){g.reel={version:"1.2alpha",def:{area:q,brake:0.23,clickfree:false,cw:false,delay:-1,directional:false,draggable:true,footage:6,entry:q,frame:1,frames:36,graph:q,hint:"",horizontal:true,image:q,images:[],indicator:0,inversed:false,klass:"",laziness:6,loops:true,monitor:q,opening:0,orbital:0,path:"",preloader:4,rebound:0.5,revolution:q,row:1,rows:0,spacing:0,speed:0,step:q,steps:q,stitched:0,suffix:"-reel",tempo:36,timeout:2,throwable:true,vertical:false,wheelable:true,annotations:q,attr:{},
cursor:q,preload:"fidelity",scrollable:true,steppable:true,velocity:0}};g.fn.reel=function(e){var a=g.extend({},g.reel.def,e);e=function(h){var t=[];h.filter(La).each(function(){var d=g(this),c=a.images.length&&a.images||a.image||a.attr.src||d.attr(fb),A=ta(a.attr.width||d.css(gb)),o=ta(a.attr.height||d.css(hb));!c||c==$||!A||!o||t.push(d)});h.filter(p(w)).each(function(){t.push(g(this).unreel())});return g(t)}(this);var n=[];a.tooltip&&(a.hint=a.tooltip);a.hotspot&&(a.area=a.hotspot);e.each(function(){var h=
g(this),t=h.data(),d=function(i,b){t[i]=b;h.trigger("store",[i,b]);return b},c=function(i){var b=t[i];h.trigger("recall",[i,b]);return b},A={setup:function(i){if(h.hasClass(w))return o.call(i);var b=h.attr(a.attr).attr(fb),f=d(Y,h.attr(Y)||h.attr(Y,w+"-"+ +new Date).attr(Y)),j=h.attr(ja),l=g.extend({},h.data()),m=a.images,k=a.stitched,u=a.loops,y={x:ta(h.css(gb)||a.attr.width),y:ta(h.css(hb)||a.attr.height)},r=d(F,a.frame),aa=d(ua,a.orbital&&a.footage||a.rows<=1&&m.length||a.frames),ba=k?1:ib(aa/
a.footage);f=ha(f+a.suffix);var va=h.attr("class")||"";r=g(Q(ka),{id:f.substr(1),"class":va+B+Ob+B+jb+r});r=h.wrap(r.addClass(a.klass)).attr({"class":w});n.push(Ib(r)[0]);r=r.parent().bind(A.instance);d(kb,m.length&&m.length||a.image||b.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2"));d(lb,[]);d(F,a.frame);d(Ma,0);d(mb,a.spacing);d(M,y);d(s,0);d(Na,a.steps||a.frames);d(wa,a.revolution||k/2||y.x*2);d(Oa,ba);d(ca,1/(aa-(u&&!k?0:1)));d(Pb,1/ia(aa,c(Na)));d(Pa,k);d(nb,k-(u?0:y.x));d(Qa,f);d(I,
d(xa,a.speed)<0);d(T,a.velocity||0);d(da,a.vertical);d(J,(a.row-1)/(a.rows-1));d(ea,Ka(1,!a.cw&&!k));d(la,false);d(ob,a.brake);d(Ra,!!a.orbital);d(N,a.tempo/(g.reel.lazy?a.laziness:1));d(U,-1);d(Sa,a.annotations)||r.unbind(".annotations");d(pb,{src:b,classes:va,style:j||$,data:l});a.steppable||r.unbind("click.steppable");C(true,$,{width:y.x,height:y.y,overflow:Ta});C(true,V+p(w),{display:qb,position:"relative"});O.bind(A.pool);o.call(i);h.trigger("setup")},instance:{teardown:function(i){var b=h.data(pb);
h.parent().unbind(A.instance).children(La).unbind(x);c(ja).remove();h.unbind(x).attr({"class":b.classes,src:b.src,style:b.style}).removeClass(w);h.data(b.data).siblings().remove();h.unwrap();Jb(h);ya();O.unbind(A.pool);fa.unbind(Ua).unbind(Va);o.call(i)},setup:function(){var i=c(M),b=c(ua),f=ia(b,c(Na));f=d(s,1/f*((a.step||a.frame)-1));d(F,W(f*b)+1);h.attr(Y);b=h.parent();var j=!c(la)||a.rows<=1||!a.orbital||a.scrollable;f=d(Qb,g(a.area||b));if(g.reel.touchy){C(true,B+p(w),{WebkitUserSelect:za,WebkitBackgroundSize:a.images.length?
"auto":c(Pa)&&R(c(Pa))+B+R(i.y)||R(i.x*a.footage)+B+R(i.y*c(Oa)*(a.rows||1)*(a.directional?2:1))});f.bind(Rb,function(k){h.trigger("down",[sa(k).clientX,sa(k).clientY,true])}).bind(Sb,function(k){h.trigger("pan",[sa(k).clientX,sa(k).clientY,true]);return!j}).bind(Tb,function(){h.trigger("up",[true]);return false}).bind(Ub,function(){h.trigger("up",[true]);return false})}else{var l=a.cursor==rb?ra(Vb)+V+Wa:a.cursor||ra(Wb)+V+Wa,m=a.cursor==rb?ra(Xb)+V+Wa+" !important":false;C(true,$,{cursor:l});C(true,
p(Xa),{cursor:Yb});C(false,p(Aa)+V+p(Aa)+" *",{cursor:m||l});f.bind(a.wheelable?Zb:$,function(k,u){h.trigger("wheel",[u]);return false}).bind(a.clickfree?$b:ac,function(k){if(!(bc?!k.button:!!k.button)){h.trigger("down",[k.clientX,k.clientY]);return false}}).bind(a.clickfree?cc:$,function(){h.trigger("up");return false}).disableTextSelect()}a.hint&&f.attr(dc,a.hint);a.monitor&&b.append(v=g(Q(ka),{"class":sb}))||(v=g());C(true,B+p(sb),{position:Ba,left:0,top:0});C(true,B+p(tb),{display:za});C(true,
B+p(ub),{position:Ba,left:0,top:i.y-a.preloader,height:a.preloader,overflow:Ta,backgroundColor:vb});a.indicator&&b.append(wb(xb));a.rows>1&&a.indicator&&b.append(wb(yb))},preload:function(i){var b=c(M),f=h.parent(),j=c(kb),l=a.images,m=!l.length,k=c(ua),u=g.reel.preload[a.preload]||g.reel.preload[g.reel.def.preload];u=m?[j]:u(l,a,c);var y=[],r=h[0];r.frames=u.length;r.preloaded=0;f.addClass(Xa).append(D=g(Q(ka),{"class":ub}));for(h.trigger("stop");u.length;){var aa=a.path+u.shift(),ba=b.x*(!m?1:a.footage),
va=b.y*(!m?1:k/a.footage)*(!a.directional?1:2);ba=g(new Image).addClass(tb).attr({width:ba,height:va}).bind("load"+x,function(){r.preloaded++;g(this).unbind(x);D.css({width:1/r.frames*r.preloaded*b.x});if(r.frames==r.preloaded){D.remove();l.length||h.css({backgroundImage:ra(a.path+j)}).attr({src:ec});f.removeClass(Xa);h.trigger("loaded");o.call(i)}});f.append(ba);y.push(aa);setTimeout(function(fc,gc){return function(){fc.attr({src:gc})}}(ba,aa),0)}d(lb,y);d(ja,g("<"+ja+' type="text/css">'+zb.join("\n")+
"</"+ja+">").prependTo("head"))},opening:function(){if(!a.opening)return h.trigger("openingDone");var i=a.entry||a.speed,b=c(s),f=a.opening;d(s,b-i*a.opening);d(U,f*K(N))},openingDone:function(){X=setTimeout(function(){h.trigger("play")},a.delay*1E3||0)},play:function(i,b){b=d(xa,b||c(xa));b=d(Ya,!!b);d(Za,!b);G();o.call(i)},pause:function(i){d(Ya,false);z();o.call(i)},stop:function(i){var b=d(Za,true);d(Ya,!b);o.call(i)},down:function(i,b,f,j){if(a.draggable){d(Ca,c(F));d(T,0);Da=Ea(b,f,c(s),c(wa),
c(J));z();ya();ma=false;Ab.addClass(Aa);if(!j){fa.bind(Va,function(l){h.trigger("pan",[l.clientX,l.clientY]);o.call(l);return false});a.clickfree||fa.bind(Ua,function(l){h.trigger("up");o.call(l)})}}o.call(i)},up:function(i,b){if(!a.draggable)return o.call(i);d(Ca,false);d(la,false);var f=d(T,!a.throwable?0:L(na[0]+na[1])/60);P=f?1:0;f?G():z();ya();Ab.removeClass(Aa);!b&&fa.unbind(Ua).unbind(Va);o.call(i)},pan:function(i,b,f){if(a.draggable&&$a){$a=false;z();var j={x:b-Da.x,y:f-Da.y};if(L(j.x)>0||
L(j.y)>0){ma=true;Da={x:b,y:f};var l=c(wa),m=c(Bb),k=c(da),u=d(s,Cb(k?f-m.y:b-m.x,c(ab),l,c(bb),c(cb),c(ea),k?f-m.y:b-m.x));d(la,c(la)||c(F)!=c(Ca));(j=Db(k?j.y:j.x||0))&&d(I,j<0);if(a.orbital&&c(Ra)){d(da,L(f-m.y)>L(b-m.x));m=Ea(b,f,u,l,c(J))}if(a.rows>1){j=c(M).y;k=c(Eb);var y=-k*j;d(J,g.reel.math.envelope(f-m.y,k,j,y,y+j,-1))}!(u%1)&&!a.loops&&Ea(b,f,u,l,c(J));h.trigger("fractionChange")}}o.call(i)},wheel:function(i,b){var f=ib(hc(L(b))/2);f=Ka(f,b>0);b=0.0833*c(wa);Ea(q,q,c(s),b,c(J));d(s,Cb(f,
c(ab),b,c(bb),c(cb),c(ea)));f&&d(I,f<0);d(T,0);z();o.call(i);h.trigger("fractionChange");return false},fractionChange:function(i,b){b=d(s,Fa.fraction(b,a,c));var f=d(F,1+ga(b/c(ca))),j=a.rows>1,l=a.orbital;d(Ra,!!l&&(f<=l||f>=a.footage-l+2));if(!a.loops&&a.rebound){!H&&!(b%1)?db++:(db=0);db>=a.rebound*1E3/K(N)&&d(I,!c(I))}h.trigger(j?"rowChange":"frameChange");o.call(i)},rowChange:function(i,b){var f=c(s)/c(ca)+1;b=d(J,Fa.row(b,a,c));b=Z(0,a.rows-1,ga(b*a.rows));d(F,ga(f+b*a.frames));o.call(i);h.trigger("frameChange")},
frameChange:function(i,b){var f=d(s,Fa.fraction(!b?q:c(ca)*(b-1),a,c));b=Fa.frame(b,a,c);var j=a.footage;if(c(da)){b=a.inversed?j+1-b:b;b+=j}if(b==c(Ma))E(i);else{var l=a.horizontal,m=a.images,k=c(M);b=d(Ma,d(F,b));if(m.length)h.attr({src:a.path+m[b-1]});else{if(a.stitched)k=[-W(f*c(nb))+S,0+S];else{f=b%j-1;f=f<0?j-1:f;j=ga((b-0.1)/j);j+=a.rows>1?0:c(I)?0:c(Oa);b=c(mb);j=j*((l?k.y:k.x)+b);k=f*((l?k.x:k.y)+b);k=m.length?[0,0]:l?[-k+S,-j+S]:[-j+S,-k+S]}h.css({backgroundPosition:k.join(B)})}}if(a.indicator){l=
c(Qa);m=a.rows>1;k=c(M);f=(c(da)?k.y:k.x)-a.indicator;b=Z(0,f,W(g.reel.math.interpolate(c(s),-1,f+2)));b=!a.cw||a.stitched?b:f-b;g(p(Ga+p(xb)),l).css(c(da)?{left:0,top:b}:{left:b,top:k.y-a.indicator});if(m){k=k.y-a.indicator;k=Z(0,k,W(g.reel.math.interpolate(c(J),-1,k+2)));g(p(Ga+p(yb)),l).css({top:k})}}o.call(i)},stepLeft:function(){z();d(I,false);h.trigger("fractionChange",c(s)-c(ca)*c(ea))},stepRight:function(){z();d(I,true);h.trigger("fractionChange",c(s)+c(ca)*c(ea))},"click.steppable":function(i){if(ma)return E(i);
h.trigger(i.clientX-h.offset().left>0.5*c(M).x?"stepRight":"stepLeft")},"setup.annotations":function(){c(M);var i=h.parent();g.each(c(Sa),function(b,f){var j=g(Q(ka),f.node).attr({id:b}).addClass(ic),l=f.image?g(Q(La),f.image):g(),m=f.link?g(Q(jc),f.link):g();C(false,ha(b),{display:za,position:Ba});m.bind({"click.annotations":function(k){k.stopPropagation()}});f.image||f.link&&j.append(m);f.link||f.image&&j.append(l);f.link&&f.image&&j.append(m.append(l));j.appendTo(i)});h.trigger("frameChange.annotations")},
"frameChange.annotations":function(i,b){b=b||c(F);this.className=this.className.replace(kc,jb+b);c(T)||g.each(c(Sa),function(f,j){f=g(ha(f));var l=j.start||1,m=j.end,k=b-1,u=j.at?j.at[k]=="+":false;k=j.at?k:k-l+1;var y=typeof j.x!=Fb?j.x:j.x[k],r=typeof j.y!=Fb?j.y:j.y[k];j={display:y!==q&&r!==q&&(j.at?u:k>=0&&(!m||k<=m-l))?qb:za,left:R(y)||0,top:R(r)||0};f.css(j)})},"setup.fu":function(){h.trigger("preload")},"loaded.fu":function(){h.trigger("opening")}},pool:{"tick.reel":function(i){var b=c(T);
if(P){var f=b-c(ob)/K(N)*P;b=d(T,f>0.1?f:(P=H=0))}v.text(c(a.monitor));b&&P++;H&&H++;Db(0);$a=true;if(H&&!b)return E(i);if(c(Ca))return E(i,z());if(!(c(U)>0)){f=c(ea)*Ka(1,c(I));b=(c(Za)?b:L(c(xa))+b)/K(N);var j=c(s);d(s,j-b*f);o.call(i)}},"tick.reel.opening":function(i){if(a.opening){if(c(U)<=0)return;var b=(a.entry||a.speed)/K(N)*(a.cw?-1:1),f=c(s);d(s,f+b);b=d(U,c(U)-1);o.call(i);if(b>0)return;h.trigger("openingDone")}O.unbind(oa+p(Ha),A.pool[oa+p(Ha)])},"tick.reel.fu":function(){h.trigger("fractionChange")}}},
o=function(i){Gb||delete this;return i},E=function(i,b){return i.stopImmediatePropagation()||o.call(i)||b},H,P=0,G=function(){return H=0},z=function(){clearTimeout(X);O.unbind(oa+p(Ha),A.pool[oa+p(Ha)]);d(U,0);h.trigger("play");return H=-a.timeout*K(N)},ma=false,X,v,D,wb=function(i){C(true,B+p(Ga)+p(i),{position:Ba,width:a.indicator,height:a.indicator,overflow:Ta,backgroundColor:vb});return g(Q(ka),{"class":[Ga,i].join(B)})},zb=[],C=function(i,b,f){var j=c(Qa);b=b.split(V);i&&g.each(b,function(l,
m){b[l]=j+m});zb.push(b.join(V)+Mb(f));return f},db=0,Da={x:0,y:0},Db=function(i){return na.push(i)&&na.shift()&&i},ya=function(){return na=[0,0]},na=ya(),Cb=a.graph||g.reel.math[a.loops?"hatch":"envelope"],Fa=g.reel.normal,Ea=function(i,b,f,j,l){d(ab,f);d(Eb,l);d(bb,a.loops?0:-f*j);d(cb,a.loops?j:j-f*j);return i&&d(Bb,{x:i,y:b})||q},$a=true,fa;try{fa=g.browser.opera?O:g.unique(O.add(Hb.top.document))}catch(lc){fa=O}A.setup()});Ia=Ia||function h(){var t=+new Date,d=K(N);if(d){O.trigger(oa);g.reel.cost=
(+new Date+g.reel.cost-t)/2;return Ia=setTimeout(h,ia(4,1E3/d-g.reel.cost))}else return Ia=q}();return g(n)};g.fn.unreel=function(){return this.trigger("teardown")};g.reel.math={envelope:function(e,a,n,h,t,d){return a+ia(h,eb(t,-e*d))/n},hatch:function(e,a,n,h,t,d){e=(e<h?t:0)+e%t;e=a+-e*d/n;return e-ga(e)},interpolate:function(e,a,n){return a+e*(n-a)}};g.reel.preload={linear:function(e){return e},fidelity:function(e,a){function n(o,E,H){function P(D){for(;!(D>=1&&D<=X);)D+=D<1?+X:-X;return A[H+D]||
(A[H+D]=!!G.push(D))}if(!o.length)return[];var G=[],z=4*E,ma=a.frame,X=o.length;E=X/z;for(var v=0;v<z;v++)P(ma+W(v*E));for(;E>1;){v=0;z=G.length;for(E/=2;v<z;v++)P(W(G[v]+E))}for(v=0;v<G.length;v++)G[v]=o[G[v]-1];return G}var h=a.orbital?2:a.rows||1,t=a.orbital?a.footage:a.frames,d=(a.row-1)*t,c=[].concat(e),A=new Array(e.length);e=h<2?[]:c.slice(d,d+t);return n(e,1,d).concat(n(c,h,0))}};g.reel.normal={fraction:function(e,a,n){e=e!=q?e:n(s);return a.loops?e-ga(e):Z(0,1,e)},row:function(e,a,n){return Z(0,
1,e!=q?(e-1)/(a.rows-1):n(J))},frame:function(e,a,n){e=e!=q?W(e):n(F);var h=a.orbital?2:a.rows||1;n=n(ua)*h;e=a.loops?e%n||n:Z(1,n,e);return e<0?e+n:e}};g.reel.touchy=/iphone|ipod|ipad|android/i.test(navigator.userAgent);g.reel.lazy=/iphone|ipod|android/i.test(navigator.userAgent);g.reel.cdn="http://code.vostrel.cz/";g.reel.instances=g();g.reel.cost=0;g.reel.leader=K;Lb("mousewheel disableTextSelect enableTextSelect".split(/ /));var O=g(Ja),Ab=g("html");Ja=+g.browser.version.split(p()).slice(0,2).join(p());
var Gb=g.browser.msie,pa=navigator.userAgent;pa={linux:/linux/i.test(pa),windows:/windows/i.test(pa),mac:/macintosh/i.test(pa)};var bc=Gb&&Ja<=8,Ia,w="reel",Ob=w+"-overlay",Ga=w+"-indicator",ub=w+"-preloader",tb=w+"-cached",sb=w+"-monitor",ic=w+"-annotation",Aa=w+"-panning",Xa=w+"-loading",jb="frame-",kc=/frame-\d+/,W=Math.round,ga=Math.floor,ib=Math.ceil,eb=Math.min,ia=Math.max,L=Math.abs,hc=Math.sqrt,ta=parseInt,Sa="annotations",Qb="area",pb="backup",I="backwards",ca="bit",ob="brake",Ra="center",
Ca="clicked",Bb="clicked_location",ab="clicked_on",Eb="clicked_row",ea="cwish",M="dimensions",s="fraction",F="frame",Ma="_frame",ua="frames",cb="hi",Ta="hidden",kb="image",lb="images",U="opening_ticks",bb="lo",Ya="playing",la="reeling",wa="revolution",J="row",Oa="rows",mb="spacing",xa="speed",Qa="stage",Na="steps",Pa="stitched",nb="stitched_travel",Za="stopped",ja="style",N="tempo",T="velocity",da="vertical",Pb="wheel_step",x=".reel",ac="mousedown"+x,$b="mouseenter"+x,cc="mouseleave"+x,Va="mousemove"+
x,Ua="mouseup"+x,Zb="mousewheel"+x,oa="tick"+x,Ub="touchcancel"+x,Tb="touchend"+x,Rb="touchstart"+x,Sb="touchmove"+x,$="",B=" ",V=",",Ba="absolute",jc="a",qb="block",ka="div",rb="hand",hb="height",vb=ha("000"),Y="id",La="img",Wa="move",za="none",Fb="object",Ha="opening",S="px",fb="src",dc="title",gb="width",xb="x",yb="y",ec=Kb("CAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7")||qa("blank.gif"),Yb="wait",Wb=qa("jquery.reel-"+(pa.mac?"black":"white")+p("cur")),Vb=qa("jquery.reel-drag"+p("cur")),
Xb=qa("jquery.reel-drag-down"+p("cur"))}}(jQuery,window,document);
