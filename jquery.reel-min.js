/* Copyright (c) 2009-2010 Petr Vostrel (http://www.pisi.cz/)
 * Dual licensed under the MIT (MIT-LICENSE.txt)
 * and GPL (GPL-LICENSE.txt) licenses.
 *
 * http://www.vostrel.cz/jquery/reel/
 * Version: 1.0.4
 * Updated: 2010-04-14
 *
 * Requires jQuery 1.4.x or higher
 */
(function(k){function p(o){return parseInt(o)}function s(o){k.each(o,function(){k.fn[this]||(k.fn[this]=function(){return this})})}k.fn.reel=function(o){var t={footage:6,frame:1,frames:36,horizontal:true,hotspot:undefined,hint:"",indicator:0,klass:"",loops:true,reversed:false,saves:false,sensitivity:20,spacing:0,stitched:undefined,suffix:"-reel",tooltip:""},u=function(b){var c=[];b.filter("img").each(function(){var m=k(this),f=m.attr("src"),g=p(m.css("width")),n=p(m.css("height"));!f||f==""||!g||
!n||c.push(m)});b.filter("div.jquery-reel").each(function(){c.push(k(this))});return k(c)}(this);s("mousewheel disableTextSelect".split(/ /));return u.each(function(){var b=k(this),c=k.extend(t,o),m=k(document),f=function(e,a){b.data(e,a);b.trigger("store");return a},g=function(e){e=b.data(e);b.trigger("recall");return e},n={setup:function(){if(!b.hasClass("jquery-reel")){var e=b.attr("src"),a=b.attr("id"),d=b.attr("class"),l=b.attr("style");e=e.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+c.suffix+
".$2");var j={x:p(b.css("width")),y:p(b.css("height"))},q=k("<div>").attr("class",d).addClass("jquery-reel").addClass(c.klass),h=c.saves?{opacity:0}:{display:"none"};b=b.attr("id","").wrap(q).css(h).parent().attr("id",a).bind(n).css({width:j.x+"px",height:j.y+"px",backgroundImage:"url("+e+")"});f("frames",c.frames);f("spacing",c.spacing);f("offset",b.offset());f("dimensions",j);f("backup",{id:a,"class":d||"",style:l||""});b.trigger("start")}},teardown:function(){b=b.unbind(n).find("img").attr(b.data("backup")).unwrap().bind("setup",
function(){b.unbind("setup");n.setup()})},start:function(){var e=c.hotspot?c.hotspot:b,a=g("dimensions");e.css({cursor:"ew-resize"}).mouseenter(function(){b.trigger("enter")}).mouseleave(function(){b.trigger("leave")}).mousemove(function(d){b.trigger("over",[d.clientX,d.clientY])}).mousewheel(function(d,l){b.trigger("wheel",[l]);return false}).dblclick(function(){b.trigger("animate")}).mousedown(function(d){b.trigger("down",[d.clientX,d.clientY])}).disableTextSelect();if(c.hint||c.tooltip)e.attr("title",
c.hint||c.tooltip);c.indicator&&b.append(k("<div>").addClass("indicator").css({width:c.indicator+"px",height:c.indicator+"px",top:a.y-c.indicator+"px",position:"relative",backgroundColor:"#000"}));b.trigger("frameChange",c.frame)},animate:function(){},down:function(e,a){f("clicked",true);f("clicked_location",a);f("last_frame",f("clicked_on_frame",g("frame")));m.mousemove(function(d){b.trigger("drag",[d.clientX,d.clientY])}).mouseup(function(){b.trigger("up")})},up:function(){f("clicked",false);m.unbind("mousemove mouseup")},
drag:function(e,a){var d=g("clicked_location");e=g("clicked_on_frame");g("frames");a=Math.round((d-a)/c.sensitivity);f("frame",e-(c.reversed?-1:1)*a);b.trigger("frameChange")},frameChange:function(e,a){a=!a?g("frame"):f("frame",a);var d=g("last_frame");e=g("frames");var l=g("dimensions"),j=g("spacing");a=!c.loops&&a>e?e:a;a=!c.loops&&a<1?1:a;a-=Math.floor(a/e)*e;a=f("last_frame",f("frame",a<1?e:a));d=a-d;d=Math.abs(d)>10?0-d:d;d=f("reversed",d!=0?d>0:g("reversed"));if(c.stitched){h=a*(c.stitched/
e);i=0;j=h+"px 0"+i+"px"}else{h=Math.floor(a/c.footage);i=a-h*c.footage-1;h=i==-1?h+i:h;i=i==-1?c.footage+i:i;var q=c.horizontal?l.y:l.x,h=-h*(j+q),i=-i*(j+(c.horizontal?l.x:l.y)),r=Math.ceil(e/c.footage);j=r*q+(r-1)*j;h=d&&c.horizontal?h-j:h;i=d&&!c.horizontal?i-j:i;j=c.horizontal?i+"px "+h+"px":h+"px "+i+"px"}a=(l.x-c.indicator)/(e-1)*(a-1)+"px";b.css({backgroundPosition:j}).find(".indicator").css({left:a})},wheel:function(e,a){e=g("frame");g("frames");var d=Math.ceil(Math.sqrt(Math.abs(a)));d=
a<0?-d:d;f("frame",e-(c.reversed?-1:1)*d);b.trigger("frameChange");return false}};b.ready(n.setup)})}})(jQuery);
