/*
 Copyright (c) 2009-2010 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 http://jquery.vostrel.cz/reel
 Version: "Dancer" (will be 1.1 on release)
 Updated: 2010-08-09

 Requires jQuery 1.4.x
*/
(function(k,pb,Pa,q){function Qa(j){return"<"+j+"/>"}function Y(j){return"."+j}function Z(j){return"url("+j+")"}function E(j){return+j.toFixed(4)}function N(j,a,t){return O(j,va(a,t))}function Ra(j){function a(){k.fn[this]||(k.fn[this]=function(){return this})}k.each(j,a)}function $(j,a){return z(j)*(a?-1:1)}function P(j){return j.originalEvent.touches[0]}var Sa=k.reel={footage:6,frame:1,frames:36,hint:"",horizontal:true,hotspot:q,indicator:0,klass:"",loops:true,reversed:q,spacing:0,stitched:q,suffix:"-reel",
tooltip:"",brake:0.5,couple:q,cw:false,delay:-1,draggable:true,graph:q,image:q,images:[],monitor:q,path:"",preloader:4,rebound:0.5,revolution:q,row:1,rows:0,speed:0,step:q,steps:q,tempo:25,timeout:2,throwable:true,wheelable:true};k.fn.reel=function(j){var a=k.extend({},Sa,j);j=function(g){var d=[];g.filter(Ta).each(function(){var c=k(this),m=a.images.length&&a.images||a.image||c.attr(wa),w=Q(c.css(xa)),u=Q(c.css(ya));!m||m==za||!w||!u||d.push(c)});g.filter(Aa+Y(F)).each(function(){d.push(k(this))});
return k(d)}(this);var t=[];a.reversed&&(a.cw=true);a.tooltip&&(a.hint=a.tooltip);aa=aa||function g(){G.trigger(ba);return setTimeout(g,1E3/a.tempo)}();j.each(function(){var g=k(this),d=function(e,b){g.data(e,b);g.trigger("store");return b},c=function(e){g.trigger("recall");return g.data(e)},m=function(e){delete this;return e},w={setup:function(e){if(g.hasClass(F))return m.call(e);var b=g.attr(wa),f=g.attr(Ua),i=g.attr("style"),h=a.images,l=a.stitched,p=a.loops,n={x:Q(g.css(xa)),y:Q(g.css(ya))},o=
{display:"block",width:n.x,height:n.y};o=g.attr({src:a.images?Va:b}).bind(w).addClass(F).css(o);t.push(o[0]);d(ca,h.length&&h.length||a.image||b.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2"));d(A,a.frame);d(Ba,a.spacing);d(H,n);d(r,0);d(da,a.steps||a.frames);d(R,a.revolution||l/2||n.x);d(Ca,Da(d(S,h.length||a.frames)/a.footage));d(T,1/(c(S)-(p&&!l?0:1)));d(Wa,1/O(c(S),c(da)));d(Ea,l-(p?0:n.x));d(Fa,n.x-a.indicator);d(I,"#"+f+a.suffix);d(x,d(ea,a.speed)<0);d(B,0);d(v,(a.row-1)/(a.rows-
1));d(U,$(1,!a.cw&&!l));d(Ga,{src:b,style:i||za});aa&&G.bind(ba,w.tick);m.call(e);g.trigger("start")},teardown:function(e){k(c(I)).remove();g.removeClass(F).unbind(s).unbind(w).attr(g.data(Ga)).enableTextSelect().removeData();V();G.unbind(fa).unbind(W).unbind(ba,w.tick);m.call(e)},start:function(e){var b=c(H),f=c(S),i=O(f,c(da));i=d(r,1/i*((a.step||a.frame)-1));d(A,i*f+1);f=c(ca);i=a.images;f=!i.length?[f]:[].concat(i);g.attr("id");var h=g[0];h.frames=f.length;h.preloads=h.preloads||[];h.preloaded=
h.preloaded||0;i=f.length!=h.preloads.length;var l=c(I).substr(1);l=k(J,{className:Xa,id:l,css:{position:"relative",width:b.x}}).insertAfter(g);var p=k(J,{className:Ya,css:{position:X,left:0,top:-b.y,width:b.x,height:b.y}}).appendTo(l);p=d(ga,k(a.hotspot||p));var n=g.add(a.couple);Za?p.css({WebkitUserSelect:"none"}).bind($a,function(o){n.trigger("down",[P(o).clientX,P(o).clientY,true]);return false}).bind(ab,function(o){n.trigger("drag",[P(o).clientX,P(o).clientY,true]);return false}).bind(bb,function(){n.trigger("up",
[true]);return false}).bind(cb,function(){n.trigger("up",[true]);return false}):p.css({cursor:"url("+Ha+"), "+ha}).bind(db,function(){n.trigger("enter")}).bind(eb,function(){n.trigger("leave")}).bind(W,function(o){n.trigger("over",[o.pageX,o.pageY])}).bind(fb,function(o,gb){n.trigger("wheel",[gb]);return false}).bind(hb,function(){n.trigger("animate")}).bind(ib,function(o){n.trigger("down",[o.clientX,o.clientY]);return false}).disableTextSelect();a.hint&&p.attr(jb,a.hint);a.monitor&&l.append(ia=k(J,
{className:kb,css:{position:X,left:0,top:-b.y}}))||(ia=k());a.indicator&&l.append(Ia("x"));a.rows&&a.indicator&&l.append(Ia("y"));if(i)for(l.append(ja=k(J,{className:lb,css:{position:X,left:0,top:-a.preloader,height:a.preloader,backgroundColor:Ja}}));f.length;){i=new Image;l=a.path+f.shift();k(i).load(function(){h.preloaded++;ja.css({width:1/h.frames*h.preloaded*b.x});h.frames==h.preloaded&&ja.remove()});i.src=l;h.preloads.push(i)}a.delay>0&&y();m.call(e);g.trigger(a.rows&&!a.stitched?"rowChange":
"frameChange")},animate:function(){},tick:function(e){var b=c(B);if(K){var f=E(b-mb*K);b=!(b*f<=0||b<z(f))&&d(B,b>z(c(ea))?f:(K=u=0))}ia.text(c(a.monitor));b&&K++;u&&u++;Ka(0);if(u&&!b)return m.call(e);if(c(ka))return m.call(e,y());f=c(U)*$(1,c(x));b=(c(la)?b:z(c(ea))+b)/a.tempo;d(r,c(r)-b*f);m.call(e);g.trigger("fractionChange")},play:function(e){var b=d(ma,true);d(la,!b);La();m.call(e)},pause:function(e){d(ma,false);y();m.call(e)},stop:function(e){var b=d(la,true);d(ma,!b);m.call(e)},down:function(e,
b,f,i){if(!a.draggable)return m.call(e);d(ka,true);d(B,0);na(b,f,c(r),c(R),c(v));oa=q;y();V();!i&&G.bind(W,function(h){g.trigger("drag",[h.clientX,h.clientY]);m.call(h)}).bind(fa,function(h){g.trigger("up");m.call(h)})&&c(ga).css({cursor:Z(nb)+", "+ha});m.call(e)},up:function(e,b){if(!a.draggable)return m.call(e);d(ka,false);var f=d(B,!a.throwable?0:z(C[0]+C[1]+C[2])/60);K=f?1:0;f?La():y();V();!b&&G.unbind(fa).unbind(W)&&c(ga).css({cursor:Z(Ha)+", "+ha});m.call(e)},drag:function(e,b,f){if(!a.draggable)return m.call(e);
var i=c(R),h=c(Ma),l=Ka(b-oa||0),p=d(r,Na(b-h.x,c(pa),i,c(qa),c(ra),c(U)));l&&d(x,l<0);if(a.rows){l=c(H).y;var n=c(Oa),o=-n*l;d(v,E(k.reel.math.envelope(f-h.y,n,l,o,o+l,-1)))}!(p%1)&&!a.loops&&na(b,f,p,i,c(v));y();oa=b;m.call(e);g.trigger("fractionChange")},wheel:function(e,b){if(!a.wheelable)return m.call(e);var f=Da(ob(z(b))/2);f=$(f,b>0);b=0.2*c(R);na(q,q,c(r),b,c(v));d(r,Na(f,c(pa),b,c(qa),c(ra),c(U)));f&&d(x,f<0);d(B,0);y();m.call(e);g.trigger("fractionChange");return false},fractionChange:function(e,
b){b=!b?c(r):d(r,b);b=a.loops?b-L(b):N(0,1,b);b=d(r,E(b));d(A,1+L(b/c(T)));if(!a.loops&&a.rebound){!u&&!(b%1)?sa++:(sa=0);sa>=a.rebound*1E3/a.tempo&&d(x,!c(x))}m.call(e);g.trigger(a.rows&&!a.stitched?"rowChange":"frameChange")},rowChange:function(e,b){var f=L(c(r)/c(T))+1;b=d(v,N(0,1,E(b!=q?(b-1)/(a.rows-1):c(v))));d(A,f+(!a.rows?0:M(b*(a.rows-1))*a.frames));m.call(e);g.trigger("frameChange")},frameChange:function(e,b){var f=!b?c(r):d(r,E(c(T)*(b-1)));b=d(A,M(b?b:c(A)));var i=a.images,h=a.footage,
l=a.horizontal;if(a.stitched)l=[-M(f*c(Ea))+D,0+D];else{var p=b%h-1;p=p<0?h-1:p;var n=L((b-0.1)/h);n+=a.rows?0:c(x)?0:c(Ca);h=c(H);var o=c(Ba);n=n*((l?h.y:h.x)+o);p=p*((l?h.x:h.y)+o);l=i.length?[0,0]:l?[-p+D,-n+D]:[-n+D,-p+D]}b=i[b-1]||c(ca);i=c(Fa);f=N(0,i,M(k.reel.math.interpolate(f,-1,i+2)));f=!a.cw||a.stitched?f:i-f;i={background:Z(a.path+b)+ta+l.join(ta)};a.images.length?g.attr({src:a.path+b}):g.css(i);k(Y(ua+".x"),c(I)).css({left:f});if(!a.rows)return m.call(e);f=c(H).y-a.indicator;b=N(0,f,
M(k.reel.math.interpolate(c(v),-1,f+2)));k(Y(ua+".y"),c(I)).css({top:b-f-a.indicator});m.call(e)}},u,K=0,La=function(){return u=0},y=function(){return u=-a.timeout*a.tempo},ia,ja,Ia=function(e){return k(J,{className:[ua,e].join(ta),css:{width:a.indicator,height:a.indicator,top:e=="y"?q:-a.indicator,left:e=="x"?q:0,position:X,backgroundColor:Ja}})},sa=0,oa=0,Ka=function(e){return C.push(e)&&C.shift()&&e},V=function(){return C=[0,0,0]},C=V(),mb=a.brake/a.tempo,Na=a.graph||k.reel.math[a.loops?"hatch":
"envelope"],na=function(e,b,f,i,h){d(pa,f);d(Oa,h);d(qa,a.loops?0:-f*i);d(ra,a.loops?i:i-f*i);return e&&d(Ma,{x:e,y:b})||q};w.setup()});return k(t)};k.reel.math={envelope:function(j,a,t,g,d,c){return a+O(g,va(d,-j*c))/t},hatch:function(j,a,t,g,d,c){j=(j<g?d:0)+j%d;j=a+-j*c/t;return j-L(j)},interpolate:function(j,a,t){return a+j*(t-a)}};Ra("mousewheel disableTextSelect enableTextSelect".split(/ /));var G=k(Pa),Za=/iphone|ipod|ipad|android/i.test(navigator.userAgent),ha="ew-resize",aa,F="jquery-reel",
Xa=F+"-overlay",ua="indicator",lb="preloader",kb="monitor",Ya="interface",Va="data:image/gif;base64,R0lGODlhCAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7",Ha="data:image/gif;base64,R0lGODlhEAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAI3lC8AeBDvgosQxQtne7yvLWGStVBelXBKqDJpNzLKq3xWBlU2nUs4C/O8cCvU0EfZGUwt19FYAAA7",nb="data:image/gif;base64,R0lGODlhEAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAIslI95EB3MHECxNjBVdE/5b2zcRV1QBabqhwltq41St4hj5konmVioZ6OtEgUAOw==",M=Math.round,L=Math.floor,
Da=Math.ceil,va=Math.min,O=Math.max,z=Math.abs,ob=Math.sqrt,Q=parseInt,Ga="backup",x="backwards",T="bit",ka="clicked",Ma="clicked_location",pa="clicked_on",Oa="clicked_row",U="cwish",H="dimensions",r="fraction",A="frame",S="frames",ra="hi",ga="hotspot",ca="image",Fa="indicator_travel",qa="lo",ma="playing",R="revolution",v="row",Ca="rows",Ba="spacing",ea="speed",I="stage",da="steps",Ea="stitched_travel",la="stopped",B="velocity",Wa="wheel_step",s=".reel",hb="dblclick"+s,ib="mousedown"+s,db="mouseenter"+
s,eb="mouseleave"+s,W="mousemove"+s,fa="mouseup"+s,fb="mousewheel"+s,ba="tick"+s,cb="touchcancel"+s,bb="touchend"+s,$a="touchstart"+s,ab="touchmove"+s,za="",ta=" ",X="absolute",Aa="div",J=Qa(Aa),ya="height",Ja="#000",Ua="id",Ta="img",D="px",wa="src",jb="title",xa="width"})(jQuery,window,document);
