/*
 Copyright (c) 2009-2012 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 jQuery Reel
 http://jquery.vostrel.cz/reel
 Version: 1.1.3-devel
 Updated: 2012-01-18

 Requires jQuery 1.5 or higher
*/
jQuery.reel||function(l,Lb,Qa,s){function Mb(e){return o.instances.push(e[0])&&e}function Nb(e){return(o.instances=o.instances.not(ma(e.attr(ga))))&&e}function O(e){return o.instances.length?o.instances.first().data(e):null}function Ob(e){return"data:image/gif;base64,R0lGODlh"+e}function P(e){return"<"+e+"/>"}function r(e){return"."+(e||F)}function va(e){return o.cdn+e}function wa(e){return"url("+e+")"}function X(e,a,q){return na(e,Ra(a,q))}function Pb(e){function a(){l.fn[this]||(l.fn[this]=function(){return this})}
l.each(e,a)}function Sa(e,a){return Q(e)*(a?-1:1)}function xa(e){return ya?e.touch||e.originalEvent.touches[0]:e}function Y(e){return e===s||typeof e==mb?e:e+Z}function ma(e){return"#"+e}function Qb(e){var a=[];l.each(e,function(q,h){a.push(q.replace(/([A-Z])/g,"-$1").toLowerCase()+":"+Y(h))});return"{"+a.join(";")+";}"}function Rb(){var e=l().jquery.split(".");if(e=+e[0]*10+ +e[1]<15)throw"FATAL: Reel needs jQuery 1.5 or higher";return e}if(!Rb()){var o=l.reel={version:"1.2alpha",def:{area:s,brake:0.23,
clickfree:false,cw:false,delay:-1,directional:false,draggable:true,footage:6,entry:s,frame:1,frames:36,graph:s,hint:"",horizontal:true,image:s,images:[],indicator:0,inversed:false,klass:"",laziness:6,loops:true,monitor:s,opening:0,orbital:0,path:"",preloader:2,rebound:0.5,revolution:s,row:1,rows:0,spacing:0,speed:0,step:s,steps:s,stitched:0,suffix:"-reel",tempo:36,timeout:2,throwable:true,vertical:false,wheelable:true,annotations:s,attr:{},cursor:s,preload:"fidelity",scrollable:true,steppable:true,
snaps:true,sequence:"",velocity:0}};l.fn.reel=function(e){var a=l.extend({},o.def,e);e=function(h){var u=[];h.filter(Ta).each(function(){var d=l(this),c=a.images.length&&a.images||a.image||a.attr.src||d.attr(nb),v=za(a.attr.width||d.css(Ua)),p=za(a.attr.height||d.css(ob));!c||c==F||!v||!p||u.push(d)});h.filter(r(x)).each(function(){u.push(l(this).unreel())});return l(u)}(this);var q=[];a.tooltip&&(a.hint=a.tooltip);a.hotspot&&(a.area=a.hotspot);e.each(function(){var h=l(this),u=h.data(),d=function(g,
b){u[g]=b;h.trigger("store",[g,b]);return b},c=function(g){var b=u[g];h.trigger("recall",[g,b]);return b},v={setup:function(g){if(h.hasClass(x))return p.call(g);var b=h.attr(a.attr).attr(nb),f=d(ga,h.attr(ga)||h.attr(ga,x+"-"+ +new Date).attr(ga)),i=h.attr(oa),j=l.extend({},h.data()),m=o.re.sequence.exec(d(Sb,a.sequence));m=d(ha,m?o.build_sequence(m,a,c):a.images);var n=a.stitched,k=a.loops,y={x:za(h.css(Ua)||a.attr.width),y:za(h.css(ob)||a.attr.height)},z=d(J,a.frame),$=d(pa,a.orbital&&a.footage||
a.rows<=1&&m.length||a.frames),Tb=n?1:pb($/a.footage);f=ma(f+a.suffix);var qb=h.attr("class")||F;z=l(P(qa),{id:f.substr(1),"class":qb+A+Ub+A+rb+z});z=h.wrap(z.addClass(a.klass)).attr({"class":x});q.push(Mb(z)[0]);z=z.parent().bind(v.instance);d(Vb,a);d(Va,m.length?F:a.image||b.replace(o.re.image,"$1"+a.suffix+".$2"));d(Wa,[]);d(Xa,0);d(sb,a.spacing);d(K,y);d(t,0);d(Ya,a.steps||a.frames);d(Aa,a.revolution||n/2||y.x*2);d(Za,Tb);d(ia,1/($-(k&&!n?0:1)));d(Wb,1/na($,c(Ya)));d($a,n);d(tb,n-(k?0:y.x));d(ab,
f);d(L,d(Ba,a.speed)<0);d(aa,a.velocity||0);d(ja,a.vertical);d(ka,0);d(G,(a.row-1)/(a.rows-1));d(la,Sa(1,!a.cw&&!n));d(bb,{});d(ra,false);d(Ca,d(cb,0));d(Da,d(Ea,0));d(sa,false);d(ub,a.brake);d(db,!!a.orbital);d(R,a.tempo/(o.lazy?a.laziness:1));d(ba,-1);d(Fa,a.annotations)||z.unbind(r(Fa));d(vb,{src:b,classes:qb,style:i||F,data:j});a.steppable||z.unbind("click.steppable");E(F,{width:y.x,height:y.y,overflow:eb,position:"relative"});E(ca+A+r(x),{display:wb});M.bind(v.pool);p.call(g);h.trigger("setup")},
instance:{teardown:function(g){var b=h.data(vb);h.parent().unbind(v.instance);c(oa).remove();Nb(h.unbind(S).siblings().unbind(S).remove().end().attr({"class":b.classes,src:b.src,style:b.style}).data(b.data).unwrap());Ga();M.unbind(v.pool);N.unbind(T);p.call(g)},setup:function(){function g(n){return function(k){if(k.button==Xb)return k.preventDefault()||h.trigger("down",[xa(k).clientX,xa(k).clientY])&&p.call(k)||n}}var b=c(K),f=c(pa),i=na(f,c(Ya));i=d(t,1/i*((a.step||a.frame)-1));d(J,U(i*f)+1);h.attr(ga);
f=h.parent();i=d(Yb,l(a.area||f));if(ya){E(A+r(x),{WebkitUserSelect:Ha,WebkitBackgroundSize:a.images.length?"auto":c($a)&&Y(c($a))+A+Y(b.y)||Y(b.x*a.footage)+A+Y(b.y*c(Za)*(a.rows||1)*(a.directional?2:1))});i.bind(Zb,g())}else{var j=a.cursor==xb?$b:a.cursor||ac,m=a.cursor==xb?bc+A+"!important":false;E(F,{cursor:j});E(r(fb),{cursor:cc});E(r(Ia)+ca+r(Ia)+" *",{cursor:m||j},true);i.bind(a.wheelable?dc:F,function(n,k){return n.preventDefault()||!k||h.trigger("wheel",[k])&&false}).bind(a.clickfree?ec:
fc,g()).disableTextSelect()}a.hint&&i.attr(gc,a.hint);a.monitor&&f.append(V=l(P(qa),{"class":yb}))||(V=l());E(A+r(yb),{position:Ja,left:0,top:0});E(A+r(zb),{display:Ha});E(A+r(Ab),{position:Ja,left:0,top:b.y-a.preloader,height:a.preloader,overflow:eb,backgroundColor:Bb});a.indicator&&f.append(H(Cb));a.rows>1&&a.indicator&&f.append(H(Db))},preload:function(g){var b=c(K),f=h.parent(),i=c(Va),j=c(ha),m=!j.length,n=c(pa),k=o.preload[a.preload]||o.preload[o.def.preload];i=m?[i]:k(j.slice(),a,c);d(ka,m?
0.5:0);j=[];f.addClass(fb).append(w=l(P(qa),{"class":Ab}));for(h.trigger("stop");i.length;){var y=a.path+i.shift();k=b.x*(!m?1:a.footage);var z=b.y*(!m?1:n/a.footage)*(!a.directional?1:2),$=l(P(Ta)).attr({"class":zb,width:k,height:z}).appendTo(f);setTimeout(function(){$.attr({src:y});h.reelTriggerOnce("preloaded",function(){return!!$.parent().length&&$[0].complete})},j.length-i.length);j.push(y)}d(Wa,j);d(oa,l("<"+oa+' type="text/css">'+Eb.join("\n")+"</"+oa+">").prependTo(gb));p.call(g)},preloaded:function(g){var b=
c(ha).length;if(d(ka,Ra(c(ka)+1,b))===b){h.unbind("preloaded",v.instance.preloaded);b>1||h.css({backgroundImage:wa(a.path+c(Va))}).attr({src:hc});h.trigger("loaded").parent().removeClass(fb);p.call(g)}},opening:function(){if(!a.opening)return h.trigger("openingDone");var g=a.entry||a.speed,b=c(t),f=a.opening;d(t,b-g*a.opening);d(ba,f*O(R))},openingDone:function(){if(a.delay)da=setTimeout(function(){h.trigger("play")},a.delay*1E3);else h.trigger("play")},play:function(g,b){b=d(Ba,b||c(Ba));b=d(hb,
!!b);d(ib,!b);h.trigger("frameChange");I();p.call(g)},pause:function(g){d(hb,false);B();p.call(g)},stop:function(g){var b=d(ib,true);d(hb,!b);p.call(g)},down:function(g,b,f){if(a.draggable){d(ra,c(J));d(aa,0);var i=!c(sa)||a.rows<=1||!a.orbital||a.scrollable;Ka=La(b,f,c(t),c(Aa),c(G));B();Ga();ta=false;l(Fb,N).addClass(Ia);ya?N.bind(ic,j(!i)).bind(jc+A+kc,m()):N.bind(lc,j()).bind(a.clickfree?mc:nc,m());function j(n){return function(k){k.preventDefault();h.trigger("pan",[xa(k).clientX,xa(k).clientY,
k]);p.call(k);return n}}function m(n){return function(k){k.preventDefault();h.trigger("up");p.call(k);return n}}}p.call(g)},up:function(g){function b(i,j,m){if(j&&a.snaps)return d(i,1/m*(X(0,m-1,ea(c(i)*m))+0.5))}if(!a.draggable)return p.call(g);d(ra,false);d(sa,false);var f=d(aa,!a.throwable?0:Q(ua[0]+ua[1])/60);W=f?1:0;b(G,a.rows>1,a.rows);b(t,!f,c(pa));f?I():B();Ga();l(Fb,N).removeClass(Ia);N.unbind(T);p.call(g)},pan:function(g,b,f,i){if(a.draggable&&jb){jb=false;B();i=i&&!l(i.currentTarget).is(M)?
oc.offset():{left:0,top:0};f-=i.top;b-=i.left;var j={x:b-Ka.x,y:f-Ka.y};if(Q(j.x)>0||Q(j.y)>0){ta=true;Ka={x:b,y:f};i=c(Aa);var m=c(bb),n=c(ja),k=d(t,Gb(n?f-m.y:b-m.x,c(Ca),i,c(Da),c(Ea),c(la),n?f-m.y:b-m.x));d(sa,c(sa)||c(J)!=c(ra));(j=Hb(n?j.y:j.x||0))&&d(L,j<0);if(a.orbital&&c(db)){d(ja,Q(f-m.y)>Q(b-m.x));m=La(b,f,k,i,c(G))}if(a.rows>1){j=c(K).y;n=c(cb);var y=-n*j;d(G,o.math.envelope(f-m.y,n,j,y,y+j,-1))}!(k%1)&&!a.loops&&La(b,f,k,i,c(G));h.trigger("fractionChange")}}p.call(g)},wheel:function(g,
b){var f=pb(pc(Q(b))/2);f=Sa(f,b>0);b=0.0833*c(Aa);La(s,s,c(t),b,c(G));d(t,Gb(f,c(Ca),b,c(Da),c(Ea),c(la)));f&&d(L,f<0);d(aa,0);B();p.call(g);h.trigger("up").trigger("fractionChange");return false},fractionChange:function(g,b){b=d(t,Ma.fraction(b,a,c));var f=d(J,1+ea(b/c(ia))),i=a.rows>1,j=a.orbital;d(db,!!j&&(f<=j||f>=a.footage-j+2));if(!a.loops&&a.rebound){!C&&!(b%1)?kb++:(kb=0);kb>=a.rebound*1E3/O(R)&&d(L,!c(L))}h.trigger(i?"rowChange":"frameChange");p.call(g)},rowChange:function(g,b){var f=c(t)/
c(ia)+1;b=d(G,Ma.row(b,a,c));b=X(0,a.rows-1,ea(b*a.rows));d(J,ea(f+b*a.frames));p.call(g);h.trigger("frameChange")},frameChange:function(g,b){var f=d(t,Ma.fraction(!b?s:c(ia)*(b-1),a,c));b=Ma.frame(b,a,c);var i=c(Wa).length==1,j=a.footage;if(c(ja)){b=a.inversed?j+1-b:b;b+=j}if(b==c(Xa))D(g);else{var m=a.horizontal,n=c(ha),k=c(K);b=d(Xa,d(J,b));if(i){if(a.stitched)k=[-U(f*c(tb))+Z,0+Z];else{f=b%j-1;f=f<0?j-1:f;j=ea((b-0.1)/j);j+=a.rows>1?0:c(L)?0:c(Za);b=c(sb);j=j*((m?k.y:k.x)+b);k=f*((m?k.x:k.y)+
b);k=n.length?[0,0]:m?[-k+Z,-j+Z]:[-j+Z,-k+Z]}h.css({backgroundPosition:k.join(A)})}else h.attr({src:a.path+n[b-1]})}if(a.indicator){m=c(ab);n=a.rows>1;k=c(K);f=(c(ja)?k.y:k.x)-a.indicator;b=X(0,f,U(o.math.interpolate(c(t),-1,f+2)));b=!a.cw||a.stitched?b:f-b;l(r(Na+r(Cb)),m).css(c(ja)?{left:0,top:b}:{left:b,top:k.y-a.indicator});if(n){k=k.y-a.indicator;k=X(0,k,U(o.math.interpolate(c(G),-1,k+2)));l(r(Na+r(Db)),m).css({top:k})}}p.call(g)},stepLeft:function(){B();d(L,false);h.trigger("fractionChange",
c(t)-c(ia)*c(la))},stepRight:function(){B();d(L,true);h.trigger("fractionChange",c(t)+c(ia)*c(la))},"click.steppable":function(g){if(ta)return D(g);h.trigger(g.clientX-h.offset().left>0.5*c(K).x?"stepRight":"stepLeft")},"setup.annotations":function(){c(K);var g=h.parent();l.each(c(Fa),function(b,f){var i=typeof f.node==mb?l(f.node):f.node||{};i=i.jquery?i:l(P(qa),i);i=i.attr({id:b}).addClass(qc);var j=f.image?l(P(Ta),f.image):l(),m=f.link?l(P(rc),f.link):l();E(ma(b),{display:Ha,position:Ja},true);
i.bind({"click.annotations":function(n){n.stopPropagation()}});f.image||f.link&&i.append(m);f.link||f.image&&i.append(j);f.link&&f.image&&i.append(m.append(j));i.appendTo(g)});h.trigger("frameChange.annotations")},"frameChange.annotations":function(g,b){b=b||c(J);this.className=this.className.replace(sc,rb+b);c(aa)||l.each(c(Fa),function(f,i){f=l(ma(f));var j=i.start||1,m=i.end,n=b-1,k=i.at?i.at[n]=="+":false;n=i.at?n:n-j+1;var y=typeof i.x!=Ib?i.x:i.x[n],z=typeof i.y!=Ib?i.y:i.y[n];i={display:y!==
s&&z!==s&&(i.at?k:n>=0&&(!m||n<=m-j))?wb:Ha,left:Y(y)||0,top:Y(z)||0};f.css(i)})},"setup.fu":function(){h.trigger("up").trigger("preload")},"loaded.fu":function(){h.trigger("opening")}},pool:{"tick.reel":function(g){var b=c(aa);if(W){var f=b-c(ub)/O(R)*W;b=d(aa,f>0.1?f:(W=C=0))}V.text(c(a.monitor));b&&W++;C&&C++;Hb(0);jb=true;if(C&&!b)return D(g);if(c(ra))return D(g,B());if(!(c(ba)>0)){f=c(la)*Sa(1,c(L));b=(c(ib)?b:Q(c(Ba))+b)/O(R);var i=c(t);d(t,i-b*f);p.call(g)}},"tick.reel.preload":function(){var g=
c(K),b=parseInt(w.css(Ua)),f=U(1/c(ha).length*c(ka)*g.x);w.css({width:b+(f-b)/3+1});if(c(ka)===c(ha).length&&b>g.x-2){w.fadeOut(300,function(){w.remove()});M.unbind(fa+r(Jb),v.pool[fa+r(Jb)])}},"tick.reel.opening":function(g){if(a.opening){if(c(ba)<=0)return;var b=(a.entry||a.speed)/O(R)*(a.cw?-1:1),f=c(t);d(t,f+b);b=d(ba,c(ba)-1);p.call(g);if(b>0)return;h.trigger("openingDone")}M.unbind(fa+r(Oa),v.pool[fa+r(Oa)])},"tick.reel.fu":function(){h.trigger("fractionChange")}}},p=function(g){Kb||delete this;
return g},D=function(g,b){return g.stopImmediatePropagation()||p.call(g)||b},C,W=0,I=function(){return C=0},B=function(){clearTimeout(da);M.unbind(fa+r(Oa),v.pool[fa+r(Oa)]);d(ba,0);h.trigger("play");return C=-a.timeout*O(R)},ta=false,da,V,w,H=function(g){E(A+r(Na)+r(g),{position:Ja,width:a.indicator,height:a.indicator,overflow:eb,backgroundColor:Bb});return l(P(qa),{"class":[Na,g].join(A)})},Eb=[],E=function(g,b,f){f=f?F:c(ab);g=g.replace(/^/,f).replace(ca,ca+f);return Eb.push(g+Qb(b))&&b},kb=0,
Ka={x:0,y:0},Hb=function(g){return ua.push(g)&&ua.shift()&&g},Ga=function(){return ua=[0,0]},ua=Ga(),Gb=a.graph||o.math[a.loops?"hatch":"envelope"],Ma=o.normal,La=function(g,b,f,i,j){d(Ca,f);d(cb,j);d(Da,a.loops?0:-f*i);d(Ea,a.loops?i:i-f*i);return g&&d(bb,{x:g,y:b})||s},jb=true,N;try{N=l.unique(M.add(Lb.top.document))}catch(tc){N=M}var oc=top===self?l():function(g){l("iframe",N.last()).each(function(){try{if(l(this).contents().find(gb).html()==l(gb).html())return(g=l(this))&&false}catch(b){}});return g}();
v.setup()});Pa=Pa||function h(){var u=+new Date,d=O(R);if(d){M.trigger(fa);o.cost=(+new Date+o.cost-u)/2;return Pa=setTimeout(h,na(4,1E3/d-o.cost))}else return Pa=s}();return l(q)};l.fn.unreel=function(){return this.trigger("teardown")};o.math={envelope:function(e,a,q,h,u,d){return a+na(h,Ra(u,-e*d))/q},hatch:function(e,a,q,h,u,d){e=(e<h?u:0)+e%u;e=a+-e*d/q;return e-ea(e)},interpolate:function(e,a,q){return a+e*(q-a)}};o.preload={linear:function(e){return e},fidelity:function(e,a){function q(p,D,
C){function W(H){for(;!(H>=1&&H<=da);)H+=H<1?+da:-da;return v[C+H]||(v[C+H]=!!I.push(H))}if(!p.length)return[];var I=[],B=4*D,ta=a.frame,da=p.length;D=true;for(var V=da/B,w=0;w<B;w++)W(ta+U(w*V));for(;V>1;){w=0;B=I.length;V/=2;for(D=!D;w<B;w++)W(I[w]+(D?1:-1)*U(V))}for(w=0;w<I.length;w++)I[w]=p[I[w]-1];return I}var h=a.orbital?2:a.rows||1,u=a.orbital?a.footage:a.frames,d=(a.row-1)*u,c=[].concat(e),v=new Array(e.length);e=h<2?[]:c.slice(d,d+u);return q(e,1,d).concat(q(c,h,0))}};o.normal={fraction:function(e,
a,q){e=e!=s?e:q(t);return a.loops?e-ea(e):X(0,1,e)},row:function(e,a,q){return X(0,1,e!=s?(e-1)/(a.rows-1):q(G))},frame:function(e,a,q){e=e!=s?U(e):q(J);var h=a.orbital?2:a.rows||1;q=q(pa)*h;e=a.loops?e%q||q:X(1,q,e);return e<0?e+q:e}};o.re={image:/^(.*)\.(jpg|jpeg|png|gif)$/,touchy_agent:/iphone|ipod|ipad|android/i,lazy_agent:/iphone|ipod|android/i,sequence:/(^[^#|]*([#]+)[^#|]*)($|[|]([0-9]+)\.\.([0-9]+))($|[|]([0-9]+)$)/};o.cdn="http://code.vostrel.cz/";o.build_sequence=function(e,a){function q(p,
D,C){for(;p.length<D;)p=C+p;return p}if(e.length<=1)return a.images;var h=[],u=e[1],d=e[2],c=+e[4]||1,v=a.orbital?2:a.rows||1;a=a.orbital?a.footage:a.frames;v=+(e[5]||v*a);e=+e[7]||1;for(a=0;a<v;){h.push(u.replace(d,q(c+a+F,d.length,"0")));a+=e}return h};o.touchy=o.re.touchy_agent.test(navigator.userAgent);o.lazy=o.re.lazy_agent.test(navigator.userAgent);o.instances=l();o.leader=O;o.cost=0;Pb("mousewheel disableTextSelect enableTextSelect".split(/ /));var M=l(Qa);Qa=+l.browser.version.split(r()).slice(0,
2).join(r());var Kb=l.browser.msie,ya=o.touchy,Pa,x="reel",Ub=x+"-overlay",Na=x+"-indicator",Ab=x+"-preloader",zb=x+"-cached",yb=x+"-monitor",qc=x+"-annotation",Ia=x+"-panning",fb=x+"-loading",rb="frame-",sc=/frame-\d+/,U=Math.round,ea=Math.floor,pb=Math.ceil,Ra=Math.min,na=Math.max,Q=Math.abs,pc=Math.sqrt,za=parseInt,Fa="annotations",Yb="area",vb="backup",L="backwards",ia="bit",ub="brake",Wa="cached",db="center",ra="clicked",bb="clicked_location",Ca="clicked_on",cb="clicked_row",la="cwish",K="dimensions",
t="fraction",J="frame",Xa="_frame",pa="frames",gb="head",Ea="hi",eb="hidden",Va="image",ha="images",ba="opening_ticks",Da="lo",Vb="options",hb="playing",ka="preloaded",sa="reeling",Aa="revolution",G="row",Za="rows",Sb="sequence",sb="spacing",Ba="speed",ab="stage",Ya="steps",$a="stitched",tb="stitched_travel",ib="stopped",oa="style",R="tempo",aa="velocity",ja="vertical",Wb="wheel_step",S=r(x),T=".pan"+S,fc="mousedown"+S,ec="mouseenter"+S,mc="mouseleave"+T,lc="mousemove"+T,nc="mouseup"+T,dc="mousewheel"+
S,fa="tick"+S,kc="touchcancel"+T,jc="touchend"+T,Zb="touchstart"+S,ic="touchmove"+T,F="",A=" ",ca=",",Ja="absolute",rc="a",wb="block",qa="div",xb="hand",ob="height",Bb=ma("000"),Fb="html",ga="id",Ta="img",lb="jquery."+x,Ha="none",Ib="object",Oa="opening",Jb="preload",Z="px",nb="src",mb="string",gc="title",Ua="width",Cb="x",Db="y",hc=Ob("CAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7")||va("blank.gif"),cc="wait",ac=wa(va(lb+r("cur")))+ca+"move",$b=wa(va(lb+"-drag"+r("cur")))+ca+"move",bc=
wa(va(lb+"-drag-down"+r("cur")))+ca+"move",Xb=ya?s:Kb&&Qa<=8?1:0;l.fn.reelTriggerOnce=function(e,a){function q(h){a()?h.trigger(e):setTimeout(function(){q(h)},100);return h}return q(l(this))}}}(jQuery,window,document);
