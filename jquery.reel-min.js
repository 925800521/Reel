/*
 Copyright (c) 2009-2010 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 http://jquery.vostrel.cz/reel
 Version: "Dancer" (will be 1.1 on release)
 Updated: 2010-07-18

 Requires jQuery 1.4.x
*/
(function(i,mb,Na,w){function Oa(n){return"<"+n+"/>"}function ja(n){return"."+n}function P(n){return"url("+n+")"}function Q(n,b){return+b.toFixed(n)}function ka(n,b,G){return H(n,la(b,G))}function Pa(n){function b(){i.fn[this]||(i.fn[this]=function(){return this})}i.each(n,b)}var Qa=i.reel={footage:6,frame:1,frames:36,hint:"",horizontal:true,hotspot:w,indicator:0,klass:"",loops:true,reversed:false,sensitivity:20,spacing:0,stitched:w,suffix:"-reel",tooltip:"",delay:-1,friction:0.9,image:w,images:[],
inertia:true,monitor:w,path:"",preloader:4,rebound:0.5,revolution:w,speed:0,step:w,steps:w,tempo:25,timeout:2};i.fn.reel=function(n){var b=i.extend({},Qa,n);n=function(e){var c=[];e.filter(Ra).each(function(){var d=i(this),j=b.images.length&&b.images||b.image||d.attr(ma),x=I(d.css(na)),v=I(d.css(oa));!j||j==pa||!x||!v||c.push(d)});e.filter(qa+ja(B)).each(function(){c.push(i(this))});return i(c)}(this);var G=[];R=R||function e(){C.trigger(S);return setTimeout(e,1E3/b.tempo)}();n.each(function(){var e=
i(this),c=function(f,a){e.data(f,a);e.trigger("store");return a},d=function(f){e.trigger("recall");return e.data(f)},j=function(f){delete this;return f},x={setup:function(f){if(e.hasClass(B))return j.call(f);var a=e.attr(ma),g=e.attr(Sa);e.attr(Ta);var h=e.attr("style"),l=b.images,k={x:I(e.css(na)),y:I(e.css(oa))},m={display:"block",width:k.x+q,height:k.y+q};m=e.attr({src:b.images?Ua:a}).bind(x).addClass(B).css(m);m=m.bind(ra,J).bind(sa,ta);instances_count=G.push(m[0]);c(T,l.length&&l.length||b.image||
a.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+b.suffix+".$2"));c(D,b.frame);c(ua,b.spacing);c(U,k);c(o,0);c(K,b.steps||b.frames);c(va,b.revolution||b.stitched/2||k.x);c(V,wa(c(L,l.length||b.frames)/b.footage));c(W,1/(d(L)-(b.loops?0:1)));c(xa,1/H(d(L),d(K)));c(ya,b.stitched+(b.loops?0:-k.x));c(za,k.x-b.indicator);c(M,"#"+g+b.suffix);c(y,c(X,b.speed)<0);c(Aa,{src:a,style:h||pa});R&&C.bind(S,x.tick);j.call(f);e.trigger("start")},teardown:function(f){i(d(M)).remove();e.removeClass(B).unbind(u).unbind(x).unbind(ra,
J).unbind(sa,ta).attr(e.data(Aa)).enableTextSelect().removeData();Y();C.unbind(Z).unbind(N).unbind(S,x.tick);j.call(f)},start:function(f){var a=d(U),g=d(L),h=H(g,d(K));h=c(o,1/h*((b.step||b.frame)-1));c(D,h*g+1);g=d(T);h=b.images;g=!h.length?[g]:[].concat(h);var l;e.attr("id");var k=e[0];k.frames=g.length;k.preloads=k.preloads||[];k.preloaded=k.preloaded||0;h=g.length!=k.preloads.length;var m=d(M).substr(1);m=i(E,{className:Va,id:m,css:{position:"relative",width:a.x}}).insertAfter(e);var p=i(E,{className:Wa,
css:{position:O,left:0,top:-a.y,width:a.x,height:a.y}}).appendTo(m);p=c($,i(b.hotspot||p));Xa?p.css({WebkitUserSelect:"none"}).each(function(){function s(r,z){i.each(z,function(Ya){r.addEventListener(Ya,this,false)})}function t(r){return r.cancelable&&r.preventDefault()||false}function Za(r){var z=r.touches[0];e.trigger("down",[z.clientX,z.clientY,true]);return t(r)}function $a(r){var z=r.touches[0];e.trigger("drag",[z.clientX,z.clientY,true]);return t(r)}function Ba(r){e.trigger("up",[true]);return t(r)}
s(this,{touchstart:Za,touchmove:$a,touchend:Ba,touchcancel:Ba})}):p.css({cursor:"url("+Ca+"), "+aa}).bind(ab,function(){e.trigger("enter")}).bind(bb,function(){e.trigger("leave")}).bind(N,function(s){e.trigger("over",[s.pageX,s.pageY])}).bind(cb,function(s,t){e.trigger("wheel",[t]);return false}).bind(db,function(){e.trigger("animate")}).bind(eb,function(s){e.trigger("down",[s.clientX,s.clientY]);return false}).disableTextSelect();(b.hint||b.tooltip)&&p.attr(fb,b.hint||b.tooltip);b.monitor&&m.append(ba=
i(E,{className:gb,css:{position:O,left:0,top:-a.y}}))||(ba=i());b.indicator&&m.append(i(E,{className:Da,css:{width:b.indicator+q,height:b.indicator+q,top:-b.indicator+q,position:O,backgroundColor:Ea}}));h&&m.append(l=i(E,{className:hb,css:{position:O,left:0,top:-b.preloader,height:b.preloader,backgroundColor:Ea}}));if(h)for(;g.length;){h=new Image;m=b.path+g.shift();i(h).load(function(){k.preloaded++;l.css({width:1/k.frames*k.preloaded*a.x});k.frames==k.preloaded&&l.remove()});h.src=m;k.preloads.push(h)}b.delay>
0&&J();j.call(f);e.trigger("frameChange")},animate:function(){},tick:function(f){var a=d(F);a-=a*ib;a=Fa=a==Fa?0:a;a=c(F,(a<0?la:H)(0,Q(3,a))||0);ba.text(d(b.monitor));Ga(0);v&&v++;if(v&&!a)return j.call(f);if(d(ca))return j.call(f,J());a=(d(da)?a:a+jb())/b.tempo;c(o,d(o)+a);j.call(f);e.trigger("fractionChange")},play:function(f){var a=c(ea,true);c(da,!a);j.call(f)},pause:function(f){c(ea,false);j.call(f)},stop:function(f){var a=c(da,true);c(ea,!a);j.call(f)},down:function(f,a,g,h){c(ca,true);c(Ha,
a);c(F,0);c(fa,c(Ia,d(o)));!h&&C.bind(N,function(l){e.trigger("drag",[l.clientX,l.clientY]);j.call(l)}).bind(Z,function(l){e.trigger("up");j.call(l)})&&d($).css({cursor:P(kb)+", "+aa});j.call(f)},up:function(f,a){c(ca,false);var g=(A[0]+A[1]+A[2])/A.length/(a?15:20),h=(b.reversed?-1:1)*(b.stitched?-1:1);c(F,b.inertia?g*h:0);Y();!a&&C.unbind(Z).unbind(N)&&d($).css({cursor:P(Ca)+", "+aa});j.call(f)},drag:function(f,a){var g=d(Ha);g=a-g;var h=(b.reversed?-1:1)*(b.stitched?-1:1);c(y,g<d(Ja));h=d(Ia)+
h/d(va)*g;c(Ja,g);c(o,h);Ga(a-Ka);Ka=a;j.call(f);e.trigger("fractionChange")},wheel:function(f,a){var g=wa(lb(La(a))/2);g=a<0?-g:g;c(y,g<0);c(o,d(o)+g*d(xa));c(F,0);j.call(f);e.trigger("fractionChange");return false},fractionChange:function(f,a){a=!a?d(o):c(o,a);if(a-d(fa)===0)return j.call(f);a=b.loops?a-ga(a):ka(0,1,a);!b.loops&&b.rebound&&ha==b.rebound*1E3/b.tempo&&c(y,!d(y));a=c(fa,c(o,Q(6,a)));c(D,ga(a/d(W)+1));!v&&(a==0||a==1?ha++:(ha=0));j.call(f);e.trigger("frameChange")},frameChange:function(f,
a){var g=!a?d(o):c(o,Q(6,d(W)*(a-1)));a=c(D,ia(a?a:d(D)));var h=b.images,l=d(U);d(K);var k=d(ua),m=b.footage,p=b.horizontal;if(b.stitched)p=[-ia(g*d(ya))+q,0+q];else{var s=ga((a-0.1)/m),t=a%m-1;t=t<0?m-1:t;!d(y)&&p?(s+=d(V)):(t-=d(V));m=s*((p?l.y:l.x)+k);l=t*((p?l.x:l.y)+k);p=h.length?[0,0]:p?[-l+q,-m+q]:[-m+q,-l+q]}a=h[a-1]||d(T);h=d(za);g=ka(0,h,ia(g*(h+2))-1);h={background:P(b.path+a)+Ma+p.join(Ma)};b.images.length?e.attr({src:b.path+a}):e.css(h);j.call(f);i(ja(Da),d(M)).css({left:g+q})}},v,ta=
function(){return v=0},J=function(){return v=-b.timeout*b.tempo},ib=b.friction/b.tempo,jb=function(){return c(X,(d(y)?-1:1)*La(d(X)))},ba,ha=0,Ka=0,Fa=0,Ga=function(f){A.push(f)&&A.shift()},Y=function(){return A=[0,0,0]},A=Y();x.setup()});return i(G)};Pa("mousewheel disableTextSelect enableTextSelect".split(/ /));var u=".reel",B="jquery-reel",Va=B+"-overlay",Da="indicator",hb="preloader",gb="monitor",Wa="interface",S="tick"+u,ra="down drag up wheel pause",sa="play",C=i(Na),Xa=/iphone|ipod|ipad|android/i.test(navigator.userAgent),
aa="w-resize",R,Ua="data:image/gif;base64,R0lGODlhCAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7",Ca="data:image/gif;base64,R0lGODlhEAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAI3lC8AeBDvgosQxQtne7yvLWGStVBelXBKqDJpNzLKq3xWBlU2nUs4C/O8cCvU0EfZGUwt19FYAAA7",kb="data:image/gif;base64,R0lGODlhEAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAIslI95EB3MHECxNjBVdE/5b2zcRV1QBabqhwltq41St4hj5konmVioZ6OtEgUAOw==",ia=Math.round,ga=Math.floor,wa=Math.ceil,la=Math.min,H=Math.max,La=Math.abs,lb=
Math.sqrt,I=parseInt,Aa="backup",W="bit",ca="clicked",Ha="clicked_location",Ia="clicked_on",U="dimensions",Ja="distance_dragged",o="fraction",D="frame",L="frames",$="hotspot",T="image",za="indicator_travel",fa="last_fraction",ea="playing",y="reversed",va="revolution",V="rows",ua="spacing",X="speed",M="stage",K="steps",ya="stitched_travel",da="stopped",F="velocity",xa="wheel_step",db="dblclick"+u,eb="mousedown"+u,ab="mouseenter"+u,bb="mouseleave"+u,N="mousemove"+u,Z="mouseup"+u,cb="mousewheel"+u,pa=
"",Ma=" ",O="absolute",Ta="class",qa="div",E=Oa(qa),oa="height",Ea="#000",Sa="id",Ra="img",q="px",ma="src",fb="title",na="width"})(jQuery,window,document);
