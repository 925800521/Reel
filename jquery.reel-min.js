/*
 Copyright (c) 2009-2010 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 http://jquery.vostrel.cz/reel
 Version: 1.1 RC 2
 Updated: 2010-11-06

 Requires jQuery 1.4.2
*/
jQuery.fn.reel||function(k,ca,ab,n){function bb(l){return"<"+l+"/>"}function da(l){return"."+l}function ea(l){return"url("+l+")"}function z(l){return+l.toFixed(4)}function Q(l,a,t){return R(l,Da(a,t))}function cb(l){function a(){k.fn[this]||(k.fn[this]=function(){return this})}k.each(l,a)}function fa(l,a){return D(l)*(a?-1:1)}function S(l){return l.originalEvent.touches[0]}var db=k.reel={footage:6,frame:1,frames:36,hint:"",horizontal:true,hotspot:n,indicator:0,klass:"",loops:true,reversed:n,spacing:0,
stitched:n,suffix:"-reel",tooltip:"",area:n,brake:0.5,clickfree:false,couple:n,cw:false,delay:-1,directional:false,draggable:true,entry:n,graph:n,image:n,images:[],laziness:8,monitor:n,maximum:100,minimum:0,opening:0,path:"",preloader:4,rebound:0.5,revolution:n,row:1,rows:0,speed:0,step:n,steps:n,tempo:18,timeout:2,throwable:true,value:n,wheelable:true};k.fn.reel=function(l){var a=k.extend({},db,l);l=function(g){var d=[];g.filter(eb).each(function(){var c=k(this),m=a.images.length&&a.images||a.image||
c.attr(Ea),s=T(c.css(Fa)),u=T(c.css(Ga));!m||m==Ha||!s||!u||d.push(c)});g.filter(Ia+da(v)).each(function(){d.push(k(this))});return k(d)}(this);var t=[],E=a.tempo/=fb?a.laziness:1,F=1E3/E;a.reversed&&(a.cw=true);a.tooltip&&(a.hint=a.tooltip);a.hotspot&&(a.area=a.hotspot);ga=ga||function g(){w.trigger(A);return setTimeout(g,F)}();l.each(function(){var g=k(this),d=function(f,b){g.data(f,b);g.trigger("store");return b},c=function(f){g.trigger("recall");return g.data(f)},m=function(f){gb||delete this;
return f},s={setup:function(f){if(g.hasClass(v))return m.call(f);var b=g.attr(Ea),e=g.attr(hb),i=g.attr("style"),h=a.images,j=a.stitched,q=a.loops,p={x:T(g.css(Fa)),y:T(g.css(Ga))},x=d(Ja,!a.rows&&h.length||a.frames),ib=j?1:Ka(x/a.footage),ha={display:"block",width:p.x,height:p.y};e="#"+e+a.suffix;var La=g.attr("className"),ia={position:"relative",width:p.x,height:p.y};ia=k(L,{id:e.substr(1),className:La+U+jb,css:ia});ha=g.wrap(ia).attr({className:v,style:ha}).bind(s);t.push(ha[0]);d(ja,h.length&&
h.length||a.image||b.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2"));d(Ma,La);d(G,a.frame);d(Na,a.spacing);d(B,p);d(o,0);d(ka,a.steps||a.frames);d(V,a.revolution||j/2||p.x*2);d(la,ib);d(W,1/(x-(q&&!j?0:1)));d(kb,1/R(x,c(ka)));d(Oa,j);d(Pa,j-(q?0:p.x));d(Qa,p.x-a.indicator);d(X,e);d(C,d(ma,a.speed)<0);d(H,0);d(y,(a.row-1)/(a.rows-1));d(I,a.value||0);d(Y,fa(1,!a.cw&&!j));d(Ra,{src:b,style:i||Ha});ga&&w.bind(A,s.tick);m.call(f);g.trigger("start")},teardown:function(f){g.unbind(r).unbind(s);
var b=g.data("events"),e=g.clone().attr(g.data(Ra)).removeClass(v).addClass(c(Ma));for(var i in b)k.each(b[i],function(h,j){e.bind(i+"."+j.namespace,j.handler,j.data)});k(c(X)).before(e).detach();Z();w.unbind($).unbind(aa).unbind(A,s.tick).unbind(A,s.opening_tick);m.call(f)},start:function(){var f=c(B),b=c(Ja),e=R(b,c(ka));e=d(o,1/e*((a.step||a.frame)-1));d(G,e*b+1);g.attr("id");b=g.parent();e=k(L,{className:lb,css:{position:ba,left:0,top:0,width:f.x,height:f.y,background:na,opacity:0}}).appendTo(b);
e=d(oa,k(a.area||e));var i=g.add(a.couple);mb?e.css({WebkitUserSelect:"none",WebkitBackgroundSize:a.images.length?"auto":c(Oa)||f.x*a.footage+"px "+f.y*c(la)*(a.rows||1)*(a.directional?2:1)+"px"}).bind(nb,function(h){i.trigger("down",[S(h).clientX,S(h).clientY,true]);return false}).bind(ob,function(h){i.trigger("slide",[S(h).clientX,S(h).clientY,true]);return false}).bind(pb,function(){i.trigger("up",[true]);return false}).bind(qb,function(){i.trigger("up",[true]);return false}):e.css({cursor:"url("+
Sa+"), "+pa}).bind(aa,function(h){i.trigger("over",[h.pageX,h.pageY])}).bind(rb,function(h,j){i.trigger("wheel",[j]);return false}).bind(sb,function(){i.trigger("play")}).bind(a.clickfree?tb:ub,function(h){i.trigger("down",[h.clientX,h.clientY]);return false}).bind(a.clickfree?vb:$,function(){i.trigger("up");return false}).disableTextSelect();a.hint&&e.attr(wb,a.hint);a.monitor&&b.append(qa=k(L,{className:xb,css:{position:ba,left:0,top:0}}))||(qa=k());a.indicator&&b.append(Ta("x"));a.rows&&a.indicator&&
b.append(Ta("y"));g.trigger("preload")},preload:function(f){var b=c(B),e=g.parent(),i=c(ja),h=a.images;i=!h.length?[i]:[].concat(h);var j=g[0];j.frames=i.length;j.preloads=j.preloads||[];j.preloaded=j.preloaded||0;g.trigger("stop");for(e.append(ra=k(L,{className:yb,css:{position:ba,left:0,top:b.y-a.preloader,height:a.preloader,backgroundColor:na}}));i.length;){h=new Image;var q=a.path+i.shift();e.append(k(h).hide().bind("load"+r,function(){j.preloaded++;ra.css({width:1/j.frames*j.preloaded*b.x});
if(j.frames==j.preloaded){ra.remove();a.value!=n&&g.trigger("valueChange",c(I));g.trigger(a.rows&&!a.stitched?"rowChange":"frameChange");m.call(f);g.trigger("loaded").attr({src:zb});g.trigger("opening")}}));h.src=q;j.preloads.push(h)}},tick:function(f){var b=c(H);if(M){var e=z(b-Ab*M);b=!(b*e<=0||b<D(e))&&d(H,b>D(c(ma))?e:(M=u=0))}qa.text(c(a.monitor));b&&M++;u&&u++;Ua(0);g[0].value!=c(I)&&g.trigger("valueChange",g[0].value);if(u&&!b)return m.call(f);if(c(sa))return m.call(f,J());e=c(Y)*fa(1,c(C));
var i=(c(ta)?b:D(c(ma))+b)/a.tempo;b=c(o);e=d(o,b-i*e);m.call(f);e!=b&&g.trigger("fractionChange")},opening:function(){if(!a.opening)return g.trigger("fractionChange")&&Va();var f=a.entry||a.speed,b=c(o),e=a.opening;d(o,b-f*a.opening);d(ua,e*E);g.trigger("stop");w.bind(A,s.opening_tick)},opening_tick:function(f){var b=(a.entry||a.speed)/a.tempo*(a.cw?-1:1),e=c(o);d(o,z(e+b));b=d(ua,c(ua)-1);g.trigger("fractionChange");m.call(f);if(!(b>1)){w.unbind(A,s.opening_tick);Va()}},play:function(f){var b=d(va,
true);d(ta,!b);Wa();m.call(f)},pause:function(f){d(va,false);J();m.call(f)},stop:function(f){var b=d(ta,true);d(va,!b);m.call(f)},down:function(f,b,e,i){if(!a.draggable)return m.call(f);d(sa,true);d(H,0);wa(b,e,c(o),c(V),c(y));xa=n;J();Z();!i&&w.bind(aa,function(h){g.trigger("slide",[h.clientX,h.clientY]);m.call(h)}).css({cursor:ea(Bb)+", "+pa})&&!a.clickfree&&w.bind($,function(h){g.trigger("up");m.call(h)})&&c(oa);m.call(f)},up:function(f,b){if(!a.draggable)return m.call(f);d(sa,false);var e=d(H,
!a.throwable?0:D(N[0]+N[1])/60);M=e?1:0;e?Wa():J();Z();!b&&w.unbind($).unbind(aa)&&c(oa).css({cursor:ea(Sa)+", "+pa});m.call(f)},slide:function(f,b,e){if(!a.draggable)return m.call(f);var i=c(V),h=c(Xa),j=Ua(b-xa||0),q=d(o,Ya(b-h.x,c(ya),i,c(za),c(Aa),c(Y)));j&&d(C,j<0);if(a.rows){j=c(B).y;var p=c(Za),x=-p*j;d(y,z(k.reel.math.envelope(e-h.y,p,j,x,x+j,-1)))}!(q%1)&&!a.loops&&wa(b,e,q,i,c(y));J();xa=b;m.call(f);g.trigger("fractionChange")},wheel:function(f,b){if(!a.wheelable)return m.call(f);var e=
Ka(Cb(D(b))/2);e=fa(e,b>0);b=0.2*c(V);wa(n,n,c(o),b,c(y));d(o,Ya(e,c(ya),b,c(za),c(Aa),c(Y)));e&&d(C,e<0);d(H,0);J();m.call(f);g.trigger("fractionChange");return false},fractionChange:function(f,b,e){b=!b?c(o):d(o,b);b=a.loops?b-O(b):Q(0,1,b);b=d(o,z(b));d(G,1+O(b/c(W)));d(I,z(k.reel.math.interpolate(b,a.minimum,a.maximum)));if(!a.loops&&a.rebound){!u&&!(b%1)?Ba++:(Ba=0);Ba>=a.rebound*1E3/a.tempo&&d(C,!c(C))}m.call(f);e||g.trigger("valueChange");g.trigger(a.rows&&!a.stitched?"rowChange":"frameChange")},
rowChange:function(f,b){var e=O(c(o)/c(W))+1;b=d(y,Q(0,1,z(b!=n?(b-1)/(a.rows-1):c(y))));d(G,e+(!a.rows?0:P(b*(a.rows-1))*a.frames));m.call(f);g.trigger("frameChange")},frameChange:function(f,b){var e=!b?c(o):d(o,z(c(W)*(b-1)));b=d(G,P(b?b:c(G)));var i=a.images,h=a.footage,j=a.horizontal;if(a.stitched)j=[-P(e*c(Pa))+K,0+K];else{var q=b%h-1;q=q<0?h-1:q;var p=O((b-0.1)/h);p+=a.rows?0:c(C)?0:c(la);h=c(B);var x=c(Na);p=p*((j?h.y:h.x)+x);q=q*((j?h.x:h.y)+x);j=i.length?[0,0]:j?[-q+K,-p+K]:[-p+K,-q+K]}b=
i[b-1]||c(ja);i=c(Qa);e=Q(0,i,P(k.reel.math.interpolate(e,-1,i+2)));e=!a.cw||a.stitched?e:i-e;i={background:ea(a.path+b)+U+j.join(U)};a.images.length?g.attr({src:a.path+b}):g.css(i);k(da(Ca+".x"),c(X)).css({left:e});if(!a.rows)return m.call(f);e=c(B).y-a.indicator;e=Q(0,e,P(k.reel.math.interpolate(c(y),-1,e+2)));k(da(Ca+".y"),c(X)).css({top:e});m.call(f)},valueChange:function(f,b){f=b!==n&&d(o,b/(a.maximum-a.minimum));g[0].value=b===n?c(I):d(I,b);f===false||g.trigger("fractionChange",[n,true])}},
u,M=0,Wa=function(){return u=0},J=function(){clearTimeout($a);w.unbind(A,s.opening_tick);g.trigger("play");return u=-a.timeout*a.tempo},$a,Va=function(){$a=setTimeout(function(){g.trigger("play")},a.delay*1E3||0)},qa,ra,Ta=function(f){return k(L,{className:[Ca,f].join(U),css:{width:a.indicator,height:a.indicator,top:f=="y"?n:c(B).y-a.indicator,left:f=="x"?n:0,position:ba,backgroundColor:na}})},Ba=0,xa=0,Ua=function(f){return N.push(f)&&N.shift()&&f},Z=function(){return N=[0,0]},N=Z(),Ab=a.brake/a.tempo,
Ya=a.graph||k.reel.math[a.loops?"hatch":"envelope"],wa=function(f,b,e,i,h){d(ya,e);d(Za,h);d(za,a.loops?0:-e*i);d(Aa,a.loops?i:i-e*i);return f&&d(Xa,{x:f,y:b})||n};s.setup()});return k(t)};k.reel.math={envelope:function(l,a,t,E,F,g){return a+R(E,Da(F,-l*g))/t},hatch:function(l,a,t,E,F,g){l=(l<E?F:0)+l%F;l=a+-l*g/t;return l-O(l)},interpolate:function(l,a,t){return a+l*(t-a)}};cb("mousewheel disableTextSelect enableTextSelect".split(/ /));var w=k(ab);ca=navigator.userAgent;var mb=/iphone|ipod|ipad|android/i.test(ca),
fb=/iphone|ipod|ipad/i.test(ca),gb=k.browser.msie,pa="ew-resize",ga,v="jquery-reel",jb=v+"-overlay",Ca=v+"-indicator",yb=v+"-preloader",xb=v+"-monitor",lb=v+"-interface",zb="data:image/gif;base64,R0lGODlhCAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7",Sa="data:image/gif;base64,R0lGODlhEAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAI3lC8AeBDvgosQxQtne7yvLWGStVBelXBKqDJpNzLKq3xWBlU2nUs4C/O8cCvU0EfZGUwt19FYAAA7",Bb="data:image/gif;base64,R0lGODlhEAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAIslI95EB3MHECxNjBVdE/5b2zcRV1QBabqhwltq41St4hj5konmVioZ6OtEgUAOw==",
P=Math.round,O=Math.floor,Ka=Math.ceil,Da=Math.min,R=Math.max,D=Math.abs,Cb=Math.sqrt,T=parseInt,oa="area",Ra="backup",C="backwards",W="bit",Ma="classes",sa="clicked",Xa="clicked_location",ya="clicked_on",Za="clicked_row",Y="cwish",B="dimensions",o="fraction",G="frame",Ja="frames",Aa="hi",ja="image",Qa="indicator_travel",ua="opening_ticks",za="lo",va="playing",V="revolution",y="row",la="rows",Na="spacing",ma="speed",X="stage",ka="steps",Oa="stitched",Pa="stitched_travel",ta="stopped",I="value",H=
"velocity",kb="wheel_step",r=".reel",sb="dblclick"+r,ub="mousedown"+r,tb="mouseenter"+r,vb="mouseleave"+r,aa="mousemove"+r,$="mouseup"+r,rb="mousewheel"+r,A="tick"+r,qb="touchcancel"+r,pb="touchend"+r,nb="touchstart"+r,ob="touchmove"+r,Ha="",U=" ",ba="absolute",Ia="div",L=bb(Ia),Ga="height",na="#000",hb="id",eb="img",K="px",Ea="src",wb="title",Fa="width"}(jQuery,window,document);
