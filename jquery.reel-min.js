/*
 Copyright (c) 2009-2010 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 jQuery Reel
 http://jquery.vostrel.cz/reel
 Version: 1.1.1-devel
 Updated: 2011-04-03

 Requires jQuery 1.4.2 or higher
*/
jQuery.reel||function(j,T,eb,p){function fb(l){return"<"+l+"/>"}function ia(l){return"."+l}function gb(l){return"http://code.vostrel.cz/"+l}function ja(l){return"url("+l+")"}function G(l){return+l.toFixed(4)}function U(l,a,u){return M(l,Ia(a,u))}function hb(l){function a(){j.fn[this]||(j.fn[this]=function(){return this})}j.each(l,a)}function ka(l,a){return v(l)*(a?-1:1)}function V(l){return l.originalEvent.touches[0]}j.reel={version:"1.1.1-devel",def:{footage:6,frame:1,frames:36,hint:"",horizontal:true,
hotspot:p,indicator:0,klass:"",loops:true,reversed:p,spacing:0,stitched:p,suffix:"-reel",tooltip:"",area:p,brake:0.5,clickfree:false,cw:false,delay:-1,directional:false,draggable:true,entry:p,graph:p,image:p,images:[],inversed:false,laziness:6,monitor:p,opening:0,orbital:0,path:"",preloader:4,rebound:0.5,revolution:p,row:1,rows:0,speed:0,step:p,steps:p,tempo:36,timeout:2,throwable:true,vertical:false,wheelable:true}};j.fn.reel=function(l){var a=j.extend({},j.reel.def,l);l=function(h){var d=[];h.filter(ib).each(function(){var c=
j(this),s=a.images.length&&a.images||a.image||c.attr(Ja),m=W(c.css(Ka)),w=W(c.css(La));!s||s==Ma||!m||!w||d.push(c)});h.filter(Na+ia(x)).each(function(){d.push(j(this))});return j(d)}(this);var u=[],t=a.tempo/(j.reel.lazy?a.laziness:1),D=1E3/t,H=D;a.reversed&&(a.cw=true);a.tooltip&&(a.hint=a.tooltip);a.hotspot&&(a.area=a.hotspot);X=X||function h(){Y={before:Y.now,now:new Date};try{H+=D-la(Y.now-Y.before)}catch(d){}y.trigger(E);return X=setTimeout(h,M(3,H))}();l.each(function(){var h=j(this),d=function(f,
b){h.data(f,b);h.trigger("store",[f,b]);return b},c=function(f){var b=h.data(f);h.trigger("recall",[f,b]);return b},s={setup:function(f){if(h.hasClass(x))return m.call(f);var b=h.attr(Ja),e=h.attr(jb),g=h.attr("style"),i=a.images,k=a.stitched,n=a.loops,r={x:W(h.css(Ka)),y:W(h.css(La))},B=d(Oa,a.orbital&&a.footage||a.rows<=1&&i.length||a.frames),kb=k?1:la(B/a.footage),ma={display:"block",width:r.x,height:r.y};e="#"+e+a.suffix;var Pa=h.attr("className"),na={position:"relative",width:r.x,height:r.y};
na=j(N,{id:e.substr(1),className:Pa+Z+lb,css:na});ma=h.wrap(na).attr({className:x}).css(ma).bind(s);u.push(ma[0]);d(oa,i.length&&i.length||a.image||b.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2"));d(Qa,Pa);d(z,a.frame);d(Ra,a.spacing);d(C,r);d(o,0);d(pa,a.steps||a.frames);d($,a.revolution||k/2||r.x*2);d(qa,kb);d(aa,1/(B-(n&&!k?0:1)));d(mb,1/M(B,c(pa)));d(ra,k);d(Sa,k-(n?0:r.x));d(ba,e);d(F,d(sa,a.speed)<0);d(I,0);d(J,a.vertical);d(A,(a.row-1)/(a.rows-1));d(ca,ka(1,!a.cw&&!k));d(O,false);
d(Ta,{src:b,style:g||Ma});X&&y.bind(E,s.tick);m.call(f);h.trigger("start")},teardown:function(f){h.unbind(q).unbind(s);var b=h.data("events"),e=h.clone().attr(h.data(Ta)).removeClass(x).addClass(c(Qa));for(var g in b)j.each(b[g],function(i,k){e.bind(g+"."+k.namespace,k.handler,k.data)});j("img:hidden",h.parent()).remove();j(c(ba)).before(e).detach();da();y.unbind(ta).unbind(ua).unbind(E,s.tick).unbind(E,s.opening_tick);m.call(f)},start:function(){var f=c(C),b=c(Oa),e=M(b,c(pa));e=d(o,1/e*((a.step||
a.frame)-1));d(z,e*b+1);h.attr("id");b=h.parent();e=j(N,{className:nb,css:{position:ea,left:0,top:0,width:f.x,height:f.y,background:va,opacity:0}}).appendTo(b);e=d(Ua,j(a.area||e));if(j.reel.touchy){h.css({WebkitUserSelect:"none",WebkitBackgroundSize:a.images.length?"auto":c(ra)&&c(ra)+"px "+f.y+"px"||f.x*a.footage+"px "+f.y*c(qa)*(a.rows||1)*(a.directional?2:1)+"px"});e.bind(ob,function(g){h.trigger("down",[V(g).clientX,V(g).clientY,true])}).bind(pb,function(g){h.trigger("slide",[V(g).clientX,V(g).clientY,
true]);return!(a.rows>1||a.orbital||c(O))}).bind(qb,function(){h.trigger("up",[true]);return false}).bind(rb,function(){h.trigger("up",[true]);return false})}else e.css({cursor:"url("+Va+"), "+wa}).bind(sb,function(g,i){h.trigger("wheel",[i]);return false}).bind(tb,function(){h.trigger("play")}).bind(a.clickfree?ub:vb,function(g){h.trigger("down",[g.clientX,g.clientY]);return false}).bind(a.clickfree?wb:"",function(){h.trigger("up");return false}).disableTextSelect();a.hint&&e.attr(xb,a.hint);a.monitor&&
b.append(xa=j(N,{className:yb,css:{position:ea,left:0,top:0}}))||(xa=j());a.indicator&&b.append(Wa("x"));a.rows>1&&a.indicator&&b.append(Wa("y"));h.trigger("preload")},preload:function(f){var b=c(C),e=h.parent(),g=c(oa),i=a.images;g=!i.length?[g]:[].concat(i);var k=h[0];k.frames=g.length;k.preloaded=0;h.attr({src:zb}).trigger("stop");for(e.append(ya=j(N,{className:Ab,css:{position:ea,left:0,top:b.y-a.preloader,height:a.preloader,backgroundColor:va}}));g.length;){i=a.path+g.shift();var n=j(new Image).hide().bind("load"+
q,function(){k.preloaded++;j(this).unbind(q);ya.css({width:1/k.frames*k.preloaded*b.x});if(k.frames==k.preloaded){ya.remove();h.trigger(a.rows>1&&!a.stitched?"rowChange":"frameChange").trigger("loaded").trigger("opening");m.call(f)}});e.append(n);setTimeout(function(r,B){return function(){r.attr({src:B})}}(n,i),0)}},tick:function(f){var b=c(I);if(P){var e=G(b-Bb*P);b=!(b*e<=0||b<v(e))&&d(I,b>v(c(sa))?e:(P=w=0))}xa.text(c(a.monitor));b&&P++;w&&w++;Xa(0);za=true;if(w&&!b)return m.call(f);if(c(fa))return m.call(f,
K());e=c(ca)*ka(1,c(F));var g=(c(Aa)?b:v(c(sa))+b)/t;b=c(o);e=d(o,b-g*e);m.call(f);e!=b&&h.trigger("fractionChange")},opening:function(){var f=a.entry||a.speed,b=c(o),e=a.opening;d(o,b-f*a.opening);d(Ba,e*t);y.bind(E,s.opening_tick)},opening_tick:function(f){var b=(a.entry||a.speed)/t*(a.cw?-1:1),e=c(o);d(o,G(e+b));b=d(Ba,c(Ba)-1);h.trigger("fractionChange");m.call(f);if(!(b>1)){y.unbind(E,s.opening_tick);Cb()}},play:function(f){var b=d(Ca,true);d(Aa,!b);Ya();m.call(f)},pause:function(f){d(Ca,false);
K();m.call(f)},stop:function(f){var b=d(Aa,true);d(Ca,!b);m.call(f)},down:function(f,b,e,g){if(a.draggable){d(fa,c(z));d(I,0);ga=ha(b,e,c(o),c($),c(A));K();da();if(!g){y.css({cursor:ja(Db)+", "+wa}).bind(ua,function(i){h.trigger("slide",[i.clientX,i.clientY]);m.call(i);return false});a.clickfree||y.bind(ta,function(i){h.trigger("up");m.call(i)})}}m.call(f)},up:function(f,b){if(!a.draggable)return m.call(f);d(fa,false);d(O,false);var e=d(I,!a.throwable?0:v(Q[0]+Q[1])/60);P=e?1:0;e?Ya():K();da();!b&&
y.unbind(ta).unbind(ua)&&c(Ua).css({cursor:ja(Va)+", "+wa});m.call(f)},slide:function(f,b,e){if(a.draggable&&za){za=false;K();var g={x:b-ga.x,y:e-ga.y};if(v(g.x)>0||v(g.y)>0){ga={x:b,y:e};var i=c($),k=c(Za),n=c(J),r=d(o,$a(n?e-k.y:b-k.x,c(Da),i,c(Ea),c(Fa),c(ca)));d(O,c(O)||c(z)!=c(fa));(g=Xa(n?g.y:g.x||0))&&d(F,g<0);if(a.orbital&&c(ab)){d(J,v(e-k.y)>v(b-k.x));k=ha(b,e,r,i,c(A))}if(a.rows>1){g=c(C).y;n=c(bb);var B=-n*g;d(A,G(j.reel.math.envelope(e-k.y,n,g,B,B+g,-1)))}!(r%1)&&!a.loops&&ha(b,e,r,i,
c(A));h.trigger("fractionChange")}}m.call(f)},wheel:function(f,b){if(!a.wheelable)return m.call(f);var e=la(Eb(v(b))/2);e=ka(e,b>0);b=0.2*c($);ha(p,p,c(o),b,c(A));d(o,$a(e,c(Da),b,c(Ea),c(Fa),c(ca)));e&&d(F,e<0);d(I,0);K();m.call(f);h.trigger("fractionChange");return false},fractionChange:function(f,b){b=!b?c(o):d(o,b);b=a.loops?b-R(b):U(0,1,b);b=d(o,G(b));var e=c(z),g=d(z,1+R(b/c(aa))),i=a.orbital;d(ab,i&&(g<=i||g>=a.footage-i+2));if(!a.loops&&a.rebound){!w&&!(b%1)?Ga++:(Ga=0);Ga>=a.rebound*1E3/
t&&d(F,!c(F))}i=c(C);var k=(c(J)?i.y:i.x)-a.indicator;b=U(0,k,S(j.reel.math.interpolate(b,-1,k+2)));b=!a.cw||a.stitched?b:k-b;j(ia(Ha+".x"),c(ba)).css(c(J)?{left:0,top:b}:{left:b,top:i.y-a.indicator});if(a.rows>1){b=c(C).y-a.indicator;b=U(0,b,S(j.reel.math.interpolate(c(A),-1,b+2)));j(ia(Ha+".y"),c(ba)).css({top:b})}if(g==e&&g!=1)return m.call(f);h.trigger(a.rows>1?"rowChange":"frameChange");m.call(f)},rowChange:function(f,b){var e=R(c(o)/c(aa))+1;b=d(A,U(0,1,G(b!=p?(b-1)/(a.rows-1):c(A))));d(z,e+
(a.rows<=1?0:S(b*(a.rows-1))*a.frames));m.call(f);h.trigger("frameChange")},frameChange:function(f,b){var e=!b?c(o):d(o,G(c(aa)*(b-1)));b=d(z,S(b?b:c(z)));var g=a.images,i=a.footage,k=c(C),n=a.horizontal;if(c(J)){b=a.inversed?i+1-b:b;b+=i}if(g.length){g=g[b-1];h.attr({src:a.path+g})}else{if(a.stitched)n=[-S(e*c(Sa))+L,0+L];else{e=b%i-1;e=e<0?i-1:e;i=R((b-0.1)/i);i+=a.rows>1?0:c(F)?0:c(qa);b=c(Ra);i=i*((n?k.y:k.x)+b);k=e*((n?k.x:k.y)+b);n=g.length?[0,0]:n?[-k+L,-i+L]:[-i+L,-k+L]}g=c(oa);h.css({background:ja(a.path+
g)+Z+n.join(Z)})}m.call(f)}},m=function(f){cb||delete this;return f},w,P=0,Ya=function(){return w=0},K=function(){clearTimeout(db);y.unbind(E,s.opening_tick);h.trigger("play");return w=-a.timeout*t},db,Cb=function(){db=setTimeout(function(){h.trigger("play")},a.delay*1E3||0)},xa,ya,Wa=function(f){return j(N,{className:[Ha,f].join(Z),css:{width:a.indicator,height:a.indicator,top:c(C).y-a.indicator,left:0,position:ea,backgroundColor:va}})},Ga=0,ga={x:0,y:0},Xa=function(f){return Q.push(f)&&Q.shift()&&
f},da=function(){return Q=[0,0]},Q=da(),Bb=a.brake/t,$a=a.graph||j.reel.math[a.loops?"hatch":"envelope"],ha=function(f,b,e,g,i){d(Da,e);d(bb,i);d(Ea,a.loops?0:-e*g);d(Fa,a.loops?g:g-e*g);return f&&d(Za,{x:f,y:b})||p},za=true;s.setup()});return j(u)};j.reel.math={envelope:function(l,a,u,t,D,H){return a+M(t,Ia(D,-l*H))/u},hatch:function(l,a,u,t,D,H){l=(l<t?D:0)+l%D;l=a+-l*H/u;return l-R(l)},interpolate:function(l,a,u){return a+l*(u-a)}};j.reel.touchy=/iphone|ipod|ipad|android/i.test(navigator.userAgent);
j.reel.lazy=/iphone|ipod|android/i.test(navigator.userAgent);hb("mousewheel disableTextSelect enableTextSelect".split(/ /));var y=j(eb);T=+j.browser.version.split(".").slice(0,2).join(".");var cb=j.browser.msie;T=!(cb&&T<8);var wa="ew-resize",X,Y={before:0,now:new Date},x="jquery-reel",lb=x+"-overlay",Ha=x+"-indicator",Ab=x+"-preloader",yb=x+"-monitor",nb=x+"-interface",zb=T?"data:image/gif;base64,R0lGODlhCAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7":gb("blank.gif"),Va="data:image/gif;base64,R0lGODlhEAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAI3lC8AeBDvgosQxQtne7yvLWGStVBelXBKqDJpNzLKq3xWBlU2nUs4C/O8cCvU0EfZGUwt19FYAAA7",
Db="data:image/gif;base64,R0lGODlhEAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAIslI95EB3MHECxNjBVdE/5b2zcRV1QBabqhwltq41St4hj5konmVioZ6OtEgUAOw==",S=Math.round,R=Math.floor,la=Math.ceil,Ia=Math.min,M=Math.max,v=Math.abs,Eb=Math.sqrt,W=parseInt,Ua="area",Ta="backup",F="backwards",aa="bit",ab="center",Qa="classes",fa="clicked",Za="clicked_location",Da="clicked_on",bb="clicked_row",ca="cwish",C="dimensions",o="fraction",z="frame",Oa="frames",Fa="hi",oa="image",Ba="opening_ticks",Ea="lo",Ca="playing",
O="reeling",$="revolution",A="row",qa="rows",Ra="spacing",sa="speed",ba="stage",pa="steps",ra="stitched",Sa="stitched_travel",Aa="stopped",I="velocity",J="vertical",mb="wheel_step",q=".reel",tb="dblclick"+q,vb="mousedown"+q,ub="mouseenter"+q,wb="mouseleave"+q,ua="mousemove"+q,ta="mouseup"+q,sb="mousewheel"+q,E="tick"+q,rb="touchcancel"+q,qb="touchend"+q,ob="touchstart"+q,pb="touchmove"+q,Ma="",Z=" ",ea="absolute",Na="div",N=fb(Na),La="height",va="#000",jb="id",ib="img",L="px",Ja="src",xb="title",
Ka="width"}(jQuery,window,document);
