/*
 Copyright (c) 2009-2010 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 http://jquery.vostrel.cz/reel
 Version: "Dancer" (will be 1.1 on release)
 Updated: 2010-05-24

 Requires jQuery 1.4.x
*/
(function(m){function x(n){return"."+n}function pa(n){return"url("+n+")"}function K(n,r){return+r.toFixed(n)}function V(n,r,a){return y(n,W(r,a))}function qa(n,r){return n*r>0?r:-r}function ra(n){m.each(n,function(){m.fn[this]||(m.fn[this]=function(){return this})})}var sa={footage:6,frame:1,frames:36,hint:"",horizontal:true,hotspot:undefined,indicator:0,klass:"",loops:true,reversed:false,saves:false,sensitivity:20,spacing:0,stitched:undefined,suffix:"-reel",tooltip:"",delay:-1,friction:0.8,inertial:true,
monitor:undefined,rebound:0.5,revolution:undefined,speed:0,step:undefined,steps:undefined,tempo:25,timeout:2};m.fn.reel=function(n){var r=function(c){var d=[];c.filter(X).each(function(){var g=m(this),s=g.attr(Y),u=E(g.css(Z)),v=E(g.css($));!s||s==F||!u||!v||d.push(g)});c.filter(aa+x(L)).each(function(){d.push(m(this))});return m(d)}(this),a=m.extend({},sa,n),ba=[];G=G||function(){return setInterval(function(){z.trigger(M)},1E3/a.tempo)}();r.each(function(){var c=m(this),d=function(e,b){c.data(e,
b);c.trigger("store");return b},g=function(e){c.trigger("recall");return c.data(e)},s={setup:function(){if(!c.hasClass(L)){var e=c.attr(Y),b=c.attr(N),f=c.attr(ca),i=c.attr("style");e=e.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2");var h={x:E(c.css(Z)),y:E(c.css($))},j=m(O).attr(ca,f).addClass(L).addClass(a.klass),k=da||!a.saves?{display:"none"}:{opacity:0};ba.push((c=c.attr(N,F).wrap(j).css(k).parent().attr(N,b).bind(s).css({display:"block",width:h.x+p,height:h.y+p,backgroundImage:pa(e)}))[0]);
d(A,a.frames);d(ea,a.spacing);d(H,h);d(o,0);d(I,a.steps||a.frames);d("resolution",y(a.steps,a.frames));d(fa,a.speed<0);d(ga,{id:b,"class":f||F,style:i||F});G&&z.bind(M,s.tick);c.trigger("start")}},teardown:function(){c=c.unbind(s).find(x(P)+", "+x(Q)).remove().end().find(X).attr(c.data(ga)).unwrap().bind("setup",function(){c.unbind("setup");s.setup()});G&&z.unbind(M,s.tick)},start:function(){c.css({position:"relative"});var e=a.hotspot?a.hotspot:c,b=g(H),f=g(A),i=y(f,g(I));i=d(o,1/i*((a.step||a.frame)-
1));d(B,i*f+1);e.css({cursor:"ew-resize"}).mouseenter(function(){c.trigger("enter")}).mouseleave(function(){c.trigger("leave")}).mousemove(function(h){c.trigger("over",[h.clientX,h.clientY])}).mousewheel(function(h,j){c.trigger("wheel",[j]);return false}).dblclick(function(){c.trigger("animate")}).mousedown(function(h){c.trigger("down",[h.clientX,h.clientY])}).disableTextSelect().each(function(){function h(q,w){m.each(w,function(ta){q.addEventListener(ta,this,false)})}function j(q){q.cancelable&&
q.preventDefault();return false}function k(q){var w=q.touches[0];d(C,true);d(R,w.clientX);return j(q)}function l(q){var w=q.touches[0];c.trigger("drag",[w.clientX,w.clientY]);return j(q)}function ha(q){d(C,false);return j(q)}da&&h(this,{touchstart:k,touchmove:l,touchend:ha,touchcancel:ha,click:j,gesturestart:j,gesturechange:j,gestureend:j})});(a.hint||a.tooltip)&&e.attr(ua,a.hint||a.tooltip);a.monitor&&c.append(m(O,{className:Q,css:{position:ia,left:0,top:0}}));a.indicator&&c.append(m(O).addClass(P).css({width:a.indicator+
p,height:a.indicator+p,top:b.y-a.indicator+p,position:ia,backgroundColor:va}));c.trigger("frameChange")},animate:function(){},tick:function(){var e=a.speed,b=a.friction/a.tempo,f=g(D),i=f<0;f-=f*b;f=ja=f==ja?0:f;f=(i?W:y)(0,K(3,f))||0;f=d(D,f);step=(e+f)/a.tempo;m(x(Q),c).text(g(a.monitor));ka(0);u&&u++;if(!(u&&!f)){if(g(C))return v();d(o,g(o)+step);c.trigger("fractionChange")}},down:function(e,b){v();d(C,true);d(R,b);d(D,0);d(S,d(la,g(o)));z.mousemove(function(f){c.trigger("drag",[f.clientX,f.clientY])}).mouseup(function(){c.trigger("up")})},
up:function(){d(C,false);var e=t[1]+t[2]!=0,b=(t[0]+t[1]+t[2])/t.length/20;d(D,a.inertial&&e?a.stitched?-b:b:0);ma();u=0;z.unbind("mousemove mouseup")},drag:function(e,b){v();e=g(R);var f=g(la),i=a.stitched,h=g(H);d(o,f+(a.reversed?-1:1)*(i?-1:1)/(a.revolution||i/2||h.x)*(b-e));ka(b-na);na=b;c.trigger("fractionChange")},wheel:function(e,b){v();d(D,0);e=g(o);var f=1/y(g(A),g(I)),i=T(wa(xa(b))/2);i=b<0?-i:i;d(o,e+i*f);c.trigger("fractionChange");return false},fractionChange:function(e,b){b=!b?g(o):
d(o,b);e=g(S);e=a.speed=qa(b-e,a.speed);b=a.loops?b-(b<0?T:oa)(b):V(0,1,b);a.speed=!a.loops&&a.rebound&&U==a.rebound*1E3/a.tempo?-e:e;b=!a.loops?b:b>=0?b:1+b;b=d(S,d(o,K(6,b)));d(B,b*(g(A)-1)+1);!u&&(U=b==0||b==1?U+1:0);c.trigger("frameChange")},frameChange:function(e,b){var f=g(A);e=!b?g(o):d(o,K(6,(b-1)/(f-1)));b=!b?g(B):d(B,b);b=d(B,J(b));var i=g(H);g(I);var h=g(ea),j=g(fa);if(a.stitched){h=a.loops?a.stitched:a.stitched-i.x;k=J(e*h);l=0;j=[-k+p,l+p]}else{k=oa(b/a.footage);l=b-k*a.footage-1;k=l==
-1?k+l:k;l=l==-1?a.footage+l:l;b=a.horizontal?i.y:i.x;var k=-k*(h+b),l=-l*(h+(a.horizontal?i.x:i.y));f=T(f/a.footage);h=f*b+(f-1)*h;k=j&&a.horizontal?k-h:k;l=j&&!a.horizontal?l-h:l;j=a.horizontal?[l+p,k+p]:[k+p,l+p]}h=i.x-a.indicator;e=V(0,h,J(e*(h+2))-1);c.css({backgroundPosition:j.join(" ")}).find(x(P)).css({left:e+p})}},u=a.delay>0?-J(a.delay*a.tempo):0,v=function(){return u=-a.timeout*a.tempo},U=0,na=0,ja=0,ka=function(e){t.push(e)&&t.shift()},ma=function(){return t=[0,0,0]},t=ma();c.ready(s.setup)});
return m(ba)};ra("mousewheel disableTextSelect".split(/ /));var L="jquery-reel",M="tick.reel",z=m(document),da=/iphone|ipod|ipad|android/i.test(navigator.userAgent),G,E=parseInt,J=Math.round,oa=Math.floor,T=Math.ceil,W=Math.min,y=Math.max,wa=Math.sqrt,xa=Math.abs,ga="backup",C="clicked",R="clicked_location",la="clicked_on",H="dimensions",o="fraction",B="frame",A="frames",S="last_fraction",fa="reversed",ea="spacing",I="steps",D="velocity",F="",ia="absolute",ca="class",aa="div",O="<"+aa+"/>",$="height",
va="#000",N="id",X="img",P="indicator",Q="monitor",p="px",Y="src",ua="title",Z="width"})(jQuery);
