/*
 Copyright (c) 2009-2010 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 http://jquery.vostrel.cz/reel
 Version: "Dancer" (will be 1.1 on release)
 Updated: 2010-08-06

 Requires jQuery 1.4.x
*/
(function(k,lb,Ma,r){function Na(i){return"<"+i+"/>"}function qa(i){return"."+i}function S(i){return"url("+i+")"}function T(i){return+i.toFixed(4)}function ra(i,a,s){return H(i,sa(a,s))}function Oa(i){function a(){k.fn[this]||(k.fn[this]=function(){return this})}k.each(i,a)}function U(i,a){return y(i)*(a?-1:1)}function I(i){return i.originalEvent.touches[0]}var Pa=k.reel={footage:6,frame:1,frames:36,hint:"",horizontal:true,hotspot:r,indicator:0,klass:"",loops:true,reversed:r,spacing:0,stitched:r,
suffix:"-reel",tooltip:"",brake:0.5,cw:false,delay:-1,draggable:true,graph:r,image:r,images:[],monitor:r,path:"",preloader:4,rebound:0.5,revolution:r,speed:0,step:r,steps:r,tempo:25,timeout:2,throwable:true,wheelable:true};k.fn.reel=function(i){var a=k.extend({},Pa,i);i=function(e){var c=[];e.filter(Qa).each(function(){var d=k(this),l=a.images.length&&a.images||a.image||d.attr(ta),v=J(d.css(ua)),t=J(d.css(va));!l||l==wa||!v||!t||c.push(d)});e.filter(xa+qa(C)).each(function(){c.push(k(this))});return k(c)}(this);
var s=[];a.reversed&&(a.cw=true);a.tooltip&&(a.hint=a.tooltip);V=V||function e(){D.trigger(W);return setTimeout(e,1E3/a.tempo)}();i.each(function(){var e=k(this),c=function(f,b){e.data(f,b);e.trigger("store");return b},d=function(f){e.trigger("recall");return e.data(f)},l=function(f){delete this;return f},v={setup:function(f){if(e.hasClass(C))return l.call(f);var b=e.attr(ta),g=e.attr(Ra),j=e.attr("style"),h=a.images,n=a.stitched,o=a.loops,m={x:J(e.css(ua)),y:J(e.css(va))},u={display:"block",width:m.x,
height:m.y};u=e.attr({src:a.images?Sa:b}).bind(v).addClass(C).css(u);s.push(u[0]);c(X,h.length&&h.length||a.image||b.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2"));c(E,a.frame);c(ya,a.spacing);c(Y,m);c(p,0);c(Z,a.steps||a.frames);c(K,a.revolution||n/2||m.x);c(za,Aa(c(L,h.length||a.frames)/a.footage));c($,1/(d(L)-(o&&!n?0:1)));c(Ta,1/H(d(L),d(Z)));c(Ba,n-(o?0:m.x));c(Ca,m.x-a.indicator);c(M,"#"+g+a.suffix);c(w,c(aa,a.speed)<0);c(z,0);c(N,U(1,!a.cw&&!n));c(Da,{src:b,style:j||wa});V&&D.bind(W,
v.tick);l.call(f);e.trigger("start")},teardown:function(f){k(d(M)).remove();e.removeClass(C).unbind(q).unbind(v).attr(e.data(Da)).enableTextSelect().removeData();O();D.unbind(ba).unbind(P).unbind(W,v.tick);l.call(f)},start:function(f){var b=d(Y),g=d(L),j=H(g,d(Z));j=c(p,1/j*((a.step||a.frame)-1));c(E,j*g+1);g=d(X);j=a.images;g=!j.length?[g]:[].concat(j);e.attr("id");var h=e[0];h.frames=g.length;h.preloads=h.preloads||[];h.preloaded=h.preloaded||0;j=g.length!=h.preloads.length;var n=d(M).substr(1);
n=k(F,{className:Ua,id:n,css:{position:"relative",width:b.x}}).insertAfter(e);var o=k(F,{className:Va,css:{position:Q,left:0,top:-b.y,width:b.x,height:b.y}}).appendTo(n);o=c(ca,k(a.hotspot||o));Wa?o.css({WebkitUserSelect:"none"}).bind(Xa,function(m){e.trigger("down",[I(m).clientX,I(m).clientY,true]);return false}).bind(Ya,function(m){e.trigger("drag",[I(m).clientX,I(m).clientY,true]);return false}).bind(Za,function(){e.trigger("up",[true]);return false}).bind($a,function(){e.trigger("up",[true]);
return false}):o.css({cursor:"url("+Ea+"), "+da}).bind(ab,function(){e.trigger("enter")}).bind(bb,function(){e.trigger("leave")}).bind(P,function(m){e.trigger("over",[m.pageX,m.pageY])}).bind(cb,function(m,u){e.trigger("wheel",[u]);return false}).bind(db,function(){e.trigger("animate")}).bind(eb,function(m){e.trigger("down",[m.clientX,m.clientY]);return false}).disableTextSelect();a.hint&&o.attr(fb,a.hint);a.monitor&&n.append(ea=k(F,{className:gb,css:{position:Q,left:0,top:-b.y}}))||(ea=k());a.indicator&&
n.append(k(F,{className:Fa,css:{width:a.indicator,height:a.indicator,top:-a.indicator,position:Q,backgroundColor:Ga}}));if(j)for(n.append(fa=k(F,{className:hb,css:{position:Q,left:0,top:-a.preloader,height:a.preloader,backgroundColor:Ga}}));g.length;){j=new Image;n=a.path+g.shift();k(j).load(function(){h.preloaded++;fa.css({width:1/h.frames*h.preloaded*b.x});h.frames==h.preloaded&&fa.remove()});j.src=n;h.preloads.push(j)}a.delay>0&&x();l.call(f);e.trigger("frameChange")},animate:function(){},tick:function(f){var b=
d(z);if(G){var g=T(b-ib*G);b=!(b*g<=0||b<y(g))&&c(z,b>y(d(aa))?g:(G=t=0))}ea.text(d(a.monitor));b&&G++;t&&t++;Ha(0);if(t&&!b)return l.call(f);if(d(ga))return l.call(f,x());g=d(N)*U(1,d(w));b=(d(ha)?b:y(d(aa))+b)/a.tempo;c(p,d(p)-b*g);l.call(f);e.trigger("fractionChange")},play:function(f){var b=c(ia,true);c(ha,!b);Ia();l.call(f)},pause:function(f){c(ia,false);x();l.call(f)},stop:function(f){var b=c(ha,true);c(ia,!b);l.call(f)},down:function(f,b,g,j){if(!a.draggable)return l.call(f);c(ga,true);c(z,
0);ja(b,d(p),d(K));ka=r;x();O();!j&&D.bind(P,function(h){e.trigger("drag",[h.clientX,h.clientY]);l.call(h)}).bind(ba,function(h){e.trigger("up");l.call(h)})&&d(ca).css({cursor:S(jb)+", "+da});l.call(f)},up:function(f,b){if(!a.draggable)return l.call(f);c(ga,false);var g=c(z,!a.throwable?0:y(A[0]+A[1]+A[2])/60);G=g?1:0;g?Ia():x();O();!b&&D.unbind(ba).unbind(P)&&d(ca).css({cursor:S(Ea)+", "+da});l.call(f)},drag:function(f,b){if(!a.draggable)return l.call(f);var g=d(K),j=d(Ja),h=Ha(b-ka||0);j=c(p,Ka(b-
j,d(la),g,d(ma),d(na),d(N)));h&&c(w,h<0);!(j%1)&&!a.loops&&ja(b,j,g);x();ka=b;l.call(f);e.trigger("fractionChange")},wheel:function(f,b){if(!a.wheelable)return l.call(f);var g=Aa(kb(y(b))/2);g=U(g,b>0);b=0.2*d(K);ja(r,d(p),b);c(p,Ka(g,d(la),b,d(ma),d(na),d(N)));g&&c(w,g<0);c(z,0);x();l.call(f);e.trigger("fractionChange");return false},fractionChange:function(f,b){b=!b?d(p):c(p,b);b=a.loops?b-R(b):ra(0,1,b);b=c(p,T(b));c(E,1+R(b/d($)));if(!a.loops&&a.rebound){!t&&!(b%1)?oa++:(oa=0);oa>=a.rebound*1E3/
a.tempo&&c(w,!d(w))}l.call(f);e.trigger("frameChange")},frameChange:function(f,b){var g=!b?d(p):c(p,T(d($)*(b-1)));b=c(E,pa(b?b:d(E)));var j=a.images,h=a.footage,n=a.horizontal;if(a.stitched)n=[-pa(g*d(Ba))+B,0+B];else{var o=b%h-1;o=o<0?h-1:o;var m=R((b-0.1)/h);m+=d(w)?0:d(za);h=d(Y);var u=d(ya);m=m*((n?h.y:h.x)+u);o=o*((n?h.x:h.y)+u);n=j.length?[0,0]:n?[-o+B,-m+B]:[-m+B,-o+B]}b=j[b-1]||d(X);j=d(Ca);g=ra(0,j,pa(k.reel.math.interpolate(g,-1,j+2)));g=!a.cw||a.stitched?g:j-g;j={background:S(a.path+b)+
La+n.join(La)};a.images.length?e.attr({src:a.path+b}):e.css(j);l.call(f);k(qa(Fa),d(M)).css({left:g})}},t,G=0,Ia=function(){return t=0},x=function(){return t=-a.timeout*a.tempo},ea,fa,oa=0,ka=0,Ha=function(f){return A.push(f)&&A.shift()&&f},O=function(){return A=[0,0,0]},A=O(),ib=a.brake/a.tempo,Ka=a.graph||k.reel.math[a.loops?"hatch":"envelope"],ja=function(f,b,g){c(la,b);c(ma,a.loops?0:-b*g);c(na,a.loops?g:g-b*g);return f&&c(Ja,f)||r};v.setup()});return k(s)};k.reel.math={envelope:function(i,a,
s,e,c,d){return a+H(e,sa(c,-i*d))/s},hatch:function(i,a,s,e,c,d){i=(i<e?c:0)+i%c;i=a+-i*d/s;return i-R(i)},interpolate:function(i,a,s){return a+i*(s-a)}};Oa("mousewheel disableTextSelect enableTextSelect".split(/ /));var D=k(Ma),Wa=/iphone|ipod|ipad|android/i.test(navigator.userAgent),da="ew-resize",V,C="jquery-reel",Ua=C+"-overlay",Fa="indicator",hb="preloader",gb="monitor",Va="interface",Sa="data:image/gif;base64,R0lGODlhCAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7",Ea="data:image/gif;base64,R0lGODlhEAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAI3lC8AeBDvgosQxQtne7yvLWGStVBelXBKqDJpNzLKq3xWBlU2nUs4C/O8cCvU0EfZGUwt19FYAAA7",
jb="data:image/gif;base64,R0lGODlhEAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAIslI95EB3MHECxNjBVdE/5b2zcRV1QBabqhwltq41St4hj5konmVioZ6OtEgUAOw==",pa=Math.round,R=Math.floor,Aa=Math.ceil,sa=Math.min,H=Math.max,y=Math.abs,kb=Math.sqrt,J=parseInt,Da="backup",w="backwards",$="bit",ga="clicked",Ja="clicked_location",N="cwish",la="clicked_on",Y="dimensions",p="fraction",E="frame",L="frames",na="hi",ca="hotspot",X="image",Ca="indicator_travel",ma="lo",ia="playing",K="revolution",za="rows",ya="spacing",
aa="speed",M="stage",Z="steps",Ba="stitched_travel",ha="stopped",z="velocity",Ta="wheel_step",q=".reel",db="dblclick"+q,eb="mousedown"+q,ab="mouseenter"+q,bb="mouseleave"+q,P="mousemove"+q,ba="mouseup"+q,cb="mousewheel"+q,W="tick"+q,$a="touchcancel"+q,Za="touchend"+q,Xa="touchstart"+q,Ya="touchmove"+q,wa="",La=" ",Q="absolute",xa="div",F=Na(xa),va="height",Ga="#000",Ra="id",Qa="img",B="px",ta="src",fb="title",ua="width"})(jQuery,window,document);
