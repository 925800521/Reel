/*
 Copyright (c) 2009-2010 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 http://jquery.vostrel.cz/reel
 Version: "Dancer" (will be 1.1 on release)
 Updated: 2010-06-08

 Requires jQuery 1.4.x
*/
(function(i){function aa(l){return"<"+l+"/>"}function x(l){return"."+l}function wa(l){return"url("+l+")"}function O(l,a){return+a.toFixed(l)}function ba(l,a,F){return B(l,ca(a,F))}function xa(l,a){return l*a>0?a:-a}function ya(l){function a(){i.fn[this]||(i.fn[this]=function(){return this})}i.each(l,a)}var za={footage:6,frame:1,frames:36,hint:"",horizontal:true,hotspot:undefined,indicator:0,klass:"",loops:true,reversed:false,saves:false,sensitivity:20,spacing:0,stitched:undefined,suffix:"-reel",tooltip:"",
delay:-1,friction:0.9,image:undefined,images:[],inertial:true,monitor:undefined,rebound:0.5,loading:"Loading...",path:"",preloader:true,revolution:undefined,speed:0,step:undefined,steps:undefined,tempo:25,timeout:2};i.fn.reel=function(l){var a=i.extend({},za,l);l=function(c){var d=[];c.each(function(){var g=i(this),u=a.images.length&&a.images||a.image||g.attr(da),w=G(g.css(ea)),z=G(g.css(fa));!u||u==H||!w||!z||d.push(g)});c.filter(ga+x(P)).each(function(){d.push(i(this))});return i(d)}(this);var F=
[];I=I||function(){return setInterval(function(){C.trigger(Q)},1E3/a.tempo)}();l.each(function(){var c=i(this),d=function(e,b){c.data(e,b);c.trigger("store");return b},g=function(e){c.trigger("recall");return c.data(e)},u={setup:function(){if(!c.hasClass(P)){var e=c.attr(da),b=c.attr(R),f=c.attr(ha),h=c.attr("style"),n=a.images,o={x:G(c.css(ea)),y:G(c.css(fa))},k=i(J).attr(ha,f).addClass(P).addClass(a.klass),t=ia||!a.saves?{display:"none"}:{opacity:0};F.push((c=c.attr(R,H).wrap(k).css(t).parent().attr(R,
b).bind(u).css({display:"block",width:o.x+q,height:o.y+q}))[0]);d(S,n.length&&n.length||a.image||e.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2"));d(A,a.frame);d(D,n.length||a.frames);d(ja,a.spacing);d(K,o);d(p,0);d(L,a.steps||a.frames);d("resolution",B(a.steps,a.frames));d(ka,a.speed<0);d(la,{id:b,"class":f||H,style:h||H});I&&C.bind(Q,u.tick);c.trigger("start")}},teardown:function(){c=c.unbind(u).find([x(T),x(U),x(ma),V+x(na)].join(", ")).remove().end().find(V).attr(c.data(la)).unwrap().bind("setup",
function(){c.unbind("setup");u.setup()});I&&C.unbind(Q,u.tick)},start:function(){c.css({position:"relative"});var e=a.hotspot?a.hotspot:c,b=g(K),f=g(D),h=B(f,g(L));h=d(p,1/h*((a.step||a.frame)-1));d(A,h*f+1);f=g(S);h=a.images;var n=0,o=a.loading,k=!h.length?[f]:h,t;ia?e.each(function(){function r(s,y){i.each(y,function(Aa){s.addEventListener(Aa,this,false)})}function j(s){return s.cancelable&&s.preventDefault()||false}function m(s){var y=s.touches[0];c.trigger("down",[y.clientX,y.clientY,true]);return j(s)}
function Ba(s){var y=s.touches[0];c.trigger("drag",[y.clientX,y.clientY,true]);return j(s)}function oa(s){c.trigger("up",[true]);return j(s)}r(this,{touchstart:m,touchmove:Ba,touchend:oa,touchcancel:oa})}):e.css({cursor:"ew-resize"}).mouseenter(function(){c.trigger("enter")}).mouseleave(function(){c.trigger("leave")}).mousemove(function(r){c.trigger("over",[r.clientX,r.clientY])}).mousewheel(function(r,j){c.trigger("wheel",[j]);return false}).dblclick(function(){c.trigger("animate")}).mousedown(function(r){c.trigger("down",
[r.clientX,r.clientY])}).disableTextSelect();(a.hint||a.tooltip)&&e.attr(Ca,a.hint||a.tooltip);a.monitor&&c.append(i(J,{className:U,css:{position:W,left:0,top:0}}));a.indicator&&c.append(i(J).addClass(T).css({width:a.indicator+q,height:a.indicator+q,top:b.y-a.indicator+q,position:W,backgroundColor:Da}));i(function(){a.preloader&&c.append(t=i(J,{className:ma,css:{position:W,right:0,top:0}}).text(o+M+n+"/"+k.length));setTimeout(function(){i.each(k,function(r,j){i(aa(V),{src:a.path+j,className:na}).appendTo(c).hide().load(function(){i(this).remove();
n++;t.text(o+M+n+"/"+k.length);n==k.length&&t.remove()})})},10)});c.trigger("frameChange")},animate:function(){},tick:function(){var e=a.speed,b=a.friction/a.tempo,f=g(E),h=f<0;f-=f*b;f=pa=f==pa?0:f;f=(h?ca:B)(0,O(3,f))||0;f=d(E,f);step=(e+f)/a.tempo;i(x(U),c).text(g(a.monitor));qa(0);w&&w++;if(!(w&&!f)){if(g(X))return z();d(p,g(p)+step);c.trigger("fractionChange")}},down:function(e,b,f,h){z();d(X,true);d(ra,b);d(E,0);d(Y,d(sa,g(p)));!h&&C.mousemove(function(n){c.trigger("drag",[n.clientX,n.clientY])}).mouseup(function(){c.trigger("up")})},
up:function(e,b){d(X,false);e=v[1]+v[2]!=0;var f=(v[0]+v[1]+v[2])/v.length/(b?5:20);d(E,a.inertial&&e?a.stitched?-f:f:0);ta();w=0;!b&&C.unbind("mousemove mouseup")},drag:function(e,b){z();e=g(ra);var f=g(sa),h=a.stitched,n=g(K);d(p,f+(a.reversed?-1:1)*(h?-1:1)/(a.revolution||h/2||n.x)*(b-e));qa(b-ua);ua=b;c.trigger("fractionChange")},wheel:function(e,b){z();d(E,0);e=g(p);var f=1/B(g(D),g(L)),h=Z(Ea(Fa(b))/2);h=b<0?-h:h;d(p,e+h*f);c.trigger("fractionChange");return false},fractionChange:function(e,
b){b=!b?g(p):d(p,b);e=g(Y);e=a.speed=xa(b-e,a.speed);b=a.loops?b-(b<0?Z:va)(b):ba(0,1,b);a.speed=!a.loops&&a.rebound&&$==a.rebound*1E3/a.tempo?-e:e;b=!a.loops?b:b>=0?b:1+b;b=d(Y,d(p,O(6,b)));d(A,b*(g(D)-1)+1);!w&&($=b==0||b==1?$+1:0);c.trigger("frameChange")},frameChange:function(e,b){var f=g(D);e=!b?g(p):d(p,O(6,(b-1)/(f-1)));b=!b?g(A):d(A,b);b=d(A,N(b));var h=g(S),n=a.images,o=g(K);g(L);var k=g(ja),t=g(ka);if(a.stitched){k=a.loops?a.stitched:a.stitched-o.x;j=N(e*k);m=0;t=[-j+q,m+q]}else{j=va(b/
a.footage);m=b-j*a.footage-1;j=m==-1?j+m:j;m=m==-1?a.footage+m:m;var r=a.horizontal?o.y:o.x,j=-j*(k+r),m=-m*(k+(a.horizontal?o.x:o.y));f=Z(f/a.footage);k=f*r+(f-1)*k;j=t&&a.horizontal?j-k:j;m=t&&!a.horizontal?m-k:m;t=n.length?[0,0]:a.horizontal?[m+q,j+q]:[j+q,m+q]}b=n[b-1]||h;k=o.x-a.indicator;e=ba(0,k,N(e*(k+2))-1);b={background:wa(a.path+b)+M+t.join(M)};c.css(b).find(x(T)).css({left:e+q})}},w=a.delay>0?-N(a.delay*a.tempo):0,z=function(){return w=-a.timeout*a.tempo},$=0,ua=0,pa=0,qa=function(e){v.push(e)&&
v.shift()},ta=function(){return v=[0,0,0]},v=ta();c.ready(u.setup)});return i(F)};ya("mousewheel disableTextSelect".split(/ /));var P="jquery-reel",T="indicator",ma="preloader",na="preloaded_frame",U="monitor",Q="tick.reel",C=i(document),ia=/iphone|ipod|ipad|android/i.test(navigator.userAgent),I,N=Math.round,va=Math.floor,Z=Math.ceil,ca=Math.min,B=Math.max,Fa=Math.abs,Ea=Math.sqrt,G=parseInt,la="backup",X="clicked",ra="clicked_location",sa="clicked_on",K="dimensions",p="fraction",A="frame",D="frames",
S="image",Y="last_fraction",ka="reversed",ja="spacing",L="steps",E="velocity",H="",M=" ",W="absolute",ha="class",ga="div",J=aa(ga),fa="height",Da="#000",R="id",V="img",q="px",da="src",Ca="title",ea="width"})(jQuery);
