/*
 Copyright (c) 2009-2010 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 http://jquery.vostrel.cz/reel
 Version: "Dancer" (will be 1.1 on release)
 Updated: 2010-05-24

 Requires jQuery 1.4.x
*/
(function(m){function x(n){return"."+n}function qa(n){return"url("+n+")"}function M(n,r){return+r.toFixed(n)}function Y(n,r,a){return y(n,Z(r,a))}function ra(n,r){return n*r>0?r:-r}function sa(n){m.each(n,function(){m.fn[this]||(m.fn[this]=function(){return this})})}var ta={footage:6,frame:1,frames:36,hint:"",horizontal:true,hotspot:undefined,indicator:0,klass:"",loops:true,reversed:false,saves:false,sensitivity:20,spacing:0,stitched:undefined,suffix:"-reel",tooltip:"",delay:-1,frequency:0,friction:0.8,
inertial:true,maximum:100,minimum:0,monitor:undefined,rebound:0.5,revolution:undefined,step:undefined,steps:undefined,tempo:25,timeout:2};m.fn.reel=function(n){var r=function(c){var d=[];c.filter($).each(function(){var g=m(this),s=g.attr(aa),u=F(g.css(ba)),v=F(g.css(ca));!s||s==G||!u||!v||d.push(g)});c.filter(da+x(N)).each(function(){d.push(m(this))});return m(d)}(this),a=m.extend({},ta,n),ea=[];H=H||function(){return setInterval(function(){z.trigger(O)},1E3/a.tempo)}();r.each(function(){var c=m(this),
d=function(e,b){c.data(e,b);c.trigger("store");return b},g=function(e){c.trigger("recall");return c.data(e)},s={setup:function(){if(!c.hasClass(N)){var e=c.attr(aa),b=c.attr(P),f=c.attr(fa),i=c.attr("style");e=e.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2");var h={x:F(c.css(ba)),y:F(c.css(ca))},j=m(Q).attr(fa,f).addClass(N).addClass(a.klass),k=ga||!a.saves?{display:"none"}:{opacity:0};ea.push((c=c.attr(P,G).wrap(j).css(k).parent().attr(P,b).bind(s).css({display:"block",width:h.x+p,height:h.y+
p,backgroundImage:qa(e)}))[0]);d(A,a.frames);d(ha,a.spacing);d(I,h);d(o,0);d(J,a.steps||a.frames);d("resolution",y(a.steps,a.frames));d(ia,a.frequency<0);d(ja,{id:b,"class":f||G,style:i||G});H&&z.bind(O,s.tick);c.trigger("start")}},teardown:function(){c=c.unbind(s).find(x(R)+", "+x(S)).remove().end().find($).attr(c.data(ja)).unwrap().bind("setup",function(){c.unbind("setup");s.setup()});H&&z.unbind(O,s.tick)},start:function(){c.css({position:"relative"});var e=a.hotspot?a.hotspot:c,b=g(I),f=g(A),
i=y(f,g(J));i=d(o,1/i*((a.step||a.frame)-1));d(B,i*f+1);e.css({cursor:"ew-resize"}).mouseenter(function(){c.trigger("enter")}).mouseleave(function(){c.trigger("leave")}).mousemove(function(h){c.trigger("over",[h.clientX,h.clientY])}).mousewheel(function(h,j){c.trigger("wheel",[j]);return false}).dblclick(function(){c.trigger("animate")}).mousedown(function(h){c.trigger("down",[h.clientX,h.clientY])}).disableTextSelect().each(function(){function h(q,w){m.each(w,function(C){q.addEventListener(C,this,
false)})}function j(q){q.cancelable&&q.preventDefault();return false}function k(q){var w=q.touches[0];d(D,true);d(T,w.clientX);return j(q)}function l(q){v();var w=q.touches[0],C=w.clientX;c.trigger("drag",[C,w.clientY]);U(C-K);K=C;return j(q)}function ka(q){d(D,false);return j(q)}ga&&h(this,{touchstart:k,touchmove:l,touchend:ka,touchcancel:ka,click:j,gesturestart:j,gesturechange:j,gestureend:j})});(a.hint||a.tooltip)&&e.attr(ua,a.hint||a.tooltip);a.monitor&&c.append(m(Q,{className:S,css:{position:la,
left:0,top:0}}));a.indicator&&c.append(m(Q).addClass(R).css({width:a.indicator+p,height:a.indicator+p,top:b.y-a.indicator+p,position:la,backgroundColor:va}));c.trigger("frameChange")},animate:function(){},tick:function(){var e=a.frequency,b=a.friction/a.tempo,f=g(E),i=f<0;f-=f*b;f=ma=f==ma?0:f;f=(i?Z:y)(0,M(3,f))||0;f=d(E,f);step=(e+f)/a.tempo;m(x(S),c).text(g(a.monitor));U(0);u&&u++;if(!(u&&!f)){if(g(D))return v();d(o,g(o)+step);c.trigger("fractionChange")}},down:function(e,b){v();d(D,true);d(T,
b);d(E,0);d(V,d(na,g(o)));z.mousemove(function(f){c.trigger("drag",[f.clientX,f.clientY])}).mouseup(function(){c.trigger("up")})},up:function(){d(D,false);var e=t[1]+t[2]!=0,b=(t[0]+t[1]+t[2])/t.length/20;d(E,a.inertial&&e?a.stitched?-b:b:0);oa();u=0;z.unbind("mousemove mouseup")},drag:function(e,b){v();e=g(T);var f=g(na),i=a.stitched,h=g(I);d(o,f+(a.reversed?-1:1)*(i?-1:1)/(a.revolution||i/2||h.x)*(b-e));U(b-K);K=b;c.trigger("fractionChange")},wheel:function(e,b){v();d(E,0);e=g(o);var f=1/y(g(A),
g(J)),i=W(wa(xa(b))/2);i=b<0?-i:i;d(o,e+i*f);c.trigger("fractionChange");return false},fractionChange:function(e,b){b=!b?g(o):d(o,b);e=g(V);e=a.frequency=ra(b-e,a.frequency);b=a.loops?b-(b<0?W:pa)(b):Y(0,1,b);a.frequency=!a.loops&&a.rebound&&X==a.rebound*1E3/a.tempo?-e:e;b=!a.loops?b:b>=0?b:1+b;b=d(V,d(o,M(6,b)));d(B,b*(g(A)-1)+1);!u&&(X=b==0||b==1?X+1:0);c.trigger("frameChange")},frameChange:function(e,b){var f=g(A);e=!b?g(o):d(o,M(6,(b-1)/(f-1)));b=!b?g(B):d(B,b);b=d(B,L(b));var i=g(I);g(J);var h=
g(ha),j=g(ia);if(a.stitched){h=a.loops?a.stitched:a.stitched-i.x;k=L(e*h);l=0;j=[-k+p,l+p]}else{k=pa(b/a.footage);l=b-k*a.footage-1;k=l==-1?k+l:k;l=l==-1?a.footage+l:l;b=a.horizontal?i.y:i.x;var k=-k*(h+b),l=-l*(h+(a.horizontal?i.x:i.y));f=W(f/a.footage);h=f*b+(f-1)*h;k=j&&a.horizontal?k-h:k;l=j&&!a.horizontal?l-h:l;j=a.horizontal?[l+p,k+p]:[k+p,l+p]}h=i.x-a.indicator;e=Y(0,h,L(e*(h+2))-1);c.css({backgroundPosition:j.join(" ")}).find(x(R)).css({left:e+p})}},u=a.delay>0?-L(a.delay*a.tempo):0,v=function(){return u=
-a.timeout*a.tempo},X=0,K=0,ma=0,U=function(e){t.push(e)&&t.shift()},oa=function(){return t=[0,0,0]},t=oa();c.ready(s.setup)});return m(ea)};sa("mousewheel disableTextSelect".split(/ /));var N="jquery-reel",O="tick.reel",z=m(document),ga=/iphone|ipod|ipad|android/i.test(navigator.userAgent),H,F=parseInt,L=Math.round,pa=Math.floor,W=Math.ceil,Z=Math.min,y=Math.max,wa=Math.sqrt,xa=Math.abs,ja="backup",D="clicked",T="clicked_location",na="clicked_on",I="dimensions",o="fraction",B="frame",A="frames",
V="last_fraction",ia="reversed",ha="spacing",J="steps",E="velocity",G="",la="absolute",fa="class",da="div",Q="<"+da+"/>",ca="height",va="#000",P="id",$="img",R="indicator",S="monitor",p="px",aa="src",ua="title",ba="width"})(jQuery);
