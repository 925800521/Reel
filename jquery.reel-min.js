/*
 Copyright (c) 2009-2012 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 jQuery Reel
 http://jquery.vostrel.cz/reel
 Version: 1.1.3-devel
 Updated: 2012-01-05

 Requires jQuery 1.4.3 or higher
*/
jQuery.reel||function(g,Ib,Ja,r){function K(e){return g.reel.instances.length?g.reel.instances.first().data(e):null}function Jb(e){return g.reel.instances.push(e[0])&&e}function Kb(e){return(g.reel.instances=g.reel.instances.not(ga(e.attr(aa))))&&e}function Lb(e){return"data:image/gif;base64,R0lGODlh"+e}function S(e){return"<"+e+"/>"}function q(e){return"."+(e||"")}function pa(e){return g.reel.cdn+e}function qa(e){return"url("+e+")"}function ba(e,a,p){return ha(e,gb(a,p))}function Mb(e){function a(){g.fn[this]||
(g.fn[this]=function(){return this})}g.each(e,a)}function Ka(e,a){return L(e)*(a?-1:1)}function ra(e){return e.originalEvent.touches[0]}function T(e){return e===r||typeof e=="string"?e:e+U}function ga(e){return"#"+e}function Nb(e){var a=[];g.each(e,function(p,h){a.push(p.replace(/([A-Z])/g,"-$1").toLowerCase()+":"+T(h))});return"{"+a.join(";")+";}"}function Ob(){var e=g().jquery.split(".");if(e=+e[0]<=1&&(+e[1]<4||+e[1]==4&&+e[2]<3))try{console.error("FATAL: jQuery Reel plug-in requires at least jQuery 1.4.3")}catch(a){}return e}
if(!Ob()){g.reel={version:"1.2alpha",def:{area:r,brake:0.23,clickfree:false,cw:false,delay:-1,directional:false,draggable:true,footage:6,entry:r,frame:1,frames:36,graph:r,hint:"",horizontal:true,image:r,images:[],indicator:0,inversed:false,klass:"",laziness:6,loops:true,monitor:r,opening:0,orbital:0,path:"",preloader:4,rebound:0.5,revolution:r,row:1,rows:0,spacing:0,speed:0,step:r,steps:r,stitched:0,suffix:"-reel",tempo:36,timeout:2,throwable:true,vertical:false,wheelable:true,annotations:r,attr:{},
cursor:r,preload:"fidelity",scrollable:true,steppable:true,sequence:"",velocity:0}};g.fn.reel=function(e){var a=g.extend({},g.reel.def,e);e=function(h){var u=[];h.filter(La).each(function(){var d=g(this),c=a.images.length&&a.images||a.image||a.attr.src||d.attr(hb),v=sa(a.attr.width||d.css(ib)),o=sa(a.attr.height||d.css(jb));!c||c==M||!v||!o||u.push(d)});h.filter(q(x)).each(function(){u.push(g(this).unreel())});return g(u)}(this);var p=[];a.tooltip&&(a.hint=a.tooltip);a.hotspot&&(a.area=a.hotspot);
e.each(function(){var h=g(this),u=h.data(),d=function(i,b){u[i]=b;h.trigger("store",[i,b]);return b},c=function(i){var b=u[i];h.trigger("recall",[i,b]);return b},v={setup:function(i){if(h.hasClass(x))return o.call(i);var b=h.attr(a.attr).attr(hb),f=d(aa,h.attr(aa)||h.attr(aa,x+"-"+ +new Date).attr(aa)),j=h.attr(ia),k=g.extend({},h.data()),m=g.reel.sequence_pattern.exec(d(Pb,a.sequence));m=d(Ma,m?g.reel.build_sequence(m,a,c):a.images);var l=a.stitched,n=a.loops,s={x:sa(h.css(ib)||a.attr.width),y:sa(h.css(jb)||
a.attr.height)},y=d(H,a.frame),N=d(ta,a.orbital&&a.footage||a.rows<=1&&m.length||a.frames),Na=l?1:kb(N/a.footage);f=ga(f+a.suffix);var ua=h.attr("class")||"";y=g(S(ja),{id:f.substr(1),"class":ua+D+Qb+D+lb+y});y=h.wrap(y.addClass(a.klass)).attr({"class":x});p.push(Jb(y)[0]);y=y.parent().bind(v.instance);d(Rb,a);d(mb,m.length?M:a.image||b.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2"));d(Oa,[]);d(Pa,0);d(nb,a.spacing);d(O,s);d(t,0);d(Qa,a.steps||a.frames);d(va,a.revolution||l/2||s.x*2);d(Ra,
Na);d(ca,1/(N-(n&&!l?0:1)));d(Sb,1/ha(N,c(Qa)));d(Sa,l);d(ob,l-(n?0:s.x));d(Ta,f);d(I,d(wa,a.speed)<0);d(V,a.velocity||0);d(da,a.vertical);d(J,(a.row-1)/(a.rows-1));d(ea,Ka(1,!a.cw&&!l));d(ka,false);d(pb,a.brake);d(Ua,!!a.orbital);d(P,a.tempo/(g.reel.lazy?a.laziness:1));d(W,-1);d(Va,a.annotations)||y.unbind(".annotations");d(qb,{src:b,classes:ua,style:j||M,data:k});a.steppable||y.unbind("click.steppable");E(true,M,{width:s.x,height:s.y,overflow:Wa});E(true,X+q(x),{display:rb,position:"relative"});
Q.bind(v.pool);o.call(i);h.trigger("setup")},instance:{teardown:function(i){var b=h.data(qb);h.parent().unbind(v.instance).children(La).unbind(z);c(ia).remove();h.unbind(z).attr({"class":b.classes,src:b.src,style:b.style}).removeClass(x);h.data(b.data).siblings().remove();h.unwrap();Kb(h);xa();Q.unbind(v.pool);Y.unbind(ya).unbind(Xa);o.call(i)},setup:function(){var i=c(O),b=c(ta),f=ha(b,c(Qa));f=d(t,1/f*((a.step||a.frame)-1));d(H,Z(f*b)+1);h.attr(aa);b=h.parent();var j=!c(ka)||a.rows<=1||!a.orbital||
a.scrollable;f=d(Tb,g(a.area||b));if(g.reel.touchy){E(true,D+q(x),{WebkitUserSelect:za,WebkitBackgroundSize:a.images.length?"auto":c(Sa)&&T(c(Sa))+D+T(i.y)||T(i.x*a.footage)+D+T(i.y*c(Ra)*(a.rows||1)*(a.directional?2:1))});f.bind(Ub,function(l){h.trigger("down",[ra(l).clientX,ra(l).clientY,true])}).bind(Vb,function(l){h.trigger("pan",[ra(l).clientX,ra(l).clientY,true]);return!j}).bind(Wb,function(){h.trigger("up",[true]);return false}).bind(Xb,function(){h.trigger("up",[true]);return false})}else{var k=
a.cursor==sb?qa(Yb)+X+Ya:a.cursor||qa(Zb)+X+Ya,m=a.cursor==sb?qa($b)+X+Ya+" !important":false;E(true,M,{cursor:k});E(true,q(Za),{cursor:ac});E(false,q(Aa)+X+q(Aa)+" *",{cursor:m||k});f.bind(a.wheelable?bc:M,function(l,n){return!n||h.trigger("wheel",[n])&&false}).bind(a.clickfree?cc:dc,function(l){if(!(ec?!l.button:!!l.button)){h.trigger("down",[l.clientX,l.clientY]);return false}}).bind(a.clickfree?fc:M,function(){h.trigger("up");return false}).disableTextSelect()}a.hint&&f.attr(gc,a.hint);a.monitor&&
b.append(w=g(S(ja),{"class":tb}))||(w=g());E(true,D+q(tb),{position:Ba,left:0,top:0});E(true,D+q(ub),{display:za});E(true,D+q(vb),{position:Ba,left:0,top:i.y-a.preloader,height:a.preloader,overflow:Wa,backgroundColor:wb});a.indicator&&b.append(xb(yb));a.rows>1&&a.indicator&&b.append(xb(zb))},preload:function(i){var b=c(O),f=h.parent(),j=c(mb),k=c(Ma),m=!k.length,l=c(ta),n=g.reel.preload[a.preload]||g.reel.preload[g.reel.def.preload];k=m?[j]:n(k,a,c);n=[];var s=h[0];s.frames=k.length;s.preloaded=0;
f.addClass(Za).append(F=g(S(ja),{"class":vb}));for(h.trigger("stop");k.length;){var y=a.path+k.shift(),N=b.x*(!m?1:a.footage),Na=b.y*(!m?1:l/a.footage)*(!a.directional?1:2);N=g(new Image).addClass(ub).attr({width:N,height:Na}).bind("load"+z,function(){s.preloaded++;g(this).unbind(z);F.css({width:1/s.frames*s.preloaded*b.x});if(s.frames==s.preloaded){F.remove();m&&h.css({backgroundImage:qa(a.path+j)}).attr({src:hc});f.removeClass(Za);h.trigger("loaded");o.call(i)}});f.append(N);n.push(y);setTimeout(function(ua,
ic){return function(){ua.attr({src:ic})}}(N,y),0)}d(Oa,n);d(ia,g("<"+ia+' type="text/css">'+Ab.join("\n")+"</"+ia+">").prependTo("head"))},opening:function(){if(!a.opening)return h.trigger("openingDone");var i=a.entry||a.speed,b=c(t),f=a.opening;d(t,b-i*a.opening);d(W,f*K(P))},openingDone:function(){$=setTimeout(function(){h.trigger("play")},a.delay*1E3||0)},play:function(i,b){b=d(wa,b||c(wa));b=d($a,!!b);d(ab,!b);G();o.call(i)},pause:function(i){d($a,false);A();o.call(i)},stop:function(i){var b=
d(ab,true);d($a,!b);o.call(i)},down:function(i,b,f,j){if(a.draggable){d(Ca,c(H));d(V,0);Da=Ea(b,f,c(t),c(va),c(J));A();xa();la=false;Bb.addClass(Aa);if(!j){Y.bind(Xa,function(k){h.trigger("pan",[k.clientX,k.clientY]);o.call(k);return false});a.clickfree||Y.bind(ya,function(k){h.trigger("up");o.call(k)})}}o.call(i)},up:function(i,b){if(!a.draggable)return o.call(i);d(Ca,false);d(ka,false);var f=d(V,!a.throwable?0:L(ma[0]+ma[1])/60);R=f?1:0;f?G():A();xa();Bb.removeClass(Aa);!b&&Y.unbind(ya).unbind(Xa);
o.call(i)},pan:function(i,b,f){if(a.draggable&&bb){bb=false;A();var j={x:b-Da.x,y:f-Da.y};if(L(j.x)>0||L(j.y)>0){la=true;Da={x:b,y:f};var k=c(va),m=c(Cb),l=c(da),n=d(t,Db(l?f-m.y:b-m.x,c(cb),k,c(db),c(eb),c(ea),l?f-m.y:b-m.x));d(ka,c(ka)||c(H)!=c(Ca));(j=Eb(l?j.y:j.x||0))&&d(I,j<0);if(a.orbital&&c(Ua)){d(da,L(f-m.y)>L(b-m.x));m=Ea(b,f,n,k,c(J))}if(a.rows>1){j=c(O).y;l=c(Fb);var s=-l*j;d(J,g.reel.math.envelope(f-m.y,l,j,s,s+j,-1))}!(n%1)&&!a.loops&&Ea(b,f,n,k,c(J));h.trigger("fractionChange")}}o.call(i)},
wheel:function(i,b){var f=kb(jc(L(b))/2);f=Ka(f,b>0);b=0.0833*c(va);Ea(r,r,c(t),b,c(J));d(t,Db(f,c(cb),b,c(db),c(eb),c(ea)));f&&d(I,f<0);d(V,0);A();o.call(i);Y.trigger(ya);h.trigger("fractionChange");return false},fractionChange:function(i,b){b=d(t,Fa.fraction(b,a,c));var f=d(H,1+fa(b/c(ca))),j=a.rows>1,k=a.orbital;d(Ua,!!k&&(f<=k||f>=a.footage-k+2));if(!a.loops&&a.rebound){!C&&!(b%1)?fb++:(fb=0);fb>=a.rebound*1E3/K(P)&&d(I,!c(I))}h.trigger(j?"rowChange":"frameChange");o.call(i)},rowChange:function(i,
b){var f=c(t)/c(ca)+1;b=d(J,Fa.row(b,a,c));b=ba(0,a.rows-1,fa(b*a.rows));d(H,fa(f+b*a.frames));o.call(i);h.trigger("frameChange")},frameChange:function(i,b){var f=d(t,Fa.fraction(!b?r:c(ca)*(b-1),a,c));b=Fa.frame(b,a,c);var j=c(Oa).length==1,k=a.footage;if(c(da)){b=a.inversed?k+1-b:b;b+=k}if(b==c(Pa))B(i);else{var m=a.horizontal,l=c(Ma),n=c(O);b=d(Pa,d(H,b));if(j){if(a.stitched)n=[-Z(f*c(ob))+U,0+U];else{f=b%k-1;f=f<0?k-1:f;k=fa((b-0.1)/k);k+=a.rows>1?0:c(I)?0:c(Ra);b=c(nb);k=k*((m?n.y:n.x)+b);n=
f*((m?n.x:n.y)+b);n=l.length?[0,0]:m?[-n+U,-k+U]:[-k+U,-n+U]}h.css({backgroundPosition:n.join(D)})}else h.attr({src:a.path+l[b-1]})}if(a.indicator){m=c(Ta);l=a.rows>1;n=c(O);f=(c(da)?n.y:n.x)-a.indicator;b=ba(0,f,Z(g.reel.math.interpolate(c(t),-1,f+2)));b=!a.cw||a.stitched?b:f-b;g(q(Ga+q(yb)),m).css(c(da)?{left:0,top:b}:{left:b,top:n.y-a.indicator});if(l){n=n.y-a.indicator;n=ba(0,n,Z(g.reel.math.interpolate(c(J),-1,n+2)));g(q(Ga+q(zb)),m).css({top:n})}}o.call(i)},stepLeft:function(){A();d(I,false);
h.trigger("fractionChange",c(t)-c(ca)*c(ea))},stepRight:function(){A();d(I,true);h.trigger("fractionChange",c(t)+c(ca)*c(ea))},"click.steppable":function(i){if(la)return B(i);h.trigger(i.clientX-h.offset().left>0.5*c(O).x?"stepRight":"stepLeft")},"setup.annotations":function(){c(O);var i=h.parent();g.each(c(Va),function(b,f){var j=g(S(ja),f.node).attr({id:b}).addClass(kc),k=f.image?g(S(La),f.image):g(),m=f.link?g(S(lc),f.link):g();E(false,ga(b),{display:za,position:Ba});m.bind({"click.annotations":function(l){l.stopPropagation()}});
f.image||f.link&&j.append(m);f.link||f.image&&j.append(k);f.link&&f.image&&j.append(m.append(k));j.appendTo(i)});h.trigger("frameChange.annotations")},"frameChange.annotations":function(i,b){b=b||c(H);this.className=this.className.replace(mc,lb+b);c(V)||g.each(c(Va),function(f,j){f=g(ga(f));var k=j.start||1,m=j.end,l=b-1,n=j.at?j.at[l]=="+":false;l=j.at?l:l-k+1;var s=typeof j.x!=Gb?j.x:j.x[l],y=typeof j.y!=Gb?j.y:j.y[l];j={display:s!==r&&y!==r&&(j.at?n:l>=0&&(!m||l<=m-k))?rb:za,left:T(s)||0,top:T(y)||
0};f.css(j)})},"setup.fu":function(){h.trigger("preload")},"loaded.fu":function(){h.trigger("opening")}},pool:{"tick.reel":function(i){var b=c(V);if(R){var f=b-c(pb)/K(P)*R;b=d(V,f>0.1?f:(R=C=0))}w.text(c(a.monitor));b&&R++;C&&C++;Eb(0);bb=true;if(C&&!b)return B(i);if(c(Ca))return B(i,A());if(!(c(W)>0)){f=c(ea)*Ka(1,c(I));b=(c(ab)?b:L(c(wa))+b)/K(P);var j=c(t);d(t,j-b*f);o.call(i)}},"tick.reel.opening":function(i){if(a.opening){if(c(W)<=0)return;var b=(a.entry||a.speed)/K(P)*(a.cw?-1:1),f=c(t);d(t,
f+b);b=d(W,c(W)-1);o.call(i);if(b>0)return;h.trigger("openingDone")}Q.unbind(na+q(Ha),v.pool[na+q(Ha)])},"tick.reel.fu":function(){h.trigger("fractionChange")}}},o=function(i){Hb||delete this;return i},B=function(i,b){return i.stopImmediatePropagation()||o.call(i)||b},C,R=0,G=function(){return C=0},A=function(){clearTimeout($);Q.unbind(na+q(Ha),v.pool[na+q(Ha)]);d(W,0);h.trigger("play");return C=-a.timeout*K(P)},la=false,$,w,F,xb=function(i){E(true,D+q(Ga)+q(i),{position:Ba,width:a.indicator,height:a.indicator,
overflow:Wa,backgroundColor:wb});return g(S(ja),{"class":[Ga,i].join(D)})},Ab=[],E=function(i,b,f){var j=c(Ta);b=b.split(X);i&&g.each(b,function(k,m){b[k]=j+m});Ab.push(b.join(X)+Nb(f));return f},fb=0,Da={x:0,y:0},Eb=function(i){return ma.push(i)&&ma.shift()&&i},xa=function(){return ma=[0,0]},ma=xa(),Db=a.graph||g.reel.math[a.loops?"hatch":"envelope"],Fa=g.reel.normal,Ea=function(i,b,f,j,k){d(cb,f);d(Fb,k);d(db,a.loops?0:-f*j);d(eb,a.loops?j:j-f*j);return i&&d(Cb,{x:i,y:b})||r},bb=true,Y;try{Y=g.browser.opera?
Q:g.unique(Q.add(Ib.top.document))}catch(nc){Y=Q}v.setup()});Ia=Ia||function h(){var u=+new Date,d=K(P);if(d){Q.trigger(na);g.reel.cost=(+new Date+g.reel.cost-u)/2;return Ia=setTimeout(h,ha(4,1E3/d-g.reel.cost))}else return Ia=r}();return g(p)};g.fn.unreel=function(){return this.trigger("teardown")};g.reel.math={envelope:function(e,a,p,h,u,d){return a+ha(h,gb(u,-e*d))/p},hatch:function(e,a,p,h,u,d){e=(e<h?u:0)+e%u;e=a+-e*d/p;return e-fa(e)},interpolate:function(e,a,p){return a+e*(p-a)}};g.reel.preload=
{linear:function(e){return e},fidelity:function(e,a){function p(o,B,C){function R(F){for(;!(F>=1&&F<=$);)F+=F<1?+$:-$;return v[C+F]||(v[C+F]=!!G.push(F))}if(!o.length)return[];var G=[],A=4*B,la=a.frame,$=o.length;B=$/A;for(var w=0;w<A;w++)R(la+Z(w*B));for(;B>1;){w=0;A=G.length;for(B/=2;w<A;w++)R(Z(G[w]+B))}for(w=0;w<G.length;w++)G[w]=o[G[w]-1];return G}var h=a.orbital?2:a.rows||1,u=a.orbital?a.footage:a.frames,d=(a.row-1)*u,c=[].concat(e),v=new Array(e.length);e=h<2?[]:c.slice(d,d+u);return p(e,1,
d).concat(p(c,h,0))}};g.reel.normal={fraction:function(e,a,p){e=e!=r?e:p(t);return a.loops?e-fa(e):ba(0,1,e)},row:function(e,a,p){return ba(0,1,e!=r?(e-1)/(a.rows-1):p(J))},frame:function(e,a,p){e=e!=r?Z(e):p(H);var h=a.orbital?2:a.rows||1;p=p(ta)*h;e=a.loops?e%p||p:ba(1,p,e);return e<0?e+p:e}};g.reel.sequence_pattern=/(^[^#|]*([#]+)[^#|]*)($|[|]([0-9]+)\.\.([0-9]+))($|[|]([0-9]+)$)/;g.reel.build_sequence=function(e,a){function p(o,B,C){for(;o.length<B;)o=C+o;return o}if(e.length<=1)return a.images;
var h=[],u=e[1],d=e[2],c=+e[4]||1,v=a.orbital?2:a.rows||1;a=a.orbital?a.footage:a.frames;v=+(e[5]||v*a);e=+e[7]||1;for(a=0;a<v;){h.push(u.replace(d,p(c+a+M,d.length,"0")));a+=e}return h};g.reel.touchy=/iphone|ipod|ipad|android/i.test(navigator.userAgent);g.reel.lazy=/iphone|ipod|android/i.test(navigator.userAgent);g.reel.cdn="http://code.vostrel.cz/";g.reel.instances=g();g.reel.cost=0;g.reel.leader=K;Mb("mousewheel disableTextSelect enableTextSelect".split(/ /));var Q=g(Ja),Bb=g("html");Ja=+g.browser.version.split(q()).slice(0,
2).join(q());var Hb=g.browser.msie,oa=navigator.userAgent;oa={linux:/linux/i.test(oa),windows:/windows/i.test(oa),mac:/macintosh/i.test(oa)};var ec=Hb&&Ja<=8,Ia,x="reel",Qb=x+"-overlay",Ga=x+"-indicator",vb=x+"-preloader",ub=x+"-cached",tb=x+"-monitor",kc=x+"-annotation",Aa=x+"-panning",Za=x+"-loading",lb="frame-",mc=/frame-\d+/,Z=Math.round,fa=Math.floor,kb=Math.ceil,gb=Math.min,ha=Math.max,L=Math.abs,jc=Math.sqrt,sa=parseInt,Va="annotations",Tb="area",qb="backup",I="backwards",ca="bit",pb="brake",
Oa="cached",Ua="center",Ca="clicked",Cb="clicked_location",cb="clicked_on",Fb="clicked_row",ea="cwish",O="dimensions",t="fraction",H="frame",Pa="_frame",ta="frames",eb="hi",Wa="hidden",mb="image",Ma="images",W="opening_ticks",db="lo",Rb="options",$a="playing",ka="reeling",va="revolution",J="row",Ra="rows",Pb="sequence",nb="spacing",wa="speed",Ta="stage",Qa="steps",Sa="stitched",ob="stitched_travel",ab="stopped",ia="style",P="tempo",V="velocity",da="vertical",Sb="wheel_step",z=".reel",dc="mousedown"+
z,cc="mouseenter"+z,fc="mouseleave"+z,Xa="mousemove"+z,ya="mouseup"+z,bc="mousewheel"+z,na="tick"+z,Xb="touchcancel"+z,Wb="touchend"+z,Ub="touchstart"+z,Vb="touchmove"+z,M="",D=" ",X=",",Ba="absolute",lc="a",rb="block",ja="div",sb="hand",jb="height",wb=ga("000"),aa="id",La="img",Ya="move",za="none",Gb="object",Ha="opening",U="px",hb="src",gc="title",ib="width",yb="x",zb="y",hc=Lb("CAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7")||pa("blank.gif"),ac="wait",Zb=pa("jquery.reel-"+(oa.mac?"black":
"white")+q("cur")),Yb=pa("jquery.reel-drag"+q("cur")),$b=pa("jquery.reel-drag-down"+q("cur"))}}(jQuery,window,document);
