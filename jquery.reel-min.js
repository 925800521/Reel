/*
 Copyright (c) 2009-2011 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 jQuery Reel
 http://jquery.vostrel.cz/reel
 Version: 1.1.3-devel
 Updated: 2011-05-08

 Requires jQuery 1.4.2 or higher
*/
jQuery.reel||function(h,kb,ia,p){function z(j){return h.reel.instances.length?h.reel.instances.first().data(j):null}function lb(j){return h.reel.instances.push(j[0])&&j}function mb(j){return(h.reel.instances=h.reel.instances.not("#"+j.attr(M)))&&j}function ja(j){return nb&&"data:image/gif;base64,R0lGODlh"+j}function ob(j){return"<"+j+"/>"}function ka(j){return"."+j}function la(j){return"http://code.vostrel.cz/"+j}function ma(j){return"url("+j+")"}function H(j){return+j.toFixed(4)}function V(j,a,u){return N(j,
Na(a,u))}function pb(j){function a(){h.fn[this]||(h.fn[this]=function(){return this})}h.each(j,a)}function na(j,a){return v(j)*(a?-1:1)}function W(j){return j.originalEvent.touches[0]}h.reel={version:"1.1.3-devel",def:{footage:6,frame:1,frames:36,hint:"",horizontal:true,hotspot:p,indicator:0,klass:"",loops:true,reversed:p,spacing:0,stitched:0,suffix:"-reel",tooltip:"",area:p,brake:0.5,clickfree:false,cw:false,delay:-1,directional:false,draggable:true,entry:p,graph:p,image:p,images:[],inversed:false,
laziness:6,monitor:p,opening:0,orbital:0,path:"",preloader:4,rebound:0.5,revolution:p,row:1,rows:0,speed:0,step:p,steps:p,tempo:36,timeout:2,throwable:true,vertical:false,wheelable:true}};h.fn.reel=function(j){var a=h.extend({},h.reel.def,j);j=function(g){var r=[];g.filter(qb).each(function(){var c=h(this),d=a.images.length&&a.images||a.image||c.attr(Oa),t=X(c.css(Pa)),m=X(c.css(Qa));!d||d==Ra||!t||!m||r.push(c)});g.filter(Sa+ka(w)).each(function(){r.push(h(this))});return h(r)}(this);var u=[];a.reversed&&
(a.cw=true);a.tooltip&&(a.hint=a.tooltip);a.hotspot&&(a.area=a.hotspot);j.each(function(){var g=h(this),r=g.data(),c=function(f,b){r[f]=b;g.trigger("store",[f,b]);return b},d=function(f){var b=r[f];g.trigger("recall",[f,b]);return b},t={setup:function(f){if(g.hasClass(w))return m.call(f);var b=g.attr(Oa),e=c(M,g.attr(M)||g.attr(M,w+"-"+ +new Date).attr(M)),i=g.attr("style"),k=h.extend({},g.data()),l=a.images,n=a.stitched,A=a.loops,s={x:X(g.css(Pa)),y:X(g.css(Qa))},O=c(Ta,a.orbital&&a.footage||a.rows<=
1&&l.length||a.frames),oa=n?1:Ua(O/a.footage),pa={display:"block",width:s.x,height:s.y};e="#"+e+a.suffix;var qa=g.attr("class"),ra={position:"relative",width:s.x,height:s.y};ra=h(P,{id:e.substr(1),"class":qa+sa+rb,css:ra});pa=g.wrap(ra).attr({"class":w}).css(pa).bind(t);u.push(lb(pa)[0]);c(Va,l.length&&l.length||a.image||b.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2"));c(sb,qa);c(x,a.frame);c(Wa,a.spacing);c(B,s);c(o,0);c(ta,a.steps||a.frames);c(Y,a.revolution||n/2||s.x*2);c(ua,oa);c(Z,
1/(O-(A&&!n?0:1)));c(tb,1/N(O,d(ta)));c(va,n);c(Xa,n-(A?0:s.x));c(wa,e);c(E,c(xa,a.speed)<0);c(I,0);c(J,a.vertical);c(y,(a.row-1)/(a.rows-1));c($,na(1,!a.cw&&!n));c(Q,false);c(Ya,a.brake);c(ya,!!a.orbital);c(C,a.tempo/(h.reel.lazy?a.laziness:1));c(aa,0);c(Za,{src:b,classes:qa,style:i||Ra,data:k});D.bind(F,t.tick);m.call(f);g.trigger("start")},teardown:function(f){var b=g.data(Za);g.unbind(q).unbind(t).attr({"class":b.classes,src:b.src,style:b.style}).removeClass(w);g.data(b.data).siblings().remove();
g.unwrap();mb(g);ba();D.unbind(F,t.tick).unbind(F,t.opening_tick);ca.unbind(za).unbind(Aa);m.call(f)},start:function(){var f=d(B),b=d(Ta),e=N(b,d(ta));e=c(o,1/e*((a.step||a.frame)-1));c(x,e*b+1);g.attr("id");b=g.parent();e=h(P,{"class":ub,css:{position:da,left:0,top:0,width:f.x,height:f.y,background:Ba,opacity:0}}).appendTo(b);e=c($a,h(a.area||e));if(h.reel.touchy){g.css({WebkitUserSelect:"none",WebkitBackgroundSize:a.images.length?"auto":d(va)&&d(va)+"px "+f.y+"px"||f.x*a.footage+"px "+f.y*d(ua)*
(a.rows||1)*(a.directional?2:1)+"px"});e.bind(vb,function(i){g.trigger("down",[W(i).clientX,W(i).clientY,true])}).bind(wb,function(i){g.trigger("slide",[W(i).clientX,W(i).clientY,true]);return!(a.rows>1||a.orbital||d(Q))}).bind(xb,function(){g.trigger("up",[true]);return false}).bind(yb,function(){g.trigger("up",[true]);return false})}else e.css({cursor:"url("+ab+"), "+Ca}).bind(a.wheelable?zb:"",function(i,k){g.trigger("wheel",[k]);return false}).bind(Ab,function(){g.trigger("play")}).bind(a.clickfree?
Bb:Cb,function(i){g.trigger("down",[i.clientX,i.clientY]);return false}).bind(a.clickfree?Db:"",function(){g.trigger("up");return false}).disableTextSelect();a.hint&&e.attr(Eb,a.hint);a.monitor&&b.append(Da=h(P,{"class":Fb,css:{position:da,left:0,top:0}}))||(Da=h());a.indicator&&b.append(bb("x"));a.rows>1&&a.indicator&&b.append(bb("y"));g.trigger("preload")},preload:function(f){var b=d(B),e=g.parent(),i=d(Va),k=a.images,l=!k.length?[i]:[].concat(k),n=g[0];n.frames=l.length;n.preloaded=0;g.trigger("stop");
for(e.append(Ea=h(P,{"class":Gb,css:{position:da,left:0,top:b.y-a.preloader,height:a.preloader,overflow:cb,backgroundColor:Ba}}));l.length;){var A=a.path+l.shift(),s=h(new Image).hide().bind("load"+q,function(){n.preloaded++;h(this).unbind(q);Ea.css({width:1/n.frames*n.preloaded*b.x});if(n.frames==n.preloaded){Ea.remove();k.length||g.css({backgroundImage:ma(a.path+i)});g.attr({src:Hb}).trigger(a.rows>1&&!a.stitched?"rowChange":"frameChange").trigger("loaded").trigger("opening");m.call(f)}});e.append(s);
setTimeout(function(O,oa){return function(){O.attr({src:oa})}}(s,A),0)}},tick:function(f){var b=d(I);if(R){var e=H(b-d(Ya)/z(C)*R);b=!(b*e<=0||b<v(e))&&c(I,b>v(d(xa))?e:(R=G=0))}Da.text(d(a.monitor));b&&R++;G&&G++;db(0);Fa=true;if(G&&!b)return m.call(f);if(d(ea))return m.call(f,K());e=d($)*na(1,d(E));var i=(d(Ga)?b:v(d(xa))+b)/z(C);b=d(o);e=c(o,b-i*e);m.call(f);e!=b&&g.trigger("fractionChange")},opening:function(){var f=a.entry||a.speed,b=d(o),e=a.opening;c(o,b-f*a.opening);c(aa,e*z(C));D.bind(F,
t.opening_tick)},opening_tick:function(f){var b=(a.entry||a.speed)/z(C)*(a.cw?-1:1),e=d(o);c(o,H(e+b));b=c(aa,d(aa)-1);g.trigger("fractionChange");m.call(f);if(!(b>1)){D.unbind(F,t.opening_tick);Ib()}},play:function(f){var b=c(Ha,true);c(Ga,!b);eb();m.call(f)},pause:function(f){c(Ha,false);K();m.call(f)},stop:function(f){var b=c(Ga,true);c(Ha,!b);m.call(f)},down:function(f,b,e,i){if(a.draggable){c(ea,d(x));c(I,0);fa=ga(b,e,d(o),d(Y),d(y));K();ba();if(!i){ca.css({cursor:ma(Jb)+", "+Ca}).bind(Aa,function(k){g.trigger("slide",
[k.clientX,k.clientY]);m.call(k);return false});a.clickfree||ca.bind(za,function(k){g.trigger("up");m.call(k)})}}m.call(f)},up:function(f,b){if(!a.draggable)return m.call(f);c(ea,false);c(Q,false);var e=c(I,!a.throwable?0:v(S[0]+S[1])/60);R=e?1:0;e?eb():K();ba();!b&&ca.unbind(za).unbind(Aa)&&d($a).css({cursor:ma(ab)+", "+Ca});m.call(f)},slide:function(f,b,e){if(a.draggable&&Fa){Fa=false;K();var i={x:b-fa.x,y:e-fa.y};if(v(i.x)>0||v(i.y)>0){fa={x:b,y:e};var k=d(Y),l=d(fb),n=d(J),A=c(o,gb(n?e-l.y:b-
l.x,d(Ia),k,d(Ja),d(Ka),d($)));c(Q,d(Q)||d(x)!=d(ea));(i=db(n?i.y:i.x||0))&&c(E,i<0);if(a.orbital&&d(ya)){c(J,v(e-l.y)>v(b-l.x));l=ga(b,e,A,k,d(y))}if(a.rows>1){i=d(B).y;n=d(hb);var s=-n*i;c(y,H(h.reel.math.envelope(e-l.y,n,i,s,s+i,-1)))}!(A%1)&&!a.loops&&ga(b,e,A,k,d(y));g.trigger("fractionChange")}}m.call(f)},wheel:function(f,b){var e=Ua(Kb(v(b))/2);e=na(e,b>0);b=0.2*d(Y);ga(p,p,d(o),b,d(y));c(o,gb(e,d(Ia),b,d(Ja),d(Ka),d($)));e&&c(E,e<0);c(I,0);K();m.call(f);g.trigger("fractionChange");return false},
fractionChange:function(f,b){b=!b?d(o):c(o,b);b=a.loops?b-T(b):V(0,1,b);b=c(o,H(b));var e=d(x),i=c(x,1+T(b/d(Z))),k=a.orbital;c(ya,!!k&&(i<=k||i>=a.footage-k+2));if(!a.loops&&a.rebound){!G&&!(b%1)?La++:(La=0);La>=a.rebound*1E3/z(C)&&c(E,!d(E))}k=d(B);var l=(d(J)?k.y:k.x)-a.indicator;b=V(0,l,U(h.reel.math.interpolate(b,-1,l+2)));b=!a.cw||a.stitched?b:l-b;h(ka(Ma+".x"),d(wa)).css(d(J)?{left:0,top:b}:{left:b,top:k.y-a.indicator});if(a.rows>1){b=d(B).y-a.indicator;b=V(0,b,U(h.reel.math.interpolate(d(y),
-1,b+2)));h(ka(Ma+".y"),d(wa)).css({top:b})}if(i==e&&i!=1)return m.call(f);g.trigger(a.rows>1?"rowChange":"frameChange");m.call(f)},rowChange:function(f,b){var e=T(d(o)/d(Z))+1;b=c(y,V(0,1,H(b!=p?(b-1)/(a.rows-1):d(y))));c(x,e+(a.rows<=1?0:U(b*(a.rows-1))*a.frames));m.call(f);g.trigger("frameChange")},frameChange:function(f,b){var e=!b?d(o):c(o,H(d(Z)*(b-1)));b=c(x,U(b?b:d(x)));var i=a.images,k=a.footage,l=d(B),n=a.horizontal;if(d(J)){b=a.inversed?k+1-b:b;b+=k}if(i.length)g.attr({src:a.path+i[b-1]});
else{if(a.stitched)i=[-U(e*d(Xa))+L,0+L];else{e=b%k-1;e=e<0?k-1:e;k=T((b-0.1)/k);k+=a.rows>1?0:d(E)?0:d(ua);b=d(Wa);k=k*((n?l.y:l.x)+b);l=e*((n?l.x:l.y)+b);i=i.length?[0,0]:n?[-l+L,-k+L]:[-k+L,-l+L]}g.css({backgroundPosition:i.join(sa)})}m.call(f)}},m=function(f){ib||delete this;return f},G,R=0,eb=function(){return G=0},K=function(){clearTimeout(jb);D.unbind(F,t.opening_tick);g.trigger("play");return G=-a.timeout*z(C)},jb,Ib=function(){jb=setTimeout(function(){g.trigger("play")},a.delay*1E3||0)},
Da,Ea,bb=function(f){return h(P,{"class":[Ma,f].join(sa),css:{width:a.indicator,height:a.indicator,overflow:cb,top:d(B).y-a.indicator,left:0,position:da,backgroundColor:Ba}})},La=0,fa={x:0,y:0},db=function(f){return S.push(f)&&S.shift()&&f},ba=function(){return S=[0,0]},S=ba(),gb=a.graph||h.reel.math[a.loops?"hatch":"envelope"],ga=function(f,b,e,i,k){c(Ia,e);c(hb,k);c(Ja,a.loops?0:-e*i);c(Ka,a.loops?i:i-e*i);return f&&c(fb,{x:f,y:b})||p},Fa=true,ca=h.browser.opera?D:h.unique(D.add(kb.top.document));
t.setup()});ha=ha||function g(){var r=+new Date,c=z(C);if(c){D.trigger(F);h.reel.cost=(+new Date+h.reel.cost-r)/2;return ha=setTimeout(g,N(4,1E3/c-h.reel.cost))}else return ha=p}();return h(u)};h.reel.math={envelope:function(j,a,u,g,r,c){return a+N(g,Na(r,-j*c))/u},hatch:function(j,a,u,g,r,c){j=(j<g?r:0)+j%r;j=a+-j*c/u;return j-T(j)},interpolate:function(j,a,u){return a+j*(u-a)}};h.reel.touchy=/iphone|ipod|ipad|android/i.test(navigator.userAgent);h.reel.lazy=/iphone|ipod|android/i.test(navigator.userAgent);
h.reel.instances=h();h.reel.cost=0;h.reel.leader=z;pb("mousewheel disableTextSelect enableTextSelect".split(/ /));var D=h(ia);ia=+h.browser.version.split(".").slice(0,2).join(".");var ib=h.browser.msie,nb=!(ib&&ia<8),Ca="ew-resize",ha,w="jquery-reel",rb=w+"-overlay",Ma=w+"-indicator",Gb=w+"-preloader",Fb=w+"-monitor",ub=w+"-interface",Hb=ja("CAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7")||la("blank.gif"),ab=ja("EAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAI3lC8AeBDvgosQxQtne7yvLWGStVBelXBKqDJpNzLKq3xWBlU2nUs4C/O8cCvU0EfZGUwt19FYAAA7")||
la("jquery.reel.cursor-drag.gif"),Jb=ja("EAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAIslI95EB3MHECxNjBVdE/5b2zcRV1QBabqhwltq41St4hj5konmVioZ6OtEgUAOw==")||la("jquery.reel.cursor-drag-down.gif"),U=Math.round,T=Math.floor,Ua=Math.ceil,Na=Math.min,N=Math.max,v=Math.abs,Kb=Math.sqrt,X=parseInt,$a="area",Za="backup",E="backwards",Z="bit",Ya="brake",ya="center",sb="classes",ea="clicked",fb="clicked_location",Ia="clicked_on",hb="clicked_row",$="cwish",B="dimensions",o="fraction",x="frame",Ta="frames",
Ka="hi",cb="hidden",Va="image",aa="opening_ticks",Ja="lo",Ha="playing",Q="reeling",Y="revolution",y="row",ua="rows",Wa="spacing",xa="speed",wa="stage",ta="steps",va="stitched",Xa="stitched_travel",Ga="stopped",C="tempo",I="velocity",J="vertical",tb="wheel_step",q=".reel",Ab="dblclick"+q,Cb="mousedown"+q,Bb="mouseenter"+q,Db="mouseleave"+q,Aa="mousemove"+q,za="mouseup"+q,zb="mousewheel"+q,F="tick"+q,yb="touchcancel"+q,xb="touchend"+q,vb="touchstart"+q,wb="touchmove"+q,Ra="",sa=" ",da="absolute",Sa=
"div",P=ob(Sa),Qa="height",Ba="#000",M="id",qb="img",L="px",Oa="src",Eb="title",Pa="width"}(jQuery,window,document);
