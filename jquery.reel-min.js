/*
 Copyright (c) 2009-2011 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 jQuery Reel
 http://jquery.vostrel.cz/reel
 Version: 1.1.3-devel
 Updated: 2011-11-27

 Requires jQuery 1.4.3 or higher
*/
jQuery.reel||function(f,yb,wa,q){function K(e){return f.reel.instances.length?f.reel.instances.first().data(e):null}function zb(e){return f.reel.instances.push(e[0])&&e}function Ab(e){return(f.reel.instances=f.reel.instances.not("#"+e.attr(ba)))&&e}function xa(e){return Bb&&"data:image/gif;base64,R0lGODlh"+e}function ya(e){return"<"+e+"/>"}function z(e){return"."+e}function za(e){return"http://code.vostrel.cz/"+e}function Va(e){return"url("+e+")"}function U(e,a,n){return ca(e,Wa(a,n))}function Cb(e){function a(){f.fn[this]||
(f.fn[this]=function(){return this})}f.each(e,a)}function Aa(e,a){return E(e)*(a?-1:1)}function ka(e){return e.originalEvent.touches[0]}function da(e){return e===q||typeof e=="string"?e:e+"px"}function Db(e){var a=[];f.each(e,function(n,h){a.push(n.replace(/([A-Z])/g,"-$1").toLowerCase()+":"+da(h))});return"{"+a.join(";")+";}"}function Eb(){var e=f().jquery.split(".");(e=+e[0]<=1&&(+e[1]<4||+e[1]==4&&+e[2]<3))&&console.error("FATAL: jQuery Reel plug-in requires at least jQuery 1.4.3");return e}if(!Eb()){f.reel=
{version:"1.1.3-devel",def:{area:q,brake:0.5,clickfree:false,cw:false,delay:-1,directional:false,draggable:true,footage:6,entry:q,frame:1,frames:36,graph:q,hint:"",horizontal:true,image:q,images:[],indicator:0,inversed:false,klass:"",laziness:6,loops:true,monitor:q,opening:0,orbital:0,path:"",preloader:4,rebound:0.5,revolution:q,row:1,rows:0,spacing:0,speed:0,step:q,steps:q,stitched:0,suffix:"-reel",tempo:36,timeout:2,throwable:true,vertical:false,wheelable:true,annotations:q,attr:{},crop:true,preload:"fidelity",
scrollable:true,steppable:true,velocity:0}};f.fn.reel=function(e){var a=f.extend({},f.reel.def,e);e=function(h){var t=[];h.filter(Ba).each(function(){var d=f(this),c=a.images.length&&a.images||a.image||a.attr.src||d.attr(Xa),A=la(a.attr.width||d.css(Ya)),o=la(a.attr.height||d.css(Za));!c||c==$a||!A||!o||t.push(d)});h.filter(z(w)).each(function(){t.push(f(this).unreel())});return f(t)}(this);var n=[];a.tooltip&&(a.hint=a.tooltip);a.hotspot&&(a.area=a.hotspot);e.each(function(){var h=f(this),t=h.data(),
d=function(g,b){t[g]=b;h.trigger("store",[g,b]);return b},c=function(g){var b=t[g];h.trigger("recall",[g,b]);return b},A={setup:function(g){if(h.hasClass(w))return o.call(g);var b=h.attr(a.attr).attr(Xa),i=d(ba,h.attr(ba)||h.attr(ba,w+"-"+ +new Date).attr(ba)),k=h.attr("style"),j=f.extend({},h.data()),l=a.images,m=a.stitched,p=a.loops,x={x:la(h.css(Ya)||a.attr.width),y:la(h.css(Za)||a.attr.height)},F=d(Ca,a.orbital&&a.footage||a.rows<=1&&l.length||a.frames),P=m?1:ab(F/a.footage);i="#"+i+a.suffix;
var G=h.attr("class")||"",Q=f(V,{id:i.substr(1),"class":G+B+Fb});Q=h.wrap(Q).attr({"class":w});n.push(zb(Q)[0]);Q=Q.parent().bind(A.instance);d(bb,l.length&&l.length||a.image||b.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2"));d(cb,[]);d(H,a.frame);d(db,a.spacing);d(R,x);d(r,0);d(Da,a.steps||a.frames);d(ma,a.revolution||m/2||x.x*2);d(Ea,P);d(W,1/(F-(p&&!m?0:1)));d(Gb,1/ca(F,c(Da)));d(Fa,m);d(eb,m-(p?0:x.x));d(Ga,i);d(I,d(Ha,a.speed)<0);d(X,a.velocity||0);d(Y,a.vertical);d(J,(a.row-1)/(a.rows-
1));d(Z,Aa(1,!a.cw&&!m));d(ea,false);d(fb,a.brake);d(Ia,!!a.orbital);d(L,a.tempo/(f.reel.lazy?a.laziness:1));d(fa,q);d(gb,{src:b,classes:G,style:k||$a,data:j});a.steppable||Q.unbind("click.steppable");a.annotations||Q.unbind(".annotations");C(true,"",{width:x.x,height:x.y});C(true,","+B+z(w),{display:"block",position:"relative"});S.bind(A.pool);o.call(g);h.trigger("setup")},instance:{teardown:function(g){var b=h.data(gb);h.parent().unbind(A.instance).children(Ba).unbind(v);c(hb).remove();h.unbind(v).attr({"class":b.classes,
src:b.src,style:b.style}).removeClass(w);h.data(b.data).siblings().remove();h.unwrap();Ab(h);na();S.unbind(A.pool);oa.unbind(Ja).unbind(Ka);o.call(g)},start:function(){var g=c(R),b=c(Ca),i=ca(b,c(Da));i=d(r,1/i*((a.step||a.frame)-1));d(H,T(i*b)+1);h.attr("id");b=h.parent();var k=!c(ea)||a.rows<=1||!a.orbital||a.scrollable;i=d(La,f(a.area||b));if(f.reel.touchy){C(true,B+z(w),{WebkitUserSelect:"none",WebkitBackgroundSize:a.images.length?"auto":c(Fa)&&c(Fa)+"px "+g.y+"px"||g.x*a.footage+"px "+g.y*c(Ea)*
(a.rows||1)*(a.directional?2:1)+"px"});i.bind(Hb,function(j){h.trigger("down",[ka(j).clientX,ka(j).clientY,true])}).bind(Ib,function(j){h.trigger("pan",[ka(j).clientX,ka(j).clientY,true]);return!k}).bind(Jb,function(){h.trigger("up",[true]);return false}).bind(Kb,function(){h.trigger("up",[true]);return false})}else{C(true,"",{cursor:"url("+Lb+"), "+ib});i.bind(a.wheelable?Mb:"",function(j,l){h.trigger("wheel",[l]);return false}).bind(a.clickfree?Nb:Ob,function(j){if(!j.button){h.trigger("down",[j.clientX,
j.clientY]);return false}}).bind(a.clickfree?Pb:"",function(){h.trigger("up");return false}).disableTextSelect()}a.hint&&i.attr(Qb,a.hint);a.monitor&&b.append(M=f(V,{"class":jb}))||(M=f());C(true,B+z(jb),{position:ga,left:0,top:0});C(true,B+z(kb),{display:"none"});C(true,B+z(lb),{position:ga,left:0,top:g.y-a.preloader,height:a.preloader,overflow:mb,backgroundColor:nb});C(true,z(Ma),{cursor:Va(Rb)+", "+ib});a.indicator&&b.append(ob("x"));a.rows>1&&a.indicator&&b.append(ob("y"))},preload:function(g){var b=
c(R),i=h.parent(),k=c(bb),j=a.images,l=f.reel.preload[a.preload]||f.reel.preload[f.reel.def.preload];l=!j.length?[k]:l(j,a,c);var m=[],p=h[0];p.frames=l.length;p.preloaded=0;h.trigger("stop");for(i.append(D=f(V,{"class":lb}));l.length;){var x=a.path+l.shift(),F=f(new Image).addClass(kb).attr({width:b.x,height:b.y}).bind("load"+v,function(){p.preloaded++;f(this).unbind(v);D.css({width:1/p.frames*p.preloaded*b.x});if(p.frames==p.preloaded){D.remove();j.length||h.attr({src:Sb}).css({backgroundImage:Va(a.path+
k)});h.trigger("loaded");o.call(g)}});i.append(F);m.push(x);setTimeout(function(P,G){return function(){P.attr({src:G})}}(F,x),0)}d(cb,m);d(hb,f('<style type="text/css">'+pb.join("\n")+"</style>").insertBefore(f("head link, head style").first()))},opening:function(){var g=a.entry||a.speed,b=c(r),i=a.opening;d(r,b-g*a.opening);d(fa,i*K(L))},openingDone:function(){pa=setTimeout(function(){h.trigger("play")},a.delay*1E3||0)},play:function(g){var b=d(Na,true);d(Oa,!b);ha();o.call(g)},pause:function(g){d(Na,
false);u();o.call(g)},stop:function(g){var b=d(Oa,true);d(Na,!b);o.call(g)},down:function(g,b,i,k){if(a.draggable){d(qa,c(H));d(X,0);ra=sa(b,i,c(r),c(ma),c(J));u();na();N=false;c(La).addClass(Ma);if(!k){oa.bind(Ka,function(j){h.trigger("pan",[j.clientX,j.clientY]);o.call(j);return false});a.clickfree||oa.bind(Ja,function(j){h.trigger("up");o.call(j)})}}o.call(g)},up:function(g,b){if(!a.draggable)return o.call(g);d(qa,false);d(ea,false);var i=d(X,!a.throwable?0:E(ia[0]+ia[1])/60);O=i?1:0;i?ha():u();
na();c(La).removeClass(Ma);!b&&oa.unbind(Ja).unbind(Ka);o.call(g)},pan:function(g,b,i){if(a.draggable&&Pa){Pa=false;u();var k={x:b-ra.x,y:i-ra.y};if(E(k.x)>0||E(k.y)>0){N=true;ra={x:b,y:i};var j=c(ma),l=c(qb),m=c(Y),p=d(r,rb(m?i-l.y:b-l.x,c(Qa),j,c(Ra),c(Sa),c(Z)));d(ea,c(ea)||c(H)!=c(qa));(k=sb(m?k.y:k.x||0))&&d(I,k<0);if(a.orbital&&c(Ia)){d(Y,E(i-l.y)>E(b-l.x));l=sa(b,i,p,j,c(J))}if(a.rows>1){k=c(R).y;m=c(tb);var x=-m*k;d(J,f.reel.math.envelope(i-l.y,m,k,x,x+k,-1))}!(p%1)&&!a.loops&&sa(b,i,p,j,
c(J));h.trigger("fractionChange")}}o.call(g)},wheel:function(g,b){var i=ab(Tb(E(b))/2);i=Aa(i,b>0);b=0.2*c(ma);sa(q,q,c(r),b,c(J));d(r,rb(i,c(Qa),b,c(Ra),c(Sa),c(Z)));i&&d(I,i<0);d(X,0);u();o.call(g);h.trigger("fractionChange");return false},fractionChange:function(g,b){b=d(r,ta.fraction(b,a,c));var i=d(H,1+$(b/c(W))),k=a.rows>1,j=a.orbital;d(Ia,!!j&&(i<=j||i>=a.footage-j+2));if(!a.loops&&a.rebound){!y&&!(b%1)?Ta++:(Ta=0);Ta>=a.rebound*1E3/K(L)&&d(I,!c(I))}h.trigger(k?"rowChange":"frameChange");o.call(g)},
rowChange:function(g,b){var i=c(r)/c(W)+1;b=d(J,ta.row(b,a,c));b=U(0,a.rows-1,$(b*a.rows));d(H,$(i+b*a.frames));o.call(g);h.trigger("frameChange")},frameChange:function(g,b){var i=d(r,ta.fraction(!b?q:c(W)*(b-1),a,c)),k=c(ub);b=ta.frame(b,a,c);var j=a.images,l=a.footage,m=c(R),p=a.rows>1,x=c(Ga),F=a.horizontal;if(c(Y)){b=a.inversed?l+1-b:b;b+=l}b=d(ub,d(H,b));var P=(c(Y)?m.y:m.x)-a.indicator,G=U(0,P,T(f.reel.math.interpolate(c(r),-1,P+2)));G=!a.cw||a.stitched?G:P-G;f(z(ua+".x"),x).css(c(Y)?{left:0,
top:G}:{left:G,top:m.y-a.indicator});if(p){p=m.y-a.indicator;p=U(0,p,T(f.reel.math.interpolate(c(J),-1,p+2)));f(z(ua+".y"),x).css({top:p})}if(b==k)g.stopPropagation();else if(j.length)h.attr({src:a.path+j[b-1]});else{if(a.stitched)j=[-T(i*c(eb))+aa,0+aa];else{i=b%l-1;i=i<0?l-1:i;l=$((b-0.1)/l);l+=a.rows>1?0:c(I)?0:c(Ea);b=c(db);l=l*((F?m.y:m.x)+b);m=i*((F?m.x:m.y)+b);j=j.length?[0,0]:F?[-m+aa,-l+aa]:[-l+aa,-m+aa]}h.css({backgroundPosition:j.join(B)})}o.call(g)},stepLeft:function(){u();d(I,false);
h.trigger("fractionChange",c(r)-c(W)*c(Z))},stepRight:function(){u();d(I,true);h.trigger("fractionChange",c(r)+c(W)*c(Z))},"click.steppable":function(g){if(N)return g.stopPropagation();h.trigger(g.clientX-h.offset().left>0.5*c(R).x?"stepRight":"stepLeft")},"setup.annotations":function(){var g=c(R),b=h.parent(),i={position:ga,width:g.x,height:g.y,left:0,top:0};C(true,B+z(Ua),i);a.crop&&C(true,B+z(Ua),{clip:"rect(0 "+da(g.x)+" "+da(g.y)+" 0)"});b.append(s=f(V,{"class":Ua+B+vb+a.frame}))||(s=f());f.each(a.annotations,
function(k,j){var l=f(V,j.node).attr({id:k}),m=j.image?f(ya(Ba),j.image):f(),p=j.link?f(ya(Ub),j.link):f();C(false,"#"+k,{display:"none",position:ga});j.image||j.link&&l.append(p);j.link||j.image&&l.append(m);j.link&&j.image&&l.append(p.append(m));l.appendTo(s)})},"frameChange.annotations":function(g,b){b=b||c(H);s[0].className=s[0].className.replace(/frame-\d+/g,vb+b);f.each(a.annotations,function(i,k){i=f("#"+i,s);var j=k.start,l=k.end,m=b-(j||0),p=typeof k.x!=wb?k.x:k.x[m-1];k=typeof k.y!=wb?k.y:
k.y[m-1];k={display:p!==q&&k!==q&&m>=0&&(!l||m<=l-j)?"block":"none",left:da(p)||0,top:da(k)||0};i.css(k)})},"setup.fu":function(){h.trigger("start")},"start.fu":function(){h.trigger("preload")},"loaded.fu":function(){h.trigger(a.rows>1&&!a.stitched?"rowChange":"frameChange").trigger("opening")}},pool:{"tick.reel":function(g){var b=c(X);if(O){var i=b-c(fb)/K(L)*O;b=!(b*i<=0||b<E(i))&&d(X,b>E(c(Ha))?i:(O=y=0))}M.text(c(a.monitor));b&&O++;y&&y++;sb(0);Pa=true;if(y&&!b)return o.call(g);if(c(qa))return o.call(g,
u());i=c(Z)*Aa(1,c(I));b=(c(Oa)?b:E(c(Ha))+b)/K(L);var k=c(r);d(r,k-b*i);o.call(g)},"tick.reel.fu":function(g){h.trigger("fractionChange");c(fa)===q&&g.stopImmediatePropagation()},"tick.reel.opening":function(g){var b=(a.entry||a.speed)/K(L)*(a.cw?-1:1),i=c(r);d(r,i+b);b=d(fa,c(fa)-1);o.call(g);if(!(b>1)){S.unbind(ja+".opening",A.pool[ja+".opening"]);h.trigger("openingDone")}}}},o=function(g){xb||delete this;return g},y,O=0,ha=function(){return y=0},u=function(){clearTimeout(pa);S.unbind(ja+".opening",
A.pool[ja+".opening"]);h.trigger("play");return y=-a.timeout*K(L)},N=false,pa,M,s,D,ob=function(g){C(true,B+z(ua)+z(g),{position:ga,width:a.indicator,height:a.indicator,overflow:mb,backgroundColor:nb});return f(V,{"class":[ua,g].join(B)})},pb=[],C=function(g,b,i){var k=c(Ga);b=b.split(",");g&&f.each(b,function(j,l){b[j]=k+l});pb.push(b.join(",")+Db(i));return i},Ta=0,ra={x:0,y:0},sb=function(g){return ia.push(g)&&ia.shift()&&g},na=function(){return ia=[0,0]},ia=na(),rb=a.graph||f.reel.math[a.loops?
"hatch":"envelope"],ta=f.reel.normal,sa=function(g,b,i,k,j){d(Qa,i);d(tb,j);d(Ra,a.loops?0:-i*k);d(Sa,a.loops?k:k-i*k);return g&&d(qb,{x:g,y:b})||q},Pa=true,oa=f.browser.opera?S:f.unique(S.add(yb.top.document));A.setup()});va=va||function h(){var t=+new Date,d=K(L);if(d){S.trigger(ja);f.reel.cost=(+new Date+f.reel.cost-t)/2;return va=setTimeout(h,ca(4,1E3/d-f.reel.cost))}else return va=q}();return f(n)};f.fn.unreel=function(){return this.trigger("teardown")};f.reel.math={envelope:function(e,a,n,h,
t,d){return a+ca(h,Wa(t,-e*d))/n},hatch:function(e,a,n,h,t,d){e=(e<h?t:0)+e%t;e=a+-e*d/n;return e-$(e)},interpolate:function(e,a,n){return a+e*(n-a)}};f.reel.preload={linear:function(e){return e},fidelity:function(e,a){function n(o,y,O){function ha(D){for(;!(D>=1&&D<=M);)D+=D<1?+M:-M;return A[O+D]||(A[O+D]=!!u.push(D))}if(!o.length)return[];var u=[],N=4*y,pa=a.frame,M=o.length;y=M/N;for(var s=0;s<N;s++)ha(pa+T(s*y));for(;y>1;){s=0;N=u.length;for(y/=2;s<N;s++)ha(T(u[s]+y))}for(s=0;s<u.length;s++)u[s]=
o[u[s]-1];return u}var h=a.orbital?2:a.rows||1,t=a.orbital?a.footage:a.frames,d=(a.row-1)*t,c=[].concat(e),A=new Array(e.length);e=h<2?[]:c.slice(d,d+t);return n(e,1,d).concat(n(c,h,0))}};f.reel.normal={fraction:function(e,a,n){e=e!=q?e:n(r);return a.loops?e-$(e):U(0,1,e)},row:function(e,a,n){return U(0,1,e!=q?(e-1)/(a.rows-1):n(J))},frame:function(e,a,n){e=e!=q?T(e):n(H);var h=a.orbital?2:a.rows||1;n=n(Ca)*h;e=a.loops?e%n||n:U(1,n,e);return e<0?e+n:e}};f.reel.touchy=/iphone|ipod|ipad|android/i.test(navigator.userAgent);
f.reel.lazy=/iphone|ipod|android/i.test(navigator.userAgent);f.reel.instances=f();f.reel.cost=0;f.reel.leader=K;Cb("mousewheel disableTextSelect enableTextSelect".split(/ /));var S=f(wa);wa=+f.browser.version.split(".").slice(0,2).join(".");var xb=f.browser.msie,Bb=!(xb&&wa<8),ib="ew-resize",va,w="jquery-reel",Fb=w+"-overlay",ua=w+"-indicator",lb=w+"-preloader",kb=w+"-cached",jb=w+"-monitor",Ua=w+"-annotations",Ma=w+"-panning",vb="frame-",Sb=xa("CAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7")||
za("blank.gif"),Lb=xa("EAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAI3lC8AeBDvgosQxQtne7yvLWGStVBelXBKqDJpNzLKq3xWBlU2nUs4C/O8cCvU0EfZGUwt19FYAAA7")||za("jquery.reel.cursor-drag.gif"),Rb=xa("EAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAIslI95EB3MHECxNjBVdE/5b2zcRV1QBabqhwltq41St4hj5konmVioZ6OtEgUAOw==")||za("jquery.reel.cursor-drag-down.gif"),T=Math.round,$=Math.floor,ab=Math.ceil,Wa=Math.min,ca=Math.max,E=Math.abs,Tb=Math.sqrt,la=parseInt,La="area",gb="backup",I="backwards",W="bit",fb=
"brake",Ia="center",qa="clicked",qb="clicked_location",Qa="clicked_on",tb="clicked_row",Z="cwish",R="dimensions",r="fraction",H="frame",ub="_frame",Ca="frames",Sa="hi",mb="hidden",bb="image",cb="images",fa="opening_ticks",Ra="lo",Na="playing",ea="reeling",ma="revolution",J="row",Ea="rows",db="spacing",Ha="speed",Ga="stage",Da="steps",Fa="stitched",eb="stitched_travel",Oa="stopped",hb="style",L="tempo",X="velocity",Y="vertical",Gb="wheel_step",v=".reel",Ob="mousedown"+v,Nb="mouseenter"+v,Pb="mouseleave"+
v,Ka="mousemove"+v,Ja="mouseup"+v,Mb="mousewheel"+v,ja="tick"+v,Kb="touchcancel"+v,Jb="touchend"+v,Hb="touchstart"+v,Ib="touchmove"+v,$a="",B=" ",ga="absolute",Ub="a",V=ya("div"),Za="height",nb="#000",ba="id",Ba="img",wb="object",aa="px",Xa="src",Qb="title",Ya="width"}}(jQuery,window,document);
