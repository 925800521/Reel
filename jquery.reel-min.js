/*
 Copyright (c) 2009-2012 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 jQuery Reel
 http://jquery.vostrel.cz/reel
 Version: 1.1.3-devel
 Updated: 2012-01-28

 Requires jQuery 1.5 or higher
*/
jQuery.reel||function(l,Nb,Sa,o){function Ob(g){return p.instances.push(g[0])&&g}function Pb(g){return(p.instances=p.instances.not(na(g.attr(ga))))&&g}function R(g){return p.instances.length?p.instances.first().data(g):null}function Qb(g){return"data:image/gif;base64,R0lGODlh"+g}function S(g){return"<"+g+"/>"}function s(g){return"."+(g||"")}function xa(g){return p.cdn+g}function ya(g){return"url("+g+")"}function oa(g,j,q){return pa(g,Ta(j,q))}function Rb(g){function j(){l.fn[this]||(l.fn[this]=function(){return this})}
l.each(g,j)}function Ua(g,j){return T(g)*(j?-1:1)}function za(g){return Aa?g.touch||g.originalEvent.touches[0]:g}function L(g){return g===o||typeof g==mb?g:g+X}function na(g){return"#"+g}function nb(g){try{console.warn("Deprecation - Please consult https://github.com/pisi/Reel/wiki/Deprecations")}catch(j){}return g}if(+l().jquery.replace(s(),"").substr(0,2)<15)throw"VersionError: far too old jQuery for running Reel";var p=l.reel={version:"1.2alpha",def:{area:o,brake:0.23,clickfree:false,cw:false,
delay:-1,directional:false,draggable:true,footage:6,entry:o,frame:1,frames:36,graph:o,hint:"",horizontal:true,image:o,images:[],indicator:0,inversed:false,klass:"",laziness:6,loops:true,monitor:o,opening:0,orbital:0,path:"",preloader:2,rebound:0.5,revolution:o,row:1,rows:0,spacing:0,speed:0,step:o,steps:o,stitched:0,suffix:"-reel",tempo:36,timeout:2,throwable:true,vertical:false,wheelable:true,annotations:o,attr:{},cursor:o,preload:"fidelity",scrollable:true,steppable:true,sequence:"",velocity:0},
fn:{reel:function(){var g=arguments,j=l(this),q=j.data(),r=g[0],t=g[1];if(g.length==2){if(t!==o){try{t=p.normal[r](t,q)}catch(E){}if(q[r]!==t)if(q[r]===o)q[r]=t;else j.trigger(r+"Change",[o,q[r]=t])}return j.trigger("store",[r,t])}else if(typeof r=="string"){t=q[r];j.trigger("recall",[r,t]);return t}else{var a=l.extend({},p.def,r),M=[];(function(i){var d=[];i.filter(Va).each(function(){var c=l(this),u=a.images.length&&a.images||a.sequence||a.image||a.attr.src||c.attr(ob),C=Ba(a.attr.width||c.css(Wa)),
z=Ba(a.attr.height||c.css(pb));u&&u!=H&&C&&z&&d.push(c)});i.filter(s(w)).each(function(){d.push(l(this).unreel())});return l(d)})(this).each(function(){var i=l(this),d=function(b,e){return i.reel(b,e)&&e},c=function(b){return i.reel(b)},u={setup:function(){if(!i.hasClass(w)){d(Xa,a);var b=i.attr(a.attr).attr(ob),e=d(ga,i.attr(ga)||i.attr(ga,w+"-"+ +new Date).attr(ga)),f=i.attr(qa),h=l.extend({},i.data()),k=p.re.sequence.exec(d(Sb,a.sequence));k=d(Y,k?p.sequence(k,a,c):a.images);var n=a.stitched,m=
a.loops,x={x:Ba(i.css(Wa)||a.attr.width),y:Ba(i.css(pb)||a.attr.height)},I=d(ra,a.orbital&&a.footage||a.rows<=1&&k.length||a.frames),ha=n?1:Ca(I/a.footage);e=na(e+a.suffix);var Da=i.attr("class")||H,J=l(S(sa),{id:e.substr(1),"class":Da+A+Tb+A+qb+"0"});J=i.wrap(J.addClass(a.klass)).attr({"class":w});M.push(Ob(J)[0]);J=J.parent().bind(u.instance);d(Ya,k.length?H:a.image||b.replace(p.re.image,"$1"+a.suffix+".$2"));d(rb,[]);d(sb,a.spacing);d(F,x);d(Z,o);d(v,o);d(N,o);d(Za,a.steps||a.frames);d(Ea,a.revolution||
n/2||x.x*2);d($a,ha);d(Fa,1/(I-(m&&!n?0:1)));d(Ub,1/pa(I,c(Za)));d(ab,n);d(tb,n-(m?0:x.x));d(ub,e);d(O,d(Ga,a.speed)<0);d($,a.velocity||0);d(ia,a.vertical);d(aa,0);d(ja,Ua(1,!a.cw&&!n));d(bb,{});d(ta,false);d(Ha,d(cb,0));d(Ia,d(Ja,0));d(ua,false);d(vb,a.brake);d(db,!!a.orbital);d(U,a.tempo/(p.lazy?a.laziness:1));d(ba,-1);d(Ka,a.annotations||J.unbind(s(Ka))&&{});d(wb,{src:b,classes:Da,style:f||H,data:h});a.steppable||J.unbind("click.steppable");a.indicator||J.unbind(".indicator");B(H,{width:x.x,height:x.y,
overflow:eb,position:"relative"});B(ca+A+s(w),{display:xb});P.bind(u.pool);i.trigger("setup")}},instance:{teardown:function(){var b=i.data(wb);i.parent().unbind(u.instance);c(qa).remove();c(yb).enableTextSelect();Pb(i.unbind(V).removeData().siblings().unbind(V).remove().end().attr({"class":b.classes,src:b.src,style:b.style}).data(b.data).unwrap());La();P.unbind(u.pool);Q.unbind(W)},setup:function(){function b(n){return function(m){if(m.button==Vb)return m.preventDefault()||i.trigger("down",[za(m).clientX,
za(m).clientY])&&n}}var e=c(F),f=c(ra);f=pa(f,c(Za));i.attr(ga);var h=i.parent();area=d(yb,l(a.area||h));if(Aa){B(A+s(w),{WebkitUserSelect:Ma,WebkitBackgroundSize:c(Y).length?o:c(ab)&&L(c(ab))+A+L(e.y)||L(e.x*a.footage)+A+L(e.y*c($a)*(a.rows||1)*(a.directional?2:1))});area.bind(Wb,b())}else{e=a.cursor==zb?Xb:a.cursor||Yb;var k=a.cursor==zb?Zb+A+"!important":o;B(H,{cursor:e});B(s(fb),{cursor:$b});B(s(Na)+ca+s(Na)+" *",{cursor:k||e},true);area.bind(a.wheelable?ac:H,function(n,m){return n.preventDefault()||
!m||i.trigger("wheel",[m])&&false}).bind(a.clickfree?bc:cc,b()).disableTextSelect()}a.hint&&area.attr(dc,a.hint);a.indicator&&h.append(va(ec));a.rows>1&&a.indicator&&h.append(va(fc));a.monitor&&h.append(Ab=l(S(sa),{"class":Bb}))&&B(A+s(Bb),{position:Oa,left:0,top:0});B(A+s(Cb),{display:Ma});d(N,(a.row-1)/(a.rows-1));d(v,1/f*((a.step||a.frame)-1))},preload:function(){var b=c(F),e=i.parent(),f=c(Ya),h=c(Y),k=!h.length,n=c(ra),m=p.preload[a.preload]||p.preload[p.def.preload],x=k?[f]:m(h.slice(0),a,c);
d(aa,k?0.5:0);var I=[];e.addClass(fb).append(ka());for(i.trigger("stop");x.length;){f=a.path+x.shift();var ha=b.x*(!k?1:a.footage),Da=b.y*(!k?1:n/a.footage)*(!a.directional?1:2);h=l(S(Va)).attr({"class":Cb}).appendTo(e);J(f,h);I.push(f);function J(gc,Pa){setTimeout(function(){if(Pa.parent().length){Pa.attr({src:gc,width:ha,height:Da});i.reelTriggerOnce("preloaded",function(){return!!Pa.parent().length&&Pa[0].complete})}},I.length-x.length)}}d(rb,I);d(qa,l("<"+qa+' type="text/css">'+B.rules.join("\n")+
"</"+qa+">").prependTo(gb))},preloaded:function(){var b=c(Y).length||1;if(d(aa,Ta(c(aa)+1,b))===b){i.parent().removeClass(fb).unbind(aa,u.instance.preloaded);i.trigger("loaded")}},loaded:function(){c(Y).length>1||i.css({backgroundImage:ya(a.path+c(Ya))}).attr({src:hc})},opening:function(){if(!a.opening)return i.trigger("openingDone");var b=a.entry||a.speed,e=c(v),f=a.opening;d(v,e-b*a.opening);d(ba,f*R(U))},openingDone:function(){if(a.delay)K=setTimeout(function(){i.trigger("play")},a.delay*1E3);
else i.trigger("play")},play:function(b,e){e=d(Ga,e||c(Ga));b=d(hb,!!e);d(ib,!b);da()},pause:function(){d(hb,false);D()},stop:function(){var b=d(ib,true);d(hb,!b)},down:function(b,e,f){function h(n){return function(m){m.preventDefault();i.trigger("pan",[za(m).clientX,za(m).clientY,m]);return n}}function k(n){return function(m){m.preventDefault();i.trigger("up");return n}}if(a.draggable){d(ta,c(Z));d($,0);b=!c(ua)||a.rows<=1||!a.orbital||a.scrollable;Qa=Ra(e,f,c(v),c(Ea),c(N));D();La();y=false;l(Db,
Q).addClass(Na);Aa?Q.bind(ic,h(!b)).bind(jc+A+kc,k()):Q.bind(lc,h()).bind(a.clickfree?mc:nc,k())}},up:function(){if(a.draggable){d(ta,false);d(ua,false);var b=d($,!a.throwable?0:T(wa[0]+wa[1])/60);ea=b?1:0;b?da():D();La();l(Db,Q).removeClass(Na);Q.unbind(W)}},pan:function(b,e,f,h){if(a.draggable&&jb){jb=false;D();b=h&&!l(h.currentTarget).is(P)?oc.offset():{left:0,top:0};e-=b.left;f-=b.top;var k={x:e-Qa.x,y:f-Qa.y};if(T(k.x)>0||T(k.y)>0){y=true;Qa={x:e,y:f};b=c(Ea);h=c(bb);var n=c(ia),m=Eb(n?f-h.y:
e-h.x,c(Ha),b,c(Ia),c(Ja),c(ja),n?f-h.y:e-h.x);d(ua,c(ua)||c(Z)!=c(ta));(k=Fb(n?k.y:k.x||0))&&d(O,k<0);if(a.orbital&&c(db)){d(ia,T(f-h.y)>T(e-h.x));h=Ra(e,f,m,b,c(N))}if(a.rows>1){k=c(F).y;k=a.rows>3?k:k/(5-a.rows);n=c(cb);var x=-n*k;d(N,p.math.envelope(f-h.y,n,k,x,x+k,-1))}!(m%1)&&!a.loops&&Ra(e,f,m,b,c(N));d(v,m)}}},wheel:function(b,e){b=Ca(pc(T(e))/2);b=Ua(b,e>0);e=0.0833*c(Ea);Ra(o,o,c(v),e,c(N));b&&d(O,b<0);d($,0);d(v,Eb(b,c(Ha),e,c(Ia),c(Ja),c(ja)));D();i.trigger("up");return false},fractionChange:function(b,
e,f){if(e!==o)return nb(d(v,e));b=1+la(f/c(Fa));e=a.rows>1;var h=a.orbital;d(db,!!h&&(b<=h||b>=a.footage-h+2));if(!a.loops&&a.rebound){!z&&!(f%1)?kb++:(kb=0);kb>=a.rebound*1E3/R(U)&&d(O,!c(O))}if(e){f=oa(0,a.rows-1,la(c(N)*a.rows));b+=f*a.frames}d(Z,b)},rowChange:function(b,e,f){if(e!==o)return d(N,e);b=c(ra);b=c(Z)%b||b;f=oa(0,a.rows-1,la(f*a.rows));d(Z,b+f*a.frames)},frameChange:function(b,e,f){if(e!==o)return nb(d(Z,e));this.className=this.className.replace(p.re.frame_klass,qb+f);var h=c(v),k=
a.footage;if(a.orbital&&c(ia)){f=a.inversed?k+1-f:f;f+=k}b=a.horizontal;e=c(Y);var n=!e.length,m=c(F);if(n){if(a.stitched)b=[-fa(h*c(tb))+X,0+X];else{h=f%k-1;h=h<0?k-1:h;k=la((f-0.1)/k);k+=a.rows>1?0:c(O)?0:c($a);f=c(sb);k=k*((b?m.y:m.x)+f);m=h*((b?m.x:m.y)+f);b=e.length?[0,0]:b?[-m+X,-k+X]:[-k+X,-m+X]}i.css({backgroundPosition:b.join(A)})}else i.attr({src:a.path+e[f-1]})},"click.steppable":function(b){if(y)return C(b,false);i.trigger(b.clientX-i.offset().left>0.5*c(F).x?"stepRight":"stepLeft")},
"stepLeft stepRight":function(){D()},stepLeft:function(){d(O,false);d(v,c(v)-c(Fa)*c(ja))},stepRight:function(){d(O,true);d(v,c(v)+c(Fa)*c(ja))},"fractionChange.indicator":function(b,e,f){if(e===o&&a.indicator){b=c(F);b=a.orbital&&c(ia)?b.y:b.x;e=a.indicator;var h=Ca(b/(a.orbital?a.footage:a.images.length||a.frames||a.steps));b-=h;f=fa(f*b);f=!a.cw||a.stitched?f:b-f;va.$x.css(c(ia)?{left:0,top:L(f),bottom:null,width:e,height:h}:{bottom:0,left:L(f),top:null,width:h,height:e})}},"rowChange.indicator":function(b,
e,f){if(e===o&&a.rows>1&&a.indicator){var h=c(F).y;b=a.indicator;e=Ca(h/a.rows);h-=e;f=fa(f*h);va.$y.css({left:0,top:f,width:b,height:e})}},"setup.annotations":function(){c(F);var b=i.parent();l.each(c(Ka),function(e,f){var h=typeof f.node==mb?l(f.node):f.node||{};h=h.jquery?h:l(S(sa),h);h=h.attr({id:e}).addClass(qc);var k=f.image?l(S(Va),f.image):l(),n=f.link?l(S(rc),f.link):l();B(na(e),{display:Ma,position:Oa},true);h.bind({"click.annotations":function(m){m.stopPropagation()}});f.image||f.link&&
h.append(n);f.link||f.image&&h.append(k);f.link&&f.image&&h.append(n.append(k));h.appendTo(b)})},"frameChange.annotations":function(b,e){c($)||l.each(c(Ka),function(f,h){f=l(na(f));var k=h.start||1,n=h.end,m=e-1,x=h.at?h.at[m]=="+":false;m=h.at?m:m-k+1;var I=typeof h.x!=Gb?h.x:h.x[m],ha=typeof h.y!=Gb?h.y:h.y[m];h={display:I!==o&&ha!==o&&(h.at?x:m>=0&&(!n||m<=n-k))?xb:Ma,left:L(I)||0,top:L(ha)||0};f.css(h)})},"setup.fu":function(){i.trigger("preload")},"loaded.fu":function(){i.trigger("opening")}},
pool:{"tick.reel.preload":function(){var b=c(F),e=parseInt(ka.$.css(Wa)),f=c(Y).length||1,h=fa(1/f*c(aa)*b.x);ka.$.css({width:e+(h-e)/3+1});if(c(aa)===f&&e>b.x-1){ka.$.fadeOut(300,function(){ka.$.remove()});P.unbind(ma+s(Hb),u.pool[ma+s(Hb)])}},"tick.reel":function(b){var e=c($);if(ea){e=e-c(vb)/R(U)*ea;e=d($,e>0.1?e:(ea=z=0))}a.monitor&&Ab.text(c(a.monitor));e&&ea++;z&&z++;Fb(0);jb=true;if(z&&!e)return C(b);if(c(ta))return C(b,D());if(!(c(ba)>0)){b=c(ja)*Ua(1,c(O));e=(c(ib)?e:T(c(Ga))+e)/R(U);d(v,
c(v)-e*b)}},"tick.reel.opening":function(){var b=ma+s(lb);if(!a.opening||!c(ba))return P.unbind(b,u.pool[b]);b=(a.entry||a.speed)/R(U)*(a.cw?-1:1);var e=d(ba,c(ba)-1);d(v,c(v)+b);e||i.trigger("openingDone")}}},C=function(b,e){return b.stopImmediatePropagation()||e},z,ea=0,da=function(){return z=0},D=function(){clearTimeout(K);P.unbind(ma+s(lb),u.pool[ma+s(lb)]);d(ba,0);i.trigger("play");return z=-a.timeout*R(U)},y=false,K,Ab=l(),ka=function(){B(A+s(Ib),{position:Oa,left:0,top:c(F).y-a.preloader,height:a.preloader,
overflow:eb,backgroundColor:Jb});return ka.$=l(S(sa),{"class":Ib})},va=function(b){B(A+s(Kb)+s(b),{position:Oa,width:0,height:0,overflow:eb,backgroundColor:Jb});return va["$"+b]=l(S(sa),{"class":Kb+A+b})},B=function(b,e,f){function h(k){var n=[];l.each(k,function(m,x){n.push(m.replace(/([A-Z])/g,"-$1").toLowerCase()+":"+L(x)+";")});return"{"+n.join(H)+"}"}f=f?H:c(ub);b=b.replace(/^/,f).replace(ca,ca+f);return B.rules.push(b+h(e))&&e},kb=0,Qa={x:0,y:0},Fb=function(b){return wa.push(b)&&wa.shift()&&
b},La=function(){return wa=[0,0]},wa=La(),Eb=a.graph||p.math[a.loops?"hatch":"envelope"],Ra=function(b,e,f,h,k){d(Ha,f);d(cb,k);d(Ia,a.loops?0:-f*h);d(Ja,a.loops?h:h-f*h);return b&&d(bb,{x:b,y:e})||o},jb=true,Q;try{Q=l.unique(P.add(Nb.top.document))}catch(tc){Q=P}var oc=top===self?l():function(b){l("iframe",Q.last()).each(function(){try{if(l(this).contents().find(gb).html()==l(gb).html())return(b=l(this))&&false}catch(e){}});return b}();B.rules=[];u.setup()});Lb=Lb||function i(){var d=+new Date,c=
R(U),u;if(c){P.trigger(ma);p.cost=(+new Date+p.cost-d)/2;u=setTimeout(i,pa(4,1E3/c-p.cost))}return u}();return l(M)}},unreel:function(){return this.trigger("teardown")}},re:{image:/^(.*)\.(jpg|jpeg|png|gif)$/,touchy_agent:/iphone|ipod|ipad|android/i,lazy_agent:/iphone|ipod|android/i,frame_klass:/frame-\d+/,sequence:/(^[^#|]*([#]+)[^#|]*)($|[|]([0-9]+)\.\.([0-9]+))($|[|]([0-9]+)$)/},cdn:"http://code.vostrel.cz/",math:{envelope:function(g,j,q,r,t,E){return j+pa(r,Ta(t,-g*E))/q},hatch:function(g,j,q,
r,t,E){g=(g<r?t:0)+g%t;g=j+-g*E/q;return g-la(g)},interpolate:function(g,j,q){return j+g*(q-j)}},preload:{linear:function(g){return g},fidelity:function(g,j){function q(i,d,c){function u(K){for(;!(K>=1&&K<=da);)K+=K<1?+da:-da;return M[c+K]||(M[c+K]=!!C.push(K))}if(!i.length)return[];var C=[],z=4*d,ea=j.frame,da=i.length;d=true;for(var D=da/z,y=0;y<z;y++)u(ea+fa(y*D));for(;D>1;){y=0;z=C.length;D/=2;for(d=!d;y<z;y++)u(C[y]+(d?1:-1)*fa(D))}for(y=0;y<C.length;y++)C[y]=i[C[y]-1];return C}var r=j.orbital?
2:j.rows||1,t=j.orbital?j.footage:j.frames,E=(j.row-1)*t,a=[].concat(g),M=new Array(g.length);g=r<2?[]:a.slice(E,E+t);return q(g,1,E).concat(q(a,r,0))}},normal:{fraction:function(g,j){return j[Xa].loops?g-la(g):oa(0,1,g)},row:function(g){return oa(0,1,g)},frame:function(g,j){var q=j[Xa];j=j[ra]*(q.orbital?2:q.rows||1);g=fa(q.loops?g%j||j:oa(1,j,g));return g<0?g+j:g}},sequence:function(g,j){function q(i,d,c){for(;i.length<d;)i=c+i;return i}if(g.length<=1)return j.images;var r=[],t=g[1],E=g[2],a=+g[4]||
1,M=j.orbital?2:j.rows||1;j=j.orbital?j.footage:j.frames;M=+(g[5]||M*j);g=+g[7]||1;for(j=0;j<M;){r.push(t.replace(E,q(a+j+H,E.length,"0")));j+=g}return r},instances:l(),leader:R,cost:0},P=l(Sa);Sa=+l.browser.version.split(s()).slice(0,2).join(s());var sc=l.browser.msie,Mb=navigator.userAgent,Lb,w="reel",Tb=w+"-overlay",Kb=w+"-indicator",Ib=w+"-preloader",Cb=w+"-cached",Bb=w+"-monitor",qc=w+"-annotation",Na=w+"-panning",fb=w+"-loading",qb="frame-",G=Math,fa=G.round,la=G.floor,Ca=G.ceil,Ta=G.min,pa=
G.max,T=G.abs,pc=G.sqrt,Ba=parseInt,Ka="annotations",yb="area",wb="backup",O="backwards",Fa="bit",vb="brake",rb="cached",db="center",ta="clicked",bb="clicked_location",Ha="clicked_on",cb="clicked_row",ja="cwish",F="dimensions",v="fraction",Z="frame",ra="frames",gb="head",Ja="hi",eb="hidden",Ya="image",Y="images",ba="opening_ticks",Ia="lo",Xa="options",hb="playing",aa="preloaded",ua="reeling",Ea="revolution",N="row",$a="rows",Sb="sequence",sb="spacing",Ga="speed",ub="stage",Za="steps",ab="stitched",
tb="stitched_travel",ib="stopped",qa="style",U="tempo",$="velocity",ia="vertical",Ub="wheel_step",V=s(w),W=".pan"+V,cc="mousedown"+V,bc="mouseenter"+V,mc="mouseleave"+W,lc="mousemove"+W,nc="mouseup"+W,ac="mousewheel"+V,ma="tick"+V,kc="touchcancel"+W,jc="touchend"+W,Wb="touchstart"+V,ic="touchmove"+W,H="",A=" ",ca=",",Oa="absolute",rc="a",xb="block",sa="div",zb="hand",pb="height",Jb=na("000"),Db="html",ga="id",Va="img";G="jquery."+w;var Ma="none",Gb="object",lb="opening",Hb="preload",X="px",ob="src",
mb="string",dc="title",Wa="width",ec="x",fc="y",hc=Qb("CAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7")||xa("blank.gif"),$b="wait",Yb=ya(xa(G+s("cur")))+ca+"move",Xb=ya(xa(G+"-drag"+s("cur")))+ca+"move",Zb=ya(xa(G+"-drag-down"+s("cur")))+ca+"move",Aa=p.touchy=p.re.touchy_agent.test(Mb);p.lazy=p.re.lazy_agent.test(Mb);var Vb=Aa?o:sc&&Sa<=8?1:0;Rb("disableTextSelect enableTextSelect".split(/ /));l.extend(l.fn,p.fn);l.fn.reelTriggerOnce=function(g,j){return function q(r){j()?r.trigger(g):setTimeout(function(){q(r)},
100);return r}(l(this))}}(jQuery,window,document);
