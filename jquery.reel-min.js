/*
 Copyright (c) 2009-2011 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 jQuery Reel
 http://jquery.vostrel.cz/reel
 Version: 1.1.3-devel
 Updated: 2011-11-03

 Requires jQuery 1.4.2 or higher
*/
jQuery.reel||function(h,lb,ja,v){function C(i){return h.reel.instances.length?h.reel.instances.first().data(i):null}function mb(i){return h.reel.instances.push(i[0])&&i}function nb(i){return(h.reel.instances=h.reel.instances.not("#"+i.attr(P)))&&i}function ka(i){return ob&&"data:image/gif;base64,R0lGODlh"+i}function pb(i){return"<"+i+"/>"}function la(i){return"."+i}function ma(i){return"http://code.vostrel.cz/"+i}function na(i){return"url("+i+")"}function Q(i,a,r){return R(i,Ma(a,r))}function qb(i){function a(){h.fn[this]||
(h.fn[this]=function(){return this})}h.each(i,a)}function oa(i,a){return x(i)*(a?-1:1)}function X(i){return i.originalEvent.touches[0]}h.reel={version:"1.1.3-devel",def:{footage:6,frame:1,frames:36,hint:"",horizontal:true,hotspot:v,indicator:0,klass:"",loops:true,reversed:v,spacing:0,stitched:0,suffix:"-reel",tooltip:"",area:v,brake:0.5,clickfree:false,cw:false,delay:-1,directional:false,draggable:true,entry:v,graph:v,image:v,images:[],inversed:false,laziness:6,monitor:v,opening:0,orbital:0,path:"",
preloader:4,rebound:0.5,revolution:v,row:1,rows:0,speed:0,step:v,steps:v,tempo:36,timeout:2,throwable:true,vertical:false,wheelable:true,attr:{},scrollable:true,velocity:0}};h.fn.reel=function(i){var a=h.extend({},h.reel.def,i);i=function(f){var o=[];f.filter(rb).each(function(){var d=h(this),c=a.images.length&&a.images||a.image||a.attr.src||d.attr(Na),t=Y(a.attr.width||d.css(Oa)),l=Y(a.attr.height||d.css(Pa));!c||c==Qa||!t||!l||o.push(d)});f.filter(la(y)).each(function(){o.push(h(this).trigger("teardown"))});
return h(o)}(this);var r=[];a.reversed&&(a.cw=true);a.tooltip&&(a.hint=a.tooltip);a.hotspot&&(a.area=a.hotspot);i.each(function(){var f=h(this),o=f.data(),d=function(g,b){o[g]=b;f.trigger("store",[g,b]);return b},c=function(g){var b=o[g];f.trigger("recall",[g,b]);return b},t={setup:function(g){if(f.hasClass(y))return l.call(g);var b=f.attr(a.attr).attr(Na),e=d(P,f.attr(P)||f.attr(P,y+"-"+ +new Date).attr(P)),k=f.attr("style"),j=h.extend({},f.data()),m=a.images,n=a.stitched,p=a.loops,s={x:Y(f.css(Oa)||
a.attr.width),y:Y(f.css(Pa)||a.attr.height)},z=d(pa,a.orbital&&a.footage||a.rows<=1&&m.length||a.frames),A=n?1:Ra(z/a.footage),S={display:"block",width:s.x,height:s.y};e="#"+e+a.suffix;var Sa=f.attr("class")||"",qa={position:"relative",width:s.x,height:s.y};qa=h(T,{id:e.substr(1),"class":Sa+ra+sb,css:qa}).bind("openingDone",Ta);S=f.wrap(qa).attr({"class":y}).css(S).bind(t);r.push(mb(S)[0]);d(Ua,m.length&&m.length||a.image||b.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2"));d(Va,[]);d(D,
a.frame);d(Wa,a.spacing);d(J,s);d(q,0);d(sa,a.steps||a.frames);d(Z,a.revolution||n/2||s.x*2);d(ta,A);d($,1/(z-(p&&!n?0:1)));d(tb,1/R(z,c(sa)));d(ua,n);d(Xa,n-(p?0:s.x));d(va,e);d(G,d(wa,a.speed)<0);d(K,a.velocity||0);d(L,a.vertical);d(B,(a.row-1)/(a.rows-1));d(aa,oa(1,!a.cw&&!n));d(U,false);d(Ya,a.brake);d(xa,!!a.orbital);d(E,a.tempo/(h.reel.lazy?a.laziness:1));d(ba,0);d(Za,{src:b,classes:Sa,style:k||Qa,data:j});F.bind(H,t.tick);l.call(g);f.trigger("start")},teardown:function(g){var b=f.data(Za);
f.parent().unbind("openingDone",Ta).children("img").unbind(u);f.unbind(u).unbind(t).attr({"class":b.classes,src:b.src,style:b.style}).removeClass(y);f.data(b.data).siblings().remove();f.unwrap();nb(f);ca();F.unbind(H,t.tick).unbind(H,t.opening_tick);da.unbind(ya).unbind(za);l.call(g)},start:function(){var g=c(J),b=c(pa),e=R(b,c(sa));e=d(q,1/e*((a.step||a.frame)-1));d(D,I(e*b)+1);f.attr("id");b=f.parent();e=h(T,{"class":ub,css:{position:ea,left:0,top:0,width:g.x,height:g.y,background:Aa,opacity:0}}).appendTo(b);
var k=!c(U)||a.rows<=1||!a.orbital||a.scrollable;e=d($a,h(a.area||e));if(h.reel.touchy){f.css({WebkitUserSelect:"none",WebkitBackgroundSize:a.images.length?"auto":c(ua)&&c(ua)+"px "+g.y+"px"||g.x*a.footage+"px "+g.y*c(ta)*(a.rows||1)*(a.directional?2:1)+"px"});e.bind(vb,function(j){f.trigger("down",[X(j).clientX,X(j).clientY,true])}).bind(wb,function(j){f.trigger("slide",[X(j).clientX,X(j).clientY,true]);return!k}).bind(xb,function(){f.trigger("up",[true]);return false}).bind(yb,function(){f.trigger("up",
[true]);return false})}else e.css({cursor:"url("+ab+"), "+Ba}).bind(a.wheelable?zb:"",function(j,m){f.trigger("wheel",[m]);return false}).bind(Ab,function(){f.trigger("play")}).bind(a.clickfree?Bb:Cb,function(j){f.trigger("down",[j.clientX,j.clientY]);return false}).bind(a.clickfree?Db:"",function(){f.trigger("up");return false}).disableTextSelect();a.hint&&e.attr(Eb,a.hint);a.monitor&&b.append(Ca=h(T,{"class":Fb,css:{position:ea,left:0,top:0}}))||(Ca=h());a.indicator&&b.append(bb("x"));a.rows>1&&
a.indicator&&b.append(bb("y"));f.trigger("preload")},preload:function(g){var b=c(J),e=f.parent(),k=c(Ua),j=a.images,m=!j.length?[k]:h.reel.math.spread(j,a,c),n=[],p=f[0];p.frames=m.length;p.preloaded=0;f.trigger("stop");for(e.append(Da=h(T,{"class":Gb,css:{position:ea,left:0,top:b.y-a.preloader,height:a.preloader,overflow:cb,backgroundColor:Aa}}));m.length;){var s=a.path+m.shift(),z=h(new Image).hide().bind("load"+u,function(){p.preloaded++;h(this).unbind(u);Da.css({width:1/p.frames*p.preloaded*b.x});
if(p.frames==p.preloaded){Da.remove();j.length||f.attr({src:Hb}).css({backgroundImage:na(a.path+k)});f.trigger(a.rows>1&&!a.stitched?"rowChange":"frameChange").trigger("loaded").trigger("opening");l.call(g)}});e.append(z);n.push(s);setTimeout(function(A,S){return function(){A.attr({src:S})}}(z,s),0)}d(Va,n)},tick:function(g){var b=c(K);if(V){var e=b-c(Ya)/C(E)*V;b=!(b*e<=0||b<x(e))&&d(K,b>x(c(wa))?e:(V=w=0))}Ca.text(c(a.monitor));b&&V++;w&&w++;db(0);Ea=true;if(w&&!b)return l.call(g);if(c(fa))return l.call(g,
M());e=c(aa)*oa(1,c(G));var k=(c(Fa)?b:x(c(wa))+b)/C(E);b=c(q);e=d(q,b-k*e);l.call(g);e!=b&&f.trigger("fractionChange")},opening:function(){var g=a.entry||a.speed,b=c(q),e=a.opening;d(q,b-g*a.opening);d(ba,e*C(E));F.bind(H,t.opening_tick)},opening_tick:function(g){var b=(a.entry||a.speed)/C(E)*(a.cw?-1:1),e=c(q);d(q,e+b);b=d(ba,c(ba)-1);f.trigger("fractionChange");l.call(g);if(!(b>1)){F.unbind(H,t.opening_tick);f.trigger("openingDone")}},play:function(g){var b=d(Ga,true);d(Fa,!b);eb();l.call(g)},
pause:function(g){d(Ga,false);M();l.call(g)},stop:function(g){var b=d(Fa,true);d(Ga,!b);l.call(g)},down:function(g,b,e,k){if(a.draggable){d(fa,c(D));d(K,0);ga=ha(b,e,c(q),c(Z),c(B));M();ca();if(!k){da.css({cursor:na(Ib)+", "+Ba}).bind(za,function(j){f.trigger("slide",[j.clientX,j.clientY]);l.call(j);return false});a.clickfree||da.bind(ya,function(j){f.trigger("up");l.call(j)})}}l.call(g)},up:function(g,b){if(!a.draggable)return l.call(g);d(fa,false);d(U,false);var e=d(K,!a.throwable?0:x(W[0]+W[1])/
60);V=e?1:0;e?eb():M();ca();!b&&da.unbind(ya).unbind(za)&&c($a).css({cursor:na(ab)+", "+Ba});l.call(g)},slide:function(g,b,e){if(a.draggable&&Ea){Ea=false;M();var k={x:b-ga.x,y:e-ga.y};if(x(k.x)>0||x(k.y)>0){ga={x:b,y:e};var j=c(Z),m=c(fb),n=c(L),p=d(q,gb(n?e-m.y:b-m.x,c(Ha),j,c(Ia),c(Ja),c(aa)));d(U,c(U)||c(D)!=c(fa));(k=db(n?k.y:k.x||0))&&d(G,k<0);if(a.orbital&&c(xa)){d(L,x(e-m.y)>x(b-m.x));m=ha(b,e,p,j,c(B))}if(a.rows>1){k=c(J).y;n=c(hb);var s=-n*k;d(B,h.reel.math.envelope(e-m.y,n,k,s,s+k,-1))}!(p%
1)&&!a.loops&&ha(b,e,p,j,c(B));f.trigger("fractionChange")}}l.call(g)},wheel:function(g,b){var e=Ra(Jb(x(b))/2);e=oa(e,b>0);b=0.2*c(Z);ha(v,v,c(q),b,c(B));d(q,gb(e,c(Ha),b,c(Ia),c(Ja),c(aa)));e&&d(G,e<0);d(K,0);M();l.call(g);f.trigger("fractionChange");return false},fractionChange:function(g,b){b=!b?c(q):d(q,b);b=d(q,a.loops?b-N(b):Q(0,1,b));var e=d(D,1+N(b/c($))),k=a.rows>1,j=a.orbital;d(xa,!!j&&(e<=j||e>=a.footage-j+2));if(!a.loops&&a.rebound){!w&&!(b%1)?Ka++:(Ka=0);Ka>=a.rebound*1E3/C(E)&&d(G,
!c(G))}f.trigger(k?"rowChange":"frameChange");l.call(g)},rowChange:function(g,b){var e=c(q)/c($)+1;b=d(B,Q(0,1,b!=v?(b-1)/(a.rows-1):c(B)));b=Q(0,a.rows-1,N(b*a.rows));d(D,N(e+b*a.frames));l.call(g);f.trigger("frameChange")},frameChange:function(g,b){var e=!b?c(q):d(q,c($)*(b-1)),k=c(ib);b=d(ib,d(D,I(b?b:c(D))));var j=a.images,m=a.footage,n=c(J),p=a.rows>1,s=a.horizontal;if(c(L)){b=a.inversed?m+1-b:b;b+=m}var z=(c(L)?n.y:n.x)-a.indicator,A=Q(0,z,I(h.reel.math.interpolate(c(q),-1,z+2)));A=!a.cw||a.stitched?
A:z-A;h(la(La+".x"),c(va)).css(c(L)?{left:0,top:A}:{left:A,top:n.y-a.indicator});if(p){p=n.y-a.indicator;p=Q(0,p,I(h.reel.math.interpolate(c(B),-1,p+2)));h(la(La+".y"),c(va)).css({top:p})}if(b!=k)if(j.length)f.attr({src:a.path+j[b-1]});else{if(a.stitched)j=[-I(e*c(Xa))+O,0+O];else{e=b%m-1;e=e<0?m-1:e;m=N((b-0.1)/m);m+=a.rows>1?0:c(G)?0:c(ta);b=c(Wa);m=m*((s?n.y:n.x)+b);n=e*((s?n.x:n.y)+b);j=j.length?[0,0]:s?[-n+O,-m+O]:[-m+O,-n+O]}f.css({backgroundPosition:j.join(ra)})}l.call(g)}},l=function(g){jb||
delete this;return g},w,V=0,eb=function(){return w=0},M=function(){clearTimeout(kb);F.unbind(H,t.opening_tick);f.trigger("play");return w=-a.timeout*C(E)},kb,Ta=function(){kb=setTimeout(function(){f.trigger("play")},a.delay*1E3||0)},Ca,Da,bb=function(g){return h(T,{"class":[La,g].join(ra),css:{width:a.indicator,height:a.indicator,overflow:cb,top:c(J).y-a.indicator,left:0,position:ea,backgroundColor:Aa}})},Ka=0,ga={x:0,y:0},db=function(g){return W.push(g)&&W.shift()&&g},ca=function(){return W=[0,0]},
W=ca(),gb=a.graph||h.reel.math[a.loops?"hatch":"envelope"],ha=function(g,b,e,k,j){d(Ha,e);d(hb,j);d(Ia,a.loops?0:-e*k);d(Ja,a.loops?k:k-e*k);return g&&d(fb,{x:g,y:b})||v},Ea=true,da=h.browser.opera?F:h.unique(F.add(lb.top.document));t.setup()});ia=ia||function f(){var o=+new Date,d=C(E);if(d){F.trigger(H);h.reel.cost=(+new Date+h.reel.cost-o)/2;return ia=setTimeout(f,R(4,1E3/d-h.reel.cost))}else return ia=v}();return h(r)};h.reel.math={envelope:function(i,a,r,f,o,d){return a+R(f,Ma(o,-i*d))/r},hatch:function(i,
a,r,f,o,d){i=(i<f?o:0)+i%o;i=a+-i*d/r;return i-N(i)},interpolate:function(i,a,r){return a+i*(r-a)},spread:function(i,a,r){function f(w){for(;!(w>=1&&w<=l);)w+=w<1?+l:-l;return d[w]||(d[w]=!!o.push(w))}var o=[],d=new Array(l),c=r(pa),t=a.orbital?2:a.rows||1;r=t*2;var l=c*t;t=(a.row-1)*c+a.frame;a=l/r;for(c=0;c<r;c++)f(t+I(c*a));for(;a>1;){c=0;r=o.length;for(a/=2;c<r;c++)f(I(o[c]+a))}for(c=0;c<o.length;c++)o[c]=i[o[c]-1];return o}};h.reel.touchy=/iphone|ipod|ipad|android/i.test(navigator.userAgent);
h.reel.lazy=/iphone|ipod|android/i.test(navigator.userAgent);h.reel.instances=h();h.reel.cost=0;h.reel.leader=C;qb("mousewheel disableTextSelect enableTextSelect".split(/ /));var F=h(ja);ja=+h.browser.version.split(".").slice(0,2).join(".");var jb=h.browser.msie,ob=!(jb&&ja<8),Ba="ew-resize",ia,y="jquery-reel",sb=y+"-overlay",La=y+"-indicator",Gb=y+"-preloader",Fb=y+"-monitor",ub=y+"-interface",Hb=ka("CAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7")||ma("blank.gif"),ab=ka("EAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAI3lC8AeBDvgosQxQtne7yvLWGStVBelXBKqDJpNzLKq3xWBlU2nUs4C/O8cCvU0EfZGUwt19FYAAA7")||
ma("jquery.reel.cursor-drag.gif"),Ib=ka("EAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAIslI95EB3MHECxNjBVdE/5b2zcRV1QBabqhwltq41St4hj5konmVioZ6OtEgUAOw==")||ma("jquery.reel.cursor-drag-down.gif"),I=Math.round,N=Math.floor,Ra=Math.ceil,Ma=Math.min,R=Math.max,x=Math.abs,Jb=Math.sqrt,Y=parseInt,$a="area",Za="backup",G="backwards",$="bit",Ya="brake",xa="center",fa="clicked",fb="clicked_location",Ha="clicked_on",hb="clicked_row",aa="cwish",J="dimensions",q="fraction",D="frame",ib="_frame",pa="frames",
Ja="hi",cb="hidden",Ua="image",Va="images",ba="opening_ticks",Ia="lo",Ga="playing",U="reeling",Z="revolution",B="row",ta="rows",Wa="spacing",wa="speed",va="stage",sa="steps",ua="stitched",Xa="stitched_travel",Fa="stopped",E="tempo",K="velocity",L="vertical",tb="wheel_step",u=".reel",Ab="dblclick"+u,Cb="mousedown"+u,Bb="mouseenter"+u,Db="mouseleave"+u,za="mousemove"+u,ya="mouseup"+u,zb="mousewheel"+u,H="tick"+u,yb="touchcancel"+u,xb="touchend"+u,vb="touchstart"+u,wb="touchmove"+u,Qa="",ra=" ",ea="absolute",
T=pb("div"),Pa="height",Aa="#000",P="id",rb="img",O="px",Na="src",Eb="title",Oa="width"}(jQuery,window,document);
