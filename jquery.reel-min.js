/*
 Copyright (c) 2009-2012 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 jQuery Reel
 http://jquery.vostrel.cz/reel
 Version: 1.1.3-devel
 Updated: 2012-01-19

 Requires jQuery 1.5 or higher
*/
jQuery.reel||function(j,Jb,Qa,q){function Kb(f){return l.instances.push(f[0])&&f}function Lb(f){return(l.instances=l.instances.not(la(f.attr(ga))))&&f}function N(f){return l.instances.length?l.instances.first().data(f):null}function Mb(f){return"data:image/gif;base64,R0lGODlh"+f}function O(f){return"<"+f+"/>"}function p(f){return"."+(f||D)}function ua(f){return l.cdn+f}function va(f){return"url("+f+")"}function X(f,a,n){return ma(f,Ra(a,n))}function Nb(f){function a(){j.fn[this]||(j.fn[this]=function(){return this})}
j.each(f,a)}function Sa(f,a){return P(f)*(a?-1:1)}function wa(f){return xa?f.touch||f.originalEvent.touches[0]:f}function Y(f){return f===q||typeof f==lb?f:f+Z}function la(f){return"#"+f}function Ob(f){var a=[];j.each(f,function(n,h){a.push(n.replace(/([A-Z])/g,"-$1").toLowerCase()+":"+Y(h))});return"{"+a.join(";")+";}"}function Pb(){var f=j().jquery.split(".");if(f=+f[0]*10+ +f[1]<15)throw"FATAL: Reel needs jQuery 1.5 or higher";return f}if(!Pb()){var l=j.reel={version:"1.2alpha",def:{area:q,brake:0.23,
clickfree:false,cw:false,delay:-1,directional:false,draggable:true,footage:6,entry:q,frame:1,frames:36,graph:q,hint:"",horizontal:true,image:q,images:[],indicator:0,inversed:false,klass:"",laziness:6,loops:true,monitor:q,opening:0,orbital:0,path:"",preloader:2,rebound:0.5,revolution:q,row:1,rows:0,spacing:0,speed:0,step:q,steps:q,stitched:0,suffix:"-reel",tempo:36,timeout:2,throwable:true,vertical:false,wheelable:true,annotations:q,attr:{},cursor:q,preload:"fidelity",scrollable:true,steppable:true,
snaps:true,sequence:"",velocity:0}};j.fn.reel=function(f){var a=j.extend({},l.def,f);f=function(h){var t=[];h.filter(Ta).each(function(){var e=j(this),c=a.images.length&&a.images||a.sequence||a.image||a.attr.src||e.attr(mb),u=ya(a.attr.width||e.css(Ua)),x=ya(a.attr.height||e.css(nb));!c||c==D||!u||!x||t.push(e)});h.filter(p(v)).each(function(){t.push(j(this).unreel())});return j(t)}(this);var n=[];a.tooltip&&(a.hint=a.tooltip);a.hotspot&&(a.area=a.hotspot);f.each(function(){var h=j(this),t=h.data(),
e=function(b,d){t[b]=d;h.trigger("store",[b,d]);return d},c=function(b){var d=t[b];h.trigger("recall",[b,d]);return d},u={setup:function(){if(!h.hasClass(v)){var b=h.attr(a.attr).attr(mb),d=e(ga,h.attr(ga)||h.attr(ga,v+"-"+ +new Date).attr(ga)),i=h.attr(na),g=j.extend({},h.data()),k=l.re.sequence.exec(e(Qb,a.sequence));k=e($,k?l.build_sequence(k,a,c):a.images);var m=a.stitched,o=a.loops,r={x:ya(h.css(Ua)||a.attr.width),y:ya(h.css(nb)||a.attr.height)},A=e(I,a.frame),Q=e(oa,a.orbital&&a.footage||a.rows<=
1&&k.length||a.frames),ha=m?1:ob(Q/a.footage);d=la(d+a.suffix);var pb=h.attr("class")||D;A=j(O(pa),{id:d.substr(1),"class":pb+B+Rb+B+qb+A});A=h.wrap(A.addClass(a.klass)).attr({"class":v});n.push(Kb(A)[0]);A=A.parent().bind(u.instance);e(Sb,a);e(Va,k.length?D:a.image||b.replace(l.re.image,"$1"+a.suffix+".$2"));e(rb,[]);e(Wa,0);e(sb,a.spacing);e(J,r);e(s,0);e(Xa,a.steps||a.frames);e(za,a.revolution||m/2||r.x*2);e(Ya,ha);e(ia,1/(Q-(o&&!m?0:1)));e(Tb,1/ma(Q,c(Xa)));e(Za,m);e(tb,m-(o?0:r.x));e($a,d);e(K,
e(Aa,a.speed)<0);e(R,a.velocity||0);e(ja,a.vertical);e(aa,0);e(E,(a.row-1)/(a.rows-1));e(ka,Sa(1,!a.cw&&!m));e(ab,{});e(qa,false);e(Ba,e(bb,0));e(Ca,e(Da,0));e(ra,false);e(ub,a.brake);e(cb,!!a.orbital);e(S,a.tempo/(l.lazy?a.laziness:1));e(ba,-1);e(Ea,a.annotations)||A.unbind(p(Ea));e(vb,{src:b,classes:pb,style:i||D,data:g});a.steppable||A.unbind("click.steppable");C(D,{width:r.x,height:r.y,overflow:db,position:"relative"});C(ca+B+p(v),{display:wb});L.bind(u.pool);h.trigger("setup")}},instance:{teardown:function(){var b=
h.data(vb);h.parent().unbind(u.instance);c(na).remove();Lb(h.unbind(T).siblings().unbind(T).remove().end().attr({"class":b.classes,src:b.src,style:b.style}).data(b.data).unwrap());Fa();L.unbind(u.pool);M.unbind(U)},setup:function(){function b(o){return function(r){if(r.button==Ub)return r.preventDefault()||h.trigger("down",[wa(r).clientX,wa(r).clientY])&&o}}var d=c(J),i=c(oa),g=ma(i,c(Xa));g=e(s,1/g*((a.step||a.frame)-1));e(I,V(g*i)+1);h.attr(ga);i=h.parent();g=e(Vb,j(a.area||i));if(xa){C(B+p(v),
{WebkitUserSelect:Ga,WebkitBackgroundSize:c($).length?q:c(Za)&&Y(c(Za))+B+Y(d.y)||Y(d.x*a.footage)+B+Y(d.y*c(Ya)*(a.rows||1)*(a.directional?2:1))});g.bind(Wb,b())}else{var k=a.cursor==xb?Xb:a.cursor||Yb,m=a.cursor==xb?Zb+B+"!important":false;C(D,{cursor:k});C(p(eb),{cursor:$b});C(p(Ha)+ca+p(Ha)+" *",{cursor:m||k},true);g.bind(a.wheelable?ac:D,function(o,r){return o.preventDefault()||!r||h.trigger("wheel",[r])&&false}).bind(a.clickfree?bc:cc,b()).disableTextSelect()}a.hint&&g.attr(dc,a.hint);a.monitor&&
i.append(da=j(O(pa),{"class":yb}))&&C(B+p(yb),{position:Ia,left:0,top:0});C(B+p(zb),{display:Ga});C(B+p(Ab),{position:Ia,left:0,top:d.y-a.preloader,height:a.preloader,overflow:db,backgroundColor:Bb});a.indicator&&i.append(y(Cb));a.rows>1&&a.indicator&&i.append(y(Db))},preload:function(){var b=c(J),d=h.parent(),i=c(Va),g=c($),k=!g.length,m=c(oa),o=l.preload[a.preload]||l.preload[l.def.preload];i=k?[i]:o(g.slice(0),a,c);e(aa,k?0.5:0);g=[];d.addClass(eb).append(F=j(O(pa),{"class":Ab}));for(h.trigger("stop");i.length;){var r=
a.path+i.shift(),A=b.x*(!k?1:a.footage),Q=b.y*(!k?1:m/a.footage)*(!a.directional?1:2),ha=j(O(Ta)).attr({"class":zb}).appendTo(d);setTimeout(function(){if(ha.parent().length){ha.attr({src:r,width:A,height:Q});h.reelTriggerOnce("preloaded",function(){return!!ha.parent().length&&ha[0].complete})}},g.length-i.length);g.push(r)}e(rb,g);e(na,j("<"+na+' type="text/css">'+G.join("\n")+"</"+na+">").prependTo(fb))},preloaded:function(){var b=c($).length||1;if(e(aa,Ra(c(aa)+1,b))===b){h.parent().removeClass(eb);
h.unbind(aa,u.instance.preloaded).trigger("loaded")}},loaded:function(){c($).length>1||h.css({backgroundImage:va(a.path+c(Va))}).attr({src:ec})},opening:function(){if(!a.opening)return h.trigger("openingDone");var b=a.entry||a.speed,d=c(s),i=a.opening;e(s,d-b*a.opening);e(ba,i*N(S))},openingDone:function(){if(a.delay)Ja=setTimeout(function(){h.trigger("play")},a.delay*1E3);else h.trigger("play")},play:function(b,d){d=e(Aa,d||c(Aa));b=e(gb,!!d);e(hb,!b);h.trigger("frameChange");sa()},pause:function(){e(gb,
false);w()},stop:function(){var b=e(hb,true);e(gb,!b)},down:function(b,d,i){function g(m){return function(o){o.preventDefault();h.trigger("pan",[wa(o).clientX,wa(o).clientY,o]);return m}}function k(m){return function(o){o.preventDefault();h.trigger("up");return m}}if(a.draggable){e(qa,c(I));e(R,0);b=!c(ra)||a.rows<=1||!a.orbital||a.scrollable;Ka=La(d,i,c(s),c(za),c(E));w();Fa();W=false;j(Eb,M).addClass(Ha);xa?M.bind(fc,g(!b)).bind(gc+B+hc,k()):M.bind(ic,g()).bind(a.clickfree?jc:kc,k())}},up:function(){if(a.draggable){e(qa,
false);e(ra,false);var b=e(R,!a.throwable?0:P(ta[0]+ta[1])/60);H=b?1:0;b?sa():w();Fa();j(Eb,M).removeClass(Ha);M.unbind(U)}},snap:function(){function b(d,i,g){if(i&&a.snaps)return e(d,1/g*(X(0,g-1,ea(c(d)*g))+0.5))}b(E,a.rows>1,a.rows);b(s,!c(R),c(oa))},pan:function(b,d,i,g){if(a.draggable&&ib){ib=false;w();b=g&&!j(g.currentTarget).is(L)?lc.offset():{left:0,top:0};d-=b.left;i-=b.top;var k={x:d-Ka.x,y:i-Ka.y};if(P(k.x)>0||P(k.y)>0){W=true;Ka={x:d,y:i};b=c(za);g=c(ab);var m=c(ja),o=e(s,Fb(m?i-g.y:d-
g.x,c(Ba),b,c(Ca),c(Da),c(ka),m?i-g.y:d-g.x));e(ra,c(ra)||c(I)!=c(qa));(k=Gb(m?k.y:k.x||0))&&e(K,k<0);if(a.orbital&&c(cb)){e(ja,P(i-g.y)>P(d-g.x));g=La(d,i,o,b,c(E))}if(a.rows>1){k=c(J).y;m=c(bb);var r=-m*k;e(E,l.math.envelope(i-g.y,m,k,r,r+k,-1))}!(o%1)&&!a.loops&&La(d,i,o,b,c(E));h.trigger("fractionChange")}}},wheel:function(b,d){b=ob(mc(P(d))/2);b=Sa(b,d>0);d=0.0833*c(za);La(q,q,c(s),d,c(E));e(s,Fb(b,c(Ba),d,c(Ca),c(Da),c(ka)));b&&e(K,b<0);e(R,0);w();h.trigger("up").trigger("fractionChange");return false},
fractionChange:function(b,d){d=e(s,Ma.fraction(d,a,c));b=e(I,1+ea(d/c(ia)));var i=a.rows>1,g=a.orbital;e(cb,!!g&&(b<=g||b>=a.footage-g+2));if(!a.loops&&a.rebound){!z&&!(d%1)?jb++:(jb=0);jb>=a.rebound*1E3/N(S)&&e(K,!c(K))}h.trigger(i?"rowChange":"frameChange")},rowChange:function(b,d){b=c(s)/c(ia)+1;d=e(E,Ma.row(d,a,c));d=X(0,a.rows-1,ea(d*a.rows));e(I,ea(b+d*a.frames));h.trigger("frameChange")},frameChange:function(b,d){var i=e(s,Ma.fraction(!d?q:c(ia)*(d-1),a,c));d=Ma.frame(d,a,c);var g=a.footage;
if(c(ja)){d=a.inversed?g+1-d:d;d+=g}if(d==c(Wa))x(b);else{var k=a.horizontal,m=c($),o=!m.length;b=c(J);d=e(Wa,e(I,d));if(o){if(a.stitched)b=[-V(i*c(tb))+Z,0+Z];else{i=d%g-1;i=i<0?g-1:i;g=ea((d-0.1)/g);g+=a.rows>1?0:c(K)?0:c(Ya);d=c(sb);g=g*((k?b.y:b.x)+d);b=i*((k?b.x:b.y)+d);b=m.length?[0,0]:k?[-b+Z,-g+Z]:[-g+Z,-b+Z]}h.css({backgroundPosition:b.join(B)})}else h.attr({src:a.path+m[d-1]})}if(a.indicator){k=c($a);m=a.rows>1;b=c(J);d=(c(ja)?b.y:b.x)-a.indicator;g=X(0,d,V(l.math.interpolate(c(s),-1,d+
2)));g=!a.cw||a.stitched?g:d-g;j(p(Na+p(Cb)),k).css(c(ja)?{left:0,top:g}:{left:g,top:b.y-a.indicator});if(m){b=b.y-a.indicator;b=X(0,b,V(l.math.interpolate(c(E),-1,b+2)));j(p(Na+p(Db)),k).css({top:b})}}},stepLeft:function(){w();e(K,false);h.trigger("fractionChange",c(s)-c(ia)*c(ka))},stepRight:function(){w();e(K,true);h.trigger("fractionChange",c(s)+c(ia)*c(ka))},"click.steppable":function(b){if(W)return x(b);h.trigger(b.clientX-h.offset().left>0.5*c(J).x?"stepRight":"stepLeft")},"setup.annotations":function(){c(J);
var b=h.parent();j.each(c(Ea),function(d,i){var g=typeof i.node==lb?j(i.node):i.node||{};g=g.jquery?g:j(O(pa),g);g=g.attr({id:d}).addClass(nc);var k=i.image?j(O(Ta),i.image):j(),m=i.link?j(O(oc),i.link):j();C(la(d),{display:Ga,position:Ia},true);g.bind({"click.annotations":function(o){o.stopPropagation()}});i.image||i.link&&g.append(m);i.link||i.image&&g.append(k);i.link&&i.image&&g.append(m.append(k));g.appendTo(b)});h.trigger("frameChange.annotations")},"frameChange.annotations":function(b,d){d=
d||c(I);this.className=this.className.replace(pc,qb+d);c(R)||j.each(c(Ea),function(i,g){i=j(la(i));var k=g.start||1,m=g.end,o=d-1,r=g.at?g.at[o]=="+":false;o=g.at?o:o-k+1;var A=typeof g.x!=Hb?g.x:g.x[o],Q=typeof g.y!=Hb?g.y:g.y[o];g={display:A!==q&&Q!==q&&(g.at?r:o>=0&&(!m||o<=m-k))?wb:Ga,left:Y(A)||0,top:Y(Q)||0};i.css(g)})},"setup.fu":function(){h.trigger("preload")},"loaded.fu":function(){h.trigger("opening")},"setup.fu up.fu":function(){h.trigger("snap")}},pool:{"tick.reel":function(b){var d=
c(R);if(H){d=d-c(ub)/N(S)*H;d=e(R,d>0.1?d:(H=z=0))}da.text(c(a.monitor));d&&H++;z&&z++;Gb(0);ib=true;if(z&&!d)return x(b);if(c(qa))return x(b,w());if(!(c(ba)>0)){b=c(ka)*Sa(1,c(K));d=(c(hb)?d:P(c(Aa))+d)/N(S);var i=c(s);e(s,i-d*b)}},"tick.reel.preload":function(){var b=c(J),d=parseInt(F.css(Ua)),i=c($).length||1,g=V(1/i*c(aa)*b.x);F.css({width:d+(g-d)/3+1});if(c(aa)===i&&d>b.x-2){F.fadeOut(300,function(){F.remove()});L.unbind(fa+p(Ib),u.pool[fa+p(Ib)])}},"tick.reel.opening":function(){if(a.opening){if(c(ba)<=
0)return;var b=(a.entry||a.speed)/N(S)*(a.cw?-1:1),d=c(s);e(s,d+b);if(e(ba,c(ba)-1)>0)return;h.trigger("openingDone")}L.unbind(fa+p(Oa),u.pool[fa+p(Oa)])},"tick.reel.fu":function(){h.trigger("fractionChange")}}},x=function(b,d){return b.stopImmediatePropagation()||d},z,H=0,sa=function(){return z=0},w=function(){clearTimeout(Ja);L.unbind(fa+p(Oa),u.pool[fa+p(Oa)]);e(ba,0);h.trigger("play");return z=-a.timeout*N(S)},W=false,Ja,da=j(),F=j(),y=function(b){C(B+p(Na)+p(b),{position:Ia,width:a.indicator,
height:a.indicator,overflow:db,backgroundColor:Bb});return j(O(pa),{"class":[Na,b].join(B)})},G=[],C=function(b,d,i){i=i?D:c($a);b=b.replace(/^/,i).replace(ca,ca+i);return G.push(b+Ob(d))&&d},jb=0,Ka={x:0,y:0},Gb=function(b){return ta.push(b)&&ta.shift()&&b},Fa=function(){return ta=[0,0]},ta=Fa(),Fb=a.graph||l.math[a.loops?"hatch":"envelope"],Ma=l.normal,La=function(b,d,i,g,k){e(Ba,i);e(bb,k);e(Ca,a.loops?0:-i*g);e(Da,a.loops?g:g-i*g);return b&&e(ab,{x:b,y:d})||q},ib=true,M;try{M=j.unique(L.add(Jb.top.document))}catch(rc){M=
L}var lc=top===self?j():function(b){j("iframe",M.last()).each(function(){try{if(j(this).contents().find(fb).html()==j(fb).html())return(b=j(this))&&false}catch(d){}});return b}();u.setup()});Pa=Pa||function h(){var t=+new Date,e=N(S);if(e){L.trigger(fa);l.cost=(+new Date+l.cost-t)/2;return Pa=setTimeout(h,ma(4,1E3/e-l.cost))}else return Pa=q}();return j(n)};j.fn.unreel=function(){return this.trigger("teardown")};l.math={envelope:function(f,a,n,h,t,e){return a+ma(h,Ra(t,-f*e))/n},hatch:function(f,
a,n,h,t,e){f=(f<h?t:0)+f%t;f=a+-f*e/n;return f-ea(f)},interpolate:function(f,a,n){return a+f*(n-a)}};l.preload={linear:function(f){return f},fidelity:function(f,a){function n(x,z,H){function sa(G){for(;!(G>=1&&G<=da);)G+=G<1?+da:-da;return u[H+G]||(u[H+G]=!!w.push(G))}if(!x.length)return[];var w=[],W=4*z,Ja=a.frame,da=x.length;z=true;for(var F=da/W,y=0;y<W;y++)sa(Ja+V(y*F));for(;F>1;){y=0;W=w.length;F/=2;for(z=!z;y<W;y++)sa(w[y]+(z?1:-1)*V(F))}for(y=0;y<w.length;y++)w[y]=x[w[y]-1];return w}var h=
a.orbital?2:a.rows||1,t=a.orbital?a.footage:a.frames,e=(a.row-1)*t,c=[].concat(f),u=new Array(f.length);f=h<2?[]:c.slice(e,e+t);return n(f,1,e).concat(n(c,h,0))}};l.normal={fraction:function(f,a,n){f=f!=q?f:n(s);return a.loops?f-ea(f):X(0,1,f)},row:function(f,a,n){return X(0,1,f!=q?(f-1)/(a.rows-1):n(E))},frame:function(f,a,n){f=f!=q?V(f):n(I);var h=a.orbital?2:a.rows||1;n=n(oa)*h;f=a.loops?f%n||n:X(1,n,f);return f<0?f+n:f}};l.re={image:/^(.*)\.(jpg|jpeg|png|gif)$/,touchy_agent:/iphone|ipod|ipad|android/i,
lazy_agent:/iphone|ipod|android/i,sequence:/(^[^#|]*([#]+)[^#|]*)($|[|]([0-9]+)\.\.([0-9]+))($|[|]([0-9]+)$)/};l.cdn="http://code.vostrel.cz/";l.build_sequence=function(f,a){function n(x,z,H){for(;x.length<z;)x=H+x;return x}if(f.length<=1)return a.images;var h=[],t=f[1],e=f[2],c=+f[4]||1,u=a.orbital?2:a.rows||1;a=a.orbital?a.footage:a.frames;u=+(f[5]||u*a);f=+f[7]||1;for(a=0;a<u;){h.push(t.replace(e,n(c+a+D,e.length,"0")));a+=f}return h};l.touchy=l.re.touchy_agent.test(navigator.userAgent);l.lazy=
l.re.lazy_agent.test(navigator.userAgent);l.instances=j();l.leader=N;l.cost=0;Nb("mousewheel disableTextSelect enableTextSelect".split(/ /));var L=j(Qa);Qa=+j.browser.version.split(p()).slice(0,2).join(p());var qc=j.browser.msie,xa=l.touchy,Pa,v="reel",Rb=v+"-overlay",Na=v+"-indicator",Ab=v+"-preloader",zb=v+"-cached",yb=v+"-monitor",nc=v+"-annotation",Ha=v+"-panning",eb=v+"-loading",qb="frame-",pc=/frame-\d+/,V=Math.round,ea=Math.floor,ob=Math.ceil,Ra=Math.min,ma=Math.max,P=Math.abs,mc=Math.sqrt,
ya=parseInt,Ea="annotations",Vb="area",vb="backup",K="backwards",ia="bit",ub="brake",rb="cached",cb="center",qa="clicked",ab="clicked_location",Ba="clicked_on",bb="clicked_row",ka="cwish",J="dimensions",s="fraction",I="frame",Wa="_frame",oa="frames",fb="head",Da="hi",db="hidden",Va="image",$="images",ba="opening_ticks",Ca="lo",Sb="options",gb="playing",aa="preloaded",ra="reeling",za="revolution",E="row",Ya="rows",Qb="sequence",sb="spacing",Aa="speed",$a="stage",Xa="steps",Za="stitched",tb="stitched_travel",
hb="stopped",na="style",S="tempo",R="velocity",ja="vertical",Tb="wheel_step",T=p(v),U=".pan"+T,cc="mousedown"+T,bc="mouseenter"+T,jc="mouseleave"+U,ic="mousemove"+U,kc="mouseup"+U,ac="mousewheel"+T,fa="tick"+T,hc="touchcancel"+U,gc="touchend"+U,Wb="touchstart"+T,fc="touchmove"+U,D="",B=" ",ca=",",Ia="absolute",oc="a",wb="block",pa="div",xb="hand",nb="height",Bb=la("000"),Eb="html",ga="id",Ta="img",kb="jquery."+v,Ga="none",Hb="object",Oa="opening",Ib="preload",Z="px",mb="src",lb="string",dc="title",
Ua="width",Cb="x",Db="y",ec=Mb("CAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7")||ua("blank.gif"),$b="wait",Yb=va(ua(kb+p("cur")))+ca+"move",Xb=va(ua(kb+"-drag"+p("cur")))+ca+"move",Zb=va(ua(kb+"-drag-down"+p("cur")))+ca+"move",Ub=xa?q:qc&&Qa<=8?1:0;j.fn.reelTriggerOnce=function(f,a){function n(h){a()?h.trigger(f):setTimeout(function(){n(h)},100);return h}return n(j(this))}}}(jQuery,window,document);
