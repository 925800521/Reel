/*
 Copyright (c) 2009-2010 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 http://jquery.vostrel.cz/reel
 Version: "Dancer" (will be 1.1 on release)
 Updated: 2010-06-07

 Requires jQuery 1.4.x
*/
(function(l){function x(m){return"."+m}function V(m){return"url("+m+")"}function J(m,r){return+r.toFixed(m)}function W(m,r,a){return y(m,X(r,a))}function sa(m,r){return m*r>0?r:-r}function ta(m){function r(){l.fn[this]||(l.fn[this]=function(){return this})}l.each(m,r)}var ua={footage:6,frame:1,frames:36,hint:"",horizontal:true,hotspot:undefined,indicator:0,klass:"",loops:true,reversed:false,saves:false,sensitivity:20,spacing:0,stitched:undefined,suffix:"-reel",tooltip:"",delay:-1,friction:0.9,inertial:true,
monitor:undefined,rebound:0.5,revolution:undefined,speed:0,step:undefined,steps:undefined,tempo:25,timeout:2};l.fn.reel=function(m){var r=function(c){var e=[];c.filter(Y).each(function(){var h=l(this),s=h.attr(Z),u=D(h.css($)),w=D(h.css(aa));!s||s==E||!u||!w||e.push(h)});c.filter(ba+x(K)).each(function(){e.push(l(this))});return l(e)}(this),a=l.extend({},ua,m),ca=[];F=F||function(){return setInterval(function(){z.trigger(L)},1E3/a.tempo)}();r.each(function(){var c=l(this),e=function(d,b){c.data(d,
b);c.trigger("store");return b},h=function(d){c.trigger("recall");return c.data(d)},s={setup:function(){if(!c.hasClass(K)){var d=c.attr(Z),b=c.attr(M),f=c.attr(da),i=c.attr("style");d=d.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2");var g={x:D(c.css($)),y:D(c.css(aa))},n=l(N).attr(da,f).addClass(K).addClass(a.klass),j=ea||!a.saves?{display:"none"}:{opacity:0};ca.push((c=c.attr(M,E).wrap(n).css(j).parent().attr(M,b).bind(s).css({display:"block",width:g.x+p,height:g.y+p,backgroundImage:V(d)}))[0]);
e(A,a.frames);e(fa,a.spacing);e(G,g);e(o,0);e(H,a.steps||a.frames);e("resolution",y(a.steps,a.frames));e(ga,a.speed<0);e(ha,{id:b,"class":f||E,style:i||E});F&&z.bind(L,s.tick);c.trigger("start")}},teardown:function(){c=c.unbind(s).find(x(O)+", "+x(P)).remove().end().find(Y).attr(c.data(ha)).unwrap().bind("setup",function(){c.unbind("setup");s.setup()});F&&z.unbind(L,s.tick)},start:function(){c.css({position:"relative"});var d=a.hotspot||c,b=h(G),f=h(A),i=y(f,h(H));i=e(o,1/i*((a.step||a.frame)-1));
e(B,i*f+1);ea?d.css({WebkitUserSelect:"none"}).each(function(){function g(q,v){l.each(v,function(va){q.addEventListener(va,this,false)})}function n(q){return q.cancelable&&q.preventDefault()||false}function j(q){var v=q.touches[0];c.trigger("down",[v.clientX,v.clientY,true]);return n(q)}function k(q){var v=q.touches[0];c.trigger("drag",[v.clientX,v.clientY,true]);return n(q)}function ia(q){c.trigger("up",[true]);return n(q)}g(this,{touchstart:j,touchmove:k,touchend:ia,touchcancel:ia})}):d.css({cursor:"url("+
ja+"), "+Q}).mouseenter(function(){c.trigger("enter")}).mouseleave(function(){c.trigger("leave")}).mousemove(function(g){c.trigger("over",[g.pageX,g.pageY])}).mousewheel(function(g,n){c.trigger("wheel",[n]);return false}).dblclick(function(){c.trigger("animate")}).mousedown(function(g){c.trigger("down",[g.clientX,g.clientY])}).disableTextSelect();(a.hint||a.tooltip)&&d.attr(wa,a.hint||a.tooltip);a.monitor&&c.append(l(N,{className:P,css:{position:ka,left:0,top:0}}));a.indicator&&c.append(l(N).addClass(O).css({width:a.indicator+
p,height:a.indicator+p,top:b.y-a.indicator+p,position:ka,backgroundColor:xa}));c.trigger("frameChange")},animate:function(){},tick:function(){var d=a.speed,b=a.friction/a.tempo,f=h(C),i=f<0;f-=f*b;f=la=f==la?0:f;f=(i?X:y)(0,J(3,f))||0;f=e(C,f);step=(d+f)/a.tempo;l(x(P),c).text(h(a.monitor));ma(0);u&&u++;if(!(u&&!f)){if(h(R))return w();e(o,h(o)+step);c.trigger("fractionChange")}},down:function(d,b,f,i){w();d=a.hotspot||c;e(R,true);e(na,b);e(C,0);e(S,e(oa,h(o)));!i&&z.mousemove(function(g){c.trigger("drag",
[g.clientX,g.clientY])}).mouseup(function(){c.trigger("up")})&&d.css({cursor:V(ya)+", "+Q})},up:function(d,b){d=a.hotspot||c;e(R,false);var f=t[1]+t[2]!=0,i=(t[0]+t[1]+t[2])/t.length/(b?15:20),g=(a.reversed?-1:1)*(a.stitched?-1:1);e(C,a.inertial&&f?i*g:0);pa();u=0;!b&&z.unbind("mousemove mouseup")&&d.css({cursor:"url("+ja+"), "+Q})},drag:function(d,b){w();d=h(na);var f=h(oa),i=a.stitched,g=h(G);e(o,f+(a.reversed?-1:1)*(i?-1:1)/(a.revolution||i/2||g.x)*(b-d));ma(b-qa);qa=b;c.trigger("fractionChange")},
wheel:function(d,b){w();e(C,0);d=h(o);var f=1/y(h(A),h(H)),i=T(za(Aa(b))/2);i=b<0?-i:i;e(o,d+i*f);c.trigger("fractionChange");return false},fractionChange:function(d,b){b=!b?h(o):e(o,b);d=h(S);d=a.speed=sa(b-d,a.speed);b=a.loops?b-(b<0?T:ra)(b):W(0,1,b);a.speed=!a.loops&&a.rebound&&U==a.rebound*1E3/a.tempo?-d:d;b=!a.loops?b:b>=0?b:1+b;b=e(S,e(o,J(6,b)));e(B,b*(h(A)-1)+1);!u&&(U=b==0||b==1?U+1:0);c.trigger("frameChange")},frameChange:function(d,b){var f=h(A);d=!b?h(o):e(o,J(6,(b-1)/(f-1)));b=!b?h(B):
e(B,b);b=e(B,I(b));var i=h(G);h(H);var g=h(fa),n=h(ga);if(a.stitched){g=a.loops?a.stitched:a.stitched-i.x;j=I(d*g);k=0;n=[-j+p,k+p]}else{j=ra(b/a.footage);k=b-j*a.footage-1;j=k==-1?j+k:j;k=k==-1?a.footage+k:k;b=a.horizontal?i.y:i.x;var j=-j*(g+b),k=-k*(g+(a.horizontal?i.x:i.y));f=T(f/a.footage);g=f*b+(f-1)*g;j=n&&a.horizontal?j-g:j;k=n&&!a.horizontal?k-g:k;n=a.horizontal?[k+p,j+p]:[j+p,k+p]}g=i.x-a.indicator;d=W(0,g,I(d*(g+2))-1);c.css({backgroundPosition:n.join(" ")}).find(x(O)).css({left:d+p})}},
u=a.delay>0?-I(a.delay*a.tempo):0,w=function(){return u=-a.timeout*a.tempo},U=0,qa=0,la=0,ma=function(d){t.push(d)&&t.shift()},pa=function(){return t=[0,0,0]},t=pa();c.ready(s.setup)});return l(ca)};ta("mousewheel disableTextSelect".split(/ /));var K="jquery-reel",O="indicator",P="monitor",L="tick.reel",z=l(document),ea=/iphone|ipod|ipad|android/i.test(navigator.userAgent),Q="w-resize",F,ja="data:image/gif;base64,R0lGODlhEAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAI3lC8AeBDvgosQxQtne7yvLWGStVBelXBKqDJpNzLKq3xWBlU2nUs4C/O8cCvU0EfZGUwt19FYAAA7",
ya="data:image/gif;base64,R0lGODlhEAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAIslI95EB3MHECxNjBVdE/5b2zcRV1QBabqhwltq41St4hj5konmVioZ6OtEgUAOw==",I=Math.round,ra=Math.floor,T=Math.ceil,X=Math.min,y=Math.max,Aa=Math.abs,za=Math.sqrt,D=parseInt,ha="backup",R="clicked",na="clicked_location",oa="clicked_on",G="dimensions",o="fraction",B="frame",A="frames",S="last_fraction",ga="reversed",fa="spacing",H="steps",C="velocity",E="",ka="absolute",da="class",ba="div",N="<"+ba+"/>",aa="height",xa="#000",
M="id",Y="img",p="px",Z="src",wa="title",$="width"})(jQuery);
