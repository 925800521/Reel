/*! Copyright (c) 2009-2010 Petr Vostrel (http://www.pisi.cz/)
 * Dual licensed under the MIT (MIT-LICENSE.txt)
 * and GPL (GPL-LICENSE.txt) licenses.
 *
 * http://www.vostrel.cz/jquery/reel/
 * Version: 1.0.4 "Touchy"
 * Updated: 2010-04-14
 *
 * Requires jQuery 1.4.x or higher
 */
(function(l){function r(q){return parseInt(q)}function t(q){l.each(q,function(){l.fn[this]||(l.fn[this]=function(){return this})})}l.fn.reel=function(q){var u={footage:6,frame:1,frames:36,horizontal:true,hotspot:undefined,hint:"",indicator:0,klass:"",loops:true,reversed:false,saves:false,sensitivity:20,spacing:0,stitched:undefined,suffix:"-reel",tooltip:""},v=function(a){var b=[];a.filter("img").each(function(){var n=l(this),g=n.attr("src"),j=r(n.css("width")),o=r(n.css("height"));!g||g==""||!j||
!o||b.push(n)});a.filter("div.jquery-reel").each(function(){b.push(l(this))});return l(b)}(this),s=/iphone|ipod|ipad|android/i.test(navigator.userAgent);t("mousewheel disableTextSelect".split(/ /));return v.each(function(){var a=l(this),b=l.extend(u,q),n=l(document),g=function(e,c){a.data(e,c);a.trigger("store");return c},j=function(e){e=a.data(e);a.trigger("recall");return e},o={setup:function(){if(!a.hasClass("jquery-reel")){var e=a.attr("src"),c=a.attr("id"),d=a.attr("class"),i=a.attr("style");
e=e.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+b.suffix+".$2");var k={x:r(a.css("width")),y:r(a.css("height"))},p=l("<div>").attr("class",d).addClass("jquery-reel").addClass(b.klass),h=s||!b.saves?{display:"none"}:{opacity:0};a=a.attr("id","").wrap(p).css(h).parent().attr("id",c).bind(o).css({display:"block",width:k.x+"px",height:k.y+"px",backgroundImage:"url("+e+")"});g("frames",b.frames);g("spacing",b.spacing);g("offset",a.offset());g("dimensions",k);g("backup",{id:c,"class":d||"",style:i||""});
a.trigger("start")}},teardown:function(){a=a.unbind(o).find("img").attr(a.data("backup")).unwrap().bind("setup",function(){a.unbind("setup");o.setup()})},start:function(){var e=b.hotspot?b.hotspot:a,c=j("dimensions");e.css({cursor:"ew-resize"}).mouseenter(function(){a.trigger("enter")}).mouseleave(function(){a.trigger("leave")}).mousemove(function(d){a.trigger("over",[d.clientX,d.clientY])}).mousewheel(function(d,i){a.trigger("wheel",[i]);return false}).dblclick(function(){a.trigger("animate")}).mousedown(function(d){a.trigger("down",
[d.clientX,d.clientY])}).disableTextSelect().each(function(){function d(f,m){l.each(m,function(w){f.addEventListener(w,this,false)})}function i(f){f.cancelable&&f.preventDefault();return false}function k(f){var m=f.touches[0];g("clicked",true);g("clicked_location",m.clientX);g("last_frame",g("clicked_on_frame",j("frame")));return i(f)}function p(f){var m=f.touches[0];a.trigger("drag",[m.clientX,m.clientY]);return i(f)}function h(f){g("clicked",false);return i(f)}s&&d(this,{touchstart:k,touchmove:p,
touchend:h,touchcancel:h,click:i,gesturestart:i,gesturechange:i,gestureend:i})});(b.hint||b.tooltip)&&e.attr("title",b.hint||b.tooltip);b.indicator&&a.append(l("<div/>").addClass("indicator").css({width:b.indicator+"px",height:b.indicator+"px",top:c.y-b.indicator+"px",position:"relative",backgroundColor:"#000"}));a.trigger("frameChange",b.frame)},animate:function(){},down:function(e,c){g("clicked",true);g("clicked_location",c);g("last_frame",g("clicked_on_frame",j("frame")));n.mousemove(function(d){a.trigger("drag",
[d.clientX,d.clientY])}).mouseup(function(){a.trigger("up")})},up:function(){g("clicked",false);n.unbind("mousemove mouseup")},drag:function(e,c){var d=j("clicked_location");e=j("clicked_on_frame");j("frames");c=Math.round((d-c)/(s?b.sensitivity*0.6:b.sensitivity));g("frame",e-(b.reversed?-1:1)*c);a.trigger("frameChange")},wheel:function(e,c){e=j("frame");j("frames");var d=Math.ceil(Math.sqrt(Math.abs(c)));d=c<0?-d:d;g("frame",e-(b.reversed?-1:1)*d);a.trigger("frameChange");return false},frameChange:function(e,
c){c=!c?j("frame"):g("frame",c);var d=j("last_frame");e=j("frames");var i=j("dimensions"),k=j("spacing");c=!b.loops&&c>e?e:c;c=!b.loops&&c<1?1:c;c-=Math.floor(c/e)*e;c=g("last_frame",g("frame",c<1?e:c));d=c-d;d=Math.abs(d)>10?0-d:d;d=g("reversed",d!=0?d>0:j("reversed"));if(b.stitched){h=c*(b.stitched/e);f=0;k=h+"px 0"+f+"px"}else{h=Math.floor(c/b.footage);f=c-h*b.footage-1;h=f==-1?h+f:h;f=f==-1?b.footage+f:f;var p=b.horizontal?i.y:i.x,h=-h*(k+p),f=-f*(k+(b.horizontal?i.x:i.y)),m=Math.ceil(e/b.footage);
k=m*p+(m-1)*k;h=d&&b.horizontal?h-k:h;f=d&&!b.horizontal?f-k:f;k=b.horizontal?f+"px "+h+"px":h+"px "+f+"px"}c=(i.x-b.indicator)/(e-1)*(c-1)+"px";a.css({backgroundPosition:k}).find(".indicator").css({left:c})}};a.ready(o.setup)})}})(jQuery);
