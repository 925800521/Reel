/*
 Copyright (c) 2009-2012 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 jQuery Reel
 http://jquery.vostrel.cz/reel
 Version: 1.1.3-devel
 Updated: 2012-01-18

 Requires jQuery 1.5 or higher
*/
jQuery.reel||function(k,Ib,Pa,q){function Jb(f){return m.instances.push(f[0])&&f}function Kb(f){return(m.instances=m.instances.not(ka(f.attr(ga))))&&f}function O(f){return m.instances.length?m.instances.first().data(f):null}function Lb(f){return"data:image/gif;base64,R0lGODlh"+f}function P(f){return"<"+f+"/>"}function p(f){return"."+(f||D)}function ta(f){return m.cdn+f}function ua(f){return"url("+f+")"}function X(f,a,o){return la(f,Qa(a,o))}function Mb(f){function a(){k.fn[this]||(k.fn[this]=function(){return this})}
k.each(f,a)}function Ra(f,a){return Q(f)*(a?-1:1)}function va(f){return wa?f.touch||f.originalEvent.touches[0]:f}function Y(f){return f===q||typeof f==lb?f:f+Z}function ka(f){return"#"+f}function Nb(f){var a=[];k.each(f,function(o,g){a.push(o.replace(/([A-Z])/g,"-$1").toLowerCase()+":"+Y(g))});return"{"+a.join(";")+";}"}function Ob(){var f=k().jquery.split(".");if(f=+f[0]*10+ +f[1]<15)throw"FATAL: Reel needs jQuery 1.5 or higher";return f}if(!Ob()){var m=k.reel={version:"1.2alpha",def:{area:q,brake:0.23,
clickfree:false,cw:false,delay:-1,directional:false,draggable:true,footage:6,entry:q,frame:1,frames:36,graph:q,hint:"",horizontal:true,image:q,images:[],indicator:0,inversed:false,klass:"",laziness:6,loops:true,monitor:q,opening:0,orbital:0,path:"",preloader:2,rebound:0.5,revolution:q,row:1,rows:0,spacing:0,speed:0,step:q,steps:q,stitched:0,suffix:"-reel",tempo:36,timeout:2,throwable:true,vertical:false,wheelable:true,annotations:q,attr:{},cursor:q,preload:"fidelity",scrollable:true,steppable:true,
snaps:true,sequence:"",velocity:0}};k.fn.reel=function(f){var a=k.extend({},m.def,f);f=function(g){var t=[];g.filter(Sa).each(function(){var e=k(this),d=a.images.length&&a.images||a.image||a.attr.src||e.attr(mb),u=xa(a.attr.width||e.css(Ta)),x=xa(a.attr.height||e.css(nb));!d||d==D||!u||!x||t.push(e)});g.filter(p(v)).each(function(){t.push(k(this).unreel())});return k(t)}(this);var o=[];a.tooltip&&(a.hint=a.tooltip);a.hotspot&&(a.area=a.hotspot);f.each(function(){var g=k(this),t=g.data(),e=function(b,
c){t[b]=c;g.trigger("store",[b,c]);return c},d=function(b){var c=t[b];g.trigger("recall",[b,c]);return c},u={setup:function(){if(!g.hasClass(v)){var b=g.attr(a.attr).attr(mb),c=e(ga,g.attr(ga)||g.attr(ga,v+"-"+ +new Date).attr(ga)),h=g.attr(ma),i=k.extend({},g.data()),j=m.re.sequence.exec(e(Pb,a.sequence));j=e($,j?m.build_sequence(j,a,d):a.images);var n=a.stitched,l=a.loops,r={x:xa(g.css(Ta)||a.attr.width),y:xa(g.css(nb)||a.attr.height)},A=e(J,a.frame),E=e(na,a.orbital&&a.footage||a.rows<=1&&j.length||
a.frames),Qb=n?1:ob(E/a.footage);c=ka(c+a.suffix);var pb=g.attr("class")||D;A=k(P(oa),{id:c.substr(1),"class":pb+B+Rb+B+qb+A});A=g.wrap(A.addClass(a.klass)).attr({"class":v});o.push(Jb(A)[0]);A=A.parent().bind(u.instance);e(Sb,a);e(Ua,j.length?D:a.image||b.replace(m.re.image,"$1"+a.suffix+".$2"));e(Va,[]);e(Wa,0);e(rb,a.spacing);e(K,r);e(s,0);e(Xa,a.steps||a.frames);e(ya,a.revolution||n/2||r.x*2);e(Ya,Qb);e(ha,1/(E-(l&&!n?0:1)));e(Tb,1/la(E,d(Xa)));e(Za,n);e(sb,n-(l?0:r.x));e($a,c);e(L,e(za,a.speed)<
0);e(aa,a.velocity||0);e(ia,a.vertical);e(ba,0);e(F,(a.row-1)/(a.rows-1));e(ja,Ra(1,!a.cw&&!n));e(ab,{});e(pa,false);e(Aa,e(bb,0));e(Ba,e(Ca,0));e(qa,false);e(tb,a.brake);e(cb,!!a.orbital);e(R,a.tempo/(m.lazy?a.laziness:1));e(ca,-1);e(Da,a.annotations)||A.unbind(p(Da));e(ub,{src:b,classes:pb,style:h||D,data:i});a.steppable||A.unbind("click.steppable");C(D,{width:r.x,height:r.y,overflow:db,position:"relative"});C(da+B+p(v),{display:vb});M.bind(u.pool);g.trigger("setup")}},instance:{teardown:function(){var b=
g.data(ub);g.parent().unbind(u.instance);d(ma).remove();Kb(g.unbind(S).siblings().unbind(S).remove().end().attr({"class":b.classes,src:b.src,style:b.style}).data(b.data).unwrap());Ea();M.unbind(u.pool);N.unbind(T)},setup:function(){function b(l){return function(r){if(r.button==Ub)return r.preventDefault()||g.trigger("down",[va(r).clientX,va(r).clientY])&&l}}var c=d(K),h=d(na),i=la(h,d(Xa));i=e(s,1/i*((a.step||a.frame)-1));e(J,U(i*h)+1);g.attr(ga);h=g.parent();i=e(Vb,k(a.area||h));if(wa){C(B+p(v),
{WebkitUserSelect:Fa,WebkitBackgroundSize:a.images.length?"auto":d(Za)&&Y(d(Za))+B+Y(c.y)||Y(c.x*a.footage)+B+Y(c.y*d(Ya)*(a.rows||1)*(a.directional?2:1))});i.bind(Wb,b())}else{var j=a.cursor==wb?Xb:a.cursor||Yb,n=a.cursor==wb?Zb+B+"!important":false;C(D,{cursor:j});C(p(eb),{cursor:$b});C(p(Ga)+da+p(Ga)+" *",{cursor:n||j},true);i.bind(a.wheelable?ac:D,function(l,r){return l.preventDefault()||!r||g.trigger("wheel",[r])&&false}).bind(a.clickfree?bc:cc,b()).disableTextSelect()}a.hint&&i.attr(dc,a.hint);
a.monitor&&h.append(V=k(P(oa),{"class":xb}))||(V=k());C(B+p(xb),{position:Ha,left:0,top:0});C(B+p(yb),{display:Fa});C(B+p(zb),{position:Ha,left:0,top:c.y-a.preloader,height:a.preloader,overflow:db,backgroundColor:Ab});a.indicator&&h.append(y(Bb));a.rows>1&&a.indicator&&h.append(y(Cb))},preload:function(){var b=d(K),c=g.parent(),h=d(Ua),i=d($),j=!i.length,n=d(na),l=m.preload[a.preload]||m.preload[m.def.preload];h=j?[h]:l(i.slice(),a,d);e(ba,j?0.5:0);i=[];c.addClass(eb).append(G=k(P(oa),{"class":zb}));
for(g.trigger("stop");h.length;){var r=a.path+h.shift();l=b.x*(!j?1:a.footage);var A=b.y*(!j?1:n/a.footage)*(!a.directional?1:2),E=k(P(Sa)).attr({"class":yb,width:l,height:A}).appendTo(c);setTimeout(function(){E.attr({src:r});g.reelTriggerOnce("preloaded",function(){return!!E.parent().length&&E[0].complete})},i.length-h.length);i.push(r)}e(Va,i);e(ma,k("<"+ma+' type="text/css">'+H.join("\n")+"</"+ma+">").prependTo(fb))},preloaded:function(){var b=d($).length||1;if(e(ba,Qa(d(ba)+1,b))===b){g.parent().removeClass(eb);
g.unbind(ba,u.instance.preloaded).trigger("loaded")}},loaded:function(){d($).length>1||g.css({backgroundImage:ua(a.path+d(Ua))}).attr({src:ec});g.trigger("opening")},opening:function(){if(!a.opening)return g.trigger("openingDone");var b=a.entry||a.speed,c=d(s),h=a.opening;e(s,c-b*a.opening);e(ca,h*O(R))},openingDone:function(){if(a.delay)Ia=setTimeout(function(){g.trigger("play")},a.delay*1E3);else g.trigger("play")},play:function(b,c){c=e(za,c||d(za));b=e(gb,!!c);e(hb,!b);g.trigger("frameChange");
ra()},pause:function(){e(gb,false);w()},stop:function(){var b=e(hb,true);e(gb,!b)},down:function(b,c,h){function i(n){return function(l){l.preventDefault();g.trigger("pan",[va(l).clientX,va(l).clientY,l]);return n}}function j(n){return function(l){l.preventDefault();g.trigger("up");return n}}if(a.draggable){e(pa,d(J));e(aa,0);b=!d(qa)||a.rows<=1||!a.orbital||a.scrollable;Ja=Ka(c,h,d(s),d(ya),d(F));w();Ea();W=false;k(Db,N).addClass(Ga);wa?N.bind(fc,i(!b)).bind(gc+B+hc,j()):N.bind(ic,i()).bind(a.clickfree?
jc:kc,j())}},up:function(){function b(h,i,j){if(i&&a.snaps)return e(h,1/j*(X(0,j-1,ea(d(h)*j))+0.5))}if(a.draggable){e(pa,false);e(qa,false);var c=e(aa,!a.throwable?0:Q(sa[0]+sa[1])/60);I=c?1:0;b(F,a.rows>1,a.rows);b(s,!c,d(na));c?ra():w();Ea();k(Db,N).removeClass(Ga);N.unbind(T)}},pan:function(b,c,h,i){if(a.draggable&&ib){ib=false;w();b=i&&!k(i.currentTarget).is(M)?lc.offset():{left:0,top:0};h-=b.top;c-=b.left;var j={x:c-Ja.x,y:h-Ja.y};if(Q(j.x)>0||Q(j.y)>0){W=true;Ja={x:c,y:h};b=d(ya);i=d(ab);var n=
d(ia),l=e(s,Eb(n?h-i.y:c-i.x,d(Aa),b,d(Ba),d(Ca),d(ja),n?h-i.y:c-i.x));e(qa,d(qa)||d(J)!=d(pa));(j=Fb(n?j.y:j.x||0))&&e(L,j<0);if(a.orbital&&d(cb)){e(ia,Q(h-i.y)>Q(c-i.x));i=Ka(c,h,l,b,d(F))}if(a.rows>1){j=d(K).y;n=d(bb);var r=-n*j;e(F,m.math.envelope(h-i.y,n,j,r,r+j,-1))}!(l%1)&&!a.loops&&Ka(c,h,l,b,d(F));g.trigger("fractionChange")}}},wheel:function(b,c){b=ob(mc(Q(c))/2);b=Ra(b,c>0);c=0.0833*d(ya);Ka(q,q,d(s),c,d(F));e(s,Eb(b,d(Aa),c,d(Ba),d(Ca),d(ja)));b&&e(L,b<0);e(aa,0);w();g.trigger("up").trigger("fractionChange");
return false},fractionChange:function(b,c){c=e(s,La.fraction(c,a,d));b=e(J,1+ea(c/d(ha)));var h=a.rows>1,i=a.orbital;e(cb,!!i&&(b<=i||b>=a.footage-i+2));if(!a.loops&&a.rebound){!z&&!(c%1)?jb++:(jb=0);jb>=a.rebound*1E3/O(R)&&e(L,!d(L))}g.trigger(h?"rowChange":"frameChange")},rowChange:function(b,c){b=d(s)/d(ha)+1;c=e(F,La.row(c,a,d));c=X(0,a.rows-1,ea(c*a.rows));e(J,ea(b+c*a.frames));g.trigger("frameChange")},frameChange:function(b,c){var h=e(s,La.fraction(!c?q:d(ha)*(c-1),a,d));c=La.frame(c,a,d);
var i=d(Va).length==1,j=a.footage;if(d(ia)){c=a.inversed?j+1-c:c;c+=j}if(c==d(Wa))x(b);else{var n=a.horizontal,l=d($);b=d(K);c=e(Wa,e(J,c));if(i){if(a.stitched)b=[-U(h*d(sb))+Z,0+Z];else{h=c%j-1;h=h<0?j-1:h;j=ea((c-0.1)/j);j+=a.rows>1?0:d(L)?0:d(Ya);c=d(rb);j=j*((n?b.y:b.x)+c);b=h*((n?b.x:b.y)+c);b=l.length?[0,0]:n?[-b+Z,-j+Z]:[-j+Z,-b+Z]}g.css({backgroundPosition:b.join(B)})}else g.attr({src:a.path+l[c-1]})}if(a.indicator){n=d($a);l=a.rows>1;b=d(K);c=(d(ia)?b.y:b.x)-a.indicator;j=X(0,c,U(m.math.interpolate(d(s),
-1,c+2)));j=!a.cw||a.stitched?j:c-j;k(p(Ma+p(Bb)),n).css(d(ia)?{left:0,top:j}:{left:j,top:b.y-a.indicator});if(l){b=b.y-a.indicator;b=X(0,b,U(m.math.interpolate(d(F),-1,b+2)));k(p(Ma+p(Cb)),n).css({top:b})}}},stepLeft:function(){w();e(L,false);g.trigger("fractionChange",d(s)-d(ha)*d(ja))},stepRight:function(){w();e(L,true);g.trigger("fractionChange",d(s)+d(ha)*d(ja))},"click.steppable":function(b){if(W)return x(b);g.trigger(b.clientX-g.offset().left>0.5*d(K).x?"stepRight":"stepLeft")},"setup.annotations":function(){d(K);
var b=g.parent();k.each(d(Da),function(c,h){var i=typeof h.node==lb?k(h.node):h.node||{};i=i.jquery?i:k(P(oa),i);i=i.attr({id:c}).addClass(nc);var j=h.image?k(P(Sa),h.image):k(),n=h.link?k(P(oc),h.link):k();C(ka(c),{display:Fa,position:Ha},true);i.bind({"click.annotations":function(l){l.stopPropagation()}});h.image||h.link&&i.append(n);h.link||h.image&&i.append(j);h.link&&h.image&&i.append(n.append(j));i.appendTo(b)});g.trigger("frameChange.annotations")},"frameChange.annotations":function(b,c){c=
c||d(J);this.className=this.className.replace(pc,qb+c);d(aa)||k.each(d(Da),function(h,i){h=k(ka(h));var j=i.start||1,n=i.end,l=c-1,r=i.at?i.at[l]=="+":false;l=i.at?l:l-j+1;var A=typeof i.x!=Gb?i.x:i.x[l],E=typeof i.y!=Gb?i.y:i.y[l];i={display:A!==q&&E!==q&&(i.at?r:l>=0&&(!n||l<=n-j))?vb:Fa,left:Y(A)||0,top:Y(E)||0};h.css(i)})},"setup.fu":function(){g.trigger("up").trigger("preload")},"loaded.fu":function(){g.trigger("opening")}},pool:{"tick.reel":function(b){var c=d(aa);if(I){c=c-d(tb)/O(R)*I;c=e(aa,
c>0.1?c:(I=z=0))}V.text(d(a.monitor));c&&I++;z&&z++;Fb(0);ib=true;if(z&&!c)return x(b);if(d(pa))return x(b,w());if(!(d(ca)>0)){b=d(ja)*Ra(1,d(L));c=(d(hb)?c:Q(d(za))+c)/O(R);var h=d(s);e(s,h-c*b)}},"tick.reel.preload":function(){var b=d(K),c=parseInt(G.css(Ta)),h=U(1/d($).length*d(ba)*b.x);G.css({width:c+(h-c)/3+1});if(d(ba)===d($).length&&c>b.x-2){G.fadeOut(300,function(){G.remove()});M.unbind(fa+p(Hb),u.pool[fa+p(Hb)])}},"tick.reel.opening":function(){if(a.opening){if(d(ca)<=0)return;var b=(a.entry||
a.speed)/O(R)*(a.cw?-1:1),c=d(s);e(s,c+b);if(e(ca,d(ca)-1)>0)return;g.trigger("openingDone")}M.unbind(fa+p(Na),u.pool[fa+p(Na)])},"tick.reel.fu":function(){g.trigger("fractionChange")}}},x=function(b,c){return b.stopImmediatePropagation()||c},z,I=0,ra=function(){return z=0},w=function(){clearTimeout(Ia);M.unbind(fa+p(Na),u.pool[fa+p(Na)]);e(ca,0);g.trigger("play");return z=-a.timeout*O(R)},W=false,Ia,V,G,y=function(b){C(B+p(Ma)+p(b),{position:Ha,width:a.indicator,height:a.indicator,overflow:db,backgroundColor:Ab});
return k(P(oa),{"class":[Ma,b].join(B)})},H=[],C=function(b,c,h){h=h?D:d($a);b=b.replace(/^/,h).replace(da,da+h);return H.push(b+Nb(c))&&c},jb=0,Ja={x:0,y:0},Fb=function(b){return sa.push(b)&&sa.shift()&&b},Ea=function(){return sa=[0,0]},sa=Ea(),Eb=a.graph||m.math[a.loops?"hatch":"envelope"],La=m.normal,Ka=function(b,c,h,i,j){e(Aa,h);e(bb,j);e(Ba,a.loops?0:-h*i);e(Ca,a.loops?i:i-h*i);return b&&e(ab,{x:b,y:c})||q},ib=true,N;try{N=k.unique(M.add(Ib.top.document))}catch(rc){N=M}var lc=top===self?k():
function(b){k("iframe",N.last()).each(function(){try{if(k(this).contents().find(fb).html()==k(fb).html())return(b=k(this))&&false}catch(c){}});return b}();u.setup()});Oa=Oa||function g(){var t=+new Date,e=O(R);if(e){M.trigger(fa);m.cost=(+new Date+m.cost-t)/2;return Oa=setTimeout(g,la(4,1E3/e-m.cost))}else return Oa=q}();return k(o)};k.fn.unreel=function(){return this.trigger("teardown")};m.math={envelope:function(f,a,o,g,t,e){return a+la(g,Qa(t,-f*e))/o},hatch:function(f,a,o,g,t,e){f=(f<g?t:0)+f%
t;f=a+-f*e/o;return f-ea(f)},interpolate:function(f,a,o){return a+f*(o-a)}};m.preload={linear:function(f){return f},fidelity:function(f,a){function o(x,z,I){function ra(H){for(;!(H>=1&&H<=V);)H+=H<1?+V:-V;return u[I+H]||(u[I+H]=!!w.push(H))}if(!x.length)return[];var w=[],W=4*z,Ia=a.frame,V=x.length;z=true;for(var G=V/W,y=0;y<W;y++)ra(Ia+U(y*G));for(;G>1;){y=0;W=w.length;G/=2;for(z=!z;y<W;y++)ra(w[y]+(z?1:-1)*U(G))}for(y=0;y<w.length;y++)w[y]=x[w[y]-1];return w}var g=a.orbital?2:a.rows||1,t=a.orbital?
a.footage:a.frames,e=(a.row-1)*t,d=[].concat(f),u=new Array(f.length);f=g<2?[]:d.slice(e,e+t);return o(f,1,e).concat(o(d,g,0))}};m.normal={fraction:function(f,a,o){f=f!=q?f:o(s);return a.loops?f-ea(f):X(0,1,f)},row:function(f,a,o){return X(0,1,f!=q?(f-1)/(a.rows-1):o(F))},frame:function(f,a,o){f=f!=q?U(f):o(J);var g=a.orbital?2:a.rows||1;o=o(na)*g;f=a.loops?f%o||o:X(1,o,f);return f<0?f+o:f}};m.re={image:/^(.*)\.(jpg|jpeg|png|gif)$/,touchy_agent:/iphone|ipod|ipad|android/i,lazy_agent:/iphone|ipod|android/i,
sequence:/(^[^#|]*([#]+)[^#|]*)($|[|]([0-9]+)\.\.([0-9]+))($|[|]([0-9]+)$)/};m.cdn="http://code.vostrel.cz/";m.build_sequence=function(f,a){function o(x,z,I){for(;x.length<z;)x=I+x;return x}if(f.length<=1)return a.images;var g=[],t=f[1],e=f[2],d=+f[4]||1,u=a.orbital?2:a.rows||1;a=a.orbital?a.footage:a.frames;u=+(f[5]||u*a);f=+f[7]||1;for(a=0;a<u;){g.push(t.replace(e,o(d+a+D,e.length,"0")));a+=f}return g};m.touchy=m.re.touchy_agent.test(navigator.userAgent);m.lazy=m.re.lazy_agent.test(navigator.userAgent);
m.instances=k();m.leader=O;m.cost=0;Mb("mousewheel disableTextSelect enableTextSelect".split(/ /));var M=k(Pa);Pa=+k.browser.version.split(p()).slice(0,2).join(p());var qc=k.browser.msie,wa=m.touchy,Oa,v="reel",Rb=v+"-overlay",Ma=v+"-indicator",zb=v+"-preloader",yb=v+"-cached",xb=v+"-monitor",nc=v+"-annotation",Ga=v+"-panning",eb=v+"-loading",qb="frame-",pc=/frame-\d+/,U=Math.round,ea=Math.floor,ob=Math.ceil,Qa=Math.min,la=Math.max,Q=Math.abs,mc=Math.sqrt,xa=parseInt,Da="annotations",Vb="area",ub=
"backup",L="backwards",ha="bit",tb="brake",Va="cached",cb="center",pa="clicked",ab="clicked_location",Aa="clicked_on",bb="clicked_row",ja="cwish",K="dimensions",s="fraction",J="frame",Wa="_frame",na="frames",fb="head",Ca="hi",db="hidden",Ua="image",$="images",ca="opening_ticks",Ba="lo",Sb="options",gb="playing",ba="preloaded",qa="reeling",ya="revolution",F="row",Ya="rows",Pb="sequence",rb="spacing",za="speed",$a="stage",Xa="steps",Za="stitched",sb="stitched_travel",hb="stopped",ma="style",R="tempo",
aa="velocity",ia="vertical",Tb="wheel_step",S=p(v),T=".pan"+S,cc="mousedown"+S,bc="mouseenter"+S,jc="mouseleave"+T,ic="mousemove"+T,kc="mouseup"+T,ac="mousewheel"+S,fa="tick"+S,hc="touchcancel"+T,gc="touchend"+T,Wb="touchstart"+S,fc="touchmove"+T,D="",B=" ",da=",",Ha="absolute",oc="a",vb="block",oa="div",wb="hand",nb="height",Ab=ka("000"),Db="html",ga="id",Sa="img",kb="jquery."+v,Fa="none",Gb="object",Na="opening",Hb="preload",Z="px",mb="src",lb="string",dc="title",Ta="width",Bb="x",Cb="y",ec=Lb("CAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7")||
ta("blank.gif"),$b="wait",Yb=ua(ta(kb+p("cur")))+da+"move",Xb=ua(ta(kb+"-drag"+p("cur")))+da+"move",Zb=ua(ta(kb+"-drag-down"+p("cur")))+da+"move",Ub=wa?q:qc&&Pa<=8?1:0;k.fn.reelTriggerOnce=function(f,a){function o(g){a()?g.trigger(f):setTimeout(function(){o(g)},100);return g}return o(k(this))}}}(jQuery,window,document);
