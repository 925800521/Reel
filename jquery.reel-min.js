/*
 Copyright (c) 2009-2011 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 jQuery Reel
 http://jquery.vostrel.cz/reel
 Version: 1.1.3-devel
 Updated: 2011-12-23

 Requires jQuery 1.4.3 or higher
*/
jQuery.reel||function(i,zb,ka,p){function L(e){return i.reel.instances.length?i.reel.instances.first().data(e):null}function Ab(e){return i.reel.instances.push(e[0])&&e}function Bb(e){return(i.reel.instances=i.reel.instances.not(aa(e.attr(ba))))&&e}function wa(e){return Cb&&"data:image/gif;base64,R0lGODlh"+e}function xa(e){return"<"+e+"/>"}function z(e){return"."+e}function ya(e){return"http://code.vostrel.cz/"+e}function Za(e){return"url("+e+")"}function S(e,a,n){return ca(e,$a(a,n))}function Db(e){function a(){i.fn[this]||
(i.fn[this]=function(){return this})}i.each(e,a)}function za(e,a){return D(e)*(a?-1:1)}function la(e){return e.originalEvent.touches[0]}function Aa(e){return e===p||typeof e=="string"?e:e+"px"}function aa(e){return"#"+e}function Eb(e){var a=[];i.each(e,function(n,g){a.push(n.replace(/([A-Z])/g,"-$1").toLowerCase()+":"+Aa(g))});return"{"+a.join(";")+";}"}function Fb(){var e=i().jquery.split(".");if(e=+e[0]<=1&&(+e[1]<4||+e[1]==4&&+e[2]<3))try{console.error("FATAL: jQuery Reel plug-in requires at least jQuery 1.4.3")}catch(a){}return e}
if(!Fb()){i.reel={version:"1.1.3-devel",def:{area:p,brake:0.23,clickfree:false,cw:false,delay:-1,directional:false,draggable:true,footage:6,entry:p,frame:1,frames:36,graph:p,hint:"",horizontal:true,image:p,images:[],indicator:0,inversed:false,klass:"",laziness:6,loops:true,monitor:p,opening:0,orbital:0,path:"",preloader:4,rebound:0.5,revolution:p,row:1,rows:0,spacing:0,speed:0,step:p,steps:p,stitched:0,suffix:"-reel",tempo:36,timeout:2,throwable:true,vertical:false,wheelable:true,annotations:p,attr:{},
preload:"fidelity",scrollable:true,steppable:true,velocity:0}};i.fn.reel=function(e){var a=i.extend({},i.reel.def,e);e=function(g){var s=[];g.filter(Ba).each(function(){var d=i(this),c=a.images.length&&a.images||a.image||a.attr.src||d.attr(ab),x=ma(a.attr.width||d.css(bb)),o=ma(a.attr.height||d.css(cb));!c||c==Ca||!x||!o||s.push(d)});g.filter(z(v)).each(function(){s.push(i(this).unreel())});return i(s)}(this);var n=[];a.tooltip&&(a.hint=a.tooltip);a.hotspot&&(a.area=a.hotspot);e.each(function(){var g=
i(this),s=g.data(),d=function(h,b){s[h]=b;g.trigger("store",[h,b]);return b},c=function(h){var b=s[h];g.trigger("recall",[h,b]);return b},x={setup:function(h){if(g.hasClass(v))return o.call(h);var b=g.attr(a.attr).attr(ab),f=d(ba,g.attr(ba)||g.attr(ba,v+"-"+ +new Date).attr(ba)),j=g.attr("style"),l=i.extend({},g.data()),k=a.images,m=a.stitched,r=a.loops,A={x:ma(g.css(bb)||a.attr.width),y:ma(g.css(cb)||a.attr.height)},y=d(E,a.frame),da=d(Da,a.orbital&&a.footage||a.rows<=1&&k.length||a.frames),Ea=m?
1:db(da/a.footage);f=aa(f+a.suffix);var eb=g.attr("class")||"";y=i(ea,{id:f.substr(1),"class":eb+F+Gb+F+fb+y});y=g.wrap(y.addClass(a.klass)).attr({"class":v});n.push(Ab(y)[0]);y=y.parent().bind(x.instance);d(gb,k.length&&k.length||a.image||b.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2"));d(hb,[]);d(E,a.frame);d(Fa,0);d(ib,a.spacing);d(M,A);d(q,0);d(Ga,a.steps||a.frames);d(na,a.revolution||m/2||A.x*2);d(Ha,Ea);d(T,1/(da-(r&&!m?0:1)));d(Hb,1/ca(da,c(Ga)));d(Ia,m);d(jb,m-(r?0:A.x));d(Ja,
f);d(J,d(fa,a.speed)<0);d(U,a.velocity||0);d(V,a.vertical);d(K,(a.row-1)/(a.rows-1));d(W,za(1,!a.cw&&!m));d(ga,false);d(kb,a.brake);d(Ka,!!a.orbital);d(N,a.tempo/(i.reel.lazy?a.laziness:1));d(X,0);d(La,a.annotations)||y.unbind(".annotations");d(lb,{src:b,classes:eb,style:j||Ca,data:l});a.steppable||y.unbind("click.steppable");G(true,Ca,{width:A.x,height:A.y,overflow:Ma});G(true,","+F+z(v),{display:"block",position:"relative"});O.bind(x.pool);o.call(h);g.trigger("setup")},instance:{teardown:function(h){var b=
g.data(lb);g.parent().unbind(x.instance).children(Ba).unbind(u);c(mb).remove();g.unbind(u).attr({"class":b.classes,src:b.src,style:b.style}).removeClass(v);g.data(b.data).siblings().remove();g.unwrap();Bb(g);oa();O.unbind(x.pool);Y.unbind(Na).unbind(Oa);o.call(h)},setup:function(){var h=c(M),b=c(Da),f=ca(b,c(Ga));f=d(q,1/f*((a.step||a.frame)-1));d(E,Q(f*b)+1);g.attr("id");b=g.parent();var j=!c(ga)||a.rows<=1||!a.orbital||a.scrollable;f=d(Pa,i(a.area||b));if(i.reel.touchy){G(true,F+z(v),{WebkitUserSelect:"none",
WebkitBackgroundSize:a.images.length?"auto":c(Ia)&&c(Ia)+"px "+h.y+"px"||h.x*a.footage+"px "+h.y*c(Ha)*(a.rows||1)*(a.directional?2:1)+"px"});f.bind(Ib,function(l){g.trigger("down",[la(l).clientX,la(l).clientY,true])}).bind(Jb,function(l){g.trigger("pan",[la(l).clientX,la(l).clientY,true]);return!j}).bind(Kb,function(){g.trigger("up",[true]);return false}).bind(Lb,function(){g.trigger("up",[true]);return false})}else{G(true,"",{cursor:"url("+Mb+"), "+nb});f.bind(a.wheelable?Nb:"",function(l,k){g.trigger("wheel",
[k]);return false}).bind(a.clickfree?Ob:Pb,function(l){if(!(Qb?!l.button:!!l.button)){g.trigger("down",[l.clientX,l.clientY]);return false}}).bind(a.clickfree?Rb:"",function(){g.trigger("up");return false}).disableTextSelect()}a.hint&&f.attr(Sb,a.hint);a.monitor&&b.append(t=i(ea,{"class":ob}))||(t=i());G(true,F+z(ob),{position:pa,left:0,top:0});G(true,F+z(pb),{display:"none"});G(true,F+z(qb),{position:pa,left:0,top:h.y-a.preloader,height:a.preloader,overflow:Ma,backgroundColor:rb});G(true,z(Qa),{cursor:Za(Tb)+
", "+nb});a.indicator&&b.append(sb("x"));a.rows>1&&a.indicator&&b.append(sb("y"))},preload:function(h){var b=c(M),f=g.parent(),j=c(gb),l=a.images,k=i.reel.preload[a.preload]||i.reel.preload[i.reel.def.preload];k=!l.length?[j]:k(l,a,c);var m=[],r=g[0];r.frames=k.length;r.preloaded=0;f.append(B=i(ea,{"class":qb}));for(g.trigger("stop");k.length;){var A=a.path+k.shift(),y=i(new Image).addClass(pb).attr({width:b.x,height:b.y}).bind("load"+u,function(){r.preloaded++;i(this).unbind(u);B.css({width:1/r.frames*
r.preloaded*b.x});if(r.frames==r.preloaded){B.remove();l.length||g.attr({src:Ub}).css({backgroundImage:Za(a.path+j)});g.trigger("loaded");o.call(h)}});f.append(y);m.push(A);setTimeout(function(da,Ea){return function(){da.attr({src:Ea})}}(y,A),0)}d(hb,m);d(mb,i('<style type="text/css">'+tb.join("\n")+"</style>").prependTo("head"))},opening:function(){if(!a.opening)return g.trigger("openingDone");var h=a.entry||a.speed,b=c(q),f=a.opening;d(q,b-h*a.opening);d(X,f*L(N))},openingDone:function(){R=setTimeout(function(){g.trigger("play")},
a.delay*1E3||0)},play:function(h,b){b=d(fa,b||c(fa));b=d(Ra,!!b);d(Sa,!b);H();o.call(h)},pause:function(h){d(Ra,false);w();o.call(h)},stop:function(h){var b=d(Sa,true);d(Ra,!b);o.call(h)},down:function(h,b,f,j){if(a.draggable){d(qa,c(E));d(U,0);ra=sa(b,f,c(q),c(na),c(K));w();oa();ha=false;c(Pa).addClass(Qa);if(!j){Y.bind(Oa,function(l){g.trigger("pan",[l.clientX,l.clientY]);o.call(l);return false});a.clickfree||Y.bind(Na,function(l){g.trigger("up");o.call(l)})}}o.call(h)},up:function(h,b){if(!a.draggable)return o.call(h);
d(qa,false);d(ga,false);var f=d(U,!a.throwable?0:D(ia[0]+ia[1])/60);P=f?1:0;f?H():w();oa();c(Pa).removeClass(Qa);!b&&Y.unbind(Na).unbind(Oa);o.call(h)},pan:function(h,b,f){if(a.draggable&&Ta){Ta=false;w();var j={x:b-ra.x,y:f-ra.y};if(D(j.x)>0||D(j.y)>0){ha=true;ra={x:b,y:f};var l=c(na),k=c(ub),m=c(V),r=d(q,vb(m?f-k.y:b-k.x,c(Ua),l,c(Va),c(Wa),c(W)));d(ga,c(ga)||c(E)!=c(qa));(j=wb(m?j.y:j.x||0))&&d(J,j<0);if(a.orbital&&c(Ka)){d(V,D(f-k.y)>D(b-k.x));k=sa(b,f,r,l,c(K))}if(a.rows>1){j=c(M).y;m=c(xb);
var A=-m*j;d(K,i.reel.math.envelope(f-k.y,m,j,A,A+j,-1))}!(r%1)&&!a.loops&&sa(b,f,r,l,c(K));g.trigger("fractionChange")}}o.call(h)},wheel:function(h,b){var f=db(Vb(D(b))/2);f=za(f,b>0);b=0.0833*c(na);sa(p,p,c(q),b,c(K));d(q,vb(f,c(Ua),b,c(Va),c(Wa),c(W)));f&&d(J,f<0);d(U,0);w();o.call(h);g.trigger("fractionChange");return false},fractionChange:function(h,b){b=d(q,ta.fraction(b,a,c));var f=d(E,1+Z(b/c(T))),j=a.rows>1,l=a.orbital;d(Ka,!!l&&(f<=l||f>=a.footage-l+2));if(!a.loops&&a.rebound){!I&&!(b%1)?
Xa++:(Xa=0);Xa>=a.rebound*1E3/L(N)&&d(J,!c(J))}g.trigger(j?"rowChange":"frameChange");o.call(h)},rowChange:function(h,b){var f=c(q)/c(T)+1;b=d(K,ta.row(b,a,c));b=S(0,a.rows-1,Z(b*a.rows));d(E,Z(f+b*a.frames));o.call(h);g.trigger("frameChange")},frameChange:function(h,b){var f=d(q,ta.fraction(!b?p:c(T)*(b-1),a,c));b=ta.frame(b,a,c);footage=a.footage;if(c(V)){b=a.inversed?footage+1-b:b;b+=footage}if(b==c(Fa))C(h);else{var j=a.horizontal,l=a.images,k=c(M);b=d(Fa,d(E,b));if(l.length)g.attr({src:a.path+
l[b-1]});else{if(a.stitched)k=[-Q(f*c(jb))+$,0+$];else{f=b%footage-1;f=f<0?footage-1:f;var m=Z((b-0.1)/footage);m+=a.rows>1?0:c(J)?0:c(Ha);b=c(ib);m=m*((j?k.y:k.x)+b);k=f*((j?k.x:k.y)+b);k=l.length?[0,0]:j?[-k+$,-m+$]:[-m+$,-k+$]}g.css({backgroundPosition:k.join(F)})}}if(a.indicator){j=c(Ja);l=a.rows>1;k=c(M);f=(c(V)?k.y:k.x)-a.indicator;b=S(0,f,Q(i.reel.math.interpolate(c(q),-1,f+2)));b=!a.cw||a.stitched?b:f-b;i(z(ua+".x"),j).css(c(V)?{left:0,top:b}:{left:b,top:k.y-a.indicator});if(l){k=k.y-a.indicator;
k=S(0,k,Q(i.reel.math.interpolate(c(K),-1,k+2)));i(z(ua+".y"),j).css({top:k})}}o.call(h)},stepLeft:function(){w();d(J,false);g.trigger("fractionChange",c(q)-c(T)*c(W))},stepRight:function(){w();d(J,true);g.trigger("fractionChange",c(q)+c(T)*c(W))},"click.steppable":function(h){if(ha)return C(h);g.trigger(h.clientX-g.offset().left>0.5*c(M).x?"stepRight":"stepLeft")},"setup.annotations":function(){c(M);var h=g.parent();i.each(c(La),function(b,f){var j=i(ea,f.node).attr({id:b}).addClass(Wb),l=f.image?
i(xa(Ba),f.image):i(),k=f.link?i(xa(Xb),f.link):i();G(false,aa(b),{display:"none",position:pa});k.bind({"click.annotations":function(m){m.stopPropagation()}});f.image||f.link&&j.append(k);f.link||f.image&&j.append(l);f.link&&f.image&&j.append(k.append(l));j.appendTo(h)});g.trigger("frameChange.annotations")},"frameChange.annotations":function(h,b){b=b||c(E);this.className=this.className.replace(/frame-\d+/,fb+b);i.each(c(La),function(f,j){f=i(aa(f));var l=j.start,k=j.end,m=b-(l||1),r=typeof j.x!=
yb?j.x:j.x[m];j=typeof j.y!=yb?j.y:j.y[m];j={display:r!==p&&j!==p&&m>=0&&(!k||m<=k-l)?"block":"none",left:Aa(r)||0,top:Aa(j)||0};f.css(j)})},"setup.fu":function(){g.trigger("preload")},"loaded.fu":function(){g.trigger(a.rows>1&&!a.stitched?"rowChange":"frameChange").trigger("opening")}},pool:{"tick.reel":function(h){var b=c(U);if(P){var f=b-c(kb)/L(N)*P;b=!(b*f<=0||b<D(f))&&d(U,b>D(c(fa))?f:(P=I=0))}t.text(c(a.monitor));b&&P++;I&&I++;wb(0);Ta=true;if(I&&!b)return C(h);if(c(qa))return C(h,w());if(!c(X)){f=
c(W)*za(1,c(J));b=(c(Sa)?b:D(c(fa))+b)/L(N);var j=c(q);d(q,j-b*f);o.call(h)}},"tick.reel.opening":function(h){var b=(a.entry||a.speed)/L(N)*(a.cw?-1:1),f=c(q);d(q,f+b);b=d(X,c(X)-1);o.call(h);if(!b){g.trigger("openingDone");O.unbind(ja+".opening",x.pool[ja+".opening"])}},"tick.reel.fu":function(){g.trigger("fractionChange")}}},o=function(h){Ya||delete this;return h},C=function(h,b){return h.stopImmediatePropagation()||o.call(h)||b},I,P=0,H=function(){return I=0},w=function(){clearTimeout(R);O.unbind(ja+
".opening",x.pool[ja+".opening"]);d(X,0);g.trigger("play");return I=-a.timeout*L(N)},ha=false,R,t,B,sb=function(h){G(true,F+z(ua)+z(h),{position:pa,width:a.indicator,height:a.indicator,overflow:Ma,backgroundColor:rb});return i(ea,{"class":[ua,h].join(F)})},tb=[],G=function(h,b,f){var j=c(Ja);b=b.split(",");h&&i.each(b,function(l,k){b[l]=j+k});tb.push(b.join(",")+Eb(f));return f},Xa=0,ra={x:0,y:0},wb=function(h){return ia.push(h)&&ia.shift()&&h},oa=function(){return ia=[0,0]},ia=oa(),vb=a.graph||i.reel.math[a.loops?
"hatch":"envelope"],ta=i.reel.normal,sa=function(h,b,f,j,l){d(Ua,f);d(xb,l);d(Va,a.loops?0:-f*j);d(Wa,a.loops?j:j-f*j);return h&&d(ub,{x:h,y:b})||p},Ta=true,Y;try{Y=i.browser.opera?O:i.unique(O.add(zb.top.document))}catch(Yb){Y=O}x.setup()});va=va||function g(){var s=+new Date,d=L(N);if(d){O.trigger(ja);i.reel.cost=(+new Date+i.reel.cost-s)/2;return va=setTimeout(g,ca(4,1E3/d-i.reel.cost))}else return va=p}();return i(n)};i.fn.unreel=function(){return this.trigger("teardown")};i.reel.math={envelope:function(e,
a,n,g,s,d){return a+ca(g,$a(s,-e*d))/n},hatch:function(e,a,n,g,s,d){e=(e<g?s:0)+e%s;e=a+-e*d/n;return e-Z(e)},interpolate:function(e,a,n){return a+e*(n-a)}};i.reel.preload={linear:function(e){return e},fidelity:function(e,a){function n(o,C,I){function P(B){for(;!(B>=1&&B<=R);)B+=B<1?+R:-R;return x[I+B]||(x[I+B]=!!H.push(B))}if(!o.length)return[];var H=[],w=4*C,ha=a.frame,R=o.length;C=R/w;for(var t=0;t<w;t++)P(ha+Q(t*C));for(;C>1;){t=0;w=H.length;for(C/=2;t<w;t++)P(Q(H[t]+C))}for(t=0;t<H.length;t++)H[t]=
o[H[t]-1];return H}var g=a.orbital?2:a.rows||1,s=a.orbital?a.footage:a.frames,d=(a.row-1)*s,c=[].concat(e),x=new Array(e.length);e=g<2?[]:c.slice(d,d+s);return n(e,1,d).concat(n(c,g,0))}};i.reel.normal={fraction:function(e,a,n){e=e!=p?e:n(q);return a.loops?e-Z(e):S(0,1,e)},row:function(e,a,n){return S(0,1,e!=p?(e-1)/(a.rows-1):n(K))},frame:function(e,a,n){e=e!=p?Q(e):n(E);var g=a.orbital?2:a.rows||1;n=n(Da)*g;e=a.loops?e%n||n:S(1,n,e);return e<0?e+n:e}};i.reel.touchy=/iphone|ipod|ipad|android/i.test(navigator.userAgent);
i.reel.lazy=/iphone|ipod|android/i.test(navigator.userAgent);i.reel.instances=i();i.reel.cost=0;i.reel.leader=L;Db("mousewheel disableTextSelect enableTextSelect".split(/ /));var O=i(ka);ka=+i.browser.version.split(".").slice(0,2).join(".");var Ya=i.browser.msie,Cb=!(Ya&&ka<8),Qb=Ya&&ka<=8,nb="ew-resize",va,v="reel",Gb=v+"-overlay",ua=v+"-indicator",qb=v+"-preloader",pb=v+"-cached",ob=v+"-monitor",Wb=v+"-annotation",Qa=v+"-panning",fb="frame-",Ub=wa("CAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7")||
ya("blank.gif"),Mb=wa("EAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAI3lC8AeBDvgosQxQtne7yvLWGStVBelXBKqDJpNzLKq3xWBlU2nUs4C/O8cCvU0EfZGUwt19FYAAA7")||ya("jquery.reel.cursor-drag.gif"),Tb=wa("EAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAIslI95EB3MHECxNjBVdE/5b2zcRV1QBabqhwltq41St4hj5konmVioZ6OtEgUAOw==")||ya("jquery.reel.cursor-drag-down.gif"),Q=Math.round,Z=Math.floor,db=Math.ceil,$a=Math.min,ca=Math.max,D=Math.abs,Vb=Math.sqrt,ma=parseInt,La="annotations",Pa="area",lb="backup",J="backwards",
T="bit",kb="brake",Ka="center",qa="clicked",ub="clicked_location",Ua="clicked_on",xb="clicked_row",W="cwish",M="dimensions",q="fraction",E="frame",Fa="_frame",Da="frames",Wa="hi",Ma="hidden",gb="image",hb="images",X="opening_ticks",Va="lo",Ra="playing",ga="reeling",na="revolution",K="row",Ha="rows",ib="spacing",fa="speed",Ja="stage",Ga="steps",Ia="stitched",jb="stitched_travel",Sa="stopped",mb="style",N="tempo",U="velocity",V="vertical",Hb="wheel_step",u=".reel",Pb="mousedown"+u,Ob="mouseenter"+u,
Rb="mouseleave"+u,Oa="mousemove"+u,Na="mouseup"+u,Nb="mousewheel"+u,ja="tick"+u,Lb="touchcancel"+u,Kb="touchend"+u,Ib="touchstart"+u,Jb="touchmove"+u,Ca="",F=" ",pa="absolute",Xb="a",ea=xa("div"),cb="height",rb=aa("000"),ba="id",Ba="img",yb="object",$="px",ab="src",Sb="title",bb="width"}}(jQuery,window,document);
