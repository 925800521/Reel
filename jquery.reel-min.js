/*
 Copyright (c) 2009-2010 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 http://jquery.vostrel.cz/reel
 Version: "Dancer" (will be 1.1 on release)
 Updated: 2010-08-06

 Requires jQuery 1.4.x
*/
(function(k,ob,Pa,p){function Qa(j){return"<"+j+"/>"}function X(j){return"."+j}function Y(j){return"url("+j+")"}function L(j){return+j.toFixed(4)}function M(j,a,t){return N(j,va(a,t))}function Ra(j){function a(){k.fn[this]||(k.fn[this]=function(){return this})}k.each(j,a)}function Z(j,a){return A(j)*(a?-1:1)}function O(j){return j.originalEvent.touches[0]}var Sa=k.reel={footage:6,frame:1,frames:36,hint:"",horizontal:true,hotspot:p,indicator:0,klass:"",loops:true,reversed:p,spacing:0,stitched:p,suffix:"-reel",
tooltip:"",brake:0.5,cw:false,delay:-1,draggable:true,graph:p,image:p,images:[],monitor:p,path:"",preloader:4,rebound:0.5,revolution:p,row:1,rows:0,speed:0,step:p,steps:p,tempo:25,timeout:2,throwable:true,wheelable:true};k.fn.reel=function(j){var a=k.extend({},Sa,j);j=function(g){var d=[];g.filter(Ta).each(function(){var c=k(this),n=a.images.length&&a.images||a.image||c.attr(wa),w=P(c.css(xa)),u=P(c.css(ya));!n||n==za||!w||!u||d.push(c)});g.filter(Aa+X(E)).each(function(){d.push(k(this))});return k(d)}(this);
var t=[];a.reversed&&(a.cw=true);a.tooltip&&(a.hint=a.tooltip);$=$||function g(){F.trigger(aa);return setTimeout(g,1E3/a.tempo)}();j.each(function(){var g=k(this),d=function(e,b){g.data(e,b);g.trigger("store");return b},c=function(e){g.trigger("recall");return g.data(e)},n=function(e){delete this;return e},w={setup:function(e){if(g.hasClass(E))return n.call(e);var b=g.attr(wa),f=g.attr(Ua),i=g.attr("style"),h=a.images,l=a.stitched,o=a.loops,m={x:P(g.css(xa)),y:P(g.css(ya))},s={display:"block",width:m.x,
height:m.y};s=g.attr({src:a.images?Va:b}).bind(w).addClass(E).css(s);t.push(s[0]);d(ba,h.length&&h.length||a.image||b.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2"));d(x,a.frame);d(Ba,a.spacing);d(G,m);d(q,0);d(ca,a.steps||a.frames);d(Q,a.revolution||l/2||m.x);d(Ca,Da(d(R,h.length||a.frames)/a.footage));d(da,1/(c(R)-(o&&!l?0:1)));d(Wa,1/N(c(R),c(ca)));d(Ea,l-(o?0:m.x));d(Fa,m.x-a.indicator);d(H,"#"+f+a.suffix);d(y,d(ea,a.speed)<0);d(B,0);d(v,(a.row-1)/(a.rows-1));d(S,Z(1,!a.cw&&!l));d(Ga,
{src:b,style:i||za});$&&F.bind(aa,w.tick);n.call(e);g.trigger("start")},teardown:function(e){k(c(H)).remove();g.removeClass(E).unbind(r).unbind(w).attr(g.data(Ga)).enableTextSelect().removeData();T();F.unbind(fa).unbind(U).unbind(aa,w.tick);n.call(e)},start:function(e){var b=c(G),f=c(R),i=N(f,c(ca));i=d(q,1/i*((a.step||a.frame)-1));d(x,i*f+1);f=c(ba);i=a.images;f=!i.length?[f]:[].concat(i);g.attr("id");var h=g[0];h.frames=f.length;h.preloads=h.preloads||[];h.preloaded=h.preloaded||0;i=f.length!=h.preloads.length;
var l=c(H).substr(1);l=k(I,{className:Xa,id:l,css:{position:"relative",width:b.x}}).insertAfter(g);var o=k(I,{className:Ya,css:{position:V,left:0,top:-b.y,width:b.x,height:b.y}}).appendTo(l);o=d(ga,k(a.hotspot||o));Za?o.css({WebkitUserSelect:"none"}).bind($a,function(m){g.trigger("down",[O(m).clientX,O(m).clientY,true]);return false}).bind(ab,function(m){g.trigger("drag",[O(m).clientX,O(m).clientY,true]);return false}).bind(bb,function(){g.trigger("up",[true]);return false}).bind(cb,function(){g.trigger("up",
[true]);return false}):o.css({cursor:"url("+Ha+"), "+ha}).bind(db,function(){g.trigger("enter")}).bind(eb,function(){g.trigger("leave")}).bind(U,function(m){g.trigger("over",[m.pageX,m.pageY])}).bind(fb,function(m,s){g.trigger("wheel",[s]);return false}).bind(gb,function(){g.trigger("animate")}).bind(hb,function(m){g.trigger("down",[m.clientX,m.clientY]);return false}).disableTextSelect();a.hint&&o.attr(ib,a.hint);a.monitor&&l.append(ia=k(I,{className:jb,css:{position:V,left:0,top:-b.y}}))||(ia=k());
a.indicator&&l.append(Ia("x"));a.rows&&a.indicator&&l.append(Ia("y"));if(i)for(l.append(ja=k(I,{className:kb,css:{position:V,left:0,top:-a.preloader,height:a.preloader,backgroundColor:Ja}}));f.length;){i=new Image;l=a.path+f.shift();k(i).load(function(){h.preloaded++;ja.css({width:1/h.frames*h.preloaded*b.x});h.frames==h.preloaded&&ja.remove()});i.src=l;h.preloads.push(i)}a.delay>0&&z();n.call(e);g.trigger(a.rows&&!a.stitched?"rowChange":"frameChange")},animate:function(){},tick:function(e){var b=
c(B);if(J){var f=L(b-lb*J);b=!(b*f<=0||b<A(f))&&d(B,b>A(c(ea))?f:(J=u=0))}ia.text(c(a.monitor));b&&J++;u&&u++;Ka(0);if(u&&!b)return n.call(e);if(c(ka))return n.call(e,z());f=c(S)*Z(1,c(y));b=(c(la)?b:A(c(ea))+b)/a.tempo;d(q,c(q)-b*f);n.call(e);g.trigger("fractionChange")},play:function(e){var b=d(ma,true);d(la,!b);La();n.call(e)},pause:function(e){d(ma,false);z();n.call(e)},stop:function(e){var b=d(la,true);d(ma,!b);n.call(e)},down:function(e,b,f,i){if(!a.draggable)return n.call(e);d(ka,true);d(B,
0);na(b,f,c(q),c(Q),c(v));oa=p;z();T();!i&&F.bind(U,function(h){g.trigger("drag",[h.clientX,h.clientY]);n.call(h)}).bind(fa,function(h){g.trigger("up");n.call(h)})&&c(ga).css({cursor:Y(mb)+", "+ha});n.call(e)},up:function(e,b){if(!a.draggable)return n.call(e);d(ka,false);var f=d(B,!a.throwable?0:A(C[0]+C[1]+C[2])/60);J=f?1:0;f?La():z();T();!b&&F.unbind(fa).unbind(U)&&c(ga).css({cursor:Y(Ha)+", "+ha});n.call(e)},drag:function(e,b,f){if(!a.draggable)return n.call(e);var i=c(Q),h=c(Ma),l=Ka(b-oa||0),
o=d(q,Na(b-h.x,c(pa),i,c(qa),c(ra),c(S)));l&&d(y,l<0);if(a.rows){l=c(G).y;var m=c(Oa),s=-m*l;d(v,L(k.reel.math.envelope(f-h.y,m,l,s,s+l,-1)))}!(o%1)&&!a.loops&&na(b,f,o,i,c(v));z();oa=b;n.call(e);g.trigger("fractionChange")},wheel:function(e,b){if(!a.wheelable)return n.call(e);var f=Da(nb(A(b))/2);f=Z(f,b>0);b=0.2*c(Q);na(p,p,c(q),b,c(v));d(q,Na(f,c(pa),b,c(qa),c(ra),c(S)));f&&d(y,f<0);d(B,0);z();n.call(e);g.trigger("fractionChange");return false},fractionChange:function(e,b){b=!b?c(q):d(q,b);b=a.loops?
b-W(b):M(0,1,b);b=d(q,L(b));d(x,1+W(b/c(da)));if(!a.loops&&a.rebound){!u&&!(b%1)?sa++:(sa=0);sa>=a.rebound*1E3/a.tempo&&d(y,!c(y))}n.call(e);g.trigger(a.rows&&!a.stitched?"rowChange":"frameChange")},rowChange:function(e,b){b=d(v,M(0,1,b||c(v)));d(x,c(x)+(!a.rows?0:K(b*(a.rows-1))*a.frames));n.call(e);g.trigger("frameChange")},frameChange:function(e,b){var f=!b?c(q):d(q,L(c(da)*(b-1)));b=d(x,K(b?b:c(x)));var i=a.images,h=a.footage,l=a.horizontal;if(a.stitched)l=[-K(f*c(Ea))+D,0+D];else{var o=b%h-1;
o=o<0?h-1:o;var m=W((b-0.1)/h);m+=a.rows?0:c(y)?0:c(Ca);h=c(G);var s=c(Ba);m=m*((l?h.y:h.x)+s);o=o*((l?h.x:h.y)+s);l=i.length?[0,0]:l?[-o+D,-m+D]:[-m+D,-o+D]}b=i[b-1]||c(ba);i=c(Fa);f=M(0,i,K(k.reel.math.interpolate(f,-1,i+2)));f=!a.cw||a.stitched?f:i-f;i={background:Y(a.path+b)+ta+l.join(ta)};a.images.length?g.attr({src:a.path+b}):g.css(i);k(X(ua+".x"),c(H)).css({left:f});if(!a.rows)return n.call(e);f=c(G).y-a.indicator;b=M(0,f,K(k.reel.math.interpolate(c(v),-1,f+2)));k(X(ua+".y"),c(H)).css({top:b-
f-a.indicator});n.call(e)}},u,J=0,La=function(){return u=0},z=function(){return u=-a.timeout*a.tempo},ia,ja,Ia=function(e){return k(I,{className:[ua,e].join(ta),css:{width:a.indicator,height:a.indicator,top:e=="y"?p:-a.indicator,left:e=="x"?p:0,position:V,backgroundColor:Ja}})},sa=0,oa=0,Ka=function(e){return C.push(e)&&C.shift()&&e},T=function(){return C=[0,0,0]},C=T(),lb=a.brake/a.tempo,Na=a.graph||k.reel.math[a.loops?"hatch":"envelope"],na=function(e,b,f,i,h){d(pa,f);d(Oa,h);d(qa,a.loops?0:-f*
i);d(ra,a.loops?i:i-f*i);return e&&d(Ma,{x:e,y:b})||p};w.setup()});return k(t)};k.reel.math={envelope:function(j,a,t,g,d,c){return a+N(g,va(d,-j*c))/t},hatch:function(j,a,t,g,d,c){j=(j<g?d:0)+j%d;j=a+-j*c/t;return j-W(j)},interpolate:function(j,a,t){return a+j*(t-a)}};Ra("mousewheel disableTextSelect enableTextSelect".split(/ /));var F=k(Pa),Za=/iphone|ipod|ipad|android/i.test(navigator.userAgent),ha="ew-resize",$,E="jquery-reel",Xa=E+"-overlay",ua="indicator",kb="preloader",jb="monitor",Ya="interface",
Va="data:image/gif;base64,R0lGODlhCAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7",Ha="data:image/gif;base64,R0lGODlhEAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAI3lC8AeBDvgosQxQtne7yvLWGStVBelXBKqDJpNzLKq3xWBlU2nUs4C/O8cCvU0EfZGUwt19FYAAA7",mb="data:image/gif;base64,R0lGODlhEAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAIslI95EB3MHECxNjBVdE/5b2zcRV1QBabqhwltq41St4hj5konmVioZ6OtEgUAOw==",K=Math.round,W=Math.floor,Da=Math.ceil,va=Math.min,N=Math.max,A=Math.abs,nb=Math.sqrt,P=parseInt,
Ga="backup",y="backwards",da="bit",ka="clicked",Ma="clicked_location",pa="clicked_on",Oa="clicked_row",S="cwish",G="dimensions",q="fraction",x="frame",R="frames",ra="hi",ga="hotspot",ba="image",Fa="indicator_travel",qa="lo",ma="playing",Q="revolution",v="row",Ca="rows",Ba="spacing",ea="speed",H="stage",ca="steps",Ea="stitched_travel",la="stopped",B="velocity",Wa="wheel_step",r=".reel",gb="dblclick"+r,hb="mousedown"+r,db="mouseenter"+r,eb="mouseleave"+r,U="mousemove"+r,fa="mouseup"+r,fb="mousewheel"+
r,aa="tick"+r,cb="touchcancel"+r,bb="touchend"+r,$a="touchstart"+r,ab="touchmove"+r,za="",ta=" ",V="absolute",Aa="div",I=Qa(Aa),ya="height",Ja="#000",Ua="id",Ta="img",D="px",wa="src",ib="title",xa="width"})(jQuery,window,document);
