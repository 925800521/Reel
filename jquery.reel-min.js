/*
 Copyright (c) 2009-2010 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 http://jquery.vostrel.cz/reel
 Version: 1.1 RC 2
 Updated: 2010-11-14

 Requires jQuery 1.4.2
*/
jQuery.fn.reel||function(k,ga,bb,n){function cb(l){return"<"+l+"/>"}function ha(l){return"."+l}function ia(l){return"url("+l+")"}function A(l){return+l.toFixed(4)}function S(l,a,u){return T(l,Fa(a,u))}function db(l){function a(){k.fn[this]||(k.fn[this]=function(){return this})}k.each(l,a)}function ja(l,a){return z(l)*(a?-1:1)}function U(l){return l.originalEvent.touches[0]}var eb=k.reel={footage:6,frame:1,frames:36,hint:"",horizontal:true,hotspot:n,indicator:0,klass:"",loops:true,reversed:n,spacing:0,
stitched:n,suffix:"-reel",tooltip:"",area:n,brake:0.5,clickfree:false,couple:n,cw:false,delay:-1,directional:false,draggable:true,entry:n,graph:n,image:n,images:[],inversed:false,laziness:8,monitor:n,maximum:100,minimum:0,opening:0,path:"",perpendicular:0,preloader:4,rebound:0.5,revolution:n,row:1,rows:0,speed:0,step:n,steps:n,tempo:18,timeout:2,throwable:true,value:n,vertical:false,wheelable:true};k.fn.reel=function(l){var a=k.extend({},eb,l);l=function(g){var d=[];g.filter(fb).each(function(){var c=
k(this),m=a.images.length&&a.images||a.image||c.attr(Ga),t=V(c.css(Ha)),v=V(c.css(Ia));!m||m==Ja||!t||!v||d.push(c)});g.filter(Ka+ha(w)).each(function(){d.push(k(this))});return k(d)}(this);var u=[],F=a.tempo/=gb?a.laziness:1,G=1E3/F;a.reversed&&(a.cw=true);a.tooltip&&(a.hint=a.tooltip);a.hotspot&&(a.area=a.hotspot);ka=ka||function g(){x.trigger(B);return setTimeout(g,G)}();l.each(function(){var g=k(this),d=function(f,b){g.data(f,b);g.trigger("store");return b},c=function(f){g.trigger("recall");return g.data(f)},
m=function(f){hb||delete this;return f},t={setup:function(f){if(g.hasClass(w))return m.call(f);var b=g.attr(Ga),e=g.attr(ib),j=g.attr("style"),h=a.images,i=a.stitched,q=a.loops,o={x:V(g.css(Ha)),y:V(g.css(Ia))},r=d(La,a.perpendicular&&a.footage||a.rows<=1&&h.length||a.frames),H=i?1:Ma(r/a.footage),la={display:"block",width:o.x,height:o.y};e="#"+e+a.suffix;var Na=g.attr("className"),ma={position:"relative",width:o.x,height:o.y};ma=k(N,{id:e.substr(1),className:Na+W+jb,css:ma});la=g.wrap(ma).attr({className:w,
style:la}).bind(t);u.push(la[0]);d(na,h.length&&h.length||a.image||b.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2"));d(Oa,Na);d(C,a.frame);d(Pa,a.spacing);d(D,o);d(p,0);d(oa,a.steps||a.frames);d(X,a.revolution||i/2||o.x*2);d(pa,H);d(Y,1/(r-(q&&!i?0:1)));d(kb,1/T(r,c(oa)));d(Qa,i);d(Ra,i-(q?0:o.x));d(Z,e);d(E,d(qa,a.speed)<0);d(I,0);d(y,(a.row-1)/(a.rows-1));d(J,a.value||0);d(K,a.vertical);d($,ja(1,!a.cw&&!i));d(Sa,{src:b,style:j||Ja});ka&&x.bind(B,t.tick);m.call(f);g.trigger("start")},
teardown:function(f){g.unbind(s).unbind(t);var b=g.data("events"),e=g.clone().attr(g.data(Sa)).removeClass(w).addClass(c(Oa));for(var j in b)k.each(b[j],function(h,i){e.bind(j+"."+i.namespace,i.handler,i.data)});k(c(Z)).before(e).detach();aa();x.unbind(ba).unbind(ca).unbind(B,t.tick).unbind(B,t.opening_tick);m.call(f)},start:function(){var f=c(D),b=c(La),e=T(b,c(oa));e=d(p,1/e*((a.step||a.frame)-1));d(C,e*b+1);g.attr("id");b=g.parent();e=k(N,{className:lb,css:{position:da,left:0,top:0,width:f.x,height:f.y,
background:ra,opacity:0}}).appendTo(b);e=d(sa,k(a.area||e));var j=g.add(a.couple);mb?e.css({WebkitUserSelect:"none",WebkitBackgroundSize:a.images.length?"auto":c(Qa)||f.x*a.footage+"px "+f.y*c(pa)*(a.rows||1)*(a.directional?2:1)+"px"}).bind(nb,function(h){j.trigger("down",[U(h).clientX,U(h).clientY,true]);return false}).bind(ob,function(h){j.trigger("slide",[U(h).clientX,U(h).clientY,true]);return false}).bind(pb,function(){j.trigger("up",[true]);return false}).bind(qb,function(){j.trigger("up",[true]);
return false}):e.css({cursor:"url("+Ta+"), "+ta}).bind(ca,function(h){j.trigger("over",[h.pageX,h.pageY])}).bind(rb,function(h,i){j.trigger("wheel",[i]);return false}).bind(sb,function(){j.trigger("play")}).bind(a.clickfree?tb:ub,function(h){j.trigger("down",[h.clientX,h.clientY]);return false}).bind(a.clickfree?vb:ba,function(){j.trigger("up");return false}).disableTextSelect();a.hint&&e.attr(wb,a.hint);a.monitor&&b.append(ua=k(N,{className:xb,css:{position:da,left:0,top:0}}))||(ua=k());a.indicator&&
b.append(Ua("x"));a.rows>1&&a.indicator&&b.append(Ua("y"));g.trigger("preload")},preload:function(f){var b=c(D),e=g.parent(),j=c(na),h=a.images;j=!h.length?[j]:[].concat(h);var i=g[0];i.frames=j.length;i.preloads=i.preloads||[];i.preloaded=i.preloaded||0;g.trigger("stop");for(e.append(va=k(N,{className:yb,css:{position:da,left:0,top:b.y-a.preloader,height:a.preloader,backgroundColor:ra}}));j.length;){h=new Image;var q=a.path+j.shift();e.append(k(h).hide().bind("load"+s,function(){i.preloaded++;va.css({width:1/
i.frames*i.preloaded*b.x});if(i.frames==i.preloaded){va.remove();a.value!=n&&g.trigger("valueChange",c(J));g.trigger(a.rows>1&&!a.stitched?"rowChange":"frameChange");m.call(f);g.trigger("loaded").attr({src:zb});g.trigger("opening")}}));h.src=q;i.preloads.push(h)}},tick:function(f){var b=c(I);if(O){var e=A(b-Ab*O);b=!(b*e<=0||b<z(e))&&d(I,b>z(c(qa))?e:(O=v=0))}ua.text(c(a.monitor));b&&O++;v&&v++;Va(0);g[0].value!=c(J)&&g.trigger("valueChange",g[0].value);if(v&&!b)return m.call(f);if(c(wa))return m.call(f,
L());e=c($)*ja(1,c(E));var j=(c(xa)?b:z(c(qa))+b)/a.tempo;b=c(p);e=d(p,b-j*e);m.call(f);e!=b&&g.trigger("fractionChange")},opening:function(){if(!a.opening)return g.trigger("fractionChange")&&Wa();var f=a.entry||a.speed,b=c(p),e=a.opening;d(p,b-f*a.opening);d(ya,e*F);g.trigger("stop");x.bind(B,t.opening_tick)},opening_tick:function(f){var b=(a.entry||a.speed)/a.tempo*(a.cw?-1:1),e=c(p);d(p,A(e+b));b=d(ya,c(ya)-1);g.trigger("fractionChange");m.call(f);if(!(b>1)){x.unbind(B,t.opening_tick);Wa()}},play:function(f){var b=
d(za,true);d(xa,!b);Xa();m.call(f)},pause:function(f){d(za,false);L();m.call(f)},stop:function(f){var b=d(xa,true);d(za,!b);m.call(f)},down:function(f,b,e,j){if(!a.draggable)return m.call(f);d(wa,true);d(I,0);ea(b,e,c(p),c(X),c(y));fa={x:n,y:n};L();aa();!j&&x.bind(ca,function(h){g.trigger("slide",[h.clientX,h.clientY]);m.call(h)}).css({cursor:ia(Bb)+", "+ta})&&!a.clickfree&&x.bind(ba,function(h){g.trigger("up");m.call(h)})&&c(sa);m.call(f)},up:function(f,b){if(!a.draggable)return m.call(f);d(wa,false);
var e=d(I,!a.throwable?0:z(P[0]+P[1])/60);O=e?1:0;e?Xa():L();aa();!b&&x.unbind(ba).unbind(ca)&&c(sa).css({cursor:ia(Ta)+", "+ta});m.call(f)},slide:function(f,b,e){if(!a.draggable)return m.call(f);var j=c(X),h=c(Ya),i=c(K),q=Va(i?e-fa.y:b-fa.x||0);i=d(p,Za(i?e-h.y:b-h.x,c(Aa),j,c(Ba),c(Ca),c($)));q&&d(E,q<0);if(a.perpendicular)var o=a.perpendicular,r=a.footage,H=c(C);if(a.perpendicular&&(H<=o||H>=r-o+2&&H<=r+o-1||H==2*r-o+2)){d(K,z(e-h.y)>z(b-h.x));h=ea(b,e,i,j,c(y))}if(a.rows>1){q=c(D).y;o=c($a);
r=-o*q;d(y,A(k.reel.math.envelope(e-h.y,o,q,r,r+q,-1)))}!(i%1)&&!a.loops&&ea(b,e,i,j,c(y));L();fa={x:b,y:e};m.call(f);g.trigger("fractionChange")},wheel:function(f,b){if(!a.wheelable)return m.call(f);var e=Ma(Cb(z(b))/2);e=ja(e,b>0);b=0.2*c(X);ea(n,n,c(p),b,c(y));d(p,Za(e,c(Aa),b,c(Ba),c(Ca),c($)));e&&d(E,e<0);d(I,0);L();m.call(f);g.trigger("fractionChange");return false},fractionChange:function(f,b,e){b=!b?c(p):d(p,b);b=a.loops?b-Q(b):S(0,1,b);b=d(p,A(b));d(C,1+Q(b/c(Y)));d(J,A(k.reel.math.interpolate(b,
a.minimum,a.maximum)));if(!a.loops&&a.rebound){!v&&!(b%1)?Da++:(Da=0);Da>=a.rebound*1E3/a.tempo&&d(E,!c(E))}m.call(f);e||g.trigger("valueChange");g.trigger(a.rows>1&&!a.stitched?"rowChange":"frameChange")},rowChange:function(f,b){var e=Q(c(p)/c(Y))+1;b=d(y,S(0,1,A(b!=n?(b-1)/(a.rows-1):c(y))));d(C,e+(a.rows<=1?0:R(b*(a.rows-1))*a.frames));m.call(f);g.trigger("frameChange")},frameChange:function(f,b){var e=!b?c(p):d(p,A(c(Y)*(b-1)));b=d(C,R(b?b:c(C)));var j=a.images,h=a.footage,i=c(D),q=a.horizontal;
if(c(K)){b=a.inversed?h+1-b:b;b+=h}if(a.stitched)q=[-R(e*c(Ra))+M,0+M];else{var o=b%h-1;o=o<0?h-1:o;var r=Q((b-0.1)/h);r+=a.rows>1?0:c(E)?0:c(pa);h=c(Pa);r=r*((q?i.y:i.x)+h);o=o*((q?i.x:i.y)+h);q=j.length?[0,0]:q?[-o+M,-r+M]:[-r+M,-o+M]}b=j[b-1]||c(na);j=(c(K)?i.y:i.x)-a.indicator;e=S(0,j,R(k.reel.math.interpolate(e,-1,j+2)));e=!a.cw||a.stitched?e:j-e;j={background:ia(a.path+b)+W+q.join(W)};a.images.length?g.attr({src:a.path+b}):g.css(j);k(ha(Ea+".x"),c(Z)).css(c(K)?{left:0,top:e}:{left:e,top:i.y-
a.indicator});if(a.rows<=1)return m.call(f);i=c(D).y-a.indicator;i=S(0,i,R(k.reel.math.interpolate(c(y),-1,i+2)));k(ha(Ea+".y"),c(Z)).css({top:i});m.call(f)},valueChange:function(f,b){f=b!==n&&d(p,b/(a.maximum-a.minimum));g[0].value=b===n?c(J):d(J,b);f===false||g.trigger("fractionChange",[n,true])}},v,O=0,Xa=function(){return v=0},L=function(){clearTimeout(ab);x.unbind(B,t.opening_tick);g.trigger("play");return v=-a.timeout*a.tempo},ab,Wa=function(){ab=setTimeout(function(){g.trigger("play")},a.delay*
1E3||0)},ua,va,Ua=function(f){return k(N,{className:[Ea,f].join(W),css:{width:a.indicator,height:a.indicator,top:c(D).y-a.indicator,left:0,position:da,backgroundColor:ra}})},Da=0,fa={x:0,y:0},Va=function(f){return P.push(f)&&P.shift()&&f},aa=function(){return P=[0,0]},P=aa(),Ab=a.brake/a.tempo,Za=a.graph||k.reel.math[a.loops?"hatch":"envelope"],ea=function(f,b,e,j,h){d(Aa,e);d($a,h);d(Ba,a.loops?0:-e*j);d(Ca,a.loops?j:j-e*j);return f&&d(Ya,{x:f,y:b})||n};t.setup()});return k(u)};k.reel.math={envelope:function(l,
a,u,F,G,g){return a+T(F,Fa(G,-l*g))/u},hatch:function(l,a,u,F,G,g){l=(l<F?G:0)+l%G;l=a+-l*g/u;return l-Q(l)},interpolate:function(l,a,u){return a+l*(u-a)}};db("mousewheel disableTextSelect enableTextSelect".split(/ /));var x=k(bb);ga=navigator.userAgent;var mb=/iphone|ipod|ipad|android/i.test(ga),gb=/iphone|ipod|ipad/i.test(ga),hb=k.browser.msie,ta="ew-resize",ka,w="jquery-reel",jb=w+"-overlay",Ea=w+"-indicator",yb=w+"-preloader",xb=w+"-monitor",lb=w+"-interface",zb="data:image/gif;base64,R0lGODlhCAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7",
Ta="data:image/gif;base64,R0lGODlhEAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAI3lC8AeBDvgosQxQtne7yvLWGStVBelXBKqDJpNzLKq3xWBlU2nUs4C/O8cCvU0EfZGUwt19FYAAA7",Bb="data:image/gif;base64,R0lGODlhEAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAIslI95EB3MHECxNjBVdE/5b2zcRV1QBabqhwltq41St4hj5konmVioZ6OtEgUAOw==",R=Math.round,Q=Math.floor,Ma=Math.ceil,Fa=Math.min,T=Math.max,z=Math.abs,Cb=Math.sqrt,V=parseInt,sa="area",Sa="backup",E="backwards",Y="bit",Oa="classes",wa="clicked",Ya="clicked_location",
Aa="clicked_on",$a="clicked_row",$="cwish",D="dimensions",p="fraction",C="frame",La="frames",Ca="hi",na="image",ya="opening_ticks",Ba="lo",za="playing",X="revolution",y="row",pa="rows",Pa="spacing",qa="speed",Z="stage",oa="steps",Qa="stitched",Ra="stitched_travel",xa="stopped",J="value",I="velocity",K="vertical",kb="wheel_step",s=".reel",sb="dblclick"+s,ub="mousedown"+s,tb="mouseenter"+s,vb="mouseleave"+s,ca="mousemove"+s,ba="mouseup"+s,rb="mousewheel"+s,B="tick"+s,qb="touchcancel"+s,pb="touchend"+
s,nb="touchstart"+s,ob="touchmove"+s,Ja="",W=" ",da="absolute",Ka="div",N=cb(Ka),Ia="height",ra="#000",ib="id",fb="img",M="px",Ga="src",wb="title",Ha="width"}(jQuery,window,document);
